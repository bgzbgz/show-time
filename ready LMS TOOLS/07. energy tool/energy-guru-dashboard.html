<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Sprint - Guru Dashboard</title>
    <link rel="icon" type="image/png" href="favicon/favicon-16x16.png">
    
    <style>
        @font-face {
            font-family: 'Plaak';
            src: url('fonts/Plaak3Trial-43-Bold.otf') format('opentype');
            font-weight: bold;
        }
        @font-face {
            font-family: 'Riforma';
            src: url('fonts/RiformaLL-Regular.otf') format('opentype');
        }
        @font-face {
            font-family: 'Monument';
            src: url('fonts/MonumentGrotesk-Mono.otf') format('opentype');
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Riforma', sans-serif;
            background: #000;
            color: #fff;
            line-height: 1.6;
        }
        
        .plaak {
            font-family: 'Plaak', sans-serif;
            line-height: 1.2;
            letter-spacing: -0.01em;
        }
        
        .monument {
            font-family: 'Monument', monospace;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }
        
        .header {
            border-bottom: 2px solid #fff;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: #1a1a1a;
            border: 2px solid #fff;
            padding: 24px;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            background: #2a2a2a;
            transform: scale(1.02);
        }
        
        .stat-number {
            font-size: 56px;
            font-family: 'Plaak';
            margin-bottom: 8px;
        }
        
        .stat-label {
            opacity: 0.7;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .submission-grid {
            display: grid;
            gap: 20px;
        }
        
        .submission-card {
            background: #1a1a1a;
            border: 2px solid #fff;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .submission-card:hover {
            background: #2a2a2a;
            border-color: #FFF469;
        }
        
        .submission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #444;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        
        .status-complete {
            background: #10B981;
            color: #000;
        }
        
        .pillar-ratings {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        
        .pillar-rating {
            text-align: center;
            padding: 12px;
            background: #000;
            border: 1px solid #fff;
        }
        
        .pillar-rating-number {
            font-size: 28px;
            font-family: 'Plaak';
            margin-bottom: 4px;
        }
        
        .pillar-rating-label {
            font-size: 11px;
            opacity: 0.7;
            text-transform: uppercase;
        }
        
        .btn-primary {
            background: #fff;
            color: #000;
            border: 2px solid #fff;
            padding: 16px 32px;
            font-family: 'Plaak';
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }
        
        .btn-primary:hover {
            background: #FFF469;
            border-color: #FFF469;
            transform: scale(1.02);
        }
        
        .btn-primary:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: #444;
            border-color: #444;
            color: #888;
        }
        
        .input-field {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            background: #1a1a1a;
            color: #fff;
            border: 2px solid #fff;
            font-family: 'Riforma';
            transition: border-color 0.2s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #FFF469;
        }
        
        .habit-display {
            margin-top: 16px;
            padding: 12px;
            background: #000;
            font-size: 13px;
            border-left: 3px solid #FFF469;
        }
        
        .habit-display strong {
            color: #FFF469;
            display: block;
            margin-bottom: 4px;
        }
        
        .expanded-section {
            margin-top: 12px;
            padding: 16px;
            background: #0a0a0a;
            border-left: 3px solid #fff;
        }
        
        .expanded-section h4 {
            font-family: 'Plaak';
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .expanded-section p {
            font-size: 13px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const CONFIG = {
            LOAD_SUBMISSIONS_WEBHOOK: 'https://n8n-edge.fasttrack-diagnostic.com/webhook/energy-guru-view',
            TEAM_TOOL_URL: './energy-team-meeting-tool.html'
        };
        
        function GuruDashboard() {
            const [companyId, setCompanyId] = useState('');
            const [submissions, setSubmissions] = useState([]);
            const [loading, setLoading] = useState(false);
            const [stats, setStats] = useState(null);
            const [expandedCard, setExpandedCard] = useState(null);
            
            const loadSubmissions = async () => {
                if (!companyId) {
                    alert('Please enter a Company ID');
                    return;
                }
                
                setLoading(true);
                try {
                    const response = await fetch(`${CONFIG.LOAD_SUBMISSIONS_WEBHOOK}?companyId=${encodeURIComponent(companyId)}`);
                    const data = await response.json();
                    
                    if (data.error) {
                        alert(data.message || 'No submissions found for this company');
                        setLoading(false);
                        return;
                    }
                    
                    setSubmissions(data.submissions || []);
                    setStats({
                        total: data.totalTeamMembers || data.submissions?.length || 0,
                        completed: data.submissions?.length || 0,
                        avgOverall: data.averageRatings?.overall || 'N/A',
                        lowestPillar: data.lowestPillar || 'N/A'
                    });
                } catch (error) {
                    console.error('Failed to load submissions:', error);
                    alert('Failed to load submissions. Check console for details.');
                }
                setLoading(false);
            };
            
            const startTeamMeeting = () => {
                window.location.href = `${CONFIG.TEAM_TOOL_URL}?companyId=${companyId}`;
            };
            
            const toggleCard = (submissionId) => {
                setExpandedCard(expandedCard === submissionId ? null : submissionId);
            };
            
            // Login screen
            if (!stats) {
                return (
                    <div className="container">
                        <div style={{maxWidth: '600px', margin: '100px auto', textAlign: 'center'}}>
                            <img src="logo/FastTrack_F_White.png" alt="Fast Track" style={{width: '80px', height: '80px', margin: '0 auto 40px'}} />
                            
                            <h1 className="plaak" style={{fontSize: '64px', marginBottom: '20px'}}>
                                GURU DASHBOARD
                            </h1>
                            
                            <p style={{fontSize: '20px', marginBottom: '40px', opacity: 0.8}}>
                                Energy Sprint - View all team submissions
                            </p>
                            
                            <div style={{marginBottom: '20px'}}>
                                <input 
                                    type="text"
                                    placeholder="Company ID (e.g., acme_corp)"
                                    value={companyId}
                                    onChange={(e) => setCompanyId(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && loadSubmissions()}
                                    className="input-field"
                                />
                            </div>
                            
                            <button 
                                onClick={loadSubmissions}
                                disabled={!companyId || loading}
                                className="btn-primary"
                            >
                                {loading ? 'Loading...' : 'View Dashboard'}
                            </button>
                            
                            <p style={{marginTop: '40px', opacity: 0.5, fontSize: '14px'}}>
                                Press Enter or click button to continue
                            </p>
                        </div>
                    </div>
                );
            }
            
            // Dashboard view
            return (
                <div className="container">
                    <div className="header">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                            <div>
                                <h1 className="plaak" style={{fontSize: '48px', marginBottom: '8px'}}>
                                    ENERGY SPRINT DASHBOARD
                                </h1>
                                <p className="monument" style={{fontSize: '12px', opacity: 0.7}}>
                                    Company: {companyId} | {stats.completed} submissions
                                </p>
                            </div>
                            <button 
                                onClick={() => {setStats(null); setSubmissions([]); setCompanyId('');}}
                                style={{
                                    background: 'transparent',
                                    border: '1px solid #fff',
                                    color: '#fff',
                                    padding: '8px 16px',
                                    cursor: 'pointer',
                                    fontSize: '12px'
                                }}
                            >
                                ← Change Company
                            </button>
                        </div>
                    </div>
                    
                    {/* Stats */}
                    <div className="stats-grid">
                        <div className="stat-card animate-in">
                            <div className="stat-number">{stats.completed}</div>
                            <div className="stat-label">Submissions</div>
                        </div>
                        <div className="stat-card animate-in" style={{animationDelay: '0.1s'}}>
                            <div className="stat-number">{stats.total}</div>
                            <div className="stat-label">Team Size</div>
                        </div>
                        <div className="stat-card animate-in" style={{animationDelay: '0.2s'}}>
                            <div className="stat-number">{stats.avgOverall}</div>
                            <div className="stat-label">Avg Rating</div>
                        </div>
                        <div className="stat-card animate-in" style={{animationDelay: '0.3s'}}>
                            <div className="stat-number" style={{fontSize: '32px'}}>
                                {stats.lowestPillar}
                            </div>
                            <div className="stat-label">Weakest Pillar</div>
                        </div>
                    </div>
                    
                    {/* Start Meeting Button */}
                    <div style={{marginBottom: '40px', textAlign: 'center', padding: '40px', background: '#1a1a1a', border: '2px solid #fff'}}>
                        <p className="monument" style={{fontSize: '12px', marginBottom: '16px', opacity: 0.7}}>
                            {stats.completed === 0 ? 
                                'WAITING FOR SUBMISSIONS...' : 
                                `${stats.completed} PROTOCOLS READY TO REVIEW`
                            }
                        </p>
                        <button 
                            onClick={startTeamMeeting}
                            disabled={stats.completed === 0}
                            className="btn-primary"
                            style={{fontSize: '24px', padding: '20px 48px'}}
                        >
                            START TEAM MEETING →
                        </button>
                    </div>
                    
                    {/* Submissions List */}
                    <h2 className="plaak" style={{fontSize: '36px', marginBottom: '24px', borderBottom: '2px solid #fff', paddingBottom: '12px'}}>
                        INDIVIDUAL SUBMISSIONS
                    </h2>
                    
                    {submissions.length === 0 ? (
                        <div style={{textAlign: 'center', padding: '60px', opacity: 0.5}}>
                            <p style={{fontSize: '20px'}}>No submissions yet for this company</p>
                        </div>
                    ) : (
                        <div className="submission-grid">
                            {submissions.map((sub, idx) => (
                                <div 
                                    key={sub._id} 
                                    className="submission-card animate-in"
                                    style={{animationDelay: `${idx * 0.05}s`}}
                                    onClick={() => toggleCard(sub._id)}
                                >
                                    <div className="submission-header">
                                        <div>
                                            <h3 className="plaak" style={{fontSize: '28px', marginBottom: '4px'}}>
                                                {sub.userName}
                                            </h3>
                                            <p style={{opacity: 0.6, fontSize: '13px'}} className="monument">
                                                {new Date(sub.submittedAt).toLocaleString()}
                                            </p>
                                        </div>
                                        <span className="status-badge status-complete">
                                            ✓ COMPLETE
                                        </span>
                                    </div>
                                    
                                    {/* Pillar Ratings */}
                                    <div className="pillar-ratings">
                                        {['sleep', 'food', 'movement', 'brain'].map(pillar => (
                                            <div key={pillar} className="pillar-rating">
                                                <div className="pillar-rating-number">
                                                    {sub.toolData[`${pillar}Rating`] || 'N/A'}
                                                </div>
                                                <div className="pillar-rating-label">{pillar}</div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {/* Key Habits Summary */}
                                    <div className="habit-display">
                                        <strong>SLEEP HABIT</strong>
                                        {sub.toolData.sleepKeyHabit || 'Not set'}
                                    </div>
                                    
                                    {/* Expanded Details */}
                                    {expandedCard === sub._id && (
                                        <div className="expanded-section">
                                            <h4 className="plaak" style={{fontSize: '18px', marginBottom: '16px'}}>
                                                ALL HABITS & MENTAL ENERGY
                                            </h4>
                                            
                                            {/* All Pillars */}
                                            {['sleep', 'food', 'movement', 'brain'].map(pillar => (
                                                <div key={pillar} style={{marginBottom: '16px', paddingBottom: '16px', borderBottom: '1px solid #333'}}>
                                                    <h4 style={{textTransform: 'uppercase', marginBottom: '8px'}}>
                                                        {pillar} ({sub.toolData[`${pillar}Rating`]}/10)
                                                    </h4>
                                                    <p><strong>Habit:</strong> {sub.toolData[`${pillar}KeyHabit`] || 'N/A'}</p>
                                                    <p><strong>Trigger:</strong> {sub.toolData[`${pillar}Trigger`] || 'N/A'}</p>
                                                    <p><strong>Reward:</strong> {sub.toolData[`${pillar}Reward`] || 'N/A'}</p>
                                                    <p><strong>Partner:</strong> {sub.toolData[`${pillar}AccountabilityPartner`] || 'N/A'}</p>
                                                </div>
                                            ))}
                                            
                                            {/* Mental Energy */}
                                            <div style={{marginTop: '16px', padding: '12px', background: '#000', borderLeft: '3px solid #FFF469'}}>
                                                <h4 className="plaak" style={{fontSize: '16px', marginBottom: '12px'}}>
                                                    MENTAL ENERGY WISDOM
                                                </h4>
                                                <p><strong>STOP:</strong> {sub.toolData.stopDoing1}, {sub.toolData.stopDoing2}, {sub.toolData.stopDoing3}</p>
                                                <p><strong>DO MORE:</strong> {sub.toolData.doMore1}, {sub.toolData.doMore2}, {sub.toolData.doMore3}</p>
                                            </div>
                                            
                                            <p style={{marginTop: '16px', opacity: 0.6, fontSize: '12px'}}>
                                                Click card again to collapse
                                            </p>
                                        </div>
                                    )}
                                    
                                    {!expandedCard || expandedCard !== sub._id ? (
                                        <p style={{marginTop: '12px', opacity: 0.5, fontSize: '12px', textAlign: 'center'}}>
                                            Click to view all habits & mental energy →
                                        </p>
                                    ) : null}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GuruDashboard />);
    </script>
</body>
</html>

