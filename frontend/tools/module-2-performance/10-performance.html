<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Analysis & Accountability | Fast Track</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../shared/js/transition-screen.js"></script>
    <script src="../../js/tool-access-control.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preload" href="Plaak3Trial-43-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="RiformaLL-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="MonumentGrotesk-Mono.woff2" as="font" type="font/woff2" crossorigin>
    <style>
        @font-face { font-family: 'Plaak'; src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: normal; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: 600; font-display: swap; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); font-display: swap; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Riforma', -apple-system, sans-serif; font-size: 16px; color: #000; background: #000; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }
        * { scrollbar-width: thin; scrollbar-color: #000 transparent; }
        .plaak { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }
        .tool-frame { background: #fff; min-height: 100vh; }
        .tool-inner { background: #fff; min-height: 100vh; }
        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; padding: 0 48px; }
        .wizard-content { max-width: 100%; padding: 40px 0; flex: 1; }
        .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }
        .sidebar-tool-num { font-family: 'Monument', monospace; font-size: 10px; color: #fff; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 8px; }
        .sidebar-tool-title { font-family: 'Plaak', sans-serif; font-size: 22px; color: #fff; margin-bottom: 32px; line-height: 1.1; }
        .sidebar-step { padding: 8px 0; border-bottom: 1px solid #2a2a2a; cursor: default; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s; }
        .sidebar-step:last-child { border-bottom: none; }
        .sidebar-step-dot { width: 6px; height: 6px; border-radius: 50%; background: #555; flex-shrink: 0; transition: background 0.2s; }
        .sidebar-step-dot.active { background: #FFF469; }
        .sidebar-step-dot.done { background: #4ade80; }
        .sidebar-step-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.08em; color: #555; text-transform: uppercase; transition: color 0.2s; }
        .sidebar-step-label.active { color: #FFF469; }
        .sidebar-step-label.done { color: #4ade80; }
        .sidebar-divider { width: 100%; height: 1px; background: #333; margin: 12px 0; }
        .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .step-time { font-family: 'Monument', monospace; font-size: 11px; color: #6B7280; }
        .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; text-transform: uppercase; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
        .step-hint { font-size: 16px; color: #6B7280; line-height: 1.5; margin: 0 0 32px 0; }
        .field-label { font-weight: 600; font-size: 16px; color: #000; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .ft-required { color: #DC2626; font-weight: 700; }
        .field-input { width: 100%; height: 44px; padding: 8px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .field-input:focus { outline: none; border-color: #000; }
        .field-textarea { width: 100%; min-height: 120px; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; resize: none !important; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .field-textarea:focus { outline: none; border-color: #000; }
        .field-help { font-size: 14px; color: #6B7280; margin-top: 4px; line-height: 1.5; }
        .field-group { margin-bottom: 24px; }
        .field-group:last-child { margin-bottom: 0; }
        .ft-section { margin-bottom: 32px; }
        .ft-insight { background: #FFF469; border: 3px solid #000; padding: 16px; margin-bottom: 32px; }
        .ft-example { background: #F3F4F6; padding: 16px; margin-bottom: 8px; font-size: 14px; line-height: 1.6; color: #1F2937; }
        .wizard-footer { display: flex; justify-content: space-between; align-items: center; padding: 24px 48px; border-top: 1px solid #E5E7EB; background: #fff; }
        .btn-wiz-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 12px 28px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-back:hover { border-color: #000; color: #000; }
        .btn-wiz-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 36px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-next:hover:not(:disabled) { background: #FFF469; color: #000; border-color: #FFF469; }
        .btn-wiz-next:disabled { background: #E0E0E0; color: #9CA3AF; border-color: #E0E0E0; cursor: not-allowed; }
        .opening-box { margin-bottom: 32px; }
        .step-content { max-width: 100%; padding: 40px 0; flex: 1; }
        .numbered-section { background: #000; color: #fff; padding: 8px 14px; font-size: 14px; font-weight: bold; letter-spacing: 0.5px; display: inline-block; font-family: 'Monument', monospace; }
        .mobile-step-bar { display: none; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; background: #F3F4F6; }
        .mobile-step-bar .bar-text { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 6px; }
        .mobile-progress { height: 3px; background: #E5E7EB; width: 100%; }
        .mobile-progress-fill { height: 100%; background: #000; transition: width 0.3s ease; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeSlideIn 0.3s ease-out; }
        @media print { .no-print { display: none !important; } }
        @media (max-width: 768px) { .wizard-sidebar { display: none; } .mobile-step-bar { display: block; } .wizard-main { padding: 0 24px; } .wizard-content { padding: 24px 0; } .step-heading { font-size: 24px; } .btn-footer { padding: 12px 16px; } }
        @media (max-width: 480px) { .step-heading { font-size: 20px; } .wizard-content { padding: 20px 12px; } }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CONFIG = {
        TOOL_SLUG: 'performance',
        AUTOSAVE_DELAY: 2000,
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'What gets measured gets managed — but most companies track vanity metrics that feel good and tell you nothing actionable. If you cannot link a KPI to a specific decision, you are measuring the wrong thing.',
                peerProof: '"A €12M B2B firm had 23 KPIs on their dashboard. After this analysis, they kept 5. Revenue clarity improved. Leadership focus shifted. They grew 34% the following year with the same team and budget."'
            },
            2: {
                brutalTruth: 'Task tracking without root cause analysis is just documenting failure. You can monitor every task and still not know why performance is off. The 5 Whys does not take long — avoiding it does.',
                peerProof: '"A manufacturing CEO spent 6 months trying to improve delivery performance by adding more tracking. One 5-Whys session revealed the actual cause: a single scheduling conflict in the ERP system. Fixed in a day. Delivery improved 40%."'
            },
            3: {
                brutalTruth: '80% of your results come from 20% of your actions. But most organizations protect all their activities equally. The companies that break away from the pack are the ones that explicitly defund the 80% to double down on the 20%.',
                peerProof: '"A €8M professional services firm mapped their revenue by client type. The top 20% of clients generated 71% of revenue — and received the same service level as the bottom 80%. After rebalancing, revenue grew 45% in 18 months."'
            },
            4: {
                brutalTruth: 'Accountability without consequences is a suggestion. Clear expectations, public tracking, and real follow-through are not management theatre — they are the system that separates high-performance teams from mediocre ones.',
                peerProof: '"One leadership team replaced their monthly status update meetings with a weekly 15-minute accountability dashboard review. Ownership improved visibly within 30 days. The CEO described it as the single highest-leverage management change they had made in 5 years."'
            }
        },
        CLOSING_MESSAGES: {
            1: { title: 'GOALS TRACKED', text: 'Your performance dashboard is defined. Next: find the root causes of current gaps.' },
            2: { title: 'ROOT CAUSES FOUND', text: 'You know what is actually driving your results. Next: apply the 80/20 lens.' },
            3: { title: '80/20 MAPPED', text: 'Your vital few are identified. Next: build the accountability system to hold them.' },
            4: { title: 'ACCOUNTABILITY SET', text: 'Your performance system is complete. Review it weekly. What gets reviewed gets done.' }
        }
    };

    ToolDB.init(CONFIG.TOOL_SLUG);
    ToolAccessControl.init(CONFIG.TOOL_SLUG);

    window.CognitiveLoad && CognitiveLoad.init('performance', {
        insights: [
            "What gets measured gets managed. But what gets measured WRONG gets gamed.",
            "Binary task tracking (done/not done) eliminates the gray zone. No more 80% complete.",
            "The Theory of Constraints says your system is only as strong as its weakest link. Find it. Fix it. Repeat."
        ],
        caseStudy: {
            before: "A 30-person SaaS company tracked effort instead of outcomes. Teams reported being 'busy' but quarterly targets were missed 60% of the time. No one owned specific metrics, and performance reviews happened once a year — too late to course-correct.",
            after: "After implementing binary task tracking, weekly dashboards, and the 5 Whys for root cause analysis, task completion jumped from 55% to 88% in one quarter. The accountability framework gave every task a single owner with clear consequences.",
            quote: "Once we stopped tracking effort and started tracking outcomes, everything changed. The 5 Whys revealed our real bottleneck was onboarding, not capacity. — Operations Director, SaaS company"
        }
    });
    const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy } = CognitiveLoad.components;

    const MEETING_AGENDA = [
        { time: '5 min', title: 'Objective Setting', desc: 'Brief recap of sprint goals and meeting objectives.', questions: ['What are the key outcomes we need from this meeting?'], pitfalls: ['Skipping the objective and diving into discussion without alignment.'] },
        { time: '25 min', title: 'Performance Analysis System', desc: 'Review proposed system structure: tasks done/not done, reasons for gaps, improvement commitments.', questions: ['Are tasks and metrics defined clearly for all team members?', 'Is there a binary approach (done/not done) to task evaluation?', 'Are dashboards designed to track individual and team metrics?'], pitfalls: ['Using vague metrics instead of binary done/not-done.', 'Designing dashboards nobody will actually check.'] },
        { time: '25 min', title: 'Accountability & Consequences System', desc: 'Review the Accountability Checklist and key practices. Align on the consequences framework.', questions: ['Are roles and responsibilities clearly assigned?', 'Is the consequences framework transparent and fair?', 'Are timelines realistic and agreed upon?'], pitfalls: ['Making consequences punitive instead of constructive.', 'Leaving tasks without a single clear owner.'] },
        { time: '5 min', title: 'Action Plan & Closing', desc: 'Confirm Who, What, When for all agreed actions.', questions: ['Does every action have a single owner and deadline?'], pitfalls: ['Ending without written commitments.'] }
    ];

    /* === SHARED COMPONENTS === */
    function CheckIcon({ color = "#fff", size = 16 }) {
        return <svg width={size} height={size} viewBox="0 0 24 24" fill={color}><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>;
    }
    function LockIcon({ size = 16 }) {
        return <svg width={size} height={size} viewBox="0 0 24 24" fill="#9CA3AF"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>;
    }
    function ButtonFooter({ onBack, onNext, nextLabel = 'Next', showBack = true, disabled = false }) {
        return (
            <div className="wizard-footer no-print">
                {showBack ? <button className="btn-wiz-back" onClick={onBack}>&larr; Back</button> : <div />}
                <button className="btn-wiz-next" disabled={disabled} onClick={onNext}>{nextLabel} &rarr;</button>
            </div>
        );
    }
    function MobileStepBar({ step, total }) {
        return (
            <div className="mobile-step-bar no-print">
                <div className="bar-text">Step {step} of {total}</div>
                <div className="mobile-progress"><div className="mobile-progress-fill" style={{ width: `${Math.round((step / total) * 100)}%` }} /></div>
            </div>
        );
    }

    /* === STEP 1: GOAL SETTING & PERFORMANCE MONITORING === */

    const GOAL_PLACEHOLDERS = [
        { goal: 'e.g. Increase monthly revenue to €100K', kpi: 'e.g. Monthly revenue dashboard, weekly pipeline report', countermeasure: 'e.g. Maintain gross margin above 40%', q1: 'e.g. €70K/month', q2: 'e.g. €80K/month', q3: 'e.g. €90K/month', q4: 'e.g. €100K/month' },
        { goal: 'e.g. Achieve 88% weekly task completion rate', kpi: 'e.g. Binary done/not-done tracker, Monday review', countermeasure: 'e.g. No more than 10% of tasks reassigned per week', q1: 'e.g. 70% completion', q2: 'e.g. 78% completion', q3: 'e.g. 84% completion', q4: 'e.g. 88% completion' },
        { goal: 'e.g. Reduce customer churn from 8% to 4%', kpi: 'e.g. Monthly churn rate, NPS score', countermeasure: 'e.g. Maintain customer acquisition cost below €200', q1: 'e.g. Map churn reasons', q2: 'e.g. Launch retention program', q3: 'e.g. Churn to 5.5%', q4: 'e.g. Churn to 4%' },
        { goal: 'e.g. Launch 3 new product features', kpi: 'e.g. Feature release dates, user adoption rate', countermeasure: 'e.g. Maintain code quality above 90% test coverage', q1: 'e.g. Feature 1 shipped', q2: 'e.g. Feature 2 shipped', q3: 'e.g. Feature 3 shipped', q4: 'e.g. Adoption >40%' },
        { goal: 'e.g. Improve employee engagement score from 6.2 to 8.0', kpi: 'e.g. Quarterly engagement survey, 1-on-1 feedback', countermeasure: 'e.g. Keep voluntary turnover below 10%', q1: 'e.g. Baseline survey', q2: 'e.g. Score to 7.0', q3: 'e.g. Score to 7.5', q4: 'e.g. Score to 8.0' }
    ];

    function Step1({ d, u, goalIndex, setGoalIndex }) {
        const goals = d.goals || Array(5).fill(null).map(() => ({ goal: '', kpi: '', countermeasure: '', q1: '', q2: '', q3: '', q4: '' }));
        const updateGoal = (i, f, v) => { const next = [...goals]; next[i] = { ...next[i], [f]: v }; u('goals', next); };
        const i = goalIndex;
        const g = goals[i] || { goal: '', kpi: '', countermeasure: '', q1: '', q2: '', q3: '', q4: '' };
        const ph = GOAL_PLACEHOLDERS[i] || GOAL_PLACEHOLDERS[0];
        const filledCount = goals.filter(gl => (gl.goal || '').trim()).length;

        return (
            <div className="step-content animate-in" key={i}>
                <div className="step-indicator"><span>Step 1 of 6 · Goal {i + 1} of 5</span><span className="step-time">~2 min each</span></div>
                <div className="opening-box">
                <h2 className="step-heading">GOAL SETTING & MONITORING</h2>
                <p className="step-hint">Define specific, measurable goals for the year. Break each into quarterly deliverables with clear KPIs and countermeasures.</p>
                </div>

                {/* Goal progress dots */}
                <div style={{ display: 'flex', gap: 8, marginBottom: 24 }}>
                    {goals.map((gl, idx) => (
                        <button key={idx} onClick={() => setGoalIndex(idx)}
                            style={{
                                width: 36, height: 36, borderRadius: '50%', border: idx === i ? '2px solid #000' : '2px solid #E5E7EB',
                                background: (gl.goal || '').trim() ? (idx === i ? '#000' : '#E5E7EB') : (idx === i ? '#000' : 'transparent'),
                                color: idx === i ? '#fff' : (gl.goal || '').trim() ? '#374151' : '#9CA3AF',
                                fontWeight: 600, fontSize: 14, cursor: 'pointer', fontFamily: "'Monument', monospace",
                                display: 'flex', alignItems: 'center', justifyContent: 'center'
                            }}>
                            {idx + 1}
                        </button>
                    ))}
                </div>

                <div style={{ border: '2px solid #000', padding: 24, marginBottom: 24 }}>
                    <div className="numbered-section" style={{ marginBottom: 16 }}>GOAL {i + 1}</div>
                    {i === 0 && (
                        <div className="ft-example" style={{ marginBottom: 16 }}>Your Wildly Important Goal (WIG) — the one critical objective that outshines all others. The countermeasure prevents over-focus at the expense of other priorities.</div>
                    )}
                    <div className="field-group">
                        <label className="field-label">NUMERIC GOAL {i === 0 && <span className="ft-required">*</span>}</label>
                        <input className="field-input" placeholder={ph.goal} value={g.goal} onChange={e => updateGoal(i, 'goal', e.target.value)} />
                    </div>
                    <div className="field-group">
                        <label className="field-label">KPI (HOW YOU'LL MEASURE)</label>
                        <input className="field-input" placeholder={ph.kpi} value={g.kpi} onChange={e => updateGoal(i, 'kpi', e.target.value)} />
                    </div>
                    <div className="field-group">
                        <label className="field-label">COUNTERMEASURE</label>
                        <input className="field-input" placeholder={ph.countermeasure} value={g.countermeasure} onChange={e => updateGoal(i, 'countermeasure', e.target.value)} />
                        <div className="field-help">What safeguard prevents over-focus on this goal at the expense of other priorities?</div>
                    </div>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr 1fr', gap: 8, marginTop: 16 }}>
                        {['q1', 'q2', 'q3', 'q4'].map(q => (
                            <div key={q}>
                                <label className="field-label" style={{ fontSize: 11 }}>{q.toUpperCase()} TARGET</label>
                                <input className="field-input" style={{ fontSize: 14 }} placeholder={ph[q]} value={g[q]} onChange={e => updateGoal(i, q, e.target.value)} />
                            </div>
                        ))}
                    </div>
                </div>

                {/* Navigation between goals */}
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 24 }}>
                    <button onClick={() => i > 0 && setGoalIndex(i - 1)}
                        style={{ background: 'none', border: '2px solid #E5E7EB', padding: '8px 20px', cursor: i > 0 ? 'pointer' : 'not-allowed', opacity: i > 0 ? 1 : 0.3, fontFamily: "'Monument', monospace", fontSize: 12 }}>
                        ← PREV GOAL
                    </button>
                    <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#6B7280' }}>{filledCount} of 5 goals defined</span>
                    <button onClick={() => i < 4 && setGoalIndex(i + 1)}
                        style={{ background: i < 4 ? '#000' : '#E5E7EB', color: i < 4 ? '#fff' : '#9CA3AF', border: 'none', padding: '8px 20px', cursor: i < 4 ? 'pointer' : 'not-allowed', fontFamily: "'Monument', monospace", fontSize: 12 }}>
                        NEXT GOAL →
                    </button>
                </div>

                {i === 4 && (
                    <div className="ft-reveal-science">
                        <div className="ft-reveal-label">SCIENCE BEHIND IT</div>
                        <p className="ft-reveal-text">Research by Locke & Latham (2002) shows that specific, challenging goals lead to higher performance 90% of the time. Quarterly breakdowns increase goal attainment by 33% (Harvard Business Review).</p>
                    </div>
                )}
            </div>
        );
    }

    /* === STEP 2: PERFORMANCE MEASUREMENT (BINARY TASK TRACKING) === */
    function Step2({ d, u }) {
        const TASK_PLACEHOLDERS = [
            'Close 5 new client proposals this week',
            'Complete Q2 budget review and submit',
            'Ship feature update to staging environment',
            'Run weekly 1-on-1s with all direct reports',
            'Update performance dashboard with latest data',
            'Resolve top 3 customer support escalations',
            'Prepare board presentation slides',
            'Review and approve marketing campaign brief'
        ];
        const tasks = d.tasks || Array(8).fill(null).map(() => ({ task: '', status: 'not-done', owner: '', reason: '' }));
        const updateTask = (i, f, v) => { const next = [...tasks]; next[i] = { ...next[i], [f]: v }; u('tasks', next); };
        const doneCount = tasks.filter(t => t.status === 'done' && (t.task || '').trim()).length;
        const totalFilled = tasks.filter(t => (t.task || '').trim()).length;
        const rate = totalFilled > 0 ? Math.round((doneCount / totalFilled) * 100) : 0;
        return (
            <div className="step-content animate-in">
                <div className="step-indicator"><span>Step 2 of 6</span><span className="step-time">~8 min</span></div>
                <div className="opening-box">
                <h2 className="step-heading">PERFORMANCE MEASUREMENT</h2>
                <p className="step-hint">Tasks are either DONE or NOT DONE — no "in progress," no gray zones. This binary clarity drives accountability. Document reasons for any gaps.</p>
                </div>
                <div style={{ background: '#000', color: '#fff', padding: 24, textAlign: 'center', marginBottom: 32 }}>
                    <div className="monument" style={{ fontSize: 11, color: '#FFF469', marginBottom: 8 }}>COMPLETION RATE</div>
                    <div className="plaak" style={{ fontSize: 48, color: rate >= 80 ? '#FFF469' : '#fff' }}>{rate}%</div>
                    <div style={{ fontSize: 14, color: '#999' }}>{doneCount} of {totalFilled} tasks done</div>
                </div>
                <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, marginBottom: 24 }}>
                    <thead><tr style={{ background: '#000', color: '#fff' }}>
                        <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>#</th>
                        <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>TASK</th>
                        <th style={{ padding: '10px 12px', width: 100, fontFamily: "'Monument', monospace", fontSize: 11 }}>STATUS</th>
                        <th style={{ padding: '10px 12px', width: 120, fontFamily: "'Monument', monospace", fontSize: 11 }}>OWNER</th>
                    </tr></thead>
                    <tbody>
                        {tasks.map((t, i) => (
                            <React.Fragment key={i}>
                                <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
                                    <td style={{ padding: '8px 12px', fontWeight: 600 }}>{i + 1}</td>
                                    <td style={{ padding: 8 }}><input className="field-input" style={{ border: 'none', height: 36 }} placeholder={TASK_PLACEHOLDERS[i] || `Task ${i + 1}...`} value={t.task} onChange={e => updateTask(i, 'task', e.target.value)} /></td>
                                    <td style={{ padding: 8, textAlign: 'center' }}>
                                        <select className="field-input" style={{ height: 36, fontSize: 13, textAlign: 'center', background: t.status === 'done' ? '#DCFCE7' : '#FEF2F2', fontWeight: 600 }} value={t.status} onChange={e => updateTask(i, 'status', e.target.value)}>
                                            <option value="not-done">NOT DONE</option>
                                            <option value="done">DONE</option>
                                        </select>
                                    </td>
                                    <td style={{ padding: 8 }}><input className="field-input" style={{ border: 'none', height: 36, fontSize: 13 }} placeholder="Owner" value={t.owner} onChange={e => updateTask(i, 'owner', e.target.value)} /></td>
                                </tr>
                                {t.status === 'not-done' && (t.task || '').trim() && (
                                    <tr style={{ background: '#FEF2F2' }}>
                                        <td colSpan={4} style={{ padding: '8px 12px' }}>
                                            <input className="field-input" style={{ border: 'none', height: 32, background: 'transparent', fontSize: 13, color: '#991B1B' }} placeholder="Why not done? (Document the reason)" value={t.reason} onChange={e => updateTask(i, 'reason', e.target.value)} />
                                        </td>
                                    </tr>
                                )}
                            </React.Fragment>
                        ))}
                    </tbody>
                </table>
                <div className="field-group">
                    <label className="field-label">DASHBOARD METRICS</label>
                    <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. Weekly task completion rate (target: 88%), revenue per employee, customer churn rate, NPS score, pipeline conversion %" value={d.dashboardMetrics || ''} onChange={e => u('dashboardMetrics', e.target.value)} />
                </div>
                <div className="field-group">
                    <label className="field-label">REVIEW CADENCE</label>
                    <input className="field-input" placeholder="e.g. Every Monday 9am — 15-min dashboard review + weekly accountability check-in" value={d.reviewCadence || ''} onChange={e => u('reviewCadence', e.target.value)} />
                </div>
            </div>
        );
    }

    /* === STEP 3: 5 WHYS ROOT CAUSE ANALYSIS === */
    function Step3({ d, u }) {
        const whys = d.fiveWhys || { problem: '', why1: '', why2: '', why3: '', why4: '', why5: '', rootCause: '', solution: '', validation: '' };
        const uw = (f, v) => u('fiveWhys', { ...whys, [f]: v });
        return (
            <div className="step-content animate-in">
                <div className="step-indicator"><span>Step 3 of 6</span><span className="step-time">~8 min</span></div>
                <div className="opening-box">
                <h2 className="step-heading">5 WHYS — ROOT CAUSE</h2>
                <p className="step-hint">Drill down to the root cause of your biggest performance problem. Ask "Why?" five times until you reach the real issue — not just a symptom.</p>
                </div>
                <div className="ft-example">
                    <strong>Example:</strong> "Delivery times are delayed" → Why? Orders don't leave on time → Why? Packaging takes too long → Why? Not enough staff → Why? High turnover → Why? Inadequate training for new hires → <strong>Root cause: onboarding process</strong>
                </div>
                <div className="field-group">
                    <label className="field-label">PROBLEM STATEMENT <span className="ft-required">*</span></label>
                    <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. Our quarterly targets have been missed 60% of the time despite the team reporting they are 'busy'" value={whys.problem} onChange={e => uw('problem', e.target.value)} />
                </div>
                {[1, 2, 3, 4, 5].map(n => {
                    const whyPlaceholders = [
                        'e.g. Tasks are not being completed on time',
                        'e.g. Priorities shift mid-week without clear communication',
                        'e.g. There is no weekly review cadence to catch slippage early',
                        'e.g. Management assumed effort equals output — no binary tracking',
                        'e.g. The team has no shared dashboard making performance visible'
                    ];
                    return (
                    <div key={n} className="field-group" style={{ borderLeft: `4px solid ${n <= 2 ? '#FFF469' : n <= 4 ? '#F59E0B' : '#DC2626'}`, paddingLeft: 16 }}>
                        <label className="field-label">WHY #{n} {n === 1 && <span className="ft-required">*</span>}</label>
                        <input className="field-input" placeholder={whyPlaceholders[n - 1]} value={whys[`why${n}`]} onChange={e => uw(`why${n}`, e.target.value)} />
                    </div>
                    );
                })}
                <div style={{ background: '#000', color: '#fff', padding: 24, marginBottom: 24 }}>
                    <div className="field-group" style={{ marginBottom: 16 }}>
                        <label className="field-label" style={{ color: '#FFF469' }}>ROOT CAUSE IDENTIFIED <span className="ft-required">*</span></label>
                        <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. No performance visibility system — the team tracks effort, not outcomes. Without binary done/not-done tracking and weekly reviews, problems go undetected until quarterly results." value={whys.rootCause} onChange={e => uw('rootCause', e.target.value)} />
                    </div>
                    <div className="field-group" style={{ marginBottom: 16 }}>
                        <label className="field-label" style={{ color: '#FFF469' }}>PROPOSED SOLUTION</label>
                        <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. Implement binary task tracking with Monday 15-min dashboard reviews. Each task gets a single owner and a done/not-done status — no 'in progress'." value={whys.solution} onChange={e => uw('solution', e.target.value)} />
                    </div>
                    <div className="field-group">
                        <label className="field-label" style={{ color: '#FFF469' }}>VALIDATION METRIC</label>
                        <input className="field-input" placeholder="e.g. Weekly task completion rate rising from 55% to 88% within one quarter" value={whys.validation} onChange={e => uw('validation', e.target.value)} />
                    </div>
                </div>
            </div>
        );
    }

    /* === STEP 4: 80/20 PRINCIPLE === */
    function Step4({ d, u }) {
        const p = d.eighty20 || { objective: '', inputs: Array(10).fill(null).map(() => ({ input: '', contribution: 0 })), vitalFew: '', trivialMany: '', actions: '' };
        const up = (f, v) => u('eighty20', { ...p, [f]: v });
        const inputs = p.inputs || [];
        const updateInput = (i, f, v) => { const next = [...inputs]; next[i] = { ...next[i], [f]: v }; up('inputs', next); };
        const sorted = [...inputs].filter(inp => inp && (inp.input || '').trim()).sort((a, b) => (b.contribution || 0) - (a.contribution || 0));
        const totalContrib = sorted.reduce((s, inp) => s + (parseInt(inp.contribution) || 0), 0);
        return (
            <div className="step-content animate-in">
                <div className="step-indicator"><span>Step 4 of 6</span><span className="step-time">~8 min</span></div>
                <div className="opening-box">
                <h2 className="step-heading">80/20 PRINCIPLE</h2>
                <p className="step-hint">Identify the 20% of inputs that drive 80% of your results. Focus resources there and eliminate or automate the rest.</p>
                </div>
                <div className="field-group">
                    <label className="field-label">OBJECTIVE <span className="ft-required">*</span></label>
                    <input className="field-input" placeholder="e.g. Increase quarterly sales revenue — which 20% of inputs drive 80% of results?" value={p.objective} onChange={e => up('objective', e.target.value)} />
                </div>
                <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, marginBottom: 16 }}>
                    <thead><tr style={{ background: '#000', color: '#fff' }}>
                        <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>#</th>
                        <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>INPUT / FACTOR</th>
                        <th style={{ padding: '10px 12px', width: 120, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 11 }}>CONTRIBUTION %</th>
                    </tr></thead>
                    <tbody>
                        {inputs.map((inp, i) => {
                            const INPUT_PH = ['Enterprise clients (top tier)', 'Mid-market accounts', 'Small business segment', 'Inbound marketing leads', 'Outbound sales calls', 'Referral program', 'Strategic partnerships', 'Social media campaigns', 'Email nurture sequences', 'Trade shows & events'];
                            return (
                            <tr key={i} style={{ borderBottom: '1px solid #E5E7EB', background: sorted.indexOf(inp) < Math.ceil(sorted.length * 0.2) && (inp.input || '').trim() ? '#FEFCE8' : 'transparent' }}>
                                <td style={{ padding: '8px 12px', fontWeight: 600 }}>{i + 1}</td>
                                <td style={{ padding: 8 }}><input className="field-input" style={{ border: 'none', height: 36 }} placeholder={INPUT_PH[i] || `Input ${i + 1}`} value={inp.input} onChange={e => updateInput(i, 'input', e.target.value)} /></td>
                                <td style={{ padding: 8 }}><input className="field-input" type="number" min="0" max="100" style={{ border: 'none', height: 36, textAlign: 'center', width: 80 }} placeholder="%" value={inp.contribution} onChange={e => updateInput(i, 'contribution', e.target.value)} /></td>
                            </tr>
                        )})}
                    </tbody>
                </table>
                {totalContrib > 0 && (
                    <div style={{ background: '#F3F4F6', padding: 16, marginBottom: 24 }}>
                        <div className="monument" style={{ fontSize: 10, color: '#6B7280', marginBottom: 4 }}>TOTAL CONTRIBUTION</div>
                        <div style={{ fontSize: 20, fontWeight: 600, color: totalContrib === 100 ? '#000' : '#DC2626' }}>{totalContrib}%</div>
                        {totalContrib !== 100 && <div style={{ fontSize: 13, color: '#DC2626' }}>Should add up to 100%</div>}
                    </div>
                )}
                <div className="field-group">
                    <label className="field-label">THE VITAL FEW (TOP 20%)</label>
                    <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. Enterprise clients and referrals generate 71% of revenue but receive the same service level as everyone else. Double down: assign dedicated account managers, create loyalty programs, and increase touchpoints." value={p.vitalFew} onChange={e => up('vitalFew', e.target.value)} />
                </div>
                <div className="field-group">
                    <label className="field-label">THE TRIVIAL MANY (BOTTOM 80%)</label>
                    <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. Trade shows cost €40K/year but generate <3% of revenue. Social media campaigns consume 15 hrs/week with minimal conversion. Automate email sequences, stop trade shows, reduce social to 5 hrs/week." value={p.trivialMany} onChange={e => up('trivialMany', e.target.value)} />
                </div>
            </div>
        );
    }

    /* === STEP 5: THEORY OF CONSTRAINTS === */
    function Step5({ d, u }) {
        const toc = d.constraints || { systemDescription: '', constraint: '', exploit: '', subordinate: '', elevate: '', nextConstraint: '' };
        const ut = (f, v) => u('constraints', { ...toc, [f]: v });
        return (
            <div className="step-content animate-in">
                <div className="step-indicator"><span>Step 5 of 6</span><span className="step-time">~8 min</span></div>
                <div className="opening-box">
                <h2 className="step-heading">THEORY OF CONSTRAINTS</h2>
                <p className="step-hint">Your system is only as strong as its weakest link. Identify the single biggest bottleneck, then systematically resolve it.</p>
                </div>
                <div className="ft-example">
                    <strong>Example:</strong> A manufacturing line where Station 3 processes 50 units/hour but Stations 1 and 2 process 100. Station 3 is the constraint. Solution: Run Station 3 in double shifts (exploit), slow Stations 1-2 to match pace (subordinate), then upgrade Station 3 equipment (elevate).
                </div>
                <div className="field-group">
                    <label className="field-label">YOUR SYSTEM / PROCESS</label>
                    <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. Our sales pipeline: Lead generation → Qualification → Demo → Proposal → Close. We generate 200 leads/month but only close 8 deals." value={toc.systemDescription} onChange={e => ut('systemDescription', e.target.value)} />
                </div>
                {[
                    { key: 'constraint', label: '1. IDENTIFY THE CONSTRAINT', ph: 'e.g. The demo stage — only 2 people can run demos, creating a 3-week backlog. Qualified leads go cold waiting.', hint: 'Look for where work piles up, delays occur, or queues form.' },
                    { key: 'exploit', label: '2. EXPLOIT THE CONSTRAINT', ph: 'e.g. Block demo slots on a shared calendar, eliminate prep overhead with templates, run group demos for similar prospects.', hint: 'Maximize efficiency of the bottleneck without major investment.' },
                    { key: 'subordinate', label: '3. SUBORDINATE OTHER PROCESSES', ph: 'e.g. Reduce lead generation volume to match demo capacity. Better qualify leads upstream so fewer low-quality demos are booked.', hint: 'Align the rest of the system to the bottleneck\'s pace — don\'t overwhelm it.' },
                    { key: 'elevate', label: '4. ELEVATE THE CONSTRAINT', ph: 'e.g. Train 2 additional team members to run demos. Invest in a self-serve demo tool for smaller prospects.', hint: 'If it still limits output, what investment or innovation can expand its capacity?' },
                    { key: 'nextConstraint', label: '5. IDENTIFY NEXT CONSTRAINT', ph: 'e.g. Once demo capacity is resolved, the next bottleneck will likely be proposal turnaround time — currently 5 days average.', hint: 'The process repeats — continuous improvement never stops.' }
                ].map(f => (
                    <div key={f.key} className="field-group" style={{ borderLeft: '4px solid #000', paddingLeft: 16 }}>
                        <label className="field-label">{f.label} {f.key === 'constraint' && <span className="ft-required">*</span>}</label>
                        <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder={f.ph} value={toc[f.key]} onChange={e => ut(f.key, e.target.value)} />
                        <div className="field-help">{f.hint}</div>
                    </div>
                ))}
            </div>
        );
    }

    /* === STEP 6: ACCOUNTABILITY SYSTEM === */
    function Step6({ d, u }) {
        const acc = d.accountability || { expectations: '', ownership: '', checkpoints: '', consequences: '', rewards: '', corrective: '', dashboardPlan: '', transparency: '', reviewPlan: '' };
        const ua = (f, v) => u('accountability', { ...acc, [f]: v });
        return (
            <div className="step-content animate-in">
                <div className="step-indicator"><span>Step 6 of 6</span><span className="step-time">~10 min</span></div>
                <div className="opening-box">
                <h2 className="step-heading">ACCOUNTABILITY SYSTEM</h2>
                <p className="step-hint">Build a 7-step accountability and consequences framework. Clear expectations, single owners, transparent consequences.</p>
                </div>
                {[
                    { key: 'expectations', num: '1', label: 'DEFINE EXPECTATIONS', ph: 'e.g. Sales Manager: close €50K in monthly revenue. Marketing Lead: generate 150 qualified leads/month. Each role has 3 measurable deliverables reviewed weekly.', hint: 'Are responsibilities specific and measurable? No vague metrics — everything must be binary or numeric.' },
                    { key: 'ownership', num: '2', label: 'ASSIGN OWNERSHIP', ph: 'e.g. Weekly dashboard update → Sarah (Marketing). Pipeline review → James (Sales). Customer escalations → Maria (Support). No task has two owners.', hint: 'One person owns each deliverable. No overlaps, no shared accountability — that means no accountability.' },
                    { key: 'checkpoints', num: '3', label: 'SET CHECKPOINTS', ph: 'e.g. Weekly: Monday 9am 15-min dashboard standup. Monthly: first Friday deep-dive into trends. Quarterly: full recalibration of goals and priorities.', hint: 'Without regular checkpoints, problems go undetected until it\'s too late to course-correct.' },
                    { key: 'consequences', num: '4', label: 'CONSEQUENCES FRAMEWORK', ph: 'e.g. Exceeding KPIs 3 months straight → bonus + public recognition. Missing targets 2 months → structured coaching plan. Persistent underperformance → role reassignment discussion.', hint: 'Must be transparent, fair, documented, and communicated before they apply — not after.' }
                ].map(f => (
                    <div key={f.key} className="field-group">
                        <label className="field-label">{f.num}. {f.label} {f.num === '1' && <span className="ft-required">*</span>}</label>
                        <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder={f.ph} value={acc[f.key]} onChange={e => ua(f.key, e.target.value)} />
                        <div className="field-help">{f.hint}</div>
                    </div>
                ))}
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16, marginBottom: 24 }}>
                    <div className="field-group">
                        <label className="field-label">REWARDS FOR SUCCESS</label>
                        <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. Quarterly bonus for exceeding targets, public team recognition, fast-track promotion eligibility, extra PTO day" value={acc.rewards} onChange={e => ua('rewards', e.target.value)} />
                    </div>
                    <div className="field-group">
                        <label className="field-label">CORRECTIVE ACTIONS</label>
                        <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="e.g. First miss: 1-on-1 coaching session. Second miss: structured 30-day improvement plan with weekly check-ins. Third miss: role reassignment or exit discussion." value={acc.corrective} onChange={e => ua('corrective', e.target.value)} />
                    </div>
                </div>
                {[
                    { key: 'dashboardPlan', num: '5', label: 'IMPLEMENT DASHBOARDS', ph: 'e.g. Shared Google Sheet updated every Friday — columns: task, owner, status (done/not-done), reason for gap. Visible to entire team. Review every Monday standup.' },
                    { key: 'transparency', num: '6', label: 'FOSTER TRANSPARENCY', ph: 'e.g. Share a one-pager summarizing accountability policies during onboarding. Review the framework in the first team meeting. All consequences are documented before they apply.' },
                    { key: 'reviewPlan', num: '7', label: 'REVIEW & ADJUST PLAN', ph: 'e.g. Quarterly: Is the system driving the right behaviors? Are consequences being applied consistently? Adjust metrics if goals shift. Annual: full framework redesign.' }
                ].map(f => (
                    <div key={f.key} className="field-group">
                        <label className="field-label">{f.num}. {f.label}</label>
                        <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder={f.ph} value={acc[f.key]} onChange={e => ua(f.key, e.target.value)} />
                    </div>
                ))}
            </div>
        );
    }

    /* === TEAM STEP A: MEETING AGENDA === */
    function TeamStepAgenda() {
        return (
            <div className="step-content animate-in">
                <div className="step-indicator"><span>Team Step 1 of 2</span><span className="step-time">60 min meeting</span></div>
                <div className="opening-box">
                <h2 className="step-heading">TEAM MEETING AGENDA</h2>
                <p className="step-hint">Facilitate a 60-minute team meeting to establish the performance analysis and accountability systems.</p>
                </div>
                <div className="ft-insight"><strong>Meeting purpose:</strong> Establish two foundational systems — a robust performance analysis framework and a structured accountability & consequences plan. By the end, you'll have clear agreements on who, what, when, and how for both.</div>
                {MEETING_AGENDA.map((seg, i) => (
                    <div key={i} style={{ border: '2px solid #000', padding: 24, marginBottom: 16 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                            <div className="numbered-section">{seg.title.toUpperCase()}</div>
                            <span className="monument" style={{ fontSize: 12, color: '#6B7280' }}>{seg.time}</span>
                        </div>
                        <p style={{ fontSize: 15, color: '#374151', lineHeight: 1.6, marginBottom: 16 }}>{seg.desc}</p>
                        {seg.questions.length > 0 && (
                            <div style={{ marginBottom: 12 }}>
                                <div className="monument" style={{ fontSize: 10, color: '#6B7280', marginBottom: 8 }}>KEY QUESTIONS</div>
                                {seg.questions.map((q, qi) => (
                                    <div key={qi} style={{ display: 'flex', gap: 8, marginBottom: 4, fontSize: 14 }}>
                                        <span style={{ color: '#FFF469', background: '#000', width: 20, height: 20, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 11, flexShrink: 0 }}>{qi + 1}</span>
                                        <span>{q}</span>
                                    </div>
                                ))}
                            </div>
                        )}
                        {seg.pitfalls.length > 0 && (
                            <div style={{ background: '#FEF2F2', padding: 12 }}>
                                <div className="monument" style={{ fontSize: 10, color: '#991B1B', marginBottom: 4 }}>AVOID</div>
                                {seg.pitfalls.map((p, pi) => <div key={pi} style={{ fontSize: 13, color: '#991B1B', marginBottom: 2 }}>• {p}</div>)}
                            </div>
                        )}
                    </div>
                ))}
            </div>
        );
    }

    /* === TEAM STEP B: ACTION PLAN & WWW === */
    function TeamStepWWW({ d, u }) {
        const takeaways = d.teamTakeaways || '';
        const strategies = d.teamStrategies || '';
        const www = d.teamWWW || Array(5).fill(null).map(() => ({ who: '', what: '', when: '' }));
        const updateWWW = (i, f, v) => { const next = [...www]; next[i] = { ...next[i], [f]: v }; u('teamWWW', next); };
        return (
            <div className="step-content animate-in">
                <div className="step-indicator"><span>Team Step 2 of 2</span><span className="step-time">~5 min</span></div>
                <div className="opening-box">
                <h2 className="step-heading">ACTION PLAN & WWW</h2>
                <p className="step-hint">Document the meeting's conclusions and assign clear ownership for every action.</p>
                </div>
                <div className="field-group">
                    <label className="field-label">KEY TAKEAWAYS</label>
                    <textarea className="field-textarea" placeholder="What were the most important insights and decisions from this meeting?" value={takeaways} onChange={e => u('teamTakeaways', e.target.value)} />
                </div>
                <div className="field-group">
                    <label className="field-label">PERFORMANCE STRATEGIES AGREED</label>
                    <textarea className="field-textarea" placeholder="What specific performance and accountability strategies did the team agree to implement?" value={strategies} onChange={e => u('teamStrategies', e.target.value)} />
                </div>
                <div className="numbered-section" style={{ marginBottom: 16 }}>WHO / WHAT / WHEN</div>
                <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, marginBottom: 24 }}>
                    <thead><tr style={{ background: '#000', color: '#fff' }}>
                        <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHO</th>
                        <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHAT</th>
                        <th style={{ padding: '10px 12px', width: 130, fontFamily: "'Monument', monospace", fontSize: 11 }}>WHEN</th>
                    </tr></thead>
                    <tbody>
                        {www.map((row, i) => (
                            <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                <td style={{ padding: 8 }}><input className="field-input" style={{ border: 'none', height: 36, fontSize: 14 }} placeholder="Person responsible" value={row.who} onChange={e => updateWWW(i, 'who', e.target.value)} /></td>
                                <td style={{ padding: 8 }}><input className="field-input" style={{ border: 'none', height: 36, fontSize: 14 }} placeholder="Action item" value={row.what} onChange={e => updateWWW(i, 'what', e.target.value)} /></td>
                                <td style={{ padding: 8 }}><input className="field-input" type="date" style={{ border: 'none', height: 36, fontSize: 13 }} value={row.when} onChange={e => updateWWW(i, 'when', e.target.value)} /></td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );
    }

    /* === SIDEBAR === */
    function WizardSidebar({ step, teamUnlocked }) {
        const indSteps = [
            { num: 1, label: 'Goal Setting' },
            { num: 2, label: 'Task Tracking' },
            { num: 3, label: '5 Whys' },
            { num: 4, label: '80/20 Principle' },
            { num: 5, label: 'Constraints' },
            { num: 6, label: 'Accountability' },
            { num: 7, label: 'Review' },
        ];
        const teamSteps = [
            { num: 8, label: 'Meeting Agenda' },
            { num: 9, label: 'Action Plan' },
        ];
        const curNum = typeof step === 'number' ? Math.floor(step) : 0;
        return (
            <div className="wizard-sidebar no-print">
                <div className="sidebar-tool-num">SPRINT 10</div>
                <div className="sidebar-tool-title">PERFORMANCE ANALYSIS</div>
                {indSteps.map(s => {
                    const isActive = curNum === s.num;
                    const isDone = curNum > s.num;
                    return (
                        <div key={s.num} className="sidebar-step" style={{ opacity: isDone || isActive ? 1 : 0.5 }}>
                            <div className={`sidebar-step-dot ${isActive ? 'active' : isDone ? 'done' : ''}`} />
                            <span className={`sidebar-step-label ${isActive ? 'active' : isDone ? 'done' : ''}`}>{s.label}</span>
                        </div>
                    );
                })}
                <div className="sidebar-divider" />
                {teamSteps.map(s => {
                    const isActive = curNum === s.num;
                    const isDone = curNum > s.num;
                    return (
                        <div key={s.num} className="sidebar-step" style={{ opacity: teamUnlocked ? (isDone || isActive ? 1 : 0.5) : 0.3 }}>
                            <div className={`sidebar-step-dot ${teamUnlocked && isActive ? 'active' : teamUnlocked && isDone ? 'done' : ''}`} />
                            <span className={`sidebar-step-label ${teamUnlocked && isActive ? 'active' : teamUnlocked && isDone ? 'done' : ''}`}>{s.label}</span>
                        </div>
                    );
                })}
            </div>
        );
    }

    /* === MAIN APP === */
    const totalSteps = 6;

    function PerformanceApp() {
        const [step, setStep] = useState(0);
        const [data, setData] = useState({});
        const [teamData, setTeamData] = useState({});
        const [teamToolUnlocked, setTeamToolUnlocked] = useState(true); // always unlocked
        const [checkingTeamUnlock, setCheckingTeamUnlock] = useState(false);
        const [individualSubmitted, setIndividualSubmitted] = useState(false);
        const [submitStatus, setSubmitStatus] = useState(null);
        const [submitMessage, setSubmitMessage] = useState('');
        const [aiReviewing, setAiReviewing] = useState(false);
        const [goalIndex, setGoalIndex] = useState(0);
        const autosaveRef = useRef(null);

        const u = (field, value) => setData(prev => ({ ...prev, [field]: value }));
        const ut = (field, value) => setTeamData(prev => ({ ...prev, [field]: value }));

        const goToStep = (s) => { window.scrollTo({ top: 0, behavior: 'smooth' }); setStep(s); };

        // AI-gated step navigation
        const handleNext = async (fromStep) => {
            const nextStep = fromStep < 5 ? fromStep + 0.5 : fromStep + 1;
            const userId = localStorage.getItem('ft_user_id');
            if (!userId || !window.AIChallenge) {
                goToStep(nextStep);
                return;
            }
            setAiReviewing(true);
            try {
                let stepAnswers = {};
                let stepName = '';
                if (fromStep === 1) { stepName = 'Goal Setting & Monitoring'; stepAnswers = { goals: data.goals }; }
                else if (fromStep === 2) { stepName = 'Performance Measurement'; stepAnswers = { tasks: data.tasks }; }
                else if (fromStep === 3) { stepName = '5 Whys Root Cause'; stepAnswers = { five_why: data.fiveWhys }; }
                else if (fromStep === 4) { stepName = '80/20 Principle'; stepAnswers = { eighty20: data.eighty20 }; }
                else if (fromStep === 5) { stepName = 'Theory of Constraints'; stepAnswers = { constraints: data.constraints }; }
                else if (fromStep === 6) { stepName = 'Accountability System'; stepAnswers = { accountability: data.accountability }; }
                const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
                if (canProceed) {
                    goToStep(nextStep);
                }
            } catch (err) {
                console.warn('[AIChallenge] Error, allowing passage:', err);
                goToStep(nextStep);
            } finally {
                setAiReviewing(false);
            }
        };

        // Autosave
        useEffect(() => {
            if (autosaveRef.current) clearTimeout(autosaveRef.current);
            autosaveRef.current = setTimeout(() => {
                try {
                    localStorage.setItem('ft_performance_data', JSON.stringify(data));
                    localStorage.setItem('ft_performance_team', JSON.stringify(teamData));
                } catch (e) { /* quota */ }
            }, CONFIG.AUTOSAVE_DELAY);
            return () => clearTimeout(autosaveRef.current);
        }, [data, teamData]);

        // Load saved data
        useEffect(() => {
            try {
                const saved = localStorage.getItem('ft_performance_data');
                if (saved) setData(JSON.parse(saved));
                const savedTeam = localStorage.getItem('ft_performance_team');
                if (savedTeam) setTeamData(JSON.parse(savedTeam));
            } catch (e) { /* parse fail */ }
        }, []);

        // Check team unlock
        const checkTeamUnlock = async () => {
            setCheckingTeamUnlock(true);
            try {
                const userId = localStorage.getItem('ft_user_id');
                if (!userId) { setCheckingTeamUnlock(false); return; }
                const res = await fetch(`https://backend-production-639c.up.railway.app/api/toolsave/team-unlock?tool_slug=performance-individual&user_id=${encodeURIComponent(userId)}`);
                const { data } = await res.json();
                setTeamToolUnlocked(data.unlocked);
                if (data.unlocked) {
                    console.log('[Performance] All org members completed individual — team tool unlocked');
                } else {
                    console.log(`[Performance] ${data.submitted}/${data.total} members completed`);
                }
            } catch (e) {
                console.warn('[Performance] Team unlock check failed:', e);
            } finally {
                setCheckingTeamUnlock(false);
            }
        };

        useEffect(() => { if (step === 0.5) checkTeamUnlock(); }, [step]);

        // Individual submit
        const handleIndividualSubmit = async () => {
            const userId = localStorage.getItem('ft_user_id');
            if (!userId) { alert('User not authenticated.'); return; }
            const questionMappings = {
                five_why: data.fiveWhys,
                execution_dashboard: { goals: data.goals, tasks: data.tasks, eighty20: data.eighty20, constraints: data.constraints, reviewCadence: data.reviewCadence },
                consequences_table: data.accountability
            };
            await ToolDB.save(userId, questionMappings);
            setSubmitStatus('success');
            setSubmitMessage('Individual assessment submitted!');
            setIndividualSubmitted(true);
        };

        // Team submit
        const handleTeamSubmit = async () => {
            const userId = localStorage.getItem('ft_user_id');
            if (!userId) { alert('User not authenticated.'); return; }
            const teamMappings = {
                execution_dashboard: { teamTakeaways: teamData.teamTakeaways, teamStrategies: teamData.teamStrategies, www: teamData.www }
            };
            await ToolDB.save(userId, teamMappings);
            setSubmitStatus('success');
            setSubmitMessage('Team meeting submitted successfully!');
        };

        return (
            <div className="tool-frame"><div className="tool-inner">

                {/* COVER */}
                {step === 0 && (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', flexDirection: 'column', justifyContent: 'center', padding: 48, color: '#fff' }} className="animate-in">
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 12, color: '#FFF469', letterSpacing: '0.15em', marginBottom: 24, textTransform: 'uppercase' }}>SPRINT 10</div>
                        <h1 className="plaak" style={{ fontSize: 56, marginBottom: 24, textTransform: 'uppercase', lineHeight: 1.1, maxWidth: 700 }}>PERFORMANCE ANALYSIS &amp;<br/>ACCOUNTABILITY</h1>
                        <p style={{ fontSize: 20, fontStyle: 'italic', color: '#ccc', marginBottom: 48, maxWidth: 600, lineHeight: 1.5 }}>"Performance is like a GPS for your business journey."</p>
                        <button onClick={() => goToStep(0.5)} style={{ background: '#FFF469', color: '#000', border: 'none', padding: '16px 40px', fontSize: 18, fontFamily: "'Monument', monospace", letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer', fontWeight: 700, alignSelf: 'flex-start' }}>START</button>
                    </div>
                )}

                {/* BEFORE WE START + PATH CHOOSER */}
                {step === 0.5 && (
                    <div style={{ minHeight: '100vh', background: '#000', color: '#fff', padding: '64px 48px' }} className="animate-in">
                        <div style={{ maxWidth: 880, margin: '0 auto' }}>
                            <h1 className="plaak" style={{ fontSize: 56, marginBottom: 48, textTransform: 'uppercase' }}>BEFORE WE START</h1>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 24, marginBottom: 48 }}>
                                <div style={{ background: '#111', border: '1px solid #222', padding: 28 }}>
                                    <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 12 }}>SPRINT INFO</p>
                                    <p className="plaak" style={{ fontSize: 18, marginBottom: 12 }}>Sprint 10: Performance Analysis &amp; Accountability</p>
                                    <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>Build a performance system that gives you full visibility into what's working, what isn't, and who owns what. 6 individual steps + 2 team meeting steps.</p>
                                </div>
                                <div style={{ background: '#111', border: '1px solid #222', padding: 28 }}>
                                    <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 12 }}>PURPOSE</p>
                                    <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>Most companies measure activity instead of results. This sprint gives you the tools to define what really matters, find root causes using 5 Whys, apply the 80/20 principle, and build real accountability.</p>
                                </div>
                                <div style={{ background: '#111', border: '1px solid #222', padding: 28 }}>
                                    <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 12 }}>MISTAKES TO AVOID</p>
                                    {['Tasks are binary—done or not done. No gray zones.', 'Failing to capture daily learnings from gaps.', 'Dashboards without ownership frameworks.'].map((m, i) => (
                                        <div key={i} style={{ display: 'flex', gap: 12, marginBottom: 10 }}>
                                            <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', minWidth: 20 }}>{i + 1}.</span>
                                            <span style={{ fontSize: 14, color: '#ccc', lineHeight: 1.5 }}>{m}</span>
                                        </div>
                                    ))}
                                </div>
                                <div style={{ background: '#111', border: '1px solid #222', padding: 28 }}>
                                    <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 12 }}>THE JOURNEY</p>
                                    {['Goal Setting & Monitoring', 'Performance Measurement', '5 Whys Root Cause', '80/20 Principle', 'Theory of Constraints', 'Accountability System', 'Team Meeting (2 steps)'].map((s, i) => (
                                        <div key={i} style={{ display: 'flex', gap: 12, marginBottom: 8 }}>
                                            <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#555', minWidth: 24 }}>{String(i + 1).padStart(2, '0')}</span>
                                            <span style={{ fontSize: 14, color: '#ccc' }}>{s}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            {/* Path Chooser */}
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 24 }}>
                                <div style={{ border: '2px solid #fff', padding: 32 }}>
                                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 12, textTransform: 'uppercase', letterSpacing: '0.08em', fontWeight: 600, marginBottom: 12, color: '#fff' }}>Individual Assessment</div>
                                    <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.6, marginBottom: 24 }}>Complete 6 steps: Goal Setting, Task Tracking, 5 Whys, 80/20 Analysis, Theory of Constraints, and Accountability Framework.</p>
                                    <button onClick={() => goToStep(1)} style={{ background: '#FFF469', color: '#000', border: 'none', padding: '14px 36px', fontSize: 15, fontFamily: "'Monument', monospace", letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer', fontWeight: 700 }}>
                                        {individualSubmitted ? 'REVIEW INDIVIDUAL' : 'START INDIVIDUAL'}
                                    </button>
                                </div>
                                <div style={{ border: '2px solid ' + (teamToolUnlocked ? '#fff' : '#555'), padding: 32, opacity: teamToolUnlocked ? 1 : 0.7 }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>
                                        {!teamToolUnlocked && <LockIcon size={16} />}
                                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 12, textTransform: 'uppercase', letterSpacing: '0.08em', fontWeight: 600, color: '#fff' }}>Team Meeting Tool</div>
                                    </div>
                                    {teamToolUnlocked ? (
                                        <>
                                            <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.6, marginBottom: 24 }}>Facilitate the 60-minute team meeting to establish performance and accountability systems.</p>
                                            <button onClick={() => goToStep(8)} style={{ background: '#FFF469', color: '#000', border: 'none', padding: '14px 36px', fontSize: 15, fontFamily: "'Monument', monospace", letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer', fontWeight: 700 }}>START TEAM MEETING</button>
                                        </>
                                    ) : (
                                        <div onClick={(e) => { if (e.shiftKey) setTeamToolUnlocked(true); }} style={{ background: '#222', padding: '12px 16px', textAlign: 'center', color: '#666', fontFamily: "'Monument', monospace", fontSize: 12, cursor: 'default' }} title="Shift+Click to force unlock (dev only)">
                                            {checkingTeamUnlock ? 'CHECKING...' : 'LOCKED — WAITING FOR ALL TEAM MEMBERS'}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                )}

                {/* INDIVIDUAL STEPS 1-6 */}
                {[1, 2, 3, 4, 5, 6].includes(step) && (
                    <div className="wizard-layout">
                        <div className="wizard-main">
                            <MobileStepBar step={step} total={6} />
                            <div className="wizard-content">
                                {step === 1 && <Step1 d={data} u={u} goalIndex={goalIndex} setGoalIndex={setGoalIndex} />}
                                {step === 2 && <Step2 d={data} u={u} />}
                                {step === 3 && <Step3 d={data} u={u} />}
                                {step === 4 && <Step4 d={data} u={u} />}
                                {step === 5 && <Step5 d={data} u={u} />}
                                {step === 6 && <Step6 d={data} u={u} />}
                            </div>
                            <ButtonFooter onBack={() => step === 1 ? goToStep(0.5) : goToStep(step - 1)} onNext={() => step < 6 ? handleNext(step) : goToStep(step + 1)} nextLabel={step === 6 ? 'Review' : aiReviewing ? 'Reviewing...' : 'Next'} disabled={aiReviewing} />
                        </div>
                        <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                    </div>
                )}

                {/* TRANSITION SCREENS */}
                {window.renderTransitionScreen && [1.5, 2.5, 3.5, 4.5].includes(step) && window.renderTransitionScreen(step, CONFIG, totalSteps, setStep)}

                {/* STEP 7: REVIEW & SUBMIT INDIVIDUAL */}
                {step === 7 && (() => {
                    try {
                        const reviewItems = [
                            { title: 'Goals', content: (data.goals || []).filter(g => g && g.goal).length + ' goals defined' },
                            { title: 'Task Tracking', content: (data.tasks || []).filter(t => t && (t.task || '').trim()).length + ' tasks tracked' },
                            { title: '5 Whys', content: (data.fiveWhys || {}).rootCause ? 'Root cause: ' + ((data.fiveWhys || {}).rootCause || '').substring(0, 60) + '...' : 'Not completed' },
                            { title: '80/20', content: (data.eighty20 || {}).objective ? 'Analyzing: ' + ((data.eighty20 || {}).objective || '').substring(0, 60) : 'Not completed' },
                            { title: 'Constraints', content: (data.constraints || {}).constraint ? 'Bottleneck: ' + ((data.constraints || {}).constraint || '').substring(0, 60) : 'Not completed' },
                            { title: 'Accountability', content: (data.accountability || {}).expectations ? 'Framework defined' : 'Not completed' }
                        ];
                        return (
                            <div className="wizard-layout">
                                <div className="wizard-main">
                                    <div className="wizard-content animate-in">
                                        <div className="step-indicator"><span>Review & Submit</span></div>
                                        <div className="opening-box">
                                        <h2 className="step-heading">YOUR PERFORMANCE PROTOCOL</h2>
                                        <p className="step-hint">Review your work across all 6 frameworks, then submit for AI coaching.</p>
                                        </div>

                                        {reviewItems.map((s, i) => (
                                            <div key={i} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '16px 0', borderBottom: '1px solid #E5E7EB' }}>
                                                <div style={{ fontWeight: 600 }}>{s.title}</div>
                                                <div style={{ fontSize: 14, color: '#6B7280', maxWidth: 400, textAlign: 'right' }}>{s.content}</div>
                                            </div>
                                        ))}

                                        <CaseStudy
                                            before="A 30-person SaaS company tracked effort instead of outcomes. Quarterly targets were missed 60% of the time."
                                            after="Binary task tracking, weekly dashboards, and 5 Whys for root cause analysis pushed task completion from 55% to 88% in one quarter."
                                            quote="Once we stopped tracking effort and started tracking outcomes, everything changed. — Operations Director"
                                        />

                                        {submitStatus && <div style={{ padding: 16, marginTop: 16, background: submitStatus === 'success' ? '#F0FDF4' : submitStatus === 'error' ? '#FEF2F2' : '#F5F5F5', border: '1px solid ' + (submitStatus === 'success' ? '#BBF7D0' : submitStatus === 'error' ? '#FECACA' : '#E0E0E0'), textAlign: 'center' }}>{submitMessage}</div>}
                                    </div>
                                    <ButtonFooter onBack={() => goToStep(6)} onNext={handleIndividualSubmit} nextLabel={submitStatus === 'saving' ? 'AI Reviewing...' : 'Submit Individual'} disabled={submitStatus === 'saving'} />
                                </div>
                                <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                            </div>
                        );
                    } catch(e) {
                        console.error('[Performance] Review render error:', e);
                        return (
                            <div className="wizard-layout">
                                <div className="wizard-main">
                                    <div className="wizard-content animate-in">
                                        <div className="step-indicator"><span>Review & Submit</span></div>
                                        <h2 className="step-heading">YOUR PERFORMANCE PROTOCOL</h2>
                                        <p style={{ color: '#6B7280', marginBottom: 24 }}>Loading your performance summary...</p>
                                        {submitStatus && <div style={{ padding: 16, marginTop: 16, background: submitStatus === 'success' ? '#F0FDF4' : submitStatus === 'error' ? '#FEF2F2' : '#F5F5F5', border: '1px solid ' + (submitStatus === 'success' ? '#BBF7D0' : submitStatus === 'error' ? '#FECACA' : '#E0E0E0'), textAlign: 'center' }}>{submitMessage}</div>}
                                    </div>
                                    <ButtonFooter onBack={() => goToStep(6)} onNext={handleIndividualSubmit} nextLabel={submitStatus === 'saving' ? 'AI Reviewing...' : 'Submit Individual'} disabled={submitStatus === 'saving'} />
                                </div>
                                <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                            </div>
                        );
                    }
                })()}

                {/* TEAM STEPS 8-9 */}
                {[8, 9].includes(step) && (
                    <div className="wizard-layout">
                        <div className="wizard-main">
                            <MobileStepBar step={step - 7} total={2} />
                            <div className="wizard-content">
                                {step === 8 && <TeamStepAgenda />}
                                {step === 9 && <TeamStepWWW d={teamData} u={ut} />}
                            </div>
                            <ButtonFooter
                                onBack={() => step === 8 ? goToStep(0.5) : goToStep(8)}
                                onNext={() => step === 8 ? goToStep(9) : handleTeamSubmit()}
                                nextLabel={step === 9 ? (submitStatus === 'saving' ? 'AI Reviewing...' : 'Submit Team') : 'Next'}
                                disabled={step === 9 && submitStatus === 'saving'}
                            />
                        </div>
                        <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                    </div>
                )}

            </div></div>
        );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<PerformanceApp />);
</script>
</body>
</html>
