<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Rhythm Master | Fast Track Program</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../shared/js/transition-screen.js"></script>
    <script src="../../js/tool-access-control.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preload" href="Plaak3Trial-43-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="RiformaLL-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="MonumentGrotesk-Mono.woff2" as="font" type="font/woff2" crossorigin>
    <style>
        @font-face { font-family: 'Plaak'; src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: normal; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: 600; font-display: swap; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); font-display: swap; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Riforma', -apple-system, sans-serif; font-size: 16px; color: #000; background: #000; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }
        * { scrollbar-width: thin; scrollbar-color: #000 transparent; }
        .plaak { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }
        .tool-frame { background: #fff; min-height: 100vh; }
        .tool-inner { background: #fff; min-height: 100vh; }
        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; }
        .wizard-content { max-width: 720px; width: 100%; margin: 0 auto; padding: 48px 32px; flex: 1; }
        .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }
        .wizard-sidebar-inner { padding: 32px 24px; height: 100%; overflow-y: auto; overflow-x: hidden; }
        .sidebar-step-item { padding: 12px; margin-bottom: 8px; border-left: 3px solid transparent; transition: all 0.2s ease; }
        .sidebar-step-item.active { border-left-color: #FFF469; background: #222; }
        .sidebar-step-item.completed { background: #fff; color: #000; border-left-color: #fff; cursor: pointer; }
        .sidebar-step-item.completed:hover { background: #E0E0E0; }
        .sidebar-step-item.locked { opacity: 0.5; }
        .sidebar-step-item .step-num { font-family: 'Riforma', sans-serif; font-size: 14px; }
        .sidebar-step-item .step-name { font-family: 'Riforma', sans-serif; font-size: 14px; }
        .sidebar-snippet { font-size: 12px; margin-top: 4px; opacity: 0.7; line-height: 1.3; }
        .sidebar-phase-header { font-family: 'Monument', monospace; font-size: 10px; text-transform: uppercase; letter-spacing: 0.08em; color: #FFF469; padding: 8px 12px; margin-top: 16px; margin-bottom: 4px; }
        .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .step-time { font-family: 'Monument', monospace; font-size: 11px; color: #6B7280; }
        .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; text-transform: uppercase; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
        .step-hint { font-size: 16px; color: #6B7280; line-height: 1.5; margin: 0 0 32px 0; }
        .field-label { display: flex; align-items: center; gap: 6px; font-family: 'Monument', monospace; font-size: 14px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; color: #000; margin-bottom: 8px; }
        .ft-required { color: #DC2626; font-weight: 700; }
        .field-input { width: 100%; height: 44px; padding: 8px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .field-input:focus { outline: none; border-color: #000; box-shadow: 0 0 0 3px #FFF469; }
        .field-textarea { width: 100%; min-height: 120px; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; resize: none !important; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .field-textarea:focus { outline: none; border-color: #000; box-shadow: 0 0 0 3px #FFF469; }
        .field-help { font-size: 14px; color: #6B7280; margin-top: 4px; line-height: 1.5; }
        .field-group { margin-bottom: 24px; }
        .field-group:last-child { margin-bottom: 0; }
        .ft-section { margin-bottom: 32px; }
        .ft-insight { background: #FFF469; border: 3px solid #000; padding: 16px; margin-bottom: 32px; }
        .ft-example { background: #F3F4F6; padding: 16px; margin-bottom: 8px; font-size: 14px; line-height: 1.6; color: #1F2937; }
        .btn-footer { position: sticky; bottom: 0; z-index: 10; display: flex; justify-content: space-between; align-items: center; padding: 16px 32px; border-top: 1px solid #E5E7EB; background: #fff; width: 100%; }
        .btn-back { background: #fff; color: #000; border: 2px solid #000; padding: 12px 24px; font-family: 'Riforma', sans-serif; font-size: 16px; cursor: pointer; transition: all 0.2s ease; min-height: 44px; }
        .btn-back:hover { background: #F3F4F6; }
        .btn-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 24px; font-family: 'Riforma', sans-serif; font-size: 16px; cursor: pointer; transition: all 0.2s ease; min-height: 44px; }
        .btn-next:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-next:disabled { background: #E5E7EB; color: #9CA3AF; border-color: #E5E7EB; cursor: not-allowed; }
        .numbered-section { background: #000; color: #fff; padding: 8px 14px; font-size: 14px; font-weight: bold; letter-spacing: 0.5px; display: inline-block; font-family: 'Monument', monospace; }
        .mobile-step-bar { display: none; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; background: #F3F4F6; }
        .mobile-step-bar .bar-text { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 6px; }
        .mobile-progress { height: 3px; background: #E5E7EB; width: 100%; }
        .mobile-progress-fill { height: 100%; background: #000; transition: width 0.3s ease; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeSlideIn 0.3s ease-out; }
        @media print { .no-print { display: none !important; } }
        @media (min-width: 769px) and (max-width: 1024px) { .wizard-sidebar { width: 220px; } .wizard-sidebar-inner { padding: 24px 16px; } }
        @media (max-width: 768px) { .wizard-sidebar { display: none; } .mobile-step-bar { display: block; } .wizard-content { padding: 24px 16px; } .step-heading { font-size: 24px; } .btn-footer { padding: 12px 16px; } }
        @media (max-width: 480px) { .step-heading { font-size: 20px; } .wizard-content { padding: 20px 12px; } }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CONFIG = {
        TOOL_SLUG: 'meeting-rhythm',
        AUTOSAVE_DELAY: 2000,
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'Bad meetings are the most expensive line item no one tracks. A weekly leadership meeting with 6 people costs €150k+ per year in senior time — and most are theatre, not decisions. Measure your meeting ROI.',
                peerProof: '"One CEO cut leadership meetings from 3 hours to 45 minutes with a 3-item agenda cap and a written pre-read requirement. Decision velocity doubled. The team reported higher clarity and 30% less stress."'
            },
            2: {
                brutalTruth: 'Meeting readiness is not about being prepared — it is about respecting everyone else\'s time. Showing up underprepared to a meeting is the same as being late. Both say: my time matters more than yours.',
                peerProof: '"A €25M company introduced a simple rule: every meeting requires a 5-bullet pre-read sent 24 hours before. Attendance quality improved. Decisions that previously took 3 meetings now happened in one. The rule cost nothing to implement."'
            },
            3: {
                brutalTruth: 'Discussing problems in meetings without designating an owner and a deadline is not problem-solving — it is expensive group therapy. Every issue that leaves a meeting without a clear WHO, WHAT, and WHEN will return at the next meeting.',
                peerProof: '"A leadership team started ending every meeting with a 2-minute WWW (Who, What, When) round. Issue recurrence in subsequent meetings dropped 70% in 60 days. The recurring agenda items that used to eat 40% of meeting time disappeared."'
            }
        },
        CLOSING_MESSAGES: {
            1: { title: 'RHYTHM ASSESSED', text: 'Your current meeting reality is clear. Next: evaluate your preparation standards.' },
            2: { title: 'READINESS MEASURED', text: 'Your preparation gaps are identified. Next: define how you break problems and make decisions.' },
            3: { title: 'BIG ROCK CRACKED', text: 'Your decision process is built. Take it to the team meeting and align.' }
        }
    };

    ToolDB.init(CONFIG.TOOL_SLUG);
    ToolAccessControl.init(CONFIG.TOOL_SLUG);

    window.CognitiveLoad && CognitiveLoad.init('meeting-rhythm', {
        insights: [
            "Bad meetings are the #1 productivity killer. A good rhythm eliminates 80% of ad-hoc meetings.",
            "Daily huddles (15 min), weekly tacticals (60 min), monthly strategics (half day), quarterly reviews.",
            "The Big Rock Discussion solves critical issues in 30 minutes using first principles, Theory of Constraints, and 80/20."
        ],
        caseStudy: {
            before: "A 40-person logistics company spent 25 hours per week per manager in meetings. Most had no agenda, no clear owner, and ended without action items. Strategy discussions bled into daily standups, and quarterly reviews were skipped entirely.",
            after: "After implementing the Fast Track Meeting Rhythm (daily 15-min huddles, weekly 60-min tacticals, quarterly half-day reviews), meeting time dropped to 8 hours per week. Every meeting had a purpose, an owner, and ended with WWW (Who does What by When).",
            quote: "The meeting rhythm gave us back 17 hours per week per manager. That is 850 productive hours per year we reinvested into execution. Our quarterly targets went from 60% to 92% completion. — COO, logistics company"
        }
    });
    const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy } = CognitiveLoad.components;

    const MEETING_AGENDA = [
        { time: '5 min', title: 'Objective Setting', desc: 'Brief recap of sprint goals and the meeting\'s objectives.', questions: ['What are the key outcomes we need from this meeting?'], pitfalls: ['Diving into discussion without setting a clear objective first.'] },
        { time: '20 min', title: 'Meeting Rhythm Framework', desc: 'Team discussion on the Meeting Rhythm framework. Discuss potential individual and team challenges.', questions: ['Do we have a clear daily/weekly/monthly/quarterly rhythm?', 'Which meetings are currently wasting the most time?', 'What individual and team challenges do we face?'], pitfalls: ['Discussing meeting problems in the abstract without concrete examples.', 'Not assigning ownership for implementing the rhythm.'] },
        { time: '30 min', title: 'Review Individual Priorities', desc: 'Team members present their Individual Priorities Breakdown and Scheduling Tool. Discuss alignment with organizational goals.', questions: ['Are your priorities aligned with the company\'s quarterly goals?', 'Do any priorities conflict or overlap between team members?', 'Are deadlines realistic given capacity?'], pitfalls: ['Letting one person dominate. Each member gets equal airtime.', 'Skipping alignment discussion and just listing priorities.'] },
        { time: '20 min', title: 'Review Process Tools', desc: 'Discuss how the team will use Meeting Readiness, Meeting Evaluation, and the Big Rock Discussion process tools.', questions: ['How will we implement the Meeting Readiness checklist before every meeting?', 'Who will own the post-meeting evaluation process?', 'What is our first Big Rock to tackle?'], pitfalls: ['Agreeing to use all tools but never implementing any.', 'Not assigning a single owner per process tool.'] },
        { time: '5 min', title: 'Action Plan & Closing', desc: 'Confirm Who, What, When for all agreed actions. Address final questions.', questions: ['Does every action item have a single owner and deadline?'], pitfalls: ['Ending without written commitments.'] }
    ];

    /* === SHARED COMPONENTS === */
    function CheckIcon({ color = "#fff", size = 16 }) {
        return <svg width={size} height={size} viewBox="0 0 24 24" fill={color}><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>;
    }
    function LockIcon({ size = 16 }) {
        return <svg width={size} height={size} viewBox="0 0 24 24" fill="#9CA3AF"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>;
    }
    function ButtonFooter({ onBack, onNext, nextLabel = 'Next', showBack = true, disabled = false }) {
        return (
            <div className="btn-footer no-print">
                {showBack ? <button className="btn-back" onClick={onBack}>&larr; Back</button> : <div />}
                <button className="btn-next" disabled={disabled} onClick={onNext}>{nextLabel} &rarr;</button>
            </div>
        );
    }
    function MobileStepBar({ step, total }) {
        return (
            <div className="mobile-step-bar no-print">
                <div className="bar-text">Step {step} of {total}</div>
                <div className="mobile-progress"><div className="mobile-progress-fill" style={{ width: `${Math.round((step / total) * 100)}%` }} /></div>
            </div>
        );
    }

    /* === STEP 1: INDIVIDUAL PRIORITIES BREAKDOWN === */
    function Step1({ d, u, priorityIdx, setPriorityIdx }) {
        const priorities = d.priorities || Array(3).fill(null).map(() => ({
            priority: '', totalHours: '', deadline: '',
            steps: Array(5).fill(null).map(() => ({ step: '', hours: '', week: '' }))
        }));
        const updateP = (f, v) => { const next = [...priorities]; next[priorityIdx] = { ...next[priorityIdx], [f]: v }; u('priorities', next); };
        const updateStep = (si, f, v) => {
            const next = [...priorities];
            const steps = [...(next[priorityIdx].steps || Array(5).fill(null).map(() => ({ step: '', hours: '', week: '' })))];
            steps[si] = { ...steps[si], [f]: v };
            next[priorityIdx] = { ...next[priorityIdx], steps };
            u('priorities', next);
        };
        const addPriority = () => {
            if (priorities.length < 5) {
                u('priorities', [...priorities, { priority: '', totalHours: '', deadline: '', steps: Array(5).fill(null).map(() => ({ step: '', hours: '', week: '' })) }]);
                setPriorityIdx(priorities.length);
            }
        };
        const p = priorities[priorityIdx] || priorities[0];
        const hasFilled = (idx) => {
            const pr = priorities[idx];
            return pr && pr.priority && pr.priority.trim().length > 0;
        };

        return (
            <div className="animate-in" key={priorityIdx}>
                <div className="step-indicator"><span>Step 1 of 4 · Priority {priorityIdx + 1} of {priorities.length}</span><span className="step-time">~10 min</span></div>
                <h2 className="step-heading">PRIORITIES BREAKDOWN</h2>
                <p className="step-hint">Identify your big priorities, then slice each into 5 manageable steps with deadlines. Start simple — the first step should feel almost too easy.</p>

                {/* Priority navigator */}
                <div style={{ display: 'flex', gap: 8, marginBottom: 24, flexWrap: 'wrap', alignItems: 'center' }}>
                    {priorities.map((_, i) => (
                        <button key={i} onClick={() => setPriorityIdx(i)} style={{
                            width: 44, height: 44, border: `2px solid ${priorityIdx === i ? '#000' : hasFilled(i) ? '#000' : '#E5E7EB'}`,
                            background: priorityIdx === i ? '#000' : hasFilled(i) ? '#F0F0F0' : '#fff',
                            color: priorityIdx === i ? '#FFF469' : hasFilled(i) ? '#000' : '#999',
                            fontFamily: "'Monument', monospace", fontSize: 14, fontWeight: 700, cursor: 'pointer', transition: 'all 0.2s'
                        }}>{String(i + 1).padStart(2, '0')}</button>
                    ))}
                    {priorities.length < 5 && (
                        <button onClick={addPriority} style={{
                            height: 44, padding: '0 16px', border: '2px dashed #E5E7EB', background: 'none', cursor: 'pointer',
                            fontFamily: "'Monument', monospace", fontSize: 12, color: '#6B7280', transition: 'all 0.2s'
                        }}>+ ADD</button>
                    )}
                </div>

                {priorityIdx === 0 && (
                    <div className="ft-example" style={{ marginBottom: 24 }}>
                        <strong>Do's:</strong> Start with the simplest possible action. Celebrate completing each step.<br/>
                        <strong>Don'ts:</strong> Choose a first step that's too complex. Rush through steps without thorough completion.
                    </div>
                )}

                <div style={{ border: '2px solid #000', padding: 24 }}>
                    <div className="numbered-section" style={{ marginBottom: 16 }}>PRIORITY {priorityIdx + 1}</div>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 120px 140px', gap: 12, marginBottom: 16 }}>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">PRIORITY <span className="ft-required">*</span></label>
                            <input className="field-input" placeholder="The big, intimidating elephant in the room" value={p.priority} onChange={e => updateP('priority', e.target.value)} />
                        </div>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">TOTAL HRS</label>
                            <input className="field-input" type="number" placeholder="Hours" value={p.totalHours} onChange={e => updateP('totalHours', e.target.value)} />
                        </div>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">DEADLINE</label>
                            <input className="field-input" type="date" value={p.deadline} onChange={e => updateP('deadline', e.target.value)} />
                        </div>
                    </div>
                    <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14 }}>
                        <thead><tr style={{ background: '#F3F4F6' }}>
                            <th style={{ padding: '8px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>#</th>
                            <th style={{ padding: '8px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>ACTION STEP</th>
                            <th style={{ padding: '8px 12px', width: 80, fontFamily: "'Monument', monospace", fontSize: 11 }}>HOURS</th>
                            <th style={{ padding: '8px 12px', width: 100, fontFamily: "'Monument', monospace", fontSize: 11 }}>WEEK</th>
                        </tr></thead>
                        <tbody>
                            {(p.steps || []).map((s, si) => (
                                <tr key={si} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                    <td style={{ padding: '6px 12px', fontWeight: 600, color: si === 0 ? '#16A34A' : '#000' }}>{si + 1}{si === 0 && ' ★'}</td>
                                    <td style={{ padding: 4 }}><input className="field-input" style={{ border: 'none', height: 36, fontSize: 14 }} placeholder={si === 0 ? 'Start SIMPLE — almost too easy' : `Step ${si + 1} (gradually increase complexity)`} value={s.step} onChange={e => updateStep(si, 'step', e.target.value)} /></td>
                                    <td style={{ padding: 4 }}><input className="field-input" type="number" style={{ border: 'none', height: 36, textAlign: 'center', fontSize: 13 }} placeholder="hrs" value={s.hours} onChange={e => updateStep(si, 'hours', e.target.value)} /></td>
                                    <td style={{ padding: 4 }}><input className="field-input" style={{ border: 'none', height: 36, textAlign: 'center', fontSize: 13 }} placeholder="Wk #" value={s.week} onChange={e => updateStep(si, 'week', e.target.value)} /></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    {(() => {
                        const totalAllocated = (p.steps || []).reduce((sum, s) => sum + (parseInt(s.hours) || 0), 0);
                        const budget = parseInt(p.totalHours) || 0;
                        return budget > 0 && (
                            <div style={{ padding: '8px 12px', background: totalAllocated > budget ? '#FEF2F2' : '#F0FDF4', marginTop: 8, fontSize: 13 }}>
                                <strong>{totalAllocated}h allocated</strong> of {budget}h budget {totalAllocated > budget && <span style={{ color: '#DC2626', fontWeight: 600 }}>— Over budget!</span>}
                            </div>
                        );
                    })()}
                </div>
            </div>
        );
    }

    /* === STEP 2: MEETING READINESS === */
    function Step2({ d, u }) {
        const agenda = d.agendaItems || Array(3).fill(null).map(() => ({ topic: '', owner: '', duration: '' }));
        const updateA = (i, f, v) => { const next = [...agenda]; next[i] = { ...next[i], [f]: v }; u('agendaItems', next); };
        const addAgenda = () => u('agendaItems', [...agenda, { topic: '', owner: '', duration: '' }]);
        const roles = d.roles || { facilitator: '', scribe: '', timekeeper: '' };
        const updateR = (f, v) => u('roles', { ...roles, [f]: v });
        return (
            <div className="animate-in">
                <div className="step-indicator"><span>Step 2 of 4</span><span className="step-time">~8 min</span></div>
                <h2 className="step-heading">MEETING READINESS</h2>
                <p className="step-hint">Prepare meetings that are purposeful, productive, and end with clear actions. Complete this checklist before every meeting you own.</p>
                <div className="field-group">
                    <label className="field-label">1. MEETING PURPOSE <span className="ft-required">*</span></label>
                    <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="Clearly state the objective of the meeting. What specific outcome must this meeting produce?" value={d.meetingPurpose || ''} onChange={e => u('meetingPurpose', e.target.value)} />
                    <div className="field-help">Example: "Align on Q2 marketing budget and approve top 3 campaign proposals."</div>
                </div>
                <div className="field-group">
                    <label className="field-label">2. PARTICIPANTS <span className="ft-required">*</span></label>
                    <textarea className="field-textarea" style={{ minHeight: 60 }} placeholder="Only those directly involved in discussion or decision-making. No spectators." value={d.meetingParticipants || ''} onChange={e => u('meetingParticipants', e.target.value)} />
                    <div className="field-help">Example: Finance lead, Marketing lead, CEO. Not the entire department.</div>
                </div>
                <div className="field-group">
                    <label className="field-label">3. AGENDA ITEMS</label>
                    <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, marginBottom: 8 }}>
                        <thead><tr style={{ background: '#000', color: '#fff' }}>
                            <th style={{ padding: '8px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>TOPIC</th>
                            <th style={{ padding: '8px 12px', width: 130, fontFamily: "'Monument', monospace", fontSize: 11 }}>OWNER</th>
                            <th style={{ padding: '8px 12px', width: 80, fontFamily: "'Monument', monospace", fontSize: 11 }}>MINUTES</th>
                        </tr></thead>
                        <tbody>
                            {agenda.map((a, i) => (
                                <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                    <td style={{ padding: 4 }}><input className="field-input" style={{ border: 'none', height: 36 }} placeholder={`Agenda item ${i + 1}`} value={a.topic} onChange={e => updateA(i, 'topic', e.target.value)} /></td>
                                    <td style={{ padding: 4 }}><input className="field-input" style={{ border: 'none', height: 36, fontSize: 13 }} placeholder="Owner" value={a.owner} onChange={e => updateA(i, 'owner', e.target.value)} /></td>
                                    <td style={{ padding: 4 }}><input className="field-input" type="number" style={{ border: 'none', height: 36, textAlign: 'center', fontSize: 13 }} placeholder="min" value={a.duration} onChange={e => updateA(i, 'duration', e.target.value)} /></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    <button onClick={addAgenda} style={{ width: '100%', padding: 8, border: '2px dashed #E5E7EB', background: 'none', cursor: 'pointer', fontFamily: "'Monument', monospace", fontSize: 11 }}>+ ADD ITEM</button>
                </div>
                <div className="field-group">
                    <label className="field-label">4. PRE-MEETING MATERIALS</label>
                    <textarea className="field-textarea" style={{ minHeight: 60 }} placeholder="What documents/data should be shared in advance? When? (e.g. campaign performance data 24h before)" value={d.preMaterials || ''} onChange={e => u('preMaterials', e.target.value)} />
                </div>
                <div className="numbered-section" style={{ marginBottom: 16 }}>MEETING ROLES</div>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 12 }}>
                    {[
                        { key: 'facilitator', label: 'FACILITATOR', ph: 'Keeps discussion on track' },
                        { key: 'scribe', label: 'SCRIBE', ph: 'Records decisions & actions' },
                        { key: 'timekeeper', label: 'TIMEKEEPER', ph: 'Enforces time limits' }
                    ].map(r => (
                        <div key={r.key} className="field-group">
                            <label className="field-label" style={{ fontSize: 11 }}>{r.label}</label>
                            <input className="field-input" placeholder={r.ph} value={roles[r.key]} onChange={e => updateR(r.key, e.target.value)} />
                        </div>
                    ))}
                </div>
            </div>
        );
    }

    /* === STEP 3: MEETING EVALUATION === */
    function Step3({ d, u }) {
        const [openSection, setOpenSection] = useState('context');
        const eff = parseInt(d.effectiveness) || 0;

        const AccordionButton = ({ sectionId, label }) => (
            <button
                onClick={() => setOpenSection(openSection === sectionId ? null : sectionId)}
                style={{
                    width: '100%', display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                    background: openSection === sectionId ? '#000' : '#f5f5f5',
                    color: openSection === sectionId ? '#fff' : '#000',
                    border: '2px solid #000', padding: '12px 16px', cursor: 'pointer', marginBottom: 16,
                    fontFamily: "'Monument', monospace", fontSize: 11,
                    textTransform: 'uppercase', letterSpacing: '0.06em'
                }}
            >
                <span>{label}</span>
                <span style={{ fontSize: 18 }}>{openSection === sectionId ? '−' : '+'}</span>
            </button>
        );

        return (
            <div className="animate-in">
                <div className="step-indicator"><span>Step 3 of 4</span><span className="step-time">~6 min</span></div>
                <h2 className="step-heading">MEETING EVALUATION</h2>
                <p className="step-hint">Review a recent meeting's effectiveness. What worked? What didn't? What will you change next time?</p>

                {/* Meeting Context Section */}
                <AccordionButton sectionId="context" label="Meeting Context" />
                {openSection === 'context' && (
                    <div style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16, marginBottom: 0 }}>
                            <div className="field-group" style={{ marginBottom: 0 }}>
                                <label className="field-label">MEETING DATE</label>
                                <input className="field-input" type="date" value={d.meetingDate || ''} onChange={e => u('meetingDate', e.target.value)} />
                            </div>
                            <div className="field-group" style={{ marginBottom: 0 }}>
                                <label className="field-label">MEETING TYPE</label>
                                <input className="field-input" placeholder="e.g. Weekly tactical, Monthly review" value={d.meetingType || ''} onChange={e => u('meetingType', e.target.value)} />
                            </div>
                        </div>
                    </div>
                )}

                {/* Effectiveness Rating Section */}
                <AccordionButton sectionId="rating" label="Effectiveness Rating" />
                {openSection === 'rating' && (
                    <div style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">EFFECTIVENESS RATING</label>
                            <div style={{ display: 'flex', gap: 8, marginBottom: 8 }}>
                                {[1, 2, 3, 4, 5].map(n => (
                                    <button key={n} onClick={() => u('effectiveness', n)} style={{ width: 48, height: 48, border: '2px solid ' + (eff === n ? '#000' : '#E5E7EB'), background: eff === n ? '#000' : '#fff', color: eff === n ? '#FFF469' : '#000', fontWeight: 700, fontSize: 18, cursor: 'pointer' }}>{n}</button>
                                ))}
                            </div>
                            <div className="field-help">{eff <= 2 && eff > 0 ? 'Needs major improvement' : eff === 3 ? 'Average — room to grow' : eff >= 4 ? 'Strong meeting' : 'Rate 1-5'}</div>
                        </div>
                    </div>
                )}

                {/* Feedback Section */}
                <AccordionButton sectionId="feedback" label="Meeting Feedback" />
                {openSection === 'feedback' && (
                    <div style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                        <div className="field-group">
                            <label className="field-label">WHAT WORKED WELL <span className="ft-required">*</span></label>
                            <textarea className="field-textarea" placeholder="What made this meeting productive? What should we keep doing?" value={d.whatWorked || ''} onChange={e => u('whatWorked', e.target.value)} />
                        </div>
                        <div className="field-group">
                            <label className="field-label">WHAT DIDN'T WORK <span className="ft-required">*</span></label>
                            <textarea className="field-textarea" placeholder="What wasted time? What caused confusion? Where did we go off-track?" value={d.whatDidntWork || ''} onChange={e => u('whatDidntWork', e.target.value)} />
                        </div>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">IMPROVEMENTS FOR NEXT TIME <span className="ft-required">*</span></label>
                            <textarea className="field-textarea" placeholder="Specific changes you'll implement in the next meeting." value={d.improvements || ''} onChange={e => u('improvements', e.target.value)} />
                        </div>
                    </div>
                )}
            </div>
        );
    }

    /* === STEP 4: BIG ROCK DISCUSSION === */
    function Step4({ d, u }) {
        const [openSection, setOpenSection] = useState('clarify');
        const br = d.bigRock || { issue: '', problemStatement: '', firstPrinciples: '', constraint: '', subtraction: '', why1: '', why2: '', why3: '', why4: '', why5: '', rootCause: '', eighty20: '', solutions: '', www: Array(3).fill(null).map(() => ({ who: '', what: '', when: '' })) };
        const ub = (f, v) => u('bigRock', { ...br, [f]: v });
        const www = br.www || [];
        const updateWWW = (i, f, v) => { const next = [...www]; next[i] = { ...next[i], [f]: v }; ub('www', next); };

        const AccordionButton = ({ sectionId, label, borderColor }) => (
            <button
                onClick={() => setOpenSection(openSection === sectionId ? null : sectionId)}
                style={{
                    width: '100%', display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                    background: openSection === sectionId ? '#000' : '#f5f5f5',
                    color: openSection === sectionId ? '#fff' : '#000',
                    border: '2px solid #000', padding: '12px 16px', cursor: 'pointer', marginBottom: 16,
                    fontFamily: "'Monument', monospace", fontSize: 11,
                    textTransform: 'uppercase', letterSpacing: '0.06em'
                }}
            >
                <span>{label}</span>
                <span style={{ fontSize: 18 }}>{openSection === sectionId ? '−' : '+'}</span>
            </button>
        );

        return (
            <div className="animate-in">
                <div className="step-indicator"><span>Step 4 of 4</span><span className="step-time">~10 min</span></div>
                <h2 className="step-heading">BIG ROCK DISCUSSION</h2>
                <p className="step-hint">Tackle the single biggest bottleneck holding your team back. 30 minutes. Maximum clarity. Actionable outcomes.</p>

                {/* Phase 1: Clarify (5 min) */}
                <AccordionButton sectionId="clarify" label="1. Clarify the Core Problem (5 min)" />
                {openSection === 'clarify' && (
                    <div style={{ borderLeft: '4px solid #FFF469', paddingLeft: 16, marginBottom: 16, border: '2px solid #000', borderLeft: '4px solid #FFF469', padding: 20 }}>
                        <div className="field-group">
                            <label className="field-label">THE BIG ROCK ISSUE <span className="ft-required">*</span></label>
                            <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="What is the issue at its most basic level? If you had to explain it to a 10-year-old, how would you phrase it?" value={br.issue} onChange={e => ub('issue', e.target.value)} />
                        </div>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">PROBLEM STATEMENT <span className="ft-required">*</span></label>
                            <textarea className="field-textarea" style={{ minHeight: 60 }} placeholder="Crystal clear, razor-sharp. Why is this the most important thing to address NOW? What measurable outcome defines success?" value={br.problemStatement} onChange={e => ub('problemStatement', e.target.value)} />
                        </div>
                    </div>
                )}

                {/* Phase 2: Deconstruct (5 min) */}
                <AccordionButton sectionId="deconstruct" label="2. Deconstruct the Problem (5 min)" />
                {openSection === 'deconstruct' && (
                    <div style={{ borderLeft: '4px solid #F59E0B', paddingLeft: 16, marginBottom: 16, border: '2px solid #000', borderLeft: '4px solid #F59E0B', padding: 20 }}>
                        <div className="field-group">
                            <label className="field-label">FIRST PRINCIPLES</label>
                            <textarea className="field-textarea" style={{ minHeight: 60 }} placeholder="What do we know to be absolutely true? What assumptions haven't we validated? If we ignored conventional approaches, how would we start from scratch?" value={br.firstPrinciples} onChange={e => ub('firstPrinciples', e.target.value)} />
                        </div>
                        <div className="field-group">
                            <label className="field-label">THEORY OF CONSTRAINTS</label>
                            <textarea className="field-textarea" style={{ minHeight: 60 }} placeholder="What is the single biggest bottleneck? Is it internal or external? If we addressed ONLY this constraint, how much would the problem improve?" value={br.constraint} onChange={e => ub('constraint', e.target.value)} />
                        </div>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">LAW OF SUBTRACTION</label>
                            <textarea className="field-textarea" style={{ minHeight: 60 }} placeholder="What can we REMOVE or STOP doing that would simplify the problem? What would this look like with a clean slate?" value={br.subtraction} onChange={e => ub('subtraction', e.target.value)} />
                        </div>
                    </div>
                )}

                {/* Phase 3: Root Cause (10 min) */}
                <AccordionButton sectionId="rootcause" label="3. Root Cause — 5 Whys (10 min)" />
                {openSection === 'rootcause' && (
                    <div style={{ borderLeft: '4px solid #DC2626', paddingLeft: 16, marginBottom: 16, border: '2px solid #000', borderLeft: '4px solid #DC2626', padding: 20 }}>
                        {[1, 2, 3, 4, 5].map(n => (
                            <div key={n} className="field-group">
                                <label className="field-label">WHY #{n}</label>
                                <input className="field-input" placeholder={n === 1 ? 'Why does this issue exist?' : `Why? (dig deeper from #${n - 1})`} value={br[`why${n}`]} onChange={e => ub(`why${n}`, e.target.value)} />
                            </div>
                        ))}
                        <div className="field-group">
                            <label className="field-label">80/20 INSIGHT</label>
                            <input className="field-input" placeholder="Which 20% of factors drive 80% of this issue's impact?" value={br.eighty20} onChange={e => ub('eighty20', e.target.value)} />
                        </div>
                        <div style={{ background: '#000', color: '#fff', padding: 20, marginTop: 16 }}>
                            <label className="field-label" style={{ color: '#FFF469' }}>ROOT CAUSE <span className="ft-required">*</span></label>
                            <textarea className="field-textarea" style={{ minHeight: 60 }} placeholder="Concise statement of the root cause(s) identified" value={br.rootCause} onChange={e => ub('rootCause', e.target.value)} />
                        </div>
                    </div>
                )}

                {/* Phase 4: Solutions (7 min) */}
                <AccordionButton sectionId="solutions" label="4. High-Impact Solutions (7 min)" />
                {openSection === 'solutions' && (
                    <div style={{ borderLeft: '4px solid #16A34A', paddingLeft: 16, marginBottom: 16, border: '2px solid #000', borderLeft: '4px solid #16A34A', padding: 20 }}>
                        <div className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label">2-3 PRIORITIZED SOLUTIONS</label>
                            <textarea className="field-textarea" placeholder="Brainstorm solutions that directly address the bottleneck/root cause. Apply impact/easy. Apply Law of Subtraction: what's the minimum viable solution? Can it be implemented with existing resources?" value={br.solutions} onChange={e => ub('solutions', e.target.value)} />
                        </div>
                    </div>
                )}

                {/* Phase 5: WWW (3 min) */}
                <AccordionButton sectionId="www" label="5. Who / What / When" />
                {openSection === 'www' && (
                    <div style={{ border: '2px solid #000', padding: 20, marginBottom: 16 }}>
                        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14 }}>
                            <thead><tr style={{ background: '#000', color: '#fff' }}>
                                <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHO</th>
                                <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHAT</th>
                                <th style={{ padding: '10px 12px', width: 130, fontFamily: "'Monument', monospace", fontSize: 11 }}>WHEN</th>
                            </tr></thead>
                            <tbody>
                                {www.map((row, i) => (
                                    <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                        <td style={{ padding: 4 }}><input className="field-input" style={{ border: 'none', height: 36 }} placeholder="Owner" value={row.who} onChange={e => updateWWW(i, 'who', e.target.value)} /></td>
                                        <td style={{ padding: 4 }}><input className="field-input" style={{ border: 'none', height: 36 }} placeholder="Action" value={row.what} onChange={e => updateWWW(i, 'what', e.target.value)} /></td>
                                        <td style={{ padding: 4 }}><input className="field-input" type="date" style={{ border: 'none', height: 36, fontSize: 13 }} value={row.when} onChange={e => updateWWW(i, 'when', e.target.value)} /></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        );
    }

    /* === TEAM STEP A: MEETING AGENDA === */
    function TeamStepAgenda() {
        return (
            <div className="animate-in">
                <div className="step-indicator"><span>Team Step 1 of 2</span><span className="step-time">90 min meeting</span></div>
                <h2 className="step-heading">TEAM MEETING AGENDA</h2>
                <p className="step-hint">Facilitate a 90-minute team meeting to reflect on meeting alignment, review individual priorities, and master the process tools.</p>
                <div className="ft-insight"><strong>Meeting purpose:</strong> Reflect on individual and team alignment on priorities, and master tools for meetings improvement — Big Rock Discussion, Meeting Evaluations, and Annual Meeting Review Templates.</div>
                <div className="ft-example"><strong>What to prepare:</strong> Review the sprint Brain Juice on Mastering the Meeting Rhythm. Complete the Individual Priorities Breakdown. Prepare one insight from the materials, one improvement opportunity, and one Big Rock topic.</div>
                {MEETING_AGENDA.map((seg, i) => (
                    <div key={i} style={{ border: '2px solid #000', padding: 24, marginBottom: 16 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                            <div className="numbered-section">{seg.title.toUpperCase()}</div>
                            <span className="monument" style={{ fontSize: 12, color: '#6B7280' }}>{seg.time}</span>
                        </div>
                        <p style={{ fontSize: 15, color: '#374151', lineHeight: 1.6, marginBottom: 16 }}>{seg.desc}</p>
                        {seg.questions.length > 0 && (
                            <div style={{ marginBottom: 12 }}>
                                <div className="monument" style={{ fontSize: 10, color: '#6B7280', marginBottom: 8 }}>KEY QUESTIONS</div>
                                {seg.questions.map((q, qi) => (
                                    <div key={qi} style={{ display: 'flex', gap: 8, marginBottom: 4, fontSize: 14 }}>
                                        <span style={{ color: '#FFF469', background: '#000', width: 20, height: 20, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 11, flexShrink: 0 }}>{qi + 1}</span>
                                        <span>{q}</span>
                                    </div>
                                ))}
                            </div>
                        )}
                        {seg.pitfalls.length > 0 && (
                            <div style={{ background: '#FEF2F2', padding: 12 }}>
                                <div className="monument" style={{ fontSize: 10, color: '#991B1B', marginBottom: 4 }}>AVOID</div>
                                {seg.pitfalls.map((p, pi) => <div key={pi} style={{ fontSize: 13, color: '#991B1B', marginBottom: 2 }}>• {p}</div>)}
                            </div>
                        )}
                    </div>
                ))}
                <div style={{ background: '#000', color: '#fff', padding: 20, marginTop: 16 }}>
                    <div className="monument" style={{ fontSize: 11, color: '#FFF469', marginBottom: 8 }}>PRE-MORTEM PREVENTIVE STRATEGIES</div>
                    <div style={{ fontSize: 14, color: '#ccc', lineHeight: 1.8 }}>
                        • Require all participants to complete the Individual Priorities Breakdown BEFORE the meeting<br/>
                        • Use a timekeeper to ensure adherence to agenda time allocations<br/>
                        • Implement WWW (Who does What by When) at the end of each discussion point
                    </div>
                </div>
            </div>
        );
    }

    /* === TEAM STEP B: CONCLUSIONS & WWW === */
    function TeamStepConclusions({ d, u }) {
        const www = d.teamWWW || Array(5).fill(null).map(() => ({ who: '', what: '', when: '' }));
        const updateWWW = (i, f, v) => { const next = [...www]; next[i] = { ...next[i], [f]: v }; u('teamWWW', next); };
        return (
            <div className="animate-in">
                <div className="step-indicator"><span>Team Step 2 of 2</span><span className="step-time">~5 min</span></div>
                <h2 className="step-heading">CONCLUSIONS & ACTIONS</h2>
                <p className="step-hint">Document the team's key decisions and assign clear ownership for every next step.</p>
                <div className="field-group">
                    <label className="field-label">KEY TAKEAWAYS</label>
                    <textarea className="field-textarea" placeholder="What were the most important insights from the meeting? What did the team learn?" value={d.teamTakeaways || ''} onChange={e => u('teamTakeaways', e.target.value)} />
                </div>
                <div className="field-group">
                    <label className="field-label">MEETING RHYTHM DECISIONS</label>
                    <textarea className="field-textarea" placeholder="What specific meeting rhythm changes did the team agree to? (e.g. daily 15-min huddle at 9am, weekly 60-min tactical on Mondays)" value={d.teamDecisions || ''} onChange={e => u('teamDecisions', e.target.value)} />
                </div>
                <div className="field-group">
                    <label className="field-label">PROCESS TOOLS TO IMPLEMENT</label>
                    <textarea className="field-textarea" style={{ minHeight: 80 }} placeholder="Which process tools will the team adopt? Who owns each? (Meeting Readiness, Meeting Evaluation, Big Rock Discussion, Annual Review)" value={d.teamProcessTools || ''} onChange={e => u('teamProcessTools', e.target.value)} />
                </div>
                <div className="numbered-section" style={{ marginBottom: 16 }}>WHO / WHAT / WHEN</div>
                <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, marginBottom: 24 }}>
                    <thead><tr style={{ background: '#000', color: '#fff' }}>
                        <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHO</th>
                        <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHAT</th>
                        <th style={{ padding: '10px 12px', width: 130, fontFamily: "'Monument', monospace", fontSize: 11 }}>WHEN</th>
                    </tr></thead>
                    <tbody>
                        {www.map((row, i) => (
                            <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                <td style={{ padding: 8 }}><input className="field-input" style={{ border: 'none', height: 36, fontSize: 14 }} placeholder="Person responsible" value={row.who} onChange={e => updateWWW(i, 'who', e.target.value)} /></td>
                                <td style={{ padding: 8 }}><input className="field-input" style={{ border: 'none', height: 36, fontSize: 14 }} placeholder="Action item" value={row.what} onChange={e => updateWWW(i, 'what', e.target.value)} /></td>
                                <td style={{ padding: 8 }}><input className="field-input" type="date" style={{ border: 'none', height: 36, fontSize: 13 }} value={row.when} onChange={e => updateWWW(i, 'when', e.target.value)} /></td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );
    }

    /* === SIDEBAR === */
    function WizardSidebar({ step, teamUnlocked, onNavigate }) {
        const indSteps = [
            { num: 1, label: 'Priorities Breakdown' },
            { num: 2, label: 'Meeting Readiness' },
            { num: 3, label: 'Meeting Evaluation' },
            { num: 4, label: 'Big Rock Discussion' },
            { num: 5, label: 'Review & Submit' }
        ];
        const teamSteps = [
            { num: 6, label: 'Meeting Agenda' },
            { num: 7, label: 'Conclusions & WWW' }
        ];
        return (
            <div className="wizard-sidebar no-print">
                <div className="wizard-sidebar-inner">
                    <div style={{ marginBottom: 24 }}>
                        <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', color: '#fff', marginBottom: 4 }}>MEETING RHYTHM</div>
                        <div style={{ fontSize: 13, color: '#999' }}>Sprint 11</div>
                    </div>
                    <div className="sidebar-phase-header">Individual Assessment</div>
                    {indSteps.map(s => {
                        const isCompleted = step > s.num, isActive = step === s.num, isLocked = step < s.num;
                        return (
                            <div key={s.num} className={`sidebar-step-item ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''} ${isLocked ? 'locked' : ''}`} onClick={() => isCompleted && onNavigate(s.num)}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                    {isCompleted ? <CheckIcon color="#000" size={14} /> : <span className="step-num" style={{ color: isActive ? '#fff' : '#ccc' }}>{String(s.num).padStart(2, '0')}</span>}
                                    <span className="step-name" style={{ color: isLocked ? '#666' : isCompleted ? '#000' : '#fff' }}>{s.label}</span>
                                </div>
                            </div>
                        );
                    })}
                    <div className="sidebar-phase-header" style={{ opacity: teamUnlocked ? 1 : 0.4 }}>
                        {teamUnlocked ? 'Team Meeting' : 'Team (Locked)'}
                    </div>
                    {teamSteps.map(s => {
                        const isActive = step === s.num, isCompleted = step > s.num;
                        return (
                            <div key={s.num} className={`sidebar-step-item ${!teamUnlocked ? 'locked' : isActive ? 'active' : isCompleted ? 'completed' : 'locked'}`} onClick={() => teamUnlocked && isCompleted && onNavigate(s.num)}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                    {teamUnlocked && isCompleted ? <CheckIcon color="#000" size={14} /> : !teamUnlocked ? <LockIcon size={14} /> : <span className="step-num" style={{ color: isActive ? '#fff' : '#ccc' }}>{String(s.num).padStart(2, '0')}</span>}
                                    <span className="step-name" style={{ color: !teamUnlocked ? '#666' : isActive ? '#fff' : isCompleted ? '#000' : '#ccc' }}>{s.label}</span>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        );
    }

    /* === MAIN APP === */
    const totalSteps = 4;

    function MeetingRhythmApp() {
        const [step, setStep] = useState(0);
        const [data, setData] = useState({});
        const [teamData, setTeamData] = useState({});
        const [teamToolUnlocked, setTeamToolUnlocked] = useState(true); // always unlocked
        const [checkingTeamUnlock, setCheckingTeamUnlock] = useState(false);
        const [individualSubmitted, setIndividualSubmitted] = useState(false);
        const [submitStatus, setSubmitStatus] = useState(null);
        const [submitMessage, setSubmitMessage] = useState('');
        const [aiReviewing, setAiReviewing] = useState(false);
        const [priorityIdx, setPriorityIdx] = useState(0);
        const autosaveRef = useRef(null);

        const u = (field, value) => setData(prev => ({ ...prev, [field]: value }));
        const ut = (field, value) => setTeamData(prev => ({ ...prev, [field]: value }));
        const goToStep = (s) => { window.scrollTo({ top: 0, behavior: 'smooth' }); if (s === 1) setPriorityIdx(0); setStep(s); };

        // AI-gated step navigation
        const handleNext = async (fromStep) => {
            const nextStep = fromStep <= 3 ? fromStep + 0.5 : fromStep + 1;
            const userId = localStorage.getItem('ft_user_id');
            if (!userId || !window.AIChallenge) {
                goToStep(nextStep);
                return;
            }
            setAiReviewing(true);
            try {
                let stepAnswers = {};
                let stepName = '';
                if (fromStep === 1) { stepName = 'Priorities Breakdown'; stepAnswers = { priorities: data.priorities }; }
                else if (fromStep === 2) { stepName = 'Meeting Readiness'; stepAnswers = { agendaItems: data.agendaItems }; }
                else if (fromStep === 3) { stepName = 'Meeting Evaluation'; stepAnswers = { effectiveness: data.effectiveness }; }
                else if (fromStep === 4) { stepName = 'Big Rock Discussion'; stepAnswers = { bigRock: data.bigRock }; }
                const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
                if (canProceed) {
                    goToStep(nextStep);
                }
            } catch (err) {
                console.warn('[AIChallenge] Error, allowing passage:', err);
                goToStep(nextStep);
            } finally {
                setAiReviewing(false);
            }
        };

        // Autosave
        useEffect(() => {
            if (autosaveRef.current) clearTimeout(autosaveRef.current);
            autosaveRef.current = setTimeout(() => {
                try {
                    localStorage.setItem('ft_meeting_rhythm_data', JSON.stringify(data));
                    localStorage.setItem('ft_meeting_rhythm_team', JSON.stringify(teamData));
                } catch (e) { /* quota */ }
            }, CONFIG.AUTOSAVE_DELAY);
            return () => clearTimeout(autosaveRef.current);
        }, [data, teamData]);

        // Load saved data
        useEffect(() => {
            try {
                const saved = localStorage.getItem('ft_meeting_rhythm_data');
                if (saved) setData(JSON.parse(saved));
                const savedTeam = localStorage.getItem('ft_meeting_rhythm_team');
                if (savedTeam) setTeamData(JSON.parse(savedTeam));
            } catch (e) { /* parse fail */ }
        }, []);

        // Check team unlock
        const checkTeamUnlock = async () => {
            setCheckingTeamUnlock(true);
            try {
                const userId = localStorage.getItem('ft_user_id');
                if (!userId) { setCheckingTeamUnlock(false); return; }
                const res = await fetch(`https://backend-production-639c.up.railway.app/api/toolsave/team-unlock?tool_slug=meeting-rhythm-individual&user_id=${encodeURIComponent(userId)}`);
                const { data } = await res.json();
                setTeamToolUnlocked(data.unlocked);
                if (data.unlocked) {
                    console.log('[MeetingRhythm] All org members completed individual — team tool unlocked');
                } else {
                    console.log(`[MeetingRhythm] ${data.submitted}/${data.total} members completed`);
                }
            } catch (e) {
                console.warn('[MeetingRhythm] Team unlock check failed:', e);
            } finally {
                setCheckingTeamUnlock(false);
            }
        };

        useEffect(() => { if (step === 0.5) checkTeamUnlock(); }, [step]);

        // Individual submit
        const handleIndividualSubmit = async () => {
            const userId = localStorage.getItem('ft_user_id');
            if (!userId) { alert('User not authenticated.'); return; }
            const questionMappings = {
                rhythm_dates: { priorities: data.priorities, agendaItems: data.agendaItems, effectiveness: data.effectiveness, bigRock: data.bigRock }
            };
            await window.AIChallenge.submitWithChallenge(userId, 'meeting-rhythm-individual', questionMappings, {
                onReviewStart: () => { setSubmitStatus('saving'); setSubmitMessage('AI coach is reviewing...'); },
                onRevise: () => { setSubmitStatus(null); setSubmitMessage(''); goToStep(4); },
                onSubmitAnyway: () => { setSubmitStatus('success'); setSubmitMessage('Individual assessment submitted!'); setIndividualSubmitted(true); },
                onError: (err) => { setSubmitStatus('error'); setSubmitMessage('Failed: ' + err.message); }
            });
        };

        // Team submit
        const handleTeamSubmit = async () => {
            const userId = localStorage.getItem('ft_user_id');
            if (!userId) { alert('User not authenticated.'); return; }
            const teamMappings = {
                rhythm_dates: { teamDecisions: teamData.teamDecisions, teamProcessTools: teamData.teamProcessTools, www: teamData.www }
            };
            await window.AIChallenge.submitWithChallenge(userId, 'meeting-rhythm-team', teamMappings, {
                onReviewStart: () => { setSubmitStatus('saving'); setSubmitMessage('AI coach is reviewing team work...'); },
                onRevise: () => { setSubmitStatus(null); setSubmitMessage(''); goToStep(7); },
                onSubmitAnyway: () => { setSubmitStatus('success'); setSubmitMessage('Team meeting submitted successfully!'); },
                onError: (err) => { setSubmitStatus('error'); setSubmitMessage('Failed: ' + err.message); }
            });
        };

        return (
            <div className="tool-frame"><div className="tool-inner">

                {/* COVER */}
                {step === 0 && (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative', overflow: 'hidden' }}>
                        <div style={{ position: 'absolute', inset: 0, backgroundImage: 'url("https://images.unsplash.com/photo-1557804506-669a67965ba0?w=1920&q=80")', backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.4 }} />
                        <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                            <h1 className="plaak" style={{ fontSize: 64, marginBottom: 16, textTransform: 'uppercase', lineHeight: 1.1 }}>MEETING<br/>RHYTHM</h1>
                            <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48 }}>Transform chaos into clarity</p>
                            <button onClick={() => goToStep(0.5)} style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }} onMouseOver={e => e.target.style.background = '#FFF469'} onMouseOut={e => e.target.style.background = '#fff'}>START</button>
                        </div>
                    </div>
                )}

                {/* INTRO / PATH CHOOSER */}
                {step === 0.5 && (
                    <div style={{ minHeight: '100vh', background: '#000', color: '#fff', padding: '64px 32px' }}>
                        <div style={{ maxWidth: 640, margin: '0 auto' }} className="animate-in">
                            <h1 className="plaak" style={{ fontSize: 48, marginBottom: 16, textTransform: 'uppercase' }}>CHOOSE YOUR PATH</h1>
                            <p style={{ fontSize: 16, color: '#ccc', marginBottom: 48, lineHeight: 1.6 }}>
                                This sprint masters the Meeting Rhythm — the operational backbone bridging strategy and execution. You'll break down priorities, prepare meetings that work, evaluate effectiveness, and learn the Big Rock Discussion framework.
                            </p>

                            {/* Individual */}
                            <div style={{ border: '2px solid #fff', padding: 32, marginBottom: 32 }}>
                                <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', letterSpacing: '0.08em', fontWeight: 600, marginBottom: 12 }}>Individual Assessment</div>
                                <p style={{ fontSize: 15, color: '#ccc', lineHeight: 1.6, marginBottom: 24 }}>
                                    4 steps: Priorities Breakdown, Meeting Readiness, Meeting Evaluation, and Big Rock Discussion.
                                </p>
                                <button onClick={() => goToStep(1)} style={{ background: '#fff', color: '#000', border: 'none', padding: '14px 36px', fontSize: 15, fontFamily: "'Monument', monospace", letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer' }} onMouseOver={e => e.target.style.background = '#FFF469'} onMouseOut={e => e.target.style.background = '#fff'}>
                                    {individualSubmitted ? 'REVIEW INDIVIDUAL' : 'START INDIVIDUAL'}
                                </button>
                            </div>

                            {/* Team (locked) */}
                            <div style={{ border: '2px solid ' + (teamToolUnlocked ? '#fff' : '#555'), padding: 32, marginBottom: 32, opacity: teamToolUnlocked ? 1 : 0.7 }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>
                                    {!teamToolUnlocked && <LockIcon size={16} />}
                                    <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', letterSpacing: '0.08em', fontWeight: 600 }}>Team Meeting Tool</div>
                                </div>
                                {teamToolUnlocked ? (
                                    <>
                                        <p style={{ fontSize: 15, color: '#ccc', lineHeight: 1.6, marginBottom: 24 }}>Facilitate the 90-minute team meeting to align priorities and master the meeting process tools.</p>
                                        <button onClick={() => goToStep(6)} style={{ background: '#fff', color: '#000', border: 'none', padding: '14px 36px', fontSize: 15, fontFamily: "'Monument', monospace", letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer' }} onMouseOver={e => e.target.style.background = '#FFF469'} onMouseOut={e => e.target.style.background = '#fff'}>START TEAM MEETING</button>
                                    </>
                                ) : (
                                    <div onClick={(e) => { if (e.shiftKey) setTeamToolUnlocked(true); }} style={{ background: '#222', padding: '12px 16px', textAlign: 'center', color: '#666', fontFamily: "'Monument', monospace", fontSize: 12, cursor: 'default' }} title="Shift+Click to force unlock (dev only)">
                                        {checkingTeamUnlock ? 'CHECKING...' : 'LOCKED — WAITING FOR ALL TEAM MEMBERS'}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                )}

                {/* INDIVIDUAL STEPS 1-4 */}
                {[1, 2, 3, 4].includes(step) && (
                    <div className="wizard-layout">
                        <div className="wizard-main">
                            <MobileStepBar step={step} total={4} />
                            <div className="wizard-content">
                                {step === 1 && <Step1 d={data} u={u} priorityIdx={priorityIdx} setPriorityIdx={setPriorityIdx} />}
                                {step === 2 && <Step2 d={data} u={u} />}
                                {step === 3 && <Step3 d={data} u={u} />}
                                {step === 4 && <Step4 d={data} u={u} />}
                            </div>
                            <ButtonFooter
                                onBack={() => {
                                    if (step === 1 && priorityIdx > 0) { setPriorityIdx(priorityIdx - 1); window.scrollTo({ top: 0, behavior: 'smooth' }); }
                                    else if (step === 1) goToStep(0.5);
                                    else goToStep(step - 1);
                                }}
                                onNext={() => {
                                    if (step === 1) {
                                        const totalP = (data.priorities || [{},{},{}]).length;
                                        if (priorityIdx < totalP - 1) { setPriorityIdx(priorityIdx + 1); window.scrollTo({ top: 0, behavior: 'smooth' }); }
                                        else handleNext(step);
                                    } else handleNext(step);
                                }}
                                nextLabel={step === 1 && priorityIdx < ((data.priorities || [{},{},{}]).length - 1) ? `Priority ${priorityIdx + 2} →` : step === 4 ? 'Review' : aiReviewing ? 'Reviewing...' : 'Next'}
                                disabled={aiReviewing}
                            />
                        </div>
                        <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                    </div>
                )}

                {/* TRANSITION SCREENS */}
                {window.renderTransitionScreen && [1.5, 2.5, 3.5].includes(step) && window.renderTransitionScreen(step, CONFIG, totalSteps, setStep)}

                {/* STEP 5: REVIEW & SUBMIT INDIVIDUAL */}
                {step === 5 && (() => {
                    try {
                        const reviewItems = [
                            { title: 'Priorities Breakdown', content: ((data.priorities || []).filter(p => p && p.priority).length) + ' priorities with action steps' },
                            { title: 'Meeting Readiness', content: (data.meetingPurpose || '').length > 10 ? 'Purpose: ' + (data.meetingPurpose || '').substring(0, 50) + '...' : 'Not completed' },
                            { title: 'Meeting Evaluation', content: data.effectiveness ? 'Rating: ' + data.effectiveness + '/5' : 'Not completed' },
                            { title: 'Big Rock Discussion', content: (data.bigRock || {}).issue ? 'Issue: ' + ((data.bigRock || {}).issue || '').substring(0, 50) + '...' : 'Not completed' }
                        ];
                        return (
                            <div className="wizard-layout">
                                <div className="wizard-main">
                                    <div className="wizard-content animate-in">
                                        <div className="step-indicator"><span>Review & Submit</span></div>
                                        <h2 className="step-heading">YOUR MEETING TOOLKIT</h2>
                                        <p className="step-hint">Review your work across all 4 frameworks, then submit for AI coaching.</p>

                                        {reviewItems.map((s, i) => (
                                            <div key={i} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '16px 0', borderBottom: '1px solid #E5E7EB' }}>
                                                <div style={{ fontWeight: 600 }}>{s.title}</div>
                                                <div style={{ fontSize: 14, color: '#6B7280', maxWidth: 300, textAlign: 'right' }}>{s.content}</div>
                                            </div>
                                        ))}

                                        <CaseStudy
                                            before="A 40-person logistics company spent 25 hours per week per manager in meetings. Most had no agenda, no clear owner, and ended without action items."
                                            after="After implementing the Meeting Rhythm (daily huddles, weekly tacticals, quarterly reviews), meeting time dropped to 8 hours per week. Quarterly targets went from 60% to 92% completion."
                                            quote="The meeting rhythm gave us back 17 hours per week per manager — 850 productive hours per year. — COO, logistics company"
                                        />

                                        {submitStatus && <div style={{ padding: 16, marginTop: 16, background: submitStatus === 'success' ? '#F0FDF4' : submitStatus === 'error' ? '#FEF2F2' : '#F5F5F5', border: '1px solid ' + (submitStatus === 'success' ? '#BBF7D0' : submitStatus === 'error' ? '#FECACA' : '#E0E0E0'), textAlign: 'center' }}>{submitMessage}</div>}
                                    </div>
                                    <ButtonFooter onBack={() => goToStep(4)} onNext={handleIndividualSubmit} nextLabel={submitStatus === 'saving' ? 'AI Reviewing...' : 'Submit Individual'} disabled={submitStatus === 'saving'} />
                                </div>
                                <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                            </div>
                        );
                    } catch(e) {
                        console.error('[MeetingRhythm] Review render error:', e);
                        return (
                            <div className="wizard-layout">
                                <div className="wizard-main">
                                    <div className="wizard-content animate-in">
                                        <div className="step-indicator"><span>Review & Submit</span></div>
                                        <h2 className="step-heading">YOUR MEETING TOOLKIT</h2>
                                        <p style={{ color: '#6B7280', marginBottom: 24 }}>Loading your meeting toolkit summary...</p>
                                        {submitStatus && <div style={{ padding: 16, marginTop: 16, background: submitStatus === 'success' ? '#F0FDF4' : submitStatus === 'error' ? '#FEF2F2' : '#F5F5F5', border: '1px solid ' + (submitStatus === 'success' ? '#BBF7D0' : submitStatus === 'error' ? '#FECACA' : '#E0E0E0'), textAlign: 'center' }}>{submitMessage}</div>}
                                    </div>
                                    <ButtonFooter onBack={() => goToStep(4)} onNext={handleIndividualSubmit} nextLabel={submitStatus === 'saving' ? 'AI Reviewing...' : 'Submit Individual'} disabled={submitStatus === 'saving'} />
                                </div>
                                <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                            </div>
                        );
                    }
                })()}

                {/* TEAM STEPS 6-7 */}
                {[6, 7].includes(step) && (
                    <div className="wizard-layout">
                        <div className="wizard-main">
                            <MobileStepBar step={step - 5} total={2} />
                            <div className="wizard-content">
                                {step === 6 && <TeamStepAgenda />}
                                {step === 7 && <TeamStepConclusions d={teamData} u={ut} />}
                            </div>
                            <ButtonFooter
                                onBack={() => step === 6 ? goToStep(0.5) : goToStep(6)}
                                onNext={() => step === 6 ? goToStep(7) : handleTeamSubmit()}
                                nextLabel={step === 7 ? (submitStatus === 'saving' ? 'AI Reviewing...' : 'Submit Team') : 'Next'}
                                disabled={step === 7 && submitStatus === 'saving'}
                            />
                        </div>
                        <WizardSidebar step={step} teamUnlocked={teamToolUnlocked} onNavigate={goToStep} />
                    </div>
                )}

            </div></div>
        );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<MeetingRhythmApp />);
</script>
</body>
</html>
