<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprint 09 - Focus, Discipline & Productivity | Fast Track</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>
    <script src="../../shared/js/transition-screen.js"></script>
    <link rel="preload" href="Plaak3Trial-43-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="RiformaLL-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="MonumentGrotesk-Mono.woff2" as="font" type="font/woff2" crossorigin>
    <style>
        @font-face { font-family: 'Plaak'; src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: normal; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: 600; font-display: swap; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); font-display: swap; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Riforma', -apple-system, sans-serif; font-size: 16px; color: #000; background: #000; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
        * { scrollbar-width: thin; scrollbar-color: #000 transparent; }
        .plaak { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }
        .tool-frame, .tool-inner { background: #fff; min-height: 100vh; }
        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; }
        .wizard-content { max-width: 720px; width: 100%; margin: 0 auto; padding: 48px 32px; flex: 1; }
        .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }
        .wizard-sidebar-inner { padding: 32px 24px; height: 100%; overflow-y: auto; overflow-x: hidden; }
        .sidebar-step-item { padding: 12px; margin-bottom: 8px; border-left: 3px solid transparent; transition: all 0.2s ease; }
        .sidebar-step-item.active { border-left-color: #FFF469; background: #222; }
        .sidebar-step-item.completed { background: #fff; color: #000; border-left-color: #fff; cursor: pointer; }
        .sidebar-step-item.completed:hover { background: #E0E0E0; }
        .sidebar-step-item.locked { opacity: 0.5; }
        .sidebar-step-item .step-num, .sidebar-step-item .step-name { font-family: 'Riforma', sans-serif; font-size: 14px; }
        .sidebar-snippet { font-size: 12px; margin-top: 4px; opacity: 0.7; line-height: 1.3; }
        .sidebar-phase-header { font-family: 'Monument', monospace; font-size: 10px; text-transform: uppercase; letter-spacing: 0.08em; color: #FFF469; padding: 8px 12px; margin-top: 16px; margin-bottom: 4px; }
        .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; text-transform: uppercase; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
        .step-hint { font-size: 16px; color: #6B7280; line-height: 1.5; margin: 0 0 32px 0; }
        .ft-label { display: flex; align-items: center; gap: 6px; font-family: 'Monument', monospace; font-size: 14px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; color: #000; margin-bottom: 8px; }
        .ft-required { color: #DC2626; font-weight: 700; }
        .ft-input { width: 100%; height: 44px; padding: 8px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .ft-input:focus { outline: none; border-color: #000; box-shadow: 0 0 0 3px #FFF469; }
        .ft-textarea { width: 100%; min-height: 120px; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; resize: none !important; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .ft-textarea:focus { outline: none; border-color: #000; box-shadow: 0 0 0 3px #FFF469; }
        .ft-select { width: 100%; height: 44px; padding: 8px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; cursor: pointer; }
        .ft-select:focus { outline: none; border-color: #000; box-shadow: 0 0 0 3px #FFF469; }
        .ft-help { font-size: 14px; color: #6B7280; margin-top: 4px; line-height: 1.5; }
        .ft-field-group { margin-bottom: 24px; }
        .ft-section { margin-bottom: 32px; }
        .ft-insight { background: #FFF469; border: 3px solid #000; padding: 16px; margin-bottom: 32px; }
        .ft-example { background: #F3F4F6; padding: 16px; margin-bottom: 8px; font-size: 14px; line-height: 1.6; color: #1F2937; }
        .btn-footer { position: sticky; bottom: 0; z-index: 10; display: flex; justify-content: space-between; align-items: center; padding: 16px 32px; border-top: 1px solid #E5E7EB; background: #fff; width: 100%; }
        .btn-back { background: #fff; color: #000; border: 2px solid #000; padding: 12px 24px; font-family: 'Riforma', sans-serif; font-size: 16px; cursor: pointer; transition: all 0.2s ease; min-height: 44px; }
        .btn-back:hover { background: #F3F4F6; }
        .btn-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 24px; font-family: 'Riforma', sans-serif; font-size: 16px; cursor: pointer; transition: all 0.2s ease; min-height: 44px; }
        .btn-next:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-next:disabled { background: #E5E7EB; color: #9CA3AF; border-color: #E5E7EB; cursor: not-allowed; }
        .btn-primary { background: #000; color: #fff; padding: 16px 32px; border: 2px solid #000; font-family: 'Riforma', sans-serif; font-size: 18px; cursor: pointer; transition: all 0.2s ease; }
        .btn-primary:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-primary:disabled { background: #E0E0E0; color: #9CA3AF; cursor: not-allowed; opacity: 0.5; }
        .mobile-step-bar { display: none; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; background: #F3F4F6; }
        .mobile-step-bar .bar-text { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 6px; }
        .mobile-progress { height: 3px; background: #E5E7EB; width: 100%; }
        .mobile-progress-fill { height: 100%; background: #000; transition: width 0.3s ease; }
        .numbered-section { background: #000; color: #fff; padding: 8px 14px; font-size: 14px; font-weight: bold; letter-spacing: 0.5px; display: inline-block; font-family: 'Monument', monospace; }
        .badge { display: inline-flex; align-items: center; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: 500; }
        .badge-green { background: #D1FAE5; color: #065F46; }
        .badge-yellow { background: #FFF469; color: #000; }
        .badge-red { background: #FEE2E2; color: #991B1B; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeSlideIn 0.3s ease-out; }
        @media print { .no-print { display: none !important; } }
        @media (min-width: 769px) and (max-width: 1024px) { .wizard-sidebar { width: 220px; } .wizard-sidebar-inner { padding: 24px 16px; } }
        @media (max-width: 768px) { .wizard-sidebar { display: none; } .mobile-step-bar { display: block; } .wizard-content { padding: 24px 16px; } .step-heading { font-size: 24px; } .btn-footer { padding: 12px 16px; } }
        @media (max-width: 480px) { .step-heading { font-size: 20px; } .wizard-content { padding: 20px 12px; } }
        .quadrant-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .quadrant-cell { border: 1px solid #E5E7EB; padding: 16px; min-height: 100px; }
        .quadrant-cell h4 { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #000; margin-bottom: 8px; }
        .toggle-row { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #F3F4F6; }
        .toggle-btn { width: 48px; height: 28px; border-radius: 14px; border: 2px solid #E5E7EB; background: #fff; cursor: pointer; position: relative; transition: all 0.2s; }
        .toggle-btn.on { background: #000; border-color: #000; }
        .toggle-btn::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; border-radius: 50%; background: #fff; transition: transform 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .toggle-btn.on::after { transform: translateX(20px); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const CONFIG = {
            SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
            TOOL_SLUG: 'focus',
            STORAGE_KEY: 'ft_focus_autosave',
            AUTOSAVE_DELAY: 2000,
            TRANSITION_CONTENT: {
                1: {
                    brutalTruth: 'The average executive wastes 21 hours per week on low-value activities they mistake for work. Energy spent on the wrong tasks does not just waste time — it crowds out the 2-3 things that actually move the needle.',
                    peerProof: '"A founder who logged her week discovered 60% of her time went to reactive email and meetings that added no value. Cutting them freed 15 hours for sales — her close rate doubled in 6 weeks. She did the same work in 40% of the time."'
                },
                2: {
                    brutalTruth: 'Saying yes to everything is the most polite way to say no to your real priorities. Every meeting you attend, every request you accept, is a withdrawal from the limited account of focused time. Protect it like cash.',
                    peerProof: '"A CEO implemented a \'no meetings before noon\' rule for deep work. In 90 days, his team shipped a product feature backlog that had been stuck for 6 months. The rule cost nothing. The lack of it had cost €200k in delays."'
                },
                3: {
                    brutalTruth: 'Habits do not fail because of willpower — they fail because of environment. If your default is reactive (phone in hand, inbox open), the effort required to be proactive multiplies every day until the habit collapses.',
                    peerProof: '"A founder redesigned her office to have a standing desk for shallow work and a separate table with no screens for deep work. Deep work hours tripled without any extra time investment. The space created the habit."'
                }
            },
            CLOSING_MESSAGES: {
                1: { title: 'PRIORITIES RANKED', text: 'Your time priorities are clear. Next: build the daily structure to protect them.' },
                2: { title: 'BOUNDARIES SET', text: 'Your defences are designed. Next: lock in the routines that make focus automatic.' },
                3: { title: 'SYSTEM BUILT', text: 'Your focus system is complete. The real work now is protecting it. Review weekly.' }
            }
        };

        const totalSteps = 9;

        const { createClient } = supabase;
        const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
        window.supabaseClient = supabaseClient;
        ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);
        CognitiveLoad.init('focus', {
            insights: [
                "A focused individual can be up to 5x more productive than distracted counterparts.",
                "Lack of focus leads to a 30% increase in stress levels. Train your focus like a muscle."
            ],
            caseStudy: {
                before: "A CEO of a 150-person tech company was working 12-hour days, constantly switching between emails, meetings, and strategic tasks. Productivity was low despite long hours. The team mirrored this scattered approach — projects were late, priorities unclear.",
                after: "After implementing the Fast Track Focus Protocol — daily brain dumps, impact/easy prioritization, distraction blocking, and 90-minute deep work sprints — the CEO cut to 8-hour days while increasing strategic output by 60%. The team adopted structured routines and flow blocks, reducing project delivery time by 40%.",
                quote: "I thought being busy meant being productive. The Focus tools showed me I was spending 80% of my time on 20% impact activities. Flipping that ratio changed everything."
            }
        });
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy } = CognitiveLoad.components;

        const MEETING_AGENDA = [
            { num: 1, title: 'Review of Individual Focus Insights', duration: '10 min', description: 'Each member shares key insight from individual tools. What patterns emerged? Where is focus weakest?', keyQuestion: 'What is the single biggest focus killer across our team?', pitfall: 'Surface-level sharing without honest self-reflection.' },
            { num: 2, title: 'Guru Presentation: Focus Frameworks', duration: '15 min', description: 'Present Focus Protocol, Sprint Method, and Flow State frameworks. Connect to team-specific challenges.', keyQuestion: 'Which framework will have the biggest impact on our team right now?', pitfall: 'Presenting theory without linking to team reality.' },
            { num: 3, title: 'Group Discussion: Routines & Distractions', duration: '30 min', description: 'Discuss team-wide routines, distraction patterns, and flow blockers. Identify common themes and propose collective solutions.', keyQuestion: 'What team-level changes would give everyone more deep work time?', pitfall: 'Focusing on individual fixes while ignoring systemic issues (meeting overload, Slack culture).' },
            { num: 4, title: 'Decision & Action Points', duration: '20 min', description: 'Finalize 2-3 team-level focus strategies. Assign owners and timelines.', keyQuestion: 'What specific changes can we implement this week?', pitfall: 'Vague commitments without clear owners or deadlines.' },
            { num: 5, title: 'Reflection & Accountability', duration: '15 min', description: 'Each member states their #1 personal focus commitment. Set follow-up cadence.', keyQuestion: 'How will we hold each other accountable?', pitfall: 'Ending without individual commitments.' }
        ];

        /* === SHARED COMPONENTS === */
        function CheckIcon({ color = "#fff", size = 16 }) {
            return <svg width={size} height={size} viewBox="0 0 24 24" fill={color}><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>;
        }
        function LockIcon({ size = 20, color = "#9CA3AF" }) {
            return <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>;
        }
        function ButtonFooter({ onBack, onNext, nextLabel = 'Next', showBack = true, disabled = false }) {
            return (
                <div className="btn-footer no-print">
                    {showBack ? <button className="btn-back" onClick={onBack}>&larr; Back</button> : <div/>}
                    <button className="btn-next" disabled={disabled} onClick={onNext}>{nextLabel} &rarr;</button>
                </div>
            );
        }
        function MobileStepBar({ currentStep, totalSteps }) {
            const p = Math.round((Math.min(currentStep, totalSteps) / totalSteps) * 100);
            return <div className="mobile-step-bar no-print"><div className="bar-text">Step {Math.min(currentStep, totalSteps)} of {totalSteps}</div><div className="mobile-progress"><div className="mobile-progress-fill" style={{ width: `${p}%` }}/></div></div>;
        }

        /* === SIDEBAR === */
        function WizardSidebar({ currentStep, mode, onNavigate }) {
            const indSteps = [
                { num: 1, label: 'Empty Your Brain' }, { num: 2, label: 'Daily Plan' },
                { num: 3, label: 'Eliminate 1/2' }, { num: 4, label: 'Eliminate 2/2' },
                { num: 5, label: 'Distractions' }, { num: 6, label: 'Key Routines' },
                { num: 7, label: 'Routines Builder' }, { num: 8, label: 'Flow State' },
                { num: 9, label: 'Review & Submit' }
            ];
            const teamSteps = [{ num: 10, label: 'Meeting Agenda' }, { num: 11, label: 'Conclusions & WWW' }];
            const s = Math.ceil(currentStep);
            const renderItem = (item) => {
                const done = s > item.num, active = s === item.num, locked = s < item.num;
                return (
                    <div key={item.num} className={`sidebar-step-item ${done?'completed':''} ${active?'active':''} ${locked?'locked':''}`}
                        onClick={() => done && onNavigate && onNavigate(item.num)}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                            {done ? <CheckIcon color="#000" size={14}/> : <span className="step-num" style={{ color: active?'#fff':'#ccc' }}>{String(item.num).padStart(2,'0')}</span>}
                            <span className="step-name" style={{ color: locked?'#666':done?'#000':'#fff' }}>{item.label}</span>
                        </div>
                    </div>
                );
            };
            return (
                <div className="wizard-sidebar no-print"><div className="wizard-sidebar-inner">
                    <div style={{ marginBottom: 24 }}>
                        <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', color: '#fff', marginBottom: 4 }}>FOCUS PROTOCOL</div>
                        <div style={{ fontSize: 13, color: '#999' }}>{mode==='team'?'~90 min':'~60 min'}</div>
                    </div>
                    {mode === 'individual' && <><div className="sidebar-phase-header">Individual Phase</div>{indSteps.map(renderItem)}</>}
                    {mode === 'team' && <><div className="sidebar-phase-header">Team Meeting</div>{teamSteps.map(renderItem)}</>}
                </div></div>
            );
        }

        /* === STEP 1: EMPTY YOUR BRAIN === */
        function Step1({ d, u }) {
            const [openSection, setOpenSection] = useState('dump');

            const AccordionButton = ({ sectionId, label }) => (
                <button
                    onClick={() => setOpenSection(openSection === sectionId ? null : sectionId)}
                    style={{
                        width: '100%', display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                        background: openSection === sectionId ? '#000' : '#f5f5f5',
                        color: openSection === sectionId ? '#fff' : '#000',
                        border: '2px solid #000', padding: '12px 16px', cursor: 'pointer', marginBottom: 16,
                        fontFamily: "'Monument', monospace", fontSize: 11,
                        textTransform: 'uppercase', letterSpacing: '0.06em'
                    }}
                >
                    <span>{label}</span>
                    <span style={{ fontSize: 18 }}>{openSection === sectionId ? '−' : '+'}</span>
                </button>
            );

            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 1 of 9</span></div>
                    <h2 className="step-heading">EMPTY YOUR BRAIN</h2>
                    <p className="step-hint">Dump everything on your mind — tasks, worries, ideas, deadlines. Get it all out. Then categorize and pick your top 3 priorities.</p>
                    <div className="ft-insight"><strong>Why this works:</strong> Your brain is for having ideas, not holding them. A brain dump frees cognitive bandwidth for deep work. Studies show writing down tasks reduces anxiety by 20%.</div>

                    {/* Brain Dump Section */}
                    <AccordionButton sectionId="dump" label="Brain Dump" />
                    {openSection === 'dump' && (
                        <div className="ft-section" style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                            <div className="ft-field-group">
                                <label className="ft-label">Brain Dump <span className="ft-required">*</span></label>
                                <textarea className="ft-textarea" style={{ minHeight: 200 }} placeholder="Write everything that's on your mind — tasks, projects, worries, ideas, deadlines, calls to make, emails to send..." value={d.brainDump||''} onChange={e=>u('brainDump',e.target.value)}/>
                                <div className="ft-help">Don't filter or organize yet. Just get it all out.</div>
                            </div>
                        </div>
                    )}

                    {/* Priority Matrix Section */}
                    <AccordionButton sectionId="matrix" label="Priority Matrix" />
                    {openSection === 'matrix' && (
                        <div className="ft-section" style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                            <label className="ft-label">Categorize Your Items</label>
                            <p className="ft-help" style={{ marginBottom: 16 }}>Sort your brain dump items into quadrants. Write the relevant items in each box.</p>
                            <div className="quadrant-grid">
                                <div className="quadrant-cell" style={{ borderTop: '3px solid #000', borderLeft: '3px solid #000' }}>
                                    <h4>Urgent + Important</h4>
                                    <textarea className="ft-textarea" style={{ minHeight: 80, border: 'none', padding: 0 }} placeholder="Do these first..." value={d.q1UrgentImportant||''} onChange={e=>u('q1UrgentImportant',e.target.value)}/>
                                </div>
                                <div className="quadrant-cell" style={{ borderTop: '3px solid #000' }}>
                                    <h4>Important + Not Urgent</h4>
                                    <textarea className="ft-textarea" style={{ minHeight: 80, border: 'none', padding: 0 }} placeholder="Schedule these..." value={d.q2ImportantNotUrgent||''} onChange={e=>u('q2ImportantNotUrgent',e.target.value)}/>
                                </div>
                                <div className="quadrant-cell" style={{ borderLeft: '3px solid #000' }}>
                                    <h4>Urgent + Not Important</h4>
                                    <textarea className="ft-textarea" style={{ minHeight: 80, border: 'none', padding: 0 }} placeholder="Delegate these..." value={d.q3UrgentNotImportant||''} onChange={e=>u('q3UrgentNotImportant',e.target.value)}/>
                                </div>
                                <div className="quadrant-cell">
                                    <h4>Not Urgent + Not Important</h4>
                                    <textarea className="ft-textarea" style={{ minHeight: 80, border: 'none', padding: 0 }} placeholder="Eliminate these..." value={d.q4Neither||''} onChange={e=>u('q4Neither',e.target.value)}/>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Top Priorities Section */}
                    <AccordionButton sectionId="priorities" label="Top 3 Priorities" />
                    {openSection === 'priorities' && (
                        <div className="ft-section" style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                            <label className="ft-label">Top 3 Priorities <span className="ft-required">*</span></label>
                            <p className="ft-help" style={{ marginBottom: 12 }}>From your Urgent+Important quadrant, pick the 3 that will have the most impact.</p>
                            {[1,2,3].map(n => (
                                <div key={n} style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 12 }}>
                                    <div className="numbered-section">{n}</div>
                                    <input className="ft-input" placeholder={`Priority ${n}`} value={d[`priority${n}`]||''} onChange={e=>u(`priority${n}`,e.target.value)}/>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        /* === STEP 2: DAILY PLAN === */
        function Step2({ d, u }) {
            const [openSection, setOpenSection] = useState('dailyPlan');
            const days = ['Monday','Tuesday','Wednesday','Thursday','Friday'];

            const AccordionButton = ({ sectionId, label }) => (
                <button
                    onClick={() => setOpenSection(openSection === sectionId ? null : sectionId)}
                    style={{
                        width: '100%', display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                        background: openSection === sectionId ? '#000' : '#f5f5f5',
                        color: openSection === sectionId ? '#fff' : '#000',
                        border: '2px solid #000', padding: '12px 16px', cursor: 'pointer', marginBottom: 16,
                        fontFamily: "'Monument', monospace", fontSize: 11,
                        textTransform: 'uppercase', letterSpacing: '0.06em'
                    }}
                >
                    <span>{label}</span>
                    <span style={{ fontSize: 18 }}>{openSection === sectionId ? '−' : '+'}</span>
                </button>
            );

            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 2 of 9</span></div>
                    <h2 className="step-heading">YOUR DAILY PLAN</h2>
                    <p className="step-hint">Break your top 3 priorities into 3 actionable sub-steps each. Then schedule your Gold Hour and set up evening reflection.</p>
                    <div className="ft-insight"><strong>Fast Track Tip:</strong> Schedule your most challenging tasks for times when your energy is highest. Use technology mindfully — turn off notifications during deep work.</div>

                    {/* Daily Plan Section */}
                    <AccordionButton sectionId="dailyPlan" label="Daily Plan - Break Down Each Priority" />
                    {openSection === 'dailyPlan' && (
                        <div style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                            {[1,2,3].map(p => (
                                <div key={p} className="ft-section" style={{ border: '1px solid #E5E7EB', padding: 20, marginBottom: 16 }}>
                                    <label className="ft-label">Priority {p}: {d[`priority${p}`] || `(set in Step 1)`}</label>
                                    {[1,2,3].map(s => (
                                        <div key={s} style={{ marginBottom: 8 }}>
                                            <input className="ft-input" placeholder={`Sub-step ${s} — What specific action will you take?`} value={d[`p${p}s${s}`]||''} onChange={e=>u(`p${p}s${s}`,e.target.value)}/>
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Gold Hour Section */}
                    <AccordionButton sectionId="goldHour" label="Gold Hour - Peak Focus Block" />
                    {openSection === 'goldHour' && (
                        <div className="ft-section" style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                            <label className="ft-label">Gold Hour — Your Peak Focus Block</label>
                            <p className="ft-help" style={{ marginBottom: 12 }}>Block one distraction-free hour each day for your #1 priority. When is your peak focus time?</p>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, minmax(100px, 1fr))', gap: 8, overflow: 'visible' }}>
                                {days.map(day => (
                                    <div key={day} style={{ minWidth: 0 }}>
                                        <div className="monument" style={{ fontSize: 10, textTransform: 'uppercase', marginBottom: 4, textAlign: 'center' }}>{day.slice(0,3)}</div>
                                        <input className="ft-input" type="time" style={{ textAlign: 'center', minWidth: '80px', width: '100%' }} value={d[`gold${day}`]||''} onChange={e=>u(`gold${day}`,e.target.value)}/>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Evening Reflection Section */}
                    <AccordionButton sectionId="evening" label="Evening Reflection" />
                    {openSection === 'evening' && (
                        <div className="ft-section" style={{ border: '2px solid #000', borderTop: 'none', padding: 20, marginBottom: 16 }}>
                            <label className="ft-label">Evening Reflection</label>
                            <textarea className="ft-textarea" placeholder="How will you reflect each evening? What questions will you ask yourself? e.g., Did I work on my #1 priority during Gold Hour? What distracted me? What will I do differently tomorrow?" value={d.eveningReflection||''} onChange={e=>u('eveningReflection',e.target.value)}/>
                        </div>
                    )}
                </div>
            );
        }

        /* === STEP 3: ELIMINATE 1/2 — Proficiency × Passion Matrix === */
        function Step3({ d, u }) {
            const activities = d.activities || Array(8).fill(null).map(()=>({ name: '', proficiency: 0, passion: 0 }));
            const updateAct = (i, field, val) => {
                const next = [...activities]; next[i] = { ...next[i], [field]: val }; u('activities', next);
            };
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 3 of 9</span></div>
                    <h2 className="step-heading">ELIMINATE, LIMIT, DELEGATE [1/2]</h2>
                    <p className="step-hint">List your regular activities and rate each on Proficiency and Passion. Activities where you score low on both are prime candidates for elimination or delegation.</p>
                    <div className="ft-insight"><strong>80/20 Rule:</strong> 80% of your results come from 20% of your activities. Identify the vital few and eliminate the trivial many.</div>
                    <div style={{ overflowX: 'auto' }}>
                        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, tableLayout: 'auto' }}>
                            <thead>
                                <tr style={{ background: '#000', color: '#fff' }}>
                                    <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.05em' }}>ACTIVITY</th>
                                    <th style={{ padding: '10px 12px', minWidth: 120, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 11, whiteSpace: 'nowrap' }}>PROFICIENCY</th>
                                    <th style={{ padding: '10px 12px', minWidth: 120, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 11, whiteSpace: 'nowrap' }}>PASSION</th>
                                    <th style={{ padding: '10px 12px', minWidth: 100, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 11, whiteSpace: 'nowrap' }}>QUADRANT</th>
                                </tr>
                            </thead>
                            <tbody>
                                {activities.map((act, i) => {
                                    const prof = parseInt(act.proficiency)||0, pass = parseInt(act.passion)||0;
                                    let quad = '—';
                                    if (prof > 0 && pass > 0) {
                                        if (prof >= 2 && pass >= 2) quad = 'Keep';
                                        else if (prof >= 2 && pass < 2) quad = 'Delegate';
                                        else if (prof < 2 && pass >= 2) quad = 'Develop';
                                        else quad = 'Eliminate';
                                    }
                                    const qColor = quad === 'Keep' ? '#065F46' : quad === 'Eliminate' ? '#991B1B' : quad === 'Delegate' ? '#92400E' : quad === 'Develop' ? '#1E40AF' : '#9CA3AF';
                                    return (
                                        <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                            <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder={`Activity ${i+1}`} value={act.name} onChange={e=>updateAct(i,'name',e.target.value)}/></td>
                                            <td style={{ padding: 8, textAlign: 'center', minWidth: 120 }}>
                                                <select className="ft-select" style={{ height: 36, minWidth: '100px', width: '100%' }} value={act.proficiency} onChange={e=>updateAct(i,'proficiency',e.target.value)}>
                                                    <option value={0}>—</option><option value={1}>Low</option><option value={2}>Med</option><option value={3}>High</option>
                                                </select>
                                            </td>
                                            <td style={{ padding: 8, textAlign: 'center', minWidth: 120 }}>
                                                <select className="ft-select" style={{ height: 36, minWidth: '100px', width: '100%' }} value={act.passion} onChange={e=>updateAct(i,'passion',e.target.value)}>
                                                    <option value={0}>—</option><option value={1}>Low</option><option value={2}>Med</option><option value={3}>High</option>
                                                </select>
                                            </td>
                                            <td style={{ padding: 8, textAlign: 'center', minWidth: 100, whiteSpace: 'nowrap' }}><span style={{ color: qColor, fontWeight: 600, fontSize: 12 }}>{quad}</span></td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                    <div className="ft-help" style={{ marginTop: 8 }}>High Proficiency + High Passion = Keep. Low both = Eliminate. High Prof/Low Pass = Delegate. Low Prof/High Pass = Develop skills.</div>
                </div>
            );
        }

        /* === STEP 4: ELIMINATE 2/2 — Action Plan === */
        function Step4({ d, u }) {
            const lowItems = (d.activities||[]).filter(a => a.name && (parseInt(a.proficiency)||0) < 2 || (parseInt(a.passion)||0) < 2).map(a=>a.name).filter(Boolean);
            const elimActions = d.elimActions || Array(5).fill(null).map(()=>({ activity: '', sayNo: false, delegate: false, automate: false, limit: false }));
            const updateElim = (i, field, val) => { const next = [...elimActions]; next[i] = { ...next[i], [field]: val }; u('elimActions', next); };
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 4 of 9</span></div>
                    <h2 className="step-heading">ELIMINATE, LIMIT, DELEGATE [2/2]</h2>
                    <p className="step-hint">For each low-value activity, decide your action: Say NO, Delegate, Automate, or Limit. Every hour freed = an hour for deep work.</p>
                    {lowItems.length > 0 && (
                        <div className="ft-example" style={{ marginBottom: 24 }}>
                            <strong>Low-value activities from Step 3:</strong> {lowItems.join(', ')}
                        </div>
                    )}
                    <div style={{ overflowX: 'auto' }}>
                        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14 }}>
                            <thead>
                                <tr style={{ background: '#000', color: '#fff' }}>
                                    <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>ACTIVITY</th>
                                    <th style={{ padding: '10px 8px', width: 70, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 10 }}>SAY NO</th>
                                    <th style={{ padding: '10px 8px', width: 80, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 10 }}>DELEGATE</th>
                                    <th style={{ padding: '10px 8px', width: 80, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 10 }}>AUTOMATE</th>
                                    <th style={{ padding: '10px 8px', width: 65, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 10 }}>LIMIT</th>
                                </tr>
                            </thead>
                            <tbody>
                                {elimActions.map((ea, i) => (
                                    <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                        <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder={lowItems[i] || `Activity ${i+1}`} value={ea.activity} onChange={e=>updateElim(i,'activity',e.target.value)}/></td>
                                        {['sayNo','delegate','automate','limit'].map(f => (
                                            <td key={f} style={{ padding: 8, textAlign: 'center' }}>
                                                <input type="checkbox" checked={ea[f]||false} onChange={e=>updateElim(i,f,e.target.checked)} style={{ width: 20, height: 20, cursor: 'pointer' }}/>
                                            </td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div className="ft-field-group" style={{ marginTop: 24 }}>
                        <label className="ft-label">Delegation Plan</label>
                        <textarea className="ft-textarea" placeholder="For items you'll delegate: Who will take over? By when? What handoff is needed?" value={d.delegationPlan||''} onChange={e=>u('delegationPlan',e.target.value)}/>
                    </div>
                </div>
            );
        }

        /* === STEP 5: DISTRACTIONS === */
        function Step5({ d, u }) {
            const ifThens = d.ifThens || Array(5).fill(null).map(()=>({ distraction: '', ifThen: '' }));
            const updateIT = (i, f, v) => { const next = [...ifThens]; next[i] = { ...next[i], [f]: v }; u('ifThens', next); };
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 5 of 9</span></div>
                    <h2 className="step-heading">REDUCE DISTRACTIONS</h2>
                    <p className="step-hint">Map your distractions on the Control/No-Control × Annoying/Fun quadrant. Then create If-Then plans for the ones you can control.</p>
                    <div className="ft-insight"><strong>Research:</strong> Interruptions from emails and calls increase stress by 15%. It takes 23 minutes to refocus after a distraction. Managing digital interactions is essential.</div>
                    <div className="quadrant-grid">
                        <div className="quadrant-cell" style={{ borderTop: '3px solid #DC2626', borderLeft: '3px solid #DC2626' }}>
                            <h4 style={{ color: '#DC2626' }}>No Control + Annoying</h4>
                            <textarea className="ft-textarea" style={{ minHeight: 70, border: 'none', padding: 0 }} placeholder="e.g., Office noise, colleague interruptions..." value={d.dqNoControlAnnoying||''} onChange={e=>u('dqNoControlAnnoying',e.target.value)}/>
                        </div>
                        <div className="quadrant-cell" style={{ borderTop: '3px solid #92400E' }}>
                            <h4 style={{ color: '#92400E' }}>No Control + Fun</h4>
                            <textarea className="ft-textarea" style={{ minHeight: 70, border: 'none', padding: 0 }} placeholder="e.g., Interesting conversations, spontaneous meetings..." value={d.dqNoControlFun||''} onChange={e=>u('dqNoControlFun',e.target.value)}/>
                        </div>
                        <div className="quadrant-cell" style={{ borderLeft: '3px solid #000' }}>
                            <h4>Control + Annoying</h4>
                            <textarea className="ft-textarea" style={{ minHeight: 70, border: 'none', padding: 0 }} placeholder="e.g., Email notifications, phone buzzing..." value={d.dqControlAnnoying||''} onChange={e=>u('dqControlAnnoying',e.target.value)}/>
                        </div>
                        <div className="quadrant-cell">
                            <h4>Control + Fun</h4>
                            <textarea className="ft-textarea" style={{ minHeight: 70, border: 'none', padding: 0 }} placeholder="e.g., Social media, news browsing..." value={d.dqControlFun||''} onChange={e=>u('dqControlFun',e.target.value)}/>
                        </div>
                    </div>
                    <div className="ft-section">
                        <label className="ft-label">If-Then Distraction Plan <span className="ft-required">*</span></label>
                        <p className="ft-help" style={{ marginBottom: 12 }}>For distractions you CAN control, create automatic responses.</p>
                        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14 }}>
                            <thead><tr style={{ background: '#000', color: '#fff' }}>
                                <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>IF (distraction)</th>
                                <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>THEN (my response)</th>
                            </tr></thead>
                            <tbody>
                                {ifThens.map((it, i) => (
                                    <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                        <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder={`e.g., Phone buzzes during focus block`} value={it.distraction} onChange={e=>updateIT(i,'distraction',e.target.value)}/></td>
                                        <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder={`e.g., Put phone face-down, check after block`} value={it.ifThen} onChange={e=>updateIT(i,'ifThen',e.target.value)}/></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div className="ft-field-group">
                        <label className="ft-label">Additional Focus-Protecting Activities</label>
                        <textarea className="ft-textarea" placeholder="What else will you do to protect your focus? e.g., Use 'Do Not Disturb' during Gold Hour, close email app, use website blocker, noise-canceling headphones..." value={d.additionalFocus||''} onChange={e=>u('additionalFocus',e.target.value)}/>
                    </div>
                </div>
            );
        }

        /* === STEP 6: KEY ROUTINES === */
        function Step6({ d, u }) {
            const routines = d.routines || Array(7).fill(null).map(()=>({ name: '', minutes: '' }));
            const updateR = (i, f, v) => { const next = [...routines]; next[i] = { ...next[i], [f]: v }; u('routines', next); };
            const totalMins = routines.reduce((s, r) => s + (parseInt(r.minutes)||0), 0);
            const sleepMins = parseInt(d.sleepMinutes) || 480;
            const available = 1440 - sleepMins - totalMins;
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 6 of 9</span></div>
                    <h2 className="step-heading">MY KEY DAILY ROUTINES</h2>
                    <p className="step-hint">Define your 7 non-negotiable daily routines. These are the habits that protect your energy, focus, and performance. Track the time they require.</p>
                    <div className="ft-insight"><strong>Habits automate excellence.</strong> Once a routine becomes automatic, it no longer drains willpower. The best performers have the most structured routines, not the most flexible schedules.</div>
                    <div className="ft-field-group">
                        <label className="ft-label">Sleep Hours Per Night</label>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                            <input className="ft-input" type="number" min="4" max="12" style={{ width: 100 }} value={Math.round(sleepMins/60)} onChange={e=>u('sleepMinutes', parseInt(e.target.value)*60||480)}/>
                            <span style={{ color: '#6B7280', fontSize: 14 }}>hours ({sleepMins} min)</span>
                        </div>
                    </div>
                    <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, marginBottom: 16 }}>
                        <thead><tr style={{ background: '#000', color: '#fff' }}>
                            <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>#</th>
                            <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>ROUTINE</th>
                            <th style={{ padding: '10px 12px', width: 100, textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: 11 }}>MIN/DAY</th>
                        </tr></thead>
                        <tbody>
                            {routines.map((r, i) => (
                                <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                    <td style={{ padding: '8px 12px', fontWeight: 600 }}>{i+1}</td>
                                    <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder={['Morning exercise','Meditation','Reading','Planning session','Family time','Learning','Evening wind-down'][i]||`Routine ${i+1}`} value={r.name} onChange={e=>updateR(i,'name',e.target.value)}/></td>
                                    <td style={{ padding: 8 }}><input className="ft-input" type="number" style={{ border: 'none', height: 36, textAlign: 'center', width: 80 }} placeholder="min" value={r.minutes} onChange={e=>updateR(i,'minutes',e.target.value)}/></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 16, padding: 16, background: '#F3F4F6' }}>
                        <div><div className="monument" style={{ fontSize: 10, color: '#6B7280', marginBottom: 4 }}>SLEEP</div><div style={{ fontSize: 20, fontWeight: 600 }}>{sleepMins} min</div></div>
                        <div><div className="monument" style={{ fontSize: 10, color: '#6B7280', marginBottom: 4 }}>ROUTINES</div><div style={{ fontSize: 20, fontWeight: 600 }}>{totalMins} min</div></div>
                        <div><div className="monument" style={{ fontSize: 10, color: available < 0 ? '#DC2626' : '#6B7280', marginBottom: 4 }}>AVAILABLE</div><div style={{ fontSize: 20, fontWeight: 600, color: available < 0 ? '#DC2626' : '#000' }}>{available} min</div></div>
                    </div>
                    {available < 0 && <div style={{ color: '#DC2626', fontSize: 14, marginTop: 8, fontWeight: 600 }}>Warning: Your routines exceed available time! Review and trim.</div>}
                </div>
            );
        }

        /* === STEP 7: 3 ROUTINES BUILDER === */
        function Step7({ d, u }) {
            const builders = d.builders || Array(3).fill(null).map(()=>({ name: '', timeOfDay: '', contextSetup: '', reward: '', accountability: '' }));
            const updateB = (i, f, v) => { const next = [...builders]; next[i] = { ...next[i], [f]: v }; u('builders', next); };
            const topRoutines = (d.routines||[]).filter(r=>r.name).slice(0,3);
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 7 of 9</span></div>
                    <h2 className="step-heading">3 ROUTINES BUILDER</h2>
                    <p className="step-hint">Pick your top 3 routines and design them using the habit-building framework: When, Where, How, Reward, Accountability.</p>
                    <div className="ft-insight"><strong>Atomic Habits:</strong> Every habit needs a cue (time of day), craving (context), response (the routine), and reward. Adding an accountability partner increases follow-through by 65%.</div>
                    {builders.map((b, i) => (
                        <div key={i} style={{ border: '2px solid #000', padding: 24, marginBottom: 24 }}>
                            <div className="numbered-section" style={{ marginBottom: 16 }}>ROUTINE {i+1}</div>
                            <div className="ft-field-group">
                                <label className="ft-label">Routine Name <span className="ft-required">*</span></label>
                                <input className="ft-input" placeholder={topRoutines[i]?.name || `Your #${i+1} routine`} value={b.name} onChange={e=>updateB(i,'name',e.target.value)}/>
                            </div>
                            <div className="ft-field-group">
                                <label className="ft-label">Time of Day</label>
                                <input className="ft-input" placeholder="e.g., 6:00 AM, right after waking, lunch break" value={b.timeOfDay} onChange={e=>updateB(i,'timeOfDay',e.target.value)}/>
                            </div>
                            <div className="ft-field-group">
                                <label className="ft-label">Context Setup (Environment/Trigger)</label>
                                <textarea className="ft-textarea" style={{ minHeight: 80 }} placeholder="How will you set up your environment? What's the trigger that starts this routine? e.g., Running shoes next to bed, phone alarm at 6 AM" value={b.contextSetup} onChange={e=>updateB(i,'contextSetup',e.target.value)}/>
                            </div>
                            <div className="ft-field-group">
                                <label className="ft-label">Reward</label>
                                <input className="ft-input" placeholder="What's the immediate reward? e.g., Feel energized, enjoy coffee after" value={b.reward} onChange={e=>updateB(i,'reward',e.target.value)}/>
                            </div>
                            <div className="ft-field-group">
                                <label className="ft-label">Accountability Partner</label>
                                <input className="ft-input" placeholder="Who will check in with you? How often?" value={b.accountability} onChange={e=>updateB(i,'accountability',e.target.value)}/>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        /* === STEP 8: FLOW STATE === */
        function Step8({ d, u }) {
            const flows = d.flows || Array(4).fill(null).map(()=>({ activity: '', surrounding: '', environment: '' }));
            const updateF = (i, f, v) => { const next = [...flows]; next[i] = { ...next[i], [f]: v }; u('flows', next); };
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Step 8 of 9</span></div>
                    <h2 className="step-heading">FLOW STATE PRIMING</h2>
                    <p className="step-hint">Design your ideal flow environment. Flow = the state where work feels effortless and time disappears. Identify what activities trigger it and what conditions sustain it.</p>
                    <div className="ft-insight"><strong>Flow Science:</strong> Flow states increase productivity by 500% (McKinsey). The key triggers are: clear goals, immediate feedback, challenge-skill balance, and minimal distractions.</div>
                    <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14, marginBottom: 24 }}>
                        <thead><tr style={{ background: '#000', color: '#fff' }}>
                            <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>FLOW ACTIVITY</th>
                            <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>IDEAL SURROUNDING</th>
                            <th style={{ padding: '10px 12px', textAlign: 'left', fontFamily: "'Monument', monospace", fontSize: 11 }}>IDEAL ENVIRONMENT</th>
                        </tr></thead>
                        <tbody>
                            {flows.map((f, i) => (
                                <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                    <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder="e.g., Strategic planning, writing, coding" value={f.activity} onChange={e=>updateF(i,'activity',e.target.value)}/></td>
                                    <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder="e.g., Quiet, alone, music" value={f.surrounding} onChange={e=>updateF(i,'surrounding',e.target.value)}/></td>
                                    <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder="e.g., Home office, early morning" value={f.environment} onChange={e=>updateF(i,'environment',e.target.value)}/></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    <div className="ft-field-group">
                        <label className="ft-label">My Flow Routine <span className="ft-required">*</span></label>
                        <p className="ft-help" style={{ marginBottom: 8 }}>Describe your pre-flow ritual. What sequence of actions puts you into flow state?</p>
                        <textarea className="ft-textarea" style={{ minHeight: 140 }} placeholder="Step 1: Close all tabs and notifications&#10;Step 2: Put on noise-canceling headphones&#10;Step 3: 2-minute visual focus exercise (fix gaze on one point)&#10;Step 4: Review the one task I'm working on&#10;Step 5: Set timer for 90 minutes&#10;Step 6: Begin deep work" value={d.flowRoutine||''} onChange={e=>u('flowRoutine',e.target.value)}/>
                    </div>
                </div>
            );
        }

        /* === STEP 9: REVIEW & SUBMIT === */
        function Step9({ d, onSubmit, submitStatus, submitMessage }) {
            try {
                const sections = [
                    { title: 'Top 3 Priorities', items: [d.priority1, d.priority2, d.priority3].filter(Boolean) },
                    { title: 'Gold Hour Set', items: ['Mon','Tue','Wed','Thu','Fri'].map(day => d[`gold${['Monday','Tuesday','Wednesday','Thursday','Friday'][['Mon','Tue','Wed','Thu','Fri'].indexOf(day)]}`]).filter(Boolean).length > 0 ? ['Scheduled'] : [] },
                    { title: 'Activities Rated', items: [(d.activities||[]).filter(a=>a&&a.name).length + ' activities rated'] },
                    { title: 'If-Then Plans', items: [(d.ifThens||[]).filter(it=>it&&it.distraction).length + ' plans created'] },
                    { title: 'Routines Defined', items: [(d.routines||[]).filter(r=>r&&r.name).length + ' routines'] },
                    { title: 'Flow Activities', items: [(d.flows||[]).filter(f=>f&&f.activity).length + ' flow activities'] }
                ];
                return (
                    <div className="animate-in" id="canvas-content">
                        <div className="step-indicator"><span>Step 9 of 9</span></div>
                        <h2 className="step-heading">REVIEW & SUBMIT</h2>
                        <p className="step-hint">Review your complete Focus Protocol before submitting.</p>
                        {sections.map((sec, i) => (
                            <div key={i} style={{ borderBottom: '1px solid #E5E7EB', padding: '16px 0' }}>
                                <div className="monument" style={{ fontSize: 11, textTransform: 'uppercase', color: '#6B7280', marginBottom: 4 }}>{sec.title}</div>
                                {sec.items.map((item, j) => <div key={j} style={{ fontSize: 15, lineHeight: 1.6 }}>{item}</div>)}
                                {sec.items.length === 0 && <div style={{ fontSize: 14, color: '#DC2626' }}>Not completed</div>}
                            </div>
                        ))}
                        <div style={{ marginTop: 32 }}>
                            <CaseStudy title="From Scattered to Strategic" beforeLabel="BEFORE" beforeText="A CEO of a 150-person tech company worked 12-hour days, constantly switching tasks. Projects were late. The team mirrored this scattered approach." afterLabel="AFTER" afterText="After the Fast Track Focus Protocol — brain dumps, impact/easy prioritization, 90-minute deep work sprints — the CEO cut to 8-hour days while increasing strategic output by 60%. Project delivery improved 40%." quote="I thought being busy meant being productive. Flipping the 80/20 ratio changed everything." quoteAuthor="Tech Company CEO" quoteRole="Fast Track Participant"/>
                        </div>
                        {submitStatus === 'success' && <div className="badge badge-green" style={{ marginTop: 16 }}>Submitted successfully!</div>}
                        {submitStatus === 'error' && <div style={{ color: '#DC2626', marginTop: 16 }}>{submitMessage}</div>}
                        <div style={{ marginTop: 32, textAlign: 'center' }}>
                            <button className="btn-primary" onClick={onSubmit} disabled={submitStatus === 'submitting'} style={{ width: '100%' }}>
                                {submitStatus === 'submitting' ? 'SUBMITTING...' : 'SUBMIT FOCUS PROTOCOL'}
                            </button>
                        </div>
                    </div>
                );
            } catch(e) {
                console.error('[Focus] Step9 render error:', e);
                return (
                    <div className="animate-in" id="canvas-content">
                        <div className="step-indicator"><span>Step 9 of 9</span></div>
                        <h2 className="step-heading">REVIEW & SUBMIT</h2>
                        <p style={{ color: '#6B7280', marginBottom: 24 }}>Loading your focus protocol summary...</p>
                        <div style={{ marginTop: 32, textAlign: 'center' }}>
                            <button className="btn-primary" onClick={onSubmit} disabled={submitStatus === 'submitting'} style={{ width: '100%' }}>
                                {submitStatus === 'submitting' ? 'SUBMITTING...' : 'SUBMIT FOCUS PROTOCOL'}
                            </button>
                        </div>
                    </div>
                );
            }
        }

        /* === TEAM STEP 10: MEETING AGENDA === */
        function TeamStep10() {
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Team Step 1 of 2</span></div>
                    <h2 className="step-heading">TEAM MEETING AGENDA</h2>
                    <p className="step-hint">90-minute facilitated discussion on focus, discipline, and productivity. Follow this agenda to ensure productive outcomes.</p>
                    {MEETING_AGENDA.map(item => (
                        <div key={item.num} style={{ border: '1px solid #E5E7EB', padding: 20, marginBottom: 16 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                    <div className="numbered-section">{item.num}</div>
                                    <span style={{ fontWeight: 600, fontSize: 16 }}>{item.title}</span>
                                </div>
                                <span className="monument" style={{ fontSize: 11, color: '#6B7280' }}>{item.duration}</span>
                            </div>
                            <p style={{ fontSize: 14, color: '#374151', lineHeight: 1.6, marginBottom: 8 }}>{item.description}</p>
                            <div style={{ background: '#FFF9E0', padding: '8px 12px', fontSize: 13, marginBottom: 4 }}><strong>Key Question:</strong> {item.keyQuestion}</div>
                            <div style={{ background: '#FEE2E2', padding: '8px 12px', fontSize: 13 }}><strong>Pitfall:</strong> {item.pitfall}</div>
                        </div>
                    ))}
                </div>
            );
        }

        /* === TEAM STEP 11: CONCLUSIONS & WWW === */
        function TeamStep11({ td, ut, onSubmit, submitStatus }) {
            const www = td.www || Array(5).fill(null).map(()=>({ who: '', what: '', when: '' }));
            const updateWWW = (i, f, v) => { const next = [...www]; next[i] = { ...next[i], [f]: v }; ut('www', next); };
            return (
                <div className="animate-in">
                    <div className="step-indicator"><span>Team Step 2 of 2</span></div>
                    <h2 className="step-heading">CONCLUSIONS & ACTION PLAN</h2>
                    <p className="step-hint">Document key decisions, improvements, and assign clear owners with deadlines.</p>
                    <div className="ft-field-group">
                        <label className="ft-label">Key Takeaways</label>
                        <textarea className="ft-textarea" placeholder="What were the top insights from today's discussion?" value={td.keyTakeaways||''} onChange={e=>ut('keyTakeaways',e.target.value)}/>
                    </div>
                    <div className="ft-field-group">
                        <label className="ft-label">Team Focus Strategies (2-3 specific changes)</label>
                        <textarea className="ft-textarea" placeholder="e.g., No-meeting mornings on Tues/Thurs, mandatory Gold Hour for all, Slack quiet hours 9-11 AM" value={td.focusStrategies||''} onChange={e=>ut('focusStrategies',e.target.value)}/>
                    </div>
                    <div className="ft-section">
                        <label className="ft-label">WHO / WHAT / WHEN <span className="ft-required">*</span></label>
                        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 14 }}>
                            <thead><tr style={{ background: '#000', color: '#fff' }}>
                                <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHO</th>
                                <th style={{ padding: '10px 12px', fontFamily: "'Monument', monospace", fontSize: 11 }}>WHAT</th>
                                <th style={{ padding: '10px 12px', width: 130, fontFamily: "'Monument', monospace", fontSize: 11 }}>WHEN</th>
                            </tr></thead>
                            <tbody>
                                {www.map((w, i) => (
                                    <tr key={i} style={{ borderBottom: '1px solid #E5E7EB' }}>
                                        <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder="Name" value={w.who} onChange={e=>updateWWW(i,'who',e.target.value)}/></td>
                                        <td style={{ padding: 8 }}><input className="ft-input" style={{ border: 'none', height: 36 }} placeholder="Action item" value={w.what} onChange={e=>updateWWW(i,'what',e.target.value)}/></td>
                                        <td style={{ padding: 8 }}><input className="ft-input" type="date" style={{ border: 'none', height: 36 }} value={w.when} onChange={e=>updateWWW(i,'when',e.target.value)}/></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    {submitStatus === 'success' && <div className="badge badge-green" style={{ marginTop: 16 }}>Team tool submitted!</div>}
                    <div style={{ marginTop: 32, textAlign: 'center' }}>
                        <button className="btn-primary" onClick={onSubmit} disabled={submitStatus === 'submitting'} style={{ width: '100%' }}>
                            {submitStatus === 'submitting' ? 'SUBMITTING...' : 'SUBMIT TEAM CONCLUSIONS'}
                        </button>
                    </div>
                </div>
            );
        }

        /* ============================================================
           MAIN APP
           ============================================================ */
        function App() {
            const [step, setStep] = useState(0);
            const [mode, setMode] = useState(null);
            const [formData, setFormData] = useState({});
            const [teamData, setTeamData] = useState({});
            const [userId, setUserId] = useState(null);
            const [submitStatus, setSubmitStatus] = useState(null);
            const [submitMessage, setSubmitMessage] = useState('');
            const [teamToolUnlocked, setTeamToolUnlocked] = useState(true); // always unlocked
            const [checkingTeamUnlock, setCheckingTeamUnlock] = useState(false);
            const [aiReviewing, setAiReviewing] = useState(false);
            const [aiMessage, setAiMessage] = useState('');
            const STORAGE_KEY = CONFIG.STORAGE_KEY;

            // Load saved data
            useEffect(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) { try { const p = JSON.parse(saved); if (p.formData) setFormData(p.formData); if (p.teamData) setTeamData(p.teamData); } catch(e){} }
                const identify = async () => {
                    try {
                        await ToolDB.whenReady();
                        const id = await ToolDB.identifyUser();
                        if (id) { setUserId(id); const loaded = await ToolDB.load(id); if (loaded && Object.keys(loaded).length > 0) setFormData(prev => ({ ...prev, ...loaded })); }
                    } catch(e) { console.warn('[Focus] identify error:', e); }
                };
                identify();
            }, []);

            // Autosave
            const saveTimer = useRef(null);
            useEffect(() => {
                if (saveTimer.current) clearTimeout(saveTimer.current);
                saveTimer.current = setTimeout(() => {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify({ formData, teamData }));
                    if (userId && mode === 'individual' && Object.keys(formData).length > 0) {
                        const flat = {};
                        Object.entries(formData).forEach(([k, v]) => { flat[k] = typeof v === 'object' ? JSON.stringify(v) : String(v); });
                        ToolDB.save(userId, flat).catch(e => console.warn('[Focus] autosave error:', e));
                    }
                }, CONFIG.AUTOSAVE_DELAY);
                return () => { if (saveTimer.current) clearTimeout(saveTimer.current); };
            }, [formData, teamData, userId, mode]);

            // Check team unlock
            useEffect(() => {
                if (step !== 0.5) return;
                const checkTeam = async () => {
                    if (!userId) return;
                    setCheckingTeamUnlock(true);
                    try {
                        const { data: user } = await supabaseClient.from('users').select('organization_id').eq('id', userId).single();
                        if (!user?.organization_id) { setCheckingTeamUnlock(false); return; }
                        const { data: members } = await supabaseClient.from('users').select('id').eq('organization_id', user.organization_id);
                        if (!members || members.length === 0) { setCheckingTeamUnlock(false); return; }
                        const memberIds = members.map(m => m.id);
                        const { data: completions } = await supabaseClient.from('tool_completions').select('user_id').eq('tool_slug', 'focus-individual').in('user_id', memberIds);
                        const completedIds = new Set((completions||[]).map(c => c.user_id));
                        const allDone = memberIds.every(id => completedIds.has(id));
                        setTeamToolUnlocked(allDone);
                    } catch(e) { console.warn('[Focus] team check error:', e); }
                    setCheckingTeamUnlock(false);
                };
                checkTeam();
            }, [step, userId]);

            const goToStep = (s) => { setStep(s); window.scrollTo(0, 0); };
            const updateField = (key, val) => setFormData(prev => ({ ...prev, [key]: val }));
            const updateTeamField = (key, val) => setTeamData(prev => ({ ...prev, [key]: val }));

            // AI-gated step navigation — only for steps with meaningful free-text
            const handleNext = async (currentStep, nextStep) => {
                const uid = userId || localStorage.getItem('ft_user_id');
                const stepsWithText = [1, 2, 5, 7, 8]; // brain dump, daily plan, distractions, routines builder, flow state
                if (!window.AIChallenge || !uid || !stepsWithText.includes(currentStep)) {
                    goToStep(nextStep);
                    return;
                }
                setAiReviewing(true);
                try {
                    let stepAnswers = {};
                    let stepLabel = '';
                    if (currentStep === 1) {
                        stepLabel = 'Empty Your Brain';
                        stepAnswers = { brain_dump: formData.brainDump, priorities: [formData.priority1, formData.priority2, formData.priority3].filter(Boolean) };
                    } else if (currentStep === 2) {
                        stepLabel = 'Daily Plan';
                        stepAnswers = { daily_plan: formData.dailyPlan, gold_hour: formData.goldHour };
                    } else if (currentStep === 5) {
                        stepLabel = 'Distractions';
                        stepAnswers = { if_thens: (formData.ifThens || []).filter(it => it.distraction || it.ifThen) };
                    } else if (currentStep === 7) {
                        stepLabel = 'Routines Builder';
                        stepAnswers = { builders: (formData.builders || []).filter(b => b.name) };
                    } else if (currentStep === 8) {
                        stepLabel = 'Flow State';
                        stepAnswers = { flows: (formData.flows || []).filter(f => f.activity), flow_routine: formData.flowRoutine };
                    }
                    const canProceed = await window.AIChallenge.reviewStep(uid, CONFIG.TOOL_SLUG, stepAnswers, stepLabel);
                    if (canProceed) {
                        setAiMessage('');
                        goToStep(nextStep);
                    } else {
                        setAiMessage(window.AIChallenge?.getLastFeedback?.()?.suggestion || 'Please expand your answer before continuing.');
                    }
                } catch (e) {
                    // allow on error
                    goToStep(nextStep);
                } finally {
                    setAiReviewing(false);
                }
            };

            const handleIndividualSubmit = async () => {
                setSubmitStatus('submitting');
                try {
                    const flat = {};
                    Object.entries(formData).forEach(([k, v]) => { flat[k] = typeof v === 'object' ? JSON.stringify(v) : String(v); });
                    await AIChallenge.submitWithChallenge(userId, 'focus-individual', flat, {
                        onSave: async () => { await ToolDB.save(userId, flat); await ToolDB.markComplete(userId); },
                        onSuccess: () => { setSubmitStatus('success'); setSubmitMessage('Focus protocol submitted!'); },
                        onError: (err) => { setSubmitStatus('error'); setSubmitMessage(err.message || 'Submission failed'); }
                    });
                } catch(e) { setSubmitStatus('error'); setSubmitMessage(e.message); }
            };

            const handleTeamSubmit = async () => {
                setSubmitStatus('submitting');
                try {
                    const flat = {};
                    Object.entries(teamData).forEach(([k, v]) => { flat['team_'+k] = typeof v === 'object' ? JSON.stringify(v) : String(v); });
                    await ToolDB.save(userId, flat);
                    setSubmitStatus('success');
                } catch(e) { setSubmitStatus('error'); setSubmitMessage(e.message); }
            };

            const clearCache = () => { localStorage.removeItem(STORAGE_KEY); setFormData({}); setTeamData({}); setMode(null); setStep(0); setSubmitStatus(null); };

            // Render
            return (
                <>
                    {/* COVER */}
                    {step === 0 && (
                        <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative' }}>
                            <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                                <h1 className="plaak" style={{ fontSize: 64, marginBottom: 16, textTransform: 'uppercase' }}>FOCUS, DISCIPLINE<br/>& PRODUCTIVITY</h1>
                                <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48 }}>Master your focus, build unbreakable routines, and enter flow state on demand</p>
                                <button onClick={() => goToStep(0.5)} style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer' }}
                                    onMouseOver={e => e.target.style.background='#FFF469'} onMouseOut={e => e.target.style.background='#fff'}>START</button>
                                <div style={{ marginTop: 24 }}><button onClick={clearCache} style={{ background: 'none', border: 'none', color: '#555', fontSize: 12, cursor: 'pointer', fontFamily: "'Monument', monospace" }}>CLEAR SAVED DATA</button></div>
                            </div>
                        </div>
                    )}

                    {/* PATH SELECT */}
                    {step === 0.5 && (
                        <div style={{ minHeight: '100vh', background: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                            <div style={{ maxWidth: 720, width: '100%', padding: '48px 32px' }} className="animate-in">
                                <div style={{ textAlign: 'center', marginBottom: 48 }}>
                                    <div className="monument" style={{ fontSize: 12, color: '#6B7280', letterSpacing: '0.1em', marginBottom: 8 }}>TOOL 09</div>
                                    <h1 className="plaak" style={{ fontSize: 42, color: '#000', marginBottom: 8 }}>FOCUS, DISCIPLINE & PRODUCTIVITY</h1>
                                    <p style={{ fontSize: 16, color: '#6B7280' }}>Choose your path below</p>
                                </div>
                                <div style={{ border: '2px solid #000', padding: 32, marginBottom: 24 }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                                        <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', letterSpacing: '0.08em', fontWeight: 600 }}>Individual Assessment</div>
                                        <span className="monument" style={{ fontSize: 11, color: '#6B7280' }}>~60 MIN</span>
                                    </div>
                                    <p style={{ fontSize: 15, color: '#374151', lineHeight: 1.6, marginBottom: 24 }}>
                                        Complete 8 focus tools: brain dump, daily planning, activity elimination, distraction management, routine building, and flow state design.
                                    </p>
                                    <button onClick={() => { setMode('individual'); goToStep(1); }} className="btn-primary" style={{ width: '100%' }}>START INDIVIDUAL ASSESSMENT</button>
                                </div>
                                <div style={{ border: '2px solid ' + (teamToolUnlocked ? '#000' : '#E5E7EB'), padding: 32, opacity: teamToolUnlocked ? 1 : 0.7 }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                            {!teamToolUnlocked && <LockIcon size={16}/>}
                                            <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', letterSpacing: '0.08em', fontWeight: 600 }}>Team Meeting Tool</div>
                                        </div>
                                        <span className="monument" style={{ fontSize: 11, color: '#6B7280' }}>~90 MIN</span>
                                    </div>
                                    {teamToolUnlocked ? (
                                        <>
                                            <p style={{ fontSize: 15, color: '#374151', lineHeight: 1.6, marginBottom: 24 }}>Facilitate the 90-minute team focus meeting. Review insights, discuss routines, set team focus strategies.</p>
                                            <button onClick={() => { setMode('team'); goToStep(10); }} className="btn-primary" style={{ width: '100%' }}>START TEAM MEETING</button>
                                        </>
                                    ) : (
                                        <>
                                            <p style={{ fontSize: 15, color: '#6B7280', lineHeight: 1.6, marginBottom: 24 }}>Locked until all team members complete their individual focus assessment.</p>
                                            <div onClick={(e) => { if (e.shiftKey) { console.log('[DEV] Force-unlocking team tool'); setTeamToolUnlocked(true); } }}
                                                style={{ background: '#F3F4F6', padding: '12px 16px', textAlign: 'center', color: '#9CA3AF', fontFamily: "'Monument', monospace", fontSize: 12, cursor: 'default' }}
                                                title="Shift+Click to force unlock (dev only)">
                                                {checkingTeamUnlock ? 'CHECKING...' : 'LOCKED — WAITING FOR TEAM'}
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* TRANSITION SCREENS — rendered at root level so position:fixed covers entire viewport */}
                    {window.renderTransitionScreen && mode === 'individual' && renderTransitionScreen(step, CONFIG, totalSteps, setStep)}

                    {/* WIZARD LAYOUT */}
                    {step >= 1 && (
                        <div className="tool-frame"><div className="tool-inner">
                            <div className="wizard-layout">
                                <div className="wizard-main">
                                    <MobileStepBar currentStep={mode==='team'?step-9:step} totalSteps={mode==='team'?2:9}/>
                                    <div className="wizard-content">
                                        {step === 1 && <Step1 d={formData} u={updateField}/>}
                                        {step === 2 && <Step2 d={formData} u={updateField}/>}
                                        {step === 3 && <Step3 d={formData} u={updateField}/>}
                                        {step === 4 && <Step4 d={formData} u={updateField}/>}
                                        {step === 5 && <Step5 d={formData} u={updateField}/>}
                                        {step === 6 && <Step6 d={formData} u={updateField}/>}
                                        {step === 7 && <Step7 d={formData} u={updateField}/>}
                                        {step === 8 && <Step8 d={formData} u={updateField}/>}
                                        {step === 9 && <Step9 d={formData} onSubmit={handleIndividualSubmit} submitStatus={submitStatus} submitMessage={submitMessage}/>}
                                        {step === 10 && <TeamStep10/>}
                                        {step === 11 && <TeamStep11 td={teamData} ut={updateTeamField} onSubmit={handleTeamSubmit} submitStatus={submitStatus}/>}
                                    </div>
                                    {mode === 'individual' && step >= 1 && step <= 8 && (
                                        <>
                                            {aiMessage && <div style={{color:'#dc2626',fontSize:'13px',marginTop:'8px',padding:'8px 12px',background:'#fef2f2',borderRadius:'6px'}}>{aiMessage}</div>}
                                            <ButtonFooter
                                                showBack={step > 1}
                                                onBack={() => { setAiMessage(''); goToStep(step === 1 ? 0.5 : step - 1); }}
                                                onNext={() => handleNext(step, [1, 2, 3].includes(Math.floor(step)) ? step + 0.5 : step + 1)}
                                                disabled={aiReviewing}
                                                nextLabel={aiReviewing ? 'Reviewing...' : (step === 8 ? 'Review' : 'Next')}
                                            />
                                        </>
                                    )}
                                    {step === 9 && <ButtonFooter showBack onBack={() => goToStep(8)} onNext={handleIndividualSubmit} nextLabel="Submit" disabled={submitStatus==='submitting'}/>}
                                    {step === 10 && <ButtonFooter showBack={false} onNext={() => goToStep(11)} nextLabel="Conclusions"/>}
                                    {step === 11 && <ButtonFooter showBack onBack={() => goToStep(10)} onNext={handleTeamSubmit} nextLabel="Submit Team" disabled={submitStatus==='submitting'}/>}
                                </div>
                                <WizardSidebar currentStep={step} mode={mode} onNavigate={goToStep}/>
                            </div>
                        </div></div>
                    )}
                </>
            );
        }

        ReactDOM.render(<App/>, document.getElementById('root'));
    </script>
</body>
</html>
