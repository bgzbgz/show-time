<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FIT & ABC Analysis | Fast Track Program</title>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../shared/js/tool-db.js"></script>
  <script src="../../shared/js/ai-challenge.js"></script>
  <script src="../../shared/js/dependency-injection.js"></script>
  <script src="../../shared/js/transition-screen.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    /* Font Face Declarations */
    @font-face {
      font-family: 'Plaak';
      src: url('Plaak3Trial-43-Bold.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
    }

    @font-face {
      font-family: 'Riforma';
      src: url('RiformaLL-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Monument';
      src: url('MonumentGrotesk-Mono.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Riforma', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .plaak {
      font-family: 'Plaak', sans-serif;
      text-transform: uppercase;
      font-weight: bold;
      letter-spacing: -0.02em;
    }

    .riforma-bold {
      font-family: 'Riforma', sans-serif;
      font-weight: bold;
    }

    .monument {
      font-family: 'Monument', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }

    .transition-animate-in {
      animation: slideIn 0.6s ease-out;
    }

    /* Button Styles */
    .btn-primary {
      background: #000000;
      color: #FFFFFF;
      padding: 16px 32px;
      border: 2px solid #000000;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: normal;
    }

    .btn-primary:hover:not(:disabled) {
      transform: scale(1.02);
    }

    .btn-primary:disabled {
      background: #E0E0E0;
      border-color: #E0E0E0;
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #FFFFFF;
      color: #000000;
      padding: 12px 24px;
      border: 2px solid #000000;
      font-size: 16px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: #F8F8F8;
    }

    /* Form Styles */
    input[type="text"],
    input[type="number"],
    input[type="email"],
    textarea,
    select {
      border: 1px solid #E0E0E0;
      padding: 12px 16px;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      width: 100%;
      transition: border-color 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #000000;
    }

    textarea {
      min-height: 120px;
      resize: none !important;
    }

    textarea::placeholder {
      white-space: pre-line;
    }

    /* Numbered Section Badge */
    .numbered-section {
      background: #000000;
      color: #FFFFFF;
      padding: 10px 16px;
      font-family: 'Plaak', sans-serif;
      font-size: 26px;
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }

    /* Progress Indicator */
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #E0E0E0;
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: #000000;
      transform: scale(1.3);
    }

    .progress-dot.completed {
      background: #000000;
    }

    .progress-line {
      height: 2px;
      background: #E0E0E0;
      flex: 1;
    }

    /* Character Counter */
    .char-counter {
      font-size: 14px;
      color: #666;
      margin-top: 4px;
    }

    .char-counter.invalid {
      color: #EF4444;
    }

    /* Rating Scale */
    .rating-scale {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .rating-button {
      width: 48px;
      height: 48px;
      border: 2px solid #000000;
      background: #FFFFFF;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .rating-button:hover {
      background: #F8F8F8;
    }

    .rating-button.selected {
      background: #000000;
      color: #FFFFFF;
    }

    /* ABC Badge */
    .abc-badge {
      display: inline-block;
      padding: 8px 16px;
      font-family: 'Plaak', sans-serif;
      font-size: 24px;
      border: 3px solid #000000;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .abc-badge:hover {
      background: #F8F8F8;
    }

    .abc-badge.selected {
      background: #000000;
      color: #FFFFFF;
    }

    .abc-badge.a {
      border-color: #10B981;
    }

    .abc-badge.a.selected {
      background: #10B981;
      color: #FFFFFF;
    }

    .abc-badge.b {
      border-color: #F59E0B;
    }

    .abc-badge.b.selected {
      background: #F59E0B;
      color: #FFFFFF;
    }

    .abc-badge.c {
      border-color: #EF4444;
    }

    .abc-badge.c.selected {
      background: #EF4444;
      color: #FFFFFF;
    }
    /* Wizard Layout */
    .wizard-layout { display: flex; min-height: 100vh; }
    .wizard-main { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
    .wizard-content { flex: 1; padding: 48px 32px; max-width: 720px; width: 100%; margin: 0 auto; }
    .wizard-sidebar { width: 280px; background: #1a1a1a; color: #fff; padding: 40px 32px; position: sticky; top: 0; height: 100vh; overflow-y: auto; flex-shrink: 0; display: flex; flex-direction: column; }
    .wizard-footer { padding: 24px 64px; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: #fff; }
    .btn-wiz-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 14px 28px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; cursor: pointer; transition: all 0.2s; }
    .btn-wiz-next { background: #000; color: #fff; border: 2px solid #000; padding: 14px 32px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; cursor: pointer; transition: all 0.2s; }
    .btn-wiz-next:disabled { background: #E0E0E0; border-color: #E0E0E0; cursor: not-allowed; color: #999; }

  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, Fragment } = React;

    const CONFIG = {
        SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
        SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
        TOOL_SLUG: 'fit-abc-analysis',
        AUTOSAVE_DELAY: 2000,
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'Most companies keep C-players 18 months longer than they should. The cost is not just salary — it is the A-players who leave or disengage because standards are not held.',
                peerProof: '"A €20M firm ran the ABC analysis and addressed 3 C-players in critical roles. After 60 days — 2 moved on, 1 improved — team productivity increased 25% and voluntary A-player turnover dropped to zero."'
            },
            2: {
                brutalTruth: 'Role clarity is not an HR formality — it is a performance multiplier. When A-players do not know what winning looks like in their role, they default to activity over impact. Clarity unlocks discretionary effort.',
                peerProof: '"A scale-up rewrote job scorecards for their top 12 roles. Within 2 months, 3 people self-selected out (they no longer fit the role they thought they had), and performance reviews became conversations about outcomes, not feelings."'
            },
            3: {
                brutalTruth: 'Talent density — not headcount — is the true performance lever. One A-player in a key role consistently outperforms three B-players. The question is not how many people you have, but how aligned each one is to where value is created.',
                peerProof: '"After implementing ABC analysis company-wide, a €50M firm reduced headcount by 8% while revenue grew 22%. They stopped backfilling B-player exits and rebuilt roles around A-player strengths instead."'
            },
            4: {
                brutalTruth: 'Action plans without deadlines are wishes. B and C players do not improve without specific commitments, clear timelines, and named consequences. Vague coaching conversations are the most expensive HR activity in your company.',
                peerProof: '"A tech firm built 90-day development plans for every B-player. Within one quarter, 4 of 6 improved to A-player performance. The other 2 self-selected out. Net result: the team performed at 40% higher output with the same headcount."'
            }
        },
        CLOSING_MESSAGES: {
            1: { title: 'TEAM MAPPED', text: 'Your team is visible. Now score each person on energy, skills, values, and impact.' },
            2: { title: 'FIT SCORED', text: 'The scores are in. Now classify each person as A, B, or C — and defend it.' },
            3: { title: 'ABC CLASSIFIED', text: 'Classification complete. Now build the action plans that change the outcomes.' },
            4: { title: 'PLANS COMPLETE', text: 'Your talent strategy is built. Review the canvas and submit.' }
        }
    };

    const { createClient } = supabase;
    const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

    // Make Supabase client globally available for dependency injection
    window.supabaseClient = supabaseClient;

    // Initialize ToolDB and dependency injection
    ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        CognitiveLoad.init('fit-abc', {"insights":["The ABC Matrix forces the hardest conversation: who belongs and who does not.","A-players attract A-players. B-players hire C-players."],"caseStudy":{"before":"A 120-person manufacturing company had no formal talent evaluation. Managers promoted based on tenure, not performance. Three underperforming directors held executive seats for years while high-potential leaders left for competitors. Team morale was low, execution was slow, and the CEO avoided hard conversations about fit.","after":"After implementing FIT and ABC Analysis across all departments, the CEO reclassified the executive team within 90 days. Two C-players were transitioned out, one B-player was moved to a better-fit role, and two high-potential A-players were promoted. Within six months, execution speed improved 40%, voluntary turnover of top talent dropped to near zero, and the leadership team reported the highest engagement scores in company history.","quote":"We knew who our A-players were all along. What the ABC framework gave us was the courage and the structure to act on what we already knew but were afraid to confront. -- CEO, mid-market manufacturing firm"}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

        function DependencyContext({ deps }) {
            const [open, setOpen] = React.useState(false);
            if (!deps || deps.length === 0) return null;
            return (
                <div style={{ marginBottom: '16px' }}>
                    <button onClick={() => setOpen(o => !o)} style={{ display: 'flex', alignItems: 'center', gap: 8, background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '8px 14px', fontSize: 12, fontFamily: "'Monument', monospace", letterSpacing: '0.05em', textTransform: 'uppercase', cursor: 'pointer', color: '#555', width: '100%' }}>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#DAA520" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        CONTEXT FROM PREVIOUS TOOLS ({deps.length})
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#999" strokeWidth="2" style={{ marginLeft: 'auto', transform: open ? 'rotate(180deg)' : 'none', transition: 'transform 0.2s' }}><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    {open && (
                        <div style={{ border: '1px solid #F0E68C', borderTop: 'none', padding: '12px 14px' }}>
                            {deps.map((dep, i) => (
                                <div key={i} style={{ background: '#fff', padding: '8px 0', borderBottom: i < deps.length - 1 ? '1px solid #F0E68C' : 'none', fontSize: '13px' }}>
                                    <div style={{ fontWeight: 600, marginBottom: '2px', color: '#333', fontSize: '11px', fontFamily: "'Monument', monospace", letterSpacing: '0.04em', textTransform: 'uppercase' }}>{dep.label}</div>
                                    <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

    // Main App Component
    function FitAbcApp() {
            const [deps, setDeps] = useState([]);
      const [step, setStep] = useState(0);
      const [aiReviewing, setAiReviewing] = useState(false);
      const [submitted, setSubmitted] = useState(false);

      const [data, setData] = useState({
        teamMembers: [
          {
            id: 1,
            name: '',
            role: '',
            tenure: '',
            energyScore: 0,
            energyNotes: '',
            skillScore: 0,
            skillNotes: '',
            valuesScore: 0,
            valuesNotes: '',
            impactScore: 0,
            impactNotes: '',
            abcRating: '',
            abcReasoning: '',
            performanceNotes: '',
            cultureNotes: '',
            potentialNotes: '',
            developmentNeeds: '',
            coachingPlan: '',
            roleChanges: '',
            timeline: '',
            toughDecisions: ''
          }
        ]
      });

            useEffect(() => {
                async function loadDeps() {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId || !window.ToolDB || !window.DependencyInjection) return;
                    try {
                        await ToolDB.whenReady();
                        const config = DependencyInjection.getDependenciesConfig();
                        const toolConfig = config[CONFIG.TOOL_SLUG];
                        if (!toolConfig || !toolConfig.fields) return;
                        const loaded = [];
                        for (const field of toolConfig.fields) {
                            const val = await ToolDB.getDependency(userId, field.source_field);
                            if (val) {
                                loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                            }
                        }
                        setDeps(loaded);
                    } catch (err) {
                        console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
                    }
                }
                loadDeps();
            }, []);

      // Load from localStorage
      useEffect(() => {
        const saved = localStorage.getItem('fit-abc-data');
        if (saved) {
          try {
            const savedData = JSON.parse(saved);
            setData(savedData);
          } catch (e) {
            console.error('Error loading saved data:', e);
          }
        }
      }, []);

      // Auto-save every 2 seconds
      useEffect(() => {
        const interval = setInterval(() => {
          localStorage.setItem('fit-abc-data', JSON.stringify(data));
        }, 2000);
        return () => clearInterval(interval);
      }, [data]);

      const updateData = (field, value) => {
        setData({ ...data, [field]: value });
      };

      const addTeamMember = () => {
        const newMember = {
          id: Date.now(),
          name: '',
          role: '',
          tenure: '',
          energyScore: 0,
          energyNotes: '',
          skillScore: 0,
          skillNotes: '',
          valuesScore: 0,
          valuesNotes: '',
          impactScore: 0,
          impactNotes: '',
          abcRating: '',
          abcReasoning: '',
          performanceNotes: '',
          cultureNotes: '',
          potentialNotes: '',
          developmentNeeds: '',
          coachingPlan: '',
          roleChanges: '',
          timeline: '',
          toughDecisions: ''
        };
        updateData('teamMembers', [...(data.teamMembers || []), newMember]);
      };

      const removeTeamMember = (id) => {
        if ((data.teamMembers || []).length > 1) {
          updateData('teamMembers', (data.teamMembers || []).filter(m => m.id !== id));
        }
      };

      const updateTeamMember = (id, field, value) => {
        const updated = (data.teamMembers || []).map(m => m.id === id ? { ...m, [field]: value } : m);
        updateData('teamMembers', updated);
      };

      const goNext = async () => {
        if (step === 0.5) {
          setStep(1);
        } else if (step >= 1 && step <= 4) {
          // Step 2 (FIT Analysis) handles its own per-question AI reviews — skip here
          if (step !== 2) {
            const userId = localStorage.getItem('ft_user_id');
            if (userId) {
              setAiReviewing(true);
              try {
                let stepAnswers = {};
                let stepName = '';
                const teamMembers = data.teamMembers || [];
                if (step === 1) {
                  stepName = 'Team Members';
                  stepAnswers = { team_list: teamMembers.map(m => ({ name: m.name, role: m.role, tenure: m.tenure })) };
                } else if (step === 3) {
                  stepName = 'ABC Classification';
                  stepAnswers = { classification: teamMembers.map(m => ({ name: m.name, abcRating: m.abcRating, abcReasoning: m.abcReasoning })) };
                } else if (step === 4) {
                  stepName = 'Action Plans';
                  stepAnswers = { action_plans: teamMembers.filter(m => m.abcRating === 'B' || m.abcRating === 'C').map(m => ({ name: m.name, abcRating: m.abcRating, developmentNeeds: m.developmentNeeds, coachingPlan: m.coachingPlan, roleChanges: m.roleChanges, toughDecisions: m.toughDecisions })) };
                }
                const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
                if (!canProceed) { setAiReviewing(false); return; }
              } catch (err) {
                console.warn('[AIChallenge] Error, allowing passage:', err);
              } finally {
                setAiReviewing(false);
              }
            }
          }

          setStep(step + 0.5);
        } else if (step === 0) {
          setStep(0.5);
        }
      };

      const goBack = () => {
        if (step === 5) {
          setStep(4);
        } else if (step > 1) {
          setStep(step - 1);
        } else if (step === 1) {
          setStep(0.5);
        }
      };

      // Validation functions
      const isStep1Valid = () => {
        return (data.teamMembers || []).length >= 1 &&
               (data.teamMembers || []).every(m =>
                 (m.name || '').trim().length >= 2 &&
                 (m.role || '').trim().length >= 2
               );
      };

      const isStep2Valid = () => {
        return (data.teamMembers || []).every(m =>
          (m.energyScore || 0) >= 1 && (m.energyScore || 0) <= 5 &&
          (m.skillScore || 0) >= 1 && (m.skillScore || 0) <= 5 &&
          (m.valuesScore || 0) >= 1 && (m.valuesScore || 0) <= 5 &&
          (m.impactScore || 0) >= 1 && (m.impactScore || 0) <= 5
        );
      };

      const isStep3Valid = () => {
        return (data.teamMembers || []).every(m =>
          (m.abcRating || '').length >= 1 &&
          (m.abcReasoning || '').length >= 50
        );
      };

      const isStep4Valid = () => {
        const bcMembers = (data.teamMembers || []).filter(m => m.abcRating === 'B' || m.abcRating === 'C');
        if (bcMembers.length === 0) return true;
        return bcMembers.every(m =>
          (m.developmentNeeds || '').length >= 30 ||
          (m.coachingPlan || '').length >= 30 ||
          (m.roleChanges || '').length >= 30 ||
          (m.toughDecisions || '').length >= 30
        );
      };

      const exportPDF = async () => {
        try {
          const canvas = document.getElementById('canvas-content');
          if (!canvas) {
            alert('Canvas not found');
            return;
          }

          const images = canvas.querySelectorAll('img');
          const imageStates = [];
          images.forEach(img => {
            imageStates.push({ img, display: img.style.display });
            img.style.display = 'none';
          });

          const canvasImage = await html2canvas(canvas, {
            scale: 2,
            logging: false,
            backgroundColor: '#ffffff'
          });

          imageStates.forEach(({ img, display }) => {
            img.style.display = display;
          });

          const imgWidth = 190;
          const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');
          const imgData = canvasImage.toDataURL('image/png');

          pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
          pdf.save('fit-abc-analysis.pdf');
        } catch (error) {
          console.error('PDF export error:', error);
          alert('Failed to export PDF: ' + error.message);
        }
      };

      const handleSubmit = async () => {
        const userId = localStorage.getItem('ft_user_id');
        if (!userId) {
          alert('User not authenticated. Please return to the dashboard.');
          return false;
        }

        try {
          const teamMembers = data.teamMembers || [];
          const questionMappings = {
            classification: teamMembers.map(m => ({
              name: m.name,
              role: m.role,
              tenure: m.tenure,
              abcRating: m.abcRating,
              abcReasoning: m.abcReasoning,
              energyScore: m.energyScore,
              skillScore: m.skillScore,
              valuesScore: m.valuesScore,
              impactScore: m.impactScore
            })),
            talent_gaps: teamMembers.filter(m => m.abcRating === 'B' || m.abcRating === 'C').map(m => ({
              name: m.name,
              abcRating: m.abcRating,
              developmentNeeds: m.developmentNeeds,
              capabilityGap: m.abcReasoning
            })),
            a_player_agreements: teamMembers.filter(m => m.abcRating === 'A').map(m => ({
              name: m.name,
              role: m.role,
              coachingPlan: m.coachingPlan,
              roleChanges: m.roleChanges,
              timeline: m.timeline
            }))
          };
          await ToolDB.saveResponses(userId, CONFIG.TOOL_SLUG, questionMappings);
          setSubmitted(true);
          return true;
        } catch (error) {
          console.error('Supabase submission error:', error);
          alert('Submission failed. Please try again.');
          return false;
        }
      };

      // Render different pages based on step
      if (submitted) {
        return (
          <div style={{ minHeight: '100vh', background: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <div style={{ background: '#f0fdf4', border: '1px solid #86efac', borderRadius: '12px', padding: '48px 32px', textAlign: 'center', maxWidth: '480px', margin: '0 auto' }}>
              <div style={{ fontSize: '40px', marginBottom: '16px' }}>✓</div>
              <h2 style={{ fontFamily: "'Plaak', 'Monument', sans-serif", fontSize: '24px', marginBottom: '12px' }}>SUBMITTED</h2>
              <p style={{ color: '#555', marginBottom: '24px' }}>Your answers have been saved.</p>
              <a href="/dashboard" style={{ color: '#000', textDecoration: 'underline', fontSize: '14px' }}>← Back to Dashboard</a>
            </div>
          </div>
        );
      }

      if ([1.5, 2.5, 3.5, 4.5].includes(step)) {
        return window.renderTransitionScreen(step, CONFIG, 4, setStep);
      }

      if (step === 0) {
        return <CoverPage onStart={goNext} />;
      }

      if (step === 0.5) {
        return <IntroPage onNext={goNext} />;
      }

      // Steps 1-4: Wizard layout
      if (step >= 1 && step <= 4) {
        const stepLabels = ['Team Members', 'FIT Analysis', 'ABC Classification', 'Action Plans'];
        // Step 2 uses internal navigation — footer shows only Back
        const isValid = step === 1 ? isStep1Valid() : step === 2 ? true : step === 3 ? isStep3Valid() : isStep4Valid();
        const canProceed = !aiReviewing && isValid;
        const nextLabels = { 1: 'NEXT: FIT ANALYSIS →', 3: 'NEXT: ACTION PLANS →', 4: 'VIEW CANVAS →' };
        return (
          <div className="wizard-layout">
            <div className="wizard-main">
              <div className="wizard-content animate-in">
                <DependencyContext deps={deps} />
                {step === 1 && <Step1Page data={data} updateTeamMember={updateTeamMember} addTeamMember={addTeamMember} removeTeamMember={removeTeamMember} />}
                {step === 2 && <Step2Page data={data} updateTeamMember={updateTeamMember} onAdvanceStep={goNext} />}
                {step === 3 && <Step3Page data={data} updateTeamMember={updateTeamMember} />}
                {step === 4 && <Step4Page data={data} updateTeamMember={updateTeamMember} />}
              </div>
              {step !== 2 && (
                <div className="wizard-footer">
                  <button className="btn-wiz-back" onClick={goBack}>← BACK</button>
                  <button className="btn-wiz-next" disabled={!canProceed} onClick={goNext}>
                    {aiReviewing ? 'AI COACH REVIEWING...' : (nextLabels[step] || 'NEXT →')}
                  </button>
                </div>
              )}
              {step === 2 && (
                <div className="wizard-footer">
                  <button className="btn-wiz-back" onClick={goBack}>← BACK TO TEAM LIST</button>
                </div>
              )}
            </div>
            <WizardSidebar currentStep={step} stepLabels={stepLabels} totalSteps={4} />
          </div>
        );
      }

      if (step === 5) {
        return (
          <CanvasPage
            data={data}
            onExport={exportPDF}
            onSubmit={handleSubmit}
          />
        );
      }

      return null;
    }

    // Cover Page Component
    function CoverPage({ onStart }) {
      return (
        <div className="relative min-h-screen flex items-center justify-center bg-black">
          <div
            className="absolute inset-0 w-full h-full"
            style={{
              backgroundImage: 'url("https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=1920&q=80")',
              backgroundSize: 'cover',
              backgroundPosition: 'center'
            }}
          ></div>
          <div className="absolute inset-0" style={{background: 'linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.85))'}}></div>

          <div className="relative z-10 text-center text-white px-8 max-w-5xl mx-auto">
            <h1 className="plaak animate-in" style={{fontSize: '100px', lineHeight: '1', marginBottom: '32px'}}>
              FIT & ABC
            </h1>
            <h2 className="plaak animate-in" style={{fontSize: '80px', lineHeight: '1', marginBottom: '32px', color: '#FFF469', animationDelay: '0.1s'}}>
              ANALYSIS
            </h2>
            <p className="text-4xl mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              Evaluate team members with clarity and courage. Right people, right roles, right results.
            </p>
            <button
              onClick={onStart}
              className="bg-white text-black plaak px-16 py-6 border-4 border-white hover:bg-black hover:text-white transition-all text-3xl animate-in"
              style={{animationDelay: '0.4s'}}
            >
              START
            </button>
          </div>
        </div>
      );
    }

    // Intro Page Component
    function IntroPage({ onNext }) {
      return (
        <div className="bg-black text-white min-h-screen p-16">
          <div className="max-w-5xl mx-auto">
            <h1 className="plaak mb-16 animate-in" style={{fontSize: '100px'}}>
              BEFORE WE START
            </h1>

            {/* Sprint Info */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.05s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>SPRINT INFO</h2>
              <div className="bg-white text-black p-8">
                <p className="text-2xl font-bold mb-4">Sprint 24: FIT & ABC Analysis</p>
                <p className="text-xl leading-relaxed mb-4">
                  Think of your organization as a sports team. Even the best strategy won't win championships if the wrong players are on the field or playing in the wrong positions. This sprint is about making sure the right people are doing the right things—so your strategy can truly perform.
                </p>
                <div className="border-l-4 border-black pl-4 italic text-lg">
                  High performers in the right roles deliver up to 400% more than average ones. Yet 1 in 3 leaders avoid addressing people-fit issues until it's too late.
                </div>
              </div>
            </div>

            {/* Two Frameworks */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <h2 className="plaak text-6xl mb-6">TWO FRAMEWORKS</h2>

              <div className="grid grid-cols-2 gap-6">
                <div className="border-4 border-white p-6">
                  <h3 className="plaak text-4xl mb-4" style={{color: '#FFF469'}}>FIT ANALYSIS</h3>
                  <p className="text-xl mb-4">Are people naturally energized and suited for the role they are in?</p>
                  <ul className="text-lg space-y-2">
                    <li><strong>Energy:</strong> Does this role energize or drain them?</li>
                    <li><strong>Skill:</strong> Do they have natural talents and learned skills?</li>
                    <li><strong>Values:</strong> Are their values aligned with company values?</li>
                    <li><strong>Impact:</strong> Are they making significant contribution?</li>
                  </ul>
                </div>

                <div className="border-4 border-white p-6">
                  <h3 className="plaak text-4xl mb-4" style={{color: '#FFF469'}}>ABC ANALYSIS</h3>
                  <p className="text-xl mb-4">Are they delivering results and behaving in line with company values?</p>
                  <ul className="text-lg space-y-2">
                    <li><strong>A Players:</strong> Great performers + cultural fit + high potential</li>
                    <li><strong>B Players:</strong> Good but not great, or performing but not cultural fit</li>
                    <li><strong>C Players:</strong> Low performers or cultural misfits</li>
                  </ul>
                </div>
              </div>
            </div>

            {/* Mistakes to Avoid */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>MISTAKES TO AVOID</h2>

              <div className="bg-white text-black p-6 mb-6 border-4 border-yellow-400">
                <p className="riforma-bold text-2xl mb-4">COMMON EVALUATION FAILURES:</p>
                <ul className="text-xl space-y-3">
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">1.</span>
                    <span><strong>Confusing personality with performance:</strong> Being nice doesn't equal being effective</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">2.</span>
                    <span><strong>Overrating B players out of fear:</strong> Loyalty and past contribution cloud judgment</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">3.</span>
                    <span><strong>Skipping development conversations:</strong> Assessments without action waste time</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">4.</span>
                    <span><strong>Being sentimental, not strategic:</strong> The goal is performance, not comfort</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">5.</span>
                    <span><strong>Delayed tough decisions:</strong> C-players quietly kill momentum and culture</span>
                  </li>
                </ul>
              </div>
            </div>

            {/* The Journey */}
            <div className="mb-16 animate-in" style={{animationDelay: '0.3s'}}>
              <h2 className="plaak text-6xl mb-8">THE JOURNEY</h2>
              <div className="grid grid-cols-4 gap-4 text-center">
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">01</div>
                  <p className="text-xl font-bold mb-2">TEAM LIST</p>
                  <p className="text-base text-gray-400">Name, role, tenure</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">02</div>
                  <p className="text-xl font-bold mb-2">FIT ANALYSIS</p>
                  <p className="text-base text-gray-400">4 dimensions rated</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">03</div>
                  <p className="text-xl font-bold mb-4">ABC RATING</p>
                  <p className="text-base text-gray-400">Classify A/B/C</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">04</div>
                  <p className="text-xl font-bold mb-2">ACTION PLANS</p>
                  <p className="text-base text-gray-400">Development steps</p>
                </div>
              </div>
            </div>

            {/* Next Button */}
            <button
              onClick={onNext}
              className="btn-primary w-full text-3xl py-8 plaak"
            >
              LET'S START →
            </button>
          </div>
        </div>
      );
    }

    // Wizard Sidebar Component
    function WizardSidebar({ currentStep, stepLabels, totalSteps }) {
      return (
        <div className="wizard-sidebar">
          <div style={{ marginBottom: 48 }}>
            <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 8 }}>SPRINT 24</div>
            <div style={{ fontFamily: "'Monument', monospace", fontSize: 13, color: '#fff', letterSpacing: '0.06em', textTransform: 'uppercase', lineHeight: 1.4 }}>FIT & ABC ANALYSIS</div>
          </div>
          <div style={{ flex: 1 }}>
            {stepLabels.map((label, i) => {
              const stepNum = i + 1;
              const isDone = stepNum < currentStep;
              const isActive = stepNum === Math.floor(currentStep);
              return (
                <div key={stepNum} style={{ display: 'flex', alignItems: 'flex-start', gap: 16, marginBottom: 28 }}>
                  <div style={{ width: 28, height: 28, borderRadius: '50%', border: `2px solid ${isDone ? '#FFF469' : isActive ? '#fff' : '#444'}`, background: isDone ? '#FFF469' : 'transparent', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0, marginTop: 2 }}>
                    {isDone ? <span style={{ color: '#000', fontSize: 13, fontWeight: 700 }}>✓</span> : <span style={{ color: isActive ? '#fff' : '#555', fontSize: 12, fontFamily: "'Monument', monospace" }}>{stepNum}</span>}
                  </div>
                  <div>
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: isDone ? '#FFF469' : isActive ? '#fff' : '#555', letterSpacing: '0.08em', textTransform: 'uppercase', lineHeight: 1.5 }}>{label}</div>
                  </div>
                </div>
              );
            })}
          </div>
          <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#444', letterSpacing: '0.08em', textTransform: 'uppercase' }}>STEP {Math.floor(currentStep)} OF {totalSteps}</div>
        </div>
      );
    }

    // Step 1: Team Member List
    function Step1Page({ data, updateTeamMember, addTeamMember, removeTeamMember }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">01. TEAM MEMBERS</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            

            {/* Common Mistake */}


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              List the team members you will evaluate
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                "As CEO, evaluate your executive team. As an executive, evaluate your direct reports. This is the foundation for honest talent conversations."
              </p>
            </div>

            <p className="text-xl mb-8 text-gray-300">
              Create your evaluation roster. Include name, current role, and tenure. This gives context for FIT and ABC assessments in the next steps.
            </p>

            <div className="space-y-6 mb-12">
              {(data.teamMembers || []).map((member, index) => (
                <div key={member.id} className="border-4 border-gray-200 p-6 animate-in" style={{animationDelay: `${0.15 + index * 0.05}s`}}>
                  <div className="flex justify-between items-start mb-6">
                    <h4 className="riforma-bold text-3xl">Team Member {index + 1}</h4>
                    {(data.teamMembers || []).length > 1 && (
                      <button
                        onClick={() => removeTeamMember(member.id)}
                        className="text-red-600 hover:text-red-800 text-sm"
                      >
                        REMOVE
                      </button>
                    )}
                  </div>

                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="monument text-sm block mb-2">NAME <span className="text-red-500">*</span></label>
                      <ScienceBookmarkIcon>
                          Naming each person forces accountability. Research by Kahneman (2011) shows that specificity in evaluation prevents the "halo effect" -- the cognitive bias where a general impression of someone influences judgment of their specific traits.
                      </ScienceBookmarkIcon>
                      <input
                        type="text"
                        value={member.name || ''}
                        onChange={(e) => updateTeamMember(member.id, 'name', e.target.value)}
                        placeholder="John Smith"
                        className="w-full"
                      />
                      <div className="char-counter">{(member.name || '').length}/100 (min 2)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">ROLE <span className="text-red-500">*</span></label>
                      <ScienceBookmarkIcon>
                          Role clarity is the strongest predictor of engagement (Gallup, 2023). Be specific: not "Manager" but "Operations Manager responsible for supply chain and fulfillment." Vague roles produce vague evaluations.
                      </ScienceBookmarkIcon>
                      <input
                        type="text"
                        value={member.role || ''}
                        onChange={(e) => updateTeamMember(member.id, 'role', e.target.value)}
                        placeholder="Operations Manager"
                        className="w-full"
                      />
                      <div className="char-counter">{(member.role || '').length}/100 (min 2)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">TENURE</label>
                      <ScienceBookmarkIcon>
                          Tenure context matters: someone underperforming at 6 months may still be learning, but the same underperformance at 3 years signals a deeper fit problem. Collins found that leaders who waited too long to act on misfit lost an average of 18 months of team productivity.
                      </ScienceBookmarkIcon>
                      <input
                        type="text"
                        value={member.tenure || ''}
                        onChange={(e) => updateTeamMember(member.id, 'tenure', e.target.value)}
                        placeholder="2 years / 6 months"
                        className="w-full"
                      />
                      <div className="char-counter">{(member.tenure || '').length}/50</div>
                    </div>
                  </div>
                </div>
              ))}

              <button onClick={addTeamMember} className="btn-secondary w-full">
                + ADD TEAM MEMBER
              </button>
            </div>

        </div>
      );
    }

    // Step 2: FIT Analysis — typeform-style, one member at a time
    function Step2Page({ data, updateTeamMember, onAdvanceStep }) {
      const members = data.teamMembers || [];
      const [fitMemberIndex, setFitMemberIndex] = useState(0);
      const [fitQuestionIndex, setFitQuestionIndex] = useState(0);
      const [aiReviewingQ, setAiReviewingQ] = useState(false);
      const [transitioning, setTransitioning] = useState(false);

      const FIT_QUESTIONS = [
        {
          key: 'energyScore',
          notesKey: 'energyNotes',
          label: 'ENERGY',
          question: 'Does this role energize them or drain them?',
          context: 'Energy is the most underrated dimension of FIT. A-players in the wrong role will still underperform because the work depletes rather than fuels them. Look for: Do they light up when talking about this work? Do they stay late by choice or obligation?',
          placeholder: 'What evidence shows they\'re energized or drained? Do they light up or show fatigue?',
          bg: null
        },
        {
          key: 'skillScore',
          notesKey: 'skillNotes',
          label: 'SKILL',
          question: 'Do they have the natural talents and learned skills for this role?',
          context: 'Skill FIT asks: can they do this job with excellence? Consider both natural aptitude (hard to train) and learned competency (can be developed). Low skill + high energy = teachable. High skill + low energy = misplaced.',
          placeholder: 'What skills do they excel at? Where do they struggle? Natural talent or learned competency?',
          bg: null
        },
        {
          key: 'valuesScore',
          notesKey: 'valuesNotes',
          label: 'VALUES',
          question: 'Are their personal values aligned with company values?',
          context: 'Values misalignment is the silent killer of team performance. You can\'t train values. A person who doesn\'t share the company\'s core values will create cultural friction even if they are a high performer. Be honest here — it\'s the hardest dimension to confront.',
          placeholder: 'How do they demonstrate company values? Any cultural misalignment?',
          bg: 'bg-purple-50 border-purple-200'
        },
        {
          key: 'impactScore',
          notesKey: 'impactNotes',
          label: 'IMPACT',
          question: 'Are they making a significant, measurable contribution?',
          context: 'Impact is the output dimension. Not effort, not intention — results. Ask: what would be measurably different if this person were not in the role? If the answer is "not much," that\'s your score. Look for concrete numbers, outcomes, and decisions with real consequences.',
          placeholder: 'What measurable results have they delivered? How significant is their contribution?',
          bg: 'bg-orange-50 border-orange-200'
        }
      ];

      const currentMember = members[fitMemberIndex];
      const currentQuestion = FIT_QUESTIONS[fitQuestionIndex];
      const totalMembers = members.length;
      const totalQuestions = FIT_QUESTIONS.length;

      // Compute global question number for progress display
      const globalCurrent = fitMemberIndex * totalQuestions + fitQuestionIndex + 1;
      const globalTotal = totalMembers * totalQuestions;

      if (!currentMember || !currentQuestion) return null;

      const currentScore = currentMember[currentQuestion.key] || 0;
      const currentNotes = currentMember[currentQuestion.notesKey] || '';

      const RatingScale = ({ value, onChange }) => (
        <div className="rating-scale mb-3">
          {[1, 2, 3, 4, 5].map(score => (
            <button
              key={score}
              type="button"
              onClick={() => onChange(score)}
              className={`rating-button ${value === score ? 'selected' : ''}`}
            >
              {score}
            </button>
          ))}
          <div className="flex justify-between flex-1 ml-4 text-sm text-gray-400">
            <span>1 = Low</span>
            <span>5 = High</span>
          </div>
        </div>
      );

      const advanceQuestion = async () => {
        if (transitioning) return;
        setTransitioning(true);

        // AI review for this question answer
        const userId = localStorage.getItem('ft_user_id');
        if (userId && currentScore >= 1) {
          setAiReviewingQ(true);
          try {
            const stepAnswers = {
              member_name: currentMember.name || `Team Member ${fitMemberIndex + 1}`,
              dimension: currentQuestion.label,
              score: currentScore,
              notes: currentNotes
            };
            const canProceed = await window.AIChallenge.reviewStep(
              userId,
              CONFIG.TOOL_SLUG,
              stepAnswers,
              `FIT Analysis - ${currentMember.name || 'Member'} - ${currentQuestion.label}`
            );
            if (!canProceed) {
              setAiReviewingQ(false);
              setTransitioning(false);
              return;
            }
          } catch (err) {
            console.warn('[AIChallenge] Error, allowing passage:', err);
          } finally {
            setAiReviewingQ(false);
          }
        }

        // Move to next question or next member
        if (fitQuestionIndex < totalQuestions - 1) {
          setFitQuestionIndex(fitQuestionIndex + 1);
        } else if (fitMemberIndex < totalMembers - 1) {
          setFitMemberIndex(fitMemberIndex + 1);
          setFitQuestionIndex(0);
        } else {
          // All done — advance wizard step
          if (onAdvanceStep) onAdvanceStep();
        }
        setTransitioning(false);
      };

      const goBackQuestion = () => {
        if (fitQuestionIndex > 0) {
          setFitQuestionIndex(fitQuestionIndex - 1);
        } else if (fitMemberIndex > 0) {
          setFitMemberIndex(fitMemberIndex - 1);
          setFitQuestionIndex(totalQuestions - 1);
        }
      };

      const isLastQuestion = fitMemberIndex === totalMembers - 1 && fitQuestionIndex === totalQuestions - 1;
      const canAdvance = currentScore >= 1;

      return (
        <div>
          <div className="numbered-section mb-6 animate-in">02. FIT ANALYSIS</div>

          {/* Progress bar */}
          <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 32 }}>
            <div style={{ flex: 1, height: 4, background: '#E0E0E0', borderRadius: 2 }}>
              <div style={{ height: '100%', background: '#000', borderRadius: 2, width: `${(globalCurrent / globalTotal) * 100}%`, transition: 'width 0.4s ease' }} />
            </div>
            <span className="monument" style={{ fontSize: 11, color: '#666', whiteSpace: 'nowrap' }}>
              {globalCurrent} / {globalTotal}
            </span>
          </div>

          {/* Member indicator */}
          <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 24 }}>
            <span className="monument" style={{ fontSize: 11, color: '#999', letterSpacing: '0.08em' }}>
              MEMBER {fitMemberIndex + 1} OF {totalMembers}
            </span>
            <span style={{ color: '#E0E0E0' }}>·</span>
            <span className="monument" style={{ fontSize: 11, color: '#999', letterSpacing: '0.08em' }}>
              QUESTION {fitQuestionIndex + 1} OF {totalQuestions}
            </span>
          </div>

          {/* Question card */}
          <div key={`${fitMemberIndex}-${fitQuestionIndex}`} className="animate-in">
            {/* Member name header */}
            <div style={{ marginBottom: 24, padding: '12px 16px', background: '#F8F8F8', borderLeft: '4px solid #000' }}>
              <div className="monument" style={{ fontSize: 10, color: '#999', marginBottom: 4 }}>EVALUATING</div>
              <div className="riforma-bold" style={{ fontSize: 22 }}>
                {(currentMember.name || `Team Member ${fitMemberIndex + 1}`).substring(0, 60)}
                {currentMember.role && <span style={{ fontWeight: 'normal', color: '#666', fontSize: 18 }}> — {currentMember.role.substring(0, 50)}</span>}
              </div>
            </div>

            {/* Dimension badge */}
            <div className="monument" style={{ fontSize: 11, letterSpacing: '0.1em', color: '#666', marginBottom: 12 }}>
              DIMENSION: {currentQuestion.label}
            </div>

            {/* Question */}
            <h3 className="riforma-bold" style={{ fontSize: 32, lineHeight: 1.3, marginBottom: 20 }}>
              {currentQuestion.question}
            </h3>

            {/* Context */}
            <div style={{ background: '#FFFBEB', borderLeft: '3px solid #F59E0B', padding: '12px 16px', marginBottom: 28, fontSize: 15, color: '#555', lineHeight: 1.6 }}>
              {currentQuestion.context}
            </div>

            {/* Rating */}
            <div className={`p-6 mb-4 border-2 ${currentQuestion.bg || 'border-gray-200'}`} style={{ background: currentQuestion.bg ? undefined : '#fff' }}>
              <label className="monument text-sm block mb-3">
                RATE {currentQuestion.label} <span style={{ color: '#EF4444' }}>*</span>
              </label>
              <RatingScale
                value={currentScore}
                onChange={(score) => updateTeamMember(currentMember.id, currentQuestion.key, score)}
              />

              <label className="monument text-xs block mb-2" style={{ marginTop: 16, color: '#666' }}>
                NOTES (OPTIONAL)
              </label>
              <textarea
                value={currentNotes}
                onChange={(e) => updateTeamMember(currentMember.id, currentQuestion.notesKey, e.target.value)}
                placeholder={currentQuestion.placeholder}
                className="w-full"
                rows={3}
              />
              <div className="char-counter">{currentNotes.length}/500</div>
            </div>

            {/* Navigation */}
            <div style={{ display: 'flex', gap: 12, marginTop: 8 }}>
              {(fitMemberIndex > 0 || fitQuestionIndex > 0) && (
                <button
                  className="btn-wiz-back"
                  onClick={goBackQuestion}
                  style={{ flexShrink: 0 }}
                >
                  ← BACK
                </button>
              )}
              <button
                className="btn-wiz-next"
                disabled={!canAdvance || aiReviewingQ}
                onClick={advanceQuestion}
                style={{ flex: 1 }}
              >
                {aiReviewingQ
                  ? 'AI COACH REVIEWING...'
                  : isLastQuestion
                    ? 'COMPLETE FIT ANALYSIS →'
                    : fitQuestionIndex < totalQuestions - 1
                      ? `NEXT QUESTION →`
                      : `NEXT MEMBER →`}
              </button>
            </div>

            {!canAdvance && (
              <p className="monument" style={{ fontSize: 10, color: '#999', marginTop: 8, textAlign: 'center' }}>
                SELECT A RATING TO CONTINUE
              </p>
            )}
          </div>
        </div>
      );
    }

    // Step 3: ABC Classification
    function Step3Page({ data, updateTeamMember }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">03. ABC CLASSIFICATION</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Classify each team member as A, B, or C player
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                "A-players drive results AND culture. B-players are good but not great. C-players are low performers or cultural misfits. Be brutally honest, not sentimental."
              </p>
            </div>

            <div className="bg-gray-50 border-2 border-gray-200 p-6 mb-8">
              <h4 className="riforma-bold text-2xl mb-4">ABC DEFINITIONS</h4>
              <div className="grid grid-cols-3 gap-4 text-base">
                <div className="border-l-4 border-black pl-4">
                  <p className="riforma-bold text-lg mb-2">A PLAYERS</p>
                  <p>Great performers + cultural fit + high potential. They deliver consistently and elevate others.</p>
                </div>
                <div className="border-l-4 border-yellow-600 pl-4">
                  <p className="riforma-bold text-lg mb-2">B PLAYERS</p>
                  <p>Good but not great, or performing without cultural fit. Solid contributors with limitations.</p>
                </div>
                <div className="border-l-4 border-red-600 pl-4">
                  <p className="riforma-bold text-lg mb-2">C PLAYERS</p>
                  <p>Low performers or cultural misfits. They drain energy and slow momentum.</p>
                </div>
              </div>
            </div>

            <div className="space-y-8 mb-12">
              {(data.teamMembers || []).map((member, index) => (
                <div key={member.id} className="border-4 border-gray-200 p-6 animate-in" style={{animationDelay: `${0.15 + index * 0.05}s`}}>
                  <h4 className="riforma-bold text-3xl mb-6">
                    {(member.name || 'Team Member').substring(0, 50)} - {(member.role || 'Role').substring(0, 50)}
                  </h4>

                  <div className="mb-6">
                    <p className="text-lg mb-2 text-gray-500">
                      FIT Scores: Energy {member.energyScore || 0} | Skill {member.skillScore || 0} | Values {member.valuesScore || 0} | Impact {member.impactScore || 0}
                    </p>
                  </div>

                  {/* ABC Rating */}
                  <div className="mb-6">
                    <label className="monument text-sm block mb-3">ABC CLASSIFICATION <span className="text-red-500">*</span></label>
                    <div className="flex gap-4">
                      <button
                        type="button"
                        onClick={() => updateTeamMember(member.id, 'abcRating', 'A')}
                        className={`abc-badge a ${(member.abcRating || '') === 'A' ? 'selected' : ''}`}
                      >
                        A PLAYER
                      </button>
                      <button
                        type="button"
                        onClick={() => updateTeamMember(member.id, 'abcRating', 'B')}
                        className={`abc-badge b ${(member.abcRating || '') === 'B' ? 'selected' : ''}`}
                      >
                        B PLAYER
                      </button>
                      <button
                        type="button"
                        onClick={() => updateTeamMember(member.id, 'abcRating', 'C')}
                        className={`abc-badge c ${(member.abcRating || '') === 'C' ? 'selected' : ''}`}
                      >
                        C PLAYER
                      </button>
                    </div>
                  </div>

                  {/* Reasoning */}
                  <div className="bg-gray-50 border-2 border-gray-200 p-6 mb-4">
                    <label className="monument text-sm block mb-2">ABC REASONING <span className="text-red-500">*</span></label>
                    <p className="text-sm text-gray-500 mb-2">Why did you classify them this way? Be specific about performance, culture fit, and potential.</p>
                    <textarea
                      value={member.abcReasoning || ''}
                      onChange={(e) => updateTeamMember(member.id, 'abcReasoning', e.target.value)}
                      placeholder="Example: 'Classified as B player because performance is solid (delivers on time, meets targets) but lacks strategic thinking needed for next level. Cultural fit is strong, aligns with values. Limited growth potential in current role—may need lateral move to stay engaged.'"
                      className="w-full"
                      rows={4}
                    />
                    <div className="char-counter">{(member.abcReasoning || '').length}/1000 (min 50)</div>
                  </div>

                  {/* Additional Notes */}
                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="monument text-xs block mb-2">PERFORMANCE NOTES</label>
                      <textarea
                        value={member.performanceNotes || ''}
                        onChange={(e) => updateTeamMember(member.id, 'performanceNotes', e.target.value)}
                        placeholder="Specific results and contributions"
                        className="w-full text-sm"
                        rows={3}
                      />
                      <div className="char-counter text-xs">{(member.performanceNotes || '').length}/500</div>
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">CULTURE NOTES</label>
                      <textarea
                        value={member.cultureNotes || ''}
                        onChange={(e) => updateTeamMember(member.id, 'cultureNotes', e.target.value)}
                        placeholder="Values alignment and behavior"
                        className="w-full text-sm"
                        rows={3}
                      />
                      <div className="char-counter text-xs">{(member.cultureNotes || '').length}/500</div>
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">POTENTIAL NOTES</label>
                      <textarea
                        value={member.potentialNotes || ''}
                        onChange={(e) => updateTeamMember(member.id, 'potentialNotes', e.target.value)}
                        placeholder="Future growth and development capacity"
                        className="w-full text-sm"
                        rows={3}
                      />
                      <div className="char-counter text-xs">{(member.potentialNotes || '').length}/500</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

        </div>
      );
    }

    // Step 4: Action Plans
    function Step4Page({ data, updateTeamMember }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">04. ACTION PLANS</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Create development and action plans for each team member
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                "Assessment without action is wasted effort. This is where leadership courage meets talent strategy. Focus especially on B and C players."
              </p>
            </div>

            <p className="text-xl mb-8 text-gray-300">
              Define specific actions for each person. A-players need retention and stretch. B-players need development or role changes. C-players need performance plans or transitions.
            </p>

            <div className="space-y-8 mb-12">
              {(data.teamMembers || []).map((member, index) => (
                <div key={member.id} className="border-4 border-gray-200 p-6 animate-in" style={{animationDelay: `${0.15 + index * 0.05}s`}}>
                  <div className="flex justify-between items-start mb-6">
                    <div>
                      <h4 className="riforma-bold text-3xl">
                        {(member.name || 'Team Member').substring(0, 50)} - {(member.role || 'Role').substring(0, 50)}
                      </h4>
                      <div className="flex gap-2 mt-2">
                        <span className={`abc-badge ${(member.abcRating || '').toLowerCase()} ${member.abcRating ? 'selected' : ''} text-base`}>
                          {member.abcRating || 'NOT RATED'} PLAYER
                        </span>
                        <span className="text-lg text-gray-400">
                          FIT Avg: {member.energyScore && member.skillScore && member.valuesScore && member.impactScore ?
                            ((member.energyScore + member.skillScore + member.valuesScore + member.impactScore) / 4).toFixed(1) : 'N/A'}
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-4">
                    {/* Development Needs */}
                    <div className="border-2 border-gray-200 p-4">
                      <label className="monument text-sm block mb-2">DEVELOPMENT NEEDS</label>
                      <textarea
                        value={member.developmentNeeds || ''}
                        onChange={(e) => updateTeamMember(member.id, 'developmentNeeds', e.target.value)}
                        placeholder="What skills, knowledge, or experience do they need to develop? Be specific."
                        className="w-full text-sm"
                        rows={3}
                      />
                      <div className="char-counter text-xs">{(member.developmentNeeds || '').length}/500</div>
                    </div>

                    {/* Coaching Plan */}
                    <div className="border-2 border-gray-200 p-4">
                      <label className="monument text-sm block mb-2">COACHING PLAN</label>
                      <textarea
                        value={member.coachingPlan || ''}
                        onChange={(e) => updateTeamMember(member.id, 'coachingPlan', e.target.value)}
                        placeholder="What support, mentoring, or coaching will you provide? How often will you meet?"
                        className="w-full text-sm"
                        rows={3}
                      />
                      <div className="char-counter text-xs">{(member.coachingPlan || '').length}/500</div>
                    </div>

                    {/* Role Changes */}
                    <div className="bg-purple-50 border-2 border-purple-200 p-4">
                      <label className="monument text-sm block mb-2">ROLE CHANGES</label>
                      <textarea
                        value={member.roleChanges || ''}
                        onChange={(e) => updateTeamMember(member.id, 'roleChanges', e.target.value)}
                        placeholder="Should their role, responsibilities, or position change? Lateral move? Promotion? Demotion?"
                        className="w-full text-sm"
                        rows={3}
                      />
                      <div className="char-counter text-xs">{(member.roleChanges || '').length}/500</div>
                    </div>

                    {/* Timeline */}
                    <div className="bg-yellow-50 border-2 border-yellow-200 p-4">
                      <label className="monument text-sm block mb-2">TIMELINE</label>
                      <textarea
                        value={member.timeline || ''}
                        onChange={(e) => updateTeamMember(member.id, 'timeline', e.target.value)}
                        placeholder="When will these actions happen? Specific dates or timeframes (Q2 2025, next 30 days, etc.)"
                        className="w-full text-sm"
                        rows={2}
                      />
                      <div className="char-counter text-xs">{(member.timeline || '').length}/300</div>
                    </div>

                    {/* Tough Decisions */}
                    {(member.abcRating === 'C' || member.abcRating === 'B') && (
                      <div className="bg-red-50 border-2 border-red-400 p-4">
                        <label className="monument text-sm block mb-2">TOUGH DECISIONS</label>
                        <textarea
                          value={member.toughDecisions || ''}
                          onChange={(e) => updateTeamMember(member.id, 'toughDecisions', e.target.value)}
                          placeholder="Performance improvement plan? Transition out? Exit conversation? When and how will you address this?"
                          className="w-full text-sm"
                          rows={3}
                        />
                        <div className="char-counter text-xs">{(member.toughDecisions || '').length}/500</div>
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>

        </div>
      );
    }

    // Canvas Page
    function CanvasPage({ data, onExport, onSubmit }) {
      const teamMembers = data.teamMembers || [];

      const aPlayers = teamMembers.filter(m => m.abcRating === 'A');
      const bPlayers = teamMembers.filter(m => m.abcRating === 'B');
      const cPlayers = teamMembers.filter(m => m.abcRating === 'C');

      const calcAvgFit = (member) => {
        const scores = [
          member.energyScore || 0,
          member.skillScore || 0,
          member.valuesScore || 0,
          member.impactScore || 0
        ].filter(s => s > 0);
        return scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1) : 'N/A';
      };

      return (
        <div className="bg-black text-white min-h-screen p-16">
          <div className="max-w-6xl mx-auto">
            {/* Canvas Content */}
            <div id="canvas-content" className="bg-white p-16 mb-8">
              <div className="border-b-4 border-black pb-8 mb-8">
                <h1 className="plaak text-7xl mb-2">FIT & ABC ANALYSIS</h1>
                <p className="text-2xl text-gray-400">Sprint 24 - Team Evaluation & Talent Strategy</p>
              </div>

              {/* ABC Distribution */}
              <div className="mb-12">
                <h2 className="riforma-bold text-4xl mb-6">ABC DISTRIBUTION</h2>
                <div className="grid grid-cols-3 gap-6">
                  <div className="border-4 border-black p-6 bg-neutral-900">
                    <div className="text-6xl plaak mb-2">{aPlayers.length}</div>
                    <p className="text-2xl riforma-bold">A PLAYERS</p>
                    <p className="text-base text-gray-400 mt-2">Great performers + cultural fit + high potential</p>
                  </div>
                  <div className="border-4 border-yellow-600 p-6 bg-yellow-50">
                    <div className="text-6xl plaak mb-2">{bPlayers.length}</div>
                    <p className="text-2xl riforma-bold">B PLAYERS</p>
                    <p className="text-base text-gray-400 mt-2">Good but not great, or performing without cultural fit</p>
                  </div>
                  <div className="border-4 border-red-600 p-6 bg-red-50">
                    <div className="text-6xl plaak mb-2">{cPlayers.length}</div>
                    <p className="text-2xl riforma-bold">C PLAYERS</p>
                    <p className="text-base text-gray-400 mt-2">Low performers or cultural misfits</p>
                  </div>
                </div>
              </div>

              {/* Team Member Summaries */}
              <div className="mb-12">
                <h2 className="riforma-bold text-4xl mb-6">TEAM MEMBER SUMMARIES</h2>
                <div className="space-y-6">
                  {teamMembers.map((member, index) => (
                    <div key={member.id} className="border-2 border-gray-300 p-6">
                      <div className="flex justify-between items-start mb-4">
                        <div>
                          <h3 className="riforma-bold text-2xl">{member.name || 'Team Member'} - {member.role || 'Role'}</h3>
                          {member.tenure && <p className="text-base text-gray-400">Tenure: {member.tenure}</p>}
                        </div>
                        <div className="text-right">
                          <div className={`abc-badge ${(member.abcRating || '').toLowerCase()} ${member.abcRating ? 'selected' : ''} text-lg mb-2`}>
                            {member.abcRating || '?'} PLAYER
                          </div>
                          <p className="text-base text-gray-400">FIT Avg: {calcAvgFit(member)}</p>
                        </div>
                      </div>

                      {/* FIT Scores */}
                      <div className="grid grid-cols-4 gap-3 mb-4">
                        <div className="bg-neutral-900 p-3 border-l-4 border-black">
                          <p className="text-xs monument mb-1">ENERGY</p>
                          <p className="text-2xl riforma-bold">{member.energyScore || 0}/5</p>
                        </div>
                        <div className="bg-neutral-900 p-3 border-l-4 border-black">
                          <p className="text-xs monument mb-1">SKILL</p>
                          <p className="text-2xl riforma-bold">{member.skillScore || 0}/5</p>
                        </div>
                        <div className="bg-purple-50 p-3 border-l-4 border-purple-600">
                          <p className="text-xs monument mb-1">VALUES</p>
                          <p className="text-2xl riforma-bold">{member.valuesScore || 0}/5</p>
                        </div>
                        <div className="bg-orange-50 p-3 border-l-4 border-orange-600">
                          <p className="text-xs monument mb-1">IMPACT</p>
                          <p className="text-2xl riforma-bold">{member.impactScore || 0}/5</p>
                        </div>
                      </div>

                      {/* ABC Reasoning */}
                      {member.abcReasoning && (
                        <div className="bg-neutral-900 p-4 mb-4">
                          <p className="monument text-xs mb-2">ABC REASONING</p>
                          <p className="text-sm">{(member.abcReasoning || '').substring(0, 250)}...</p>
                        </div>
                      )}

                      {/* Action Plan Summary */}
                      <div className="grid grid-cols-2 gap-4">
                        {member.developmentNeeds && (
                          <div className="border-l-4 border-black pl-3">
                            <p className="monument text-xs mb-1">DEVELOPMENT</p>
                            <p className="text-sm">{(member.developmentNeeds || '').substring(0, 100)}...</p>
                          </div>
                        )}
                        {member.coachingPlan && (
                          <div className="border-l-4 border-black pl-3">
                            <p className="monument text-xs mb-1">COACHING</p>
                            <p className="text-sm">{(member.coachingPlan || '').substring(0, 100)}...</p>
                          </div>
                        )}
                        {member.roleChanges && (
                          <div className="border-l-4 border-purple-600 pl-3">
                            <p className="monument text-xs mb-1">ROLE CHANGES</p>
                            <p className="text-sm">{(member.roleChanges || '').substring(0, 100)}...</p>
                          </div>
                        )}
                        {member.toughDecisions && (
                          <div className="border-l-4 border-red-600 pl-3">
                            <p className="monument text-xs mb-1">TOUGH DECISIONS</p>
                            <p className="text-sm">{(member.toughDecisions || '').substring(0, 100)}...</p>
                          </div>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Key Actions */}
              <div className="border-4 border-yellow-400 bg-yellow-50 p-8 mb-8">
                <h2 className="riforma-bold text-3xl mb-4">KEY ACTIONS REQUIRED</h2>
                <div className="space-y-3 text-base">
                  <p className="riforma-bold">A PLAYERS ({aPlayers.length}): Retain, stretch, and develop for leadership</p>
                  <p className="riforma-bold">B PLAYERS ({bPlayers.length}): Provide clear development paths or consider role changes</p>
                  <p className="riforma-bold">C PLAYERS ({cPlayers.length}): Performance improvement plans or transition conversations needed</p>
                </div>
              </div>

              <div className="mt-12 pt-8 border-t-2 border-gray-700 text-center text-sm text-gray-500">
                <p>Generated: {new Date().toLocaleDateString()}</p>
                <p className="mt-1">Fast Track Sprint 24 - FIT & ABC Analysis</p>
              </div>
            </div>

            {/* Action Buttons */}
            <div className="flex gap-6 mb-6">
              <button onClick={onExport} className="btn-primary flex-1">
                EXPORT PDF
              </button>
              <button onClick={onSubmit} className="btn-primary flex-1">
                SUBMIT
              </button>
            </div>

            {/* Case Study */}
            <CaseStudy
                before={"A 120-person manufacturing company had no formal talent evaluation. Managers promoted based on tenure, not performance. Three underperforming directors held executive seats for years while high-potential leaders left for competitors. Team morale was low, execution was slow, and the CEO avoided hard conversations about fit."}
                after={"After implementing FIT and ABC Analysis across all departments, the CEO reclassified the executive team within 90 days. Two C-players were transitioned out, one B-player was moved to a better-fit role, and two high-potential A-players were promoted. Within six months, execution speed improved 40%, voluntary turnover of top talent dropped to near zero, and the leadership team reported the highest engagement scores in company history."}
                quote={"We knew who our A-players were all along. What the ABC framework gave us was the courage and the structure to act on what we already knew but were afraid to confront. -- CEO, mid-market manufacturing firm"}
            />
          </div>
        </div>
      );
    }

    // Progress Indicator
    function ProgressIndicator({ currentStep }) {
      const steps = [
        { number: 1, label: 'Team List' },
        { number: 2, label: 'FIT Analysis' },
        { number: 3, label: 'ABC Rating' },
        { number: 4, label: 'Action Plans' }
      ];

      return (
        <div className="flex items-center justify-center gap-4 mb-12">
          {steps.map((step, index) => (
            <Fragment key={step.number}>
              <div className="flex flex-col items-center">
                <div className={`progress-dot ${step.number === currentStep ? 'active' : ''} ${step.number < currentStep ? 'completed' : ''}`}></div>
                <div className="monument text-xs mt-2">{step.label}</div>
              </div>
              {index < steps.length - 1 && <div className="progress-line w-12"></div>}
            </Fragment>
          ))}
        </div>
      );
    }

    // Render App
        ReactDOM.render(<FitAbcApp />, document.getElementById('root'));
  </script>
</body>
</html>
