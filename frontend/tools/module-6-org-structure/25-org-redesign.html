<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Organizational Redesign | Fast Track Program</title>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="../../shared/js/tool-db.js"></script>
  <script src="../../shared/js/ai-challenge.js"></script>
  <script src="../../shared/js/dependency-injection.js"></script>
  <script src="../../shared/js/transition-screen.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    /* Font Face Declarations */
    @font-face {
      font-family: 'Plaak';
      src: url('Plaak3Trial-43-Bold.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
    }

    @font-face {
      font-family: 'Riforma';
      src: url('RiformaLL-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Monument';
      src: url('MonumentGrotesk-Mono.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Riforma', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .plaak {
      font-family: 'Plaak', sans-serif;
      text-transform: uppercase;
      font-weight: bold;
      letter-spacing: -0.02em;
    }

    .riforma-bold {
      font-family: 'Riforma', sans-serif;
      font-weight: bold;
    }

    .monument {
      font-family: 'Monument', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }

    .transition-animate-in {
      animation: slideIn 0.6s ease-out;
    }

    /* Button Styles */
    .btn-primary {
      background: #000000;
      color: #FFFFFF;
      padding: 16px 32px;
      border: 2px solid #000000;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: normal;
    }

    .btn-primary:hover:not(:disabled) {
      transform: scale(1.02);
    }

    .btn-primary:disabled {
      background: #E0E0E0;
      border-color: #E0E0E0;
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #FFFFFF;
      color: #000000;
      padding: 12px 24px;
      border: 2px solid #000000;
      font-size: 16px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: #F8F8F8;
    }

    .btn-add {
      background: #FFF469;
      color: #000000;
      padding: 12px 24px;
      border: 2px solid #000000;
      font-size: 16px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: bold;
    }

    .btn-add:hover {
      background: #FFE600;
    }

    .btn-remove {
      background: #FFFFFF;
      color: #EF4444;
      padding: 8px 16px;
      border: 2px solid #EF4444;
      font-size: 14px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-remove:hover {
      background: #FEE2E2;
    }

    /* Form Styles */
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="date"],
    textarea,
    select {
      border: 1px solid #E0E0E0;
      padding: 12px 16px;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      width: 100%;
      transition: border-color 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #000000;
    }

    textarea {
      min-height: 100px;
      resize: none !important;
    }

    textarea::placeholder {
      white-space: pre-line;
    }

    /* Numbered Section Badge */
    .numbered-section {
      background: #000000;
      color: #FFFFFF;
      padding: 10px 16px;
      font-family: 'Plaak', sans-serif;
      font-size: 26px;
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }

    /* Help Button */
    .help-button {
      position: fixed;
      top: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #000000;
      color: #FFFFFF;
      font-size: 28px;
      border: none;
      cursor: pointer;
      z-index: 40;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Riforma', sans-serif;
    }

    .help-button:hover {
      background: #FFF469;
      color: #000000;
      transform: scale(1.1);
    }

    /* Progress Indicator */
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #E0E0E0;
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: #000000;
      transform: scale(1.3);
    }

    .progress-dot.completed {
      background: #000000;
    }

    .progress-line {
      height: 2px;
      background: #E0E0E0;
      flex: 1;
    }

    /* FIT Score Styles */
    .fit-indicator {
      display: inline-block;
      padding: 4px 12px;
      font-family: 'Monument', monospace;
      font-size: 14px;
      font-weight: bold;
      border-radius: 4px;
    }

    .fit-excellent {
      background: #10B981;
      color: #FFFFFF;
    }

    .fit-good {
      background: #FFF469;
      color: #000000;
    }

    .fit-moderate {
      background: #F59E0B;
      color: #FFFFFF;
    }

    .fit-poor {
      background: #EF4444;
      color: #FFFFFF;
    }

    /* Matrix Cell Styles */
    .matrix-cell {
      border: 1px solid #E0E0E0;
      padding: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .matrix-cell:hover {
      background: #F8F8F8;
    }

    .matrix-cell.score-excellent {
      background: #D1FAE5;
      border-color: #10B981;
    }

    .matrix-cell.score-good {
      background: #FEF9C3;
      border-color: #F59E0B;
    }

    .matrix-cell.score-moderate {
      background: #FFEDD5;
      border-color: #F97316;
    }

    .matrix-cell.score-poor {
      background: #FEE2E2;
      border-color: #EF4444;
    }

    /* Category Badge */
    .category-badge {
      display: inline-block;
      padding: 6px 12px;
      font-family: 'Monument', monospace;
      font-size: 12px;
      border-radius: 4px;
      font-weight: bold;
    }

    .category-immediate {
      background: #10B981;
      color: #FFFFFF;
    }

    .category-development {
      background: #F59E0B;
      color: #FFFFFF;
    }

    .category-transition {
      background: #EF4444;
      color: #FFFFFF;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 20px;
    }

    .modal-content {
      background: white;
      max-width: 600px;
      max-height: 85vh;
      overflow-y: auto;
      border: 4px solid #000000;
    }

    /* Slider Styles */
    input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #E0E0E0;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #000000;
      cursor: pointer;
      border: 2px solid #FFFFFF;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #000000;
      cursor: pointer;
      border: 2px solid #FFFFFF;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* Skill Chip */
    .skill-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: #F3F4F6;
      border: 1px solid #D1D5DB;
      border-radius: 6px;
      font-size: 14px;
    }

    .skill-chip button {
      background: none;
      border: none;
      color: #EF4444;
      cursor: pointer;
      font-weight: bold;
      padding: 0;
      font-size: 16px;
    }

    /* Timeline Checkpoint */
    .checkpoint-box {
      border-left: 4px solid #000000;
      padding-left: 16px;
      margin-bottom: 16px;
    }

    /* ── Wizard layout ── */
    .wizard-layout { display: flex; min-height: 100vh; }
    .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; padding: 0 48px; }
    .wizard-content { flex: 1; padding: 40px 0; }
    .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; flex-shrink: 0; }
    .wizard-footer { display: flex; justify-content: space-between; align-items: center; padding: 24px 48px; border-top: 1px solid #e5e7eb; background: #fff; }
    .btn-wiz-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 12px 28px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
    .btn-wiz-back:hover { border-color: #000; color: #000; }
    .btn-wiz-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 36px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
    .btn-wiz-next:hover:not(:disabled) { background: #FFF469; color: #000; border-color: #FFF469; }
    .btn-wiz-next:disabled { background: #E0E0E0; color: #9CA3AF; border-color: #E0E0E0; cursor: not-allowed; }

    /* ── Step content ── */
    .step-content { max-width: 100%; padding: 40px 0; flex: 1; }
    .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #666; margin-bottom: 8px; }
    .opening-box { margin-bottom: 32px; }
    .opening-box .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
    .opening-box .step-hint { font-size: 14px; color: #666; line-height: 1.5; margin: 0; }

    /* ── Sidebar CSS classes ── */
    .sidebar-tool-num { font-family: 'Monument', monospace; font-size: 10px; color: #555; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 8px; }
    .sidebar-tool-title { font-family: 'Plaak', sans-serif; font-size: 22px; color: #fff; margin-bottom: 32px; line-height: 1.1; }
    .sidebar-step { padding: 8px 0; border-bottom: 1px solid #2a2a2a; cursor: default; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s; }
    .sidebar-step:last-child { border-bottom: none; }
    .sidebar-step-dot { width: 6px; height: 6px; border-radius: 50%; background: #555; flex-shrink: 0; transition: background 0.2s; }
    .sidebar-step-dot.active { background: #FFF469; }
    .sidebar-step-dot.done   { background: #4ade80; }
    .sidebar-step-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.08em; color: #555; text-transform: uppercase; transition: color 0.2s; }
    .sidebar-step-label.active { color: #FFF469; }
    .sidebar-step-label.done   { color: #4ade80; }

    /* ── Dependency context ── */
    .dep-context { border: 1px solid #E0E0E0; margin-bottom: 24px; }
    .dep-context-header { background: #F5F5F5; padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    .dep-context-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.1em; color: #666; text-transform: uppercase; }
    .dep-context-body { padding: 14px 16px; font-size: 14px; color: #333; line-height: 1.6; }

    /* ── AI message ── */
    .ai-message { background: #FFF9C4; border: 1px solid #FFF469; border-left: 4px solid #FFF469; padding: 12px 16px; font-size: 14px; color: #333; margin-bottom: 16px; line-height: 1.6; }

    /* ── Animations ── */
    .animate-in { animation: fadeSlideIn 0.4s ease both; }
    @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

    /* ── Submit success ── */
    .submit-success { background: #f0fdf4; border: 1px solid #86efac; padding: 32px; text-align: center; margin-top: 24px; }

    /* ── Mobile ── */
    @media (max-width: 768px) {
        .wizard-sidebar { display: none; }
        .wizard-main { padding: 0 24px; }
        .wizard-footer { padding: 16px 24px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, Fragment } = React;

    const CONFIG = {
        TOOL_SLUG: 'org-redesign',
        AUTOSAVE_DELAY: 2000,
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'Most org charts reflect history, not strategy. Companies structure themselves around the people they have rather than the work they need to do. Your structure is either accelerating your strategy or fighting it.',
                peerProof: '"A €30M company restructured from functional silos to two business units aligned with their core customer segments. Accountability became clearer. Cross-functional conflict dropped. Revenue per head increased 18% in 12 months."'
            },
            2: {
                brutalTruth: 'Reorganizations fail not because of the structure chosen, but because of what was not addressed: unclear decision rights, informal power structures, and roles created for people rather than outcomes.',
                peerProof: '"A tech company redesigned their org twice in three years without improvement. On the third attempt, they mapped informal influence alongside formal structure. They discovered their \'VP of Engineering\' had no actual engineering authority — it was held by a senior developer 2 levels down."'
            },
            3: {
                brutalTruth: 'The best organizational structure is the one your team can actually operate. A theoretically perfect org chart with confused humans is worse than an imperfect chart with aligned ones. Design for clarity, not elegance.',
                peerProof: '"A €15M professional services firm replaced a complex matrix structure with a simple pod model. Three months of confusion followed. Then clarity hit — pods set their own goals, managed their own P&L, and overall revenue grew 31% the next year."'
            },
            4: {
                brutalTruth: 'Personal development plans that sit in a folder do not develop people. PDPs only work when they are tied to real business needs, reviewed quarterly, and connected to visible career progression. Otherwise they are performance review theatre.',
                peerProof: '"One company tied PDPs to a role-advancement framework visible to all employees. Voluntary turnover dropped 35% in 18 months. The highest performers cited \'clarity about the path forward\' as the primary reason they stayed."'
            },
            5: {
                brutalTruth: 'An org chart without a 90-day execution plan is just a slide deck. Structural redesigns that lack a clear activation timeline revert to old patterns within 60 days because informal authority fills the vacuum.',
                peerProof: '"A €20M logistics company completed their redesign canvas and committed to a hard 90-day activation window with weekly leadership check-ins. Six months later, every key role was filled, every PDP had a sponsor, and net revenue per head was up 22%."'
            }
        },
        CLOSING_MESSAGES: {
            1: { title: 'TEAM ASSESSED', text: 'You now have a clear picture of where each person stands. This data drives everything that follows.' },
            2: { title: 'ROLES DEFINED', text: 'Your new structure is taking shape. Now you match people to those roles with precision.' },
            3: { title: 'MATRIX COMPLETE', text: 'The data doesn\'t lie. You can now see exactly where the fits are strong and where gaps exist.' },
            4: { title: 'ACTION PLAN SET', text: 'Every person has a clear path forward. Now develop the ones who need it.' },
            5: { title: 'REDESIGN COMPLETE', text: 'You have a full people strategy: placements, development plans, and a 90-day execution roadmap.' }
        }
    };

    // Make Supabase client globally available for dependency injection
    // Initialize ToolDB and dependency injection
    ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        window.CognitiveLoad && CognitiveLoad.init('org-redesign', {"insights":["Structure follows strategy, never the reverse.","Every role should have a clear owner, clear metrics, and clear authority."],"caseStudy":{"before":"A 200-person B2B services firm kept the same org chart for 5 years while tripling in size. Roles were designed around personalities, not functions. Span of control reached 14 direct reports for the CEO. Decision bottlenecks delayed client delivery by weeks.","after":"Redesigned around 5 core value streams with clear process owners and 3-7 span of control. FIT analysis placed A-players in mission-critical roles, created PDPs for B+ players, and transitioned 3 poor-fit team members within 90 days. Decision speed doubled. Client satisfaction rose 34%.","quote":"We finally stopped designing the org around who we had and started designing it around what the business needed. The hardest part was admitting our current structure was built for comfort, not performance. - CEO, B2B Services Company"}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

        function DependencyContext({ deps }) {
            const [open, setOpen] = React.useState(false);
            if (!deps || deps.length === 0) return null;
            return (
                <div className="dep-context">
                    <div className="dep-context-header" onClick={() => setOpen(o => !o)}>
                        <span className="dep-context-label">Context from previous tools ({deps.length})</span>
                        <span style={{ fontSize: 12, color: '#999' }}>{open ? '▲' : '▼'}</span>
                    </div>
                    {open && (
                        <div className="dep-context-body">
                            {deps.map((dep, i) => (
                                <div key={i} style={{ marginBottom: 8 }}>
                                    <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', textTransform: 'uppercase', letterSpacing: '0.08em' }}>{dep.label}: </span>
                                    <span>{dep.value}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

    // Main App Component
    function OrganizationalRedesignApp() {
            const [deps, setDeps] = useState([]);
      const [step, setStep] = useState(0);
      const [aiReviewing, setAiReviewing] = useState(false);
      const [aiMessage, setAiMessage] = useState('');
      const [submitted, setSubmitted] = useState(false);
      const [roleIdx, setRoleIdx] = useState(0);

      // Reset roleIdx when entering step 2
      useEffect(() => {
        if (step === 2) setRoleIdx(0);
      }, [step]);

      const [data, setData] = useState({
        // Sheet 1: Current Team Assessment
        currentTeam: [
          {
            id: 1,
            name: '',
            currentPosition: '',
            companyFit: 0,
            jobFit: 0,
            bossFit: 0,
            teamFit: 0,
            totalFit: 0
          }
        ],

        // Sheet 2: Define New Roles
        newRoles: [
          {
            id: 1,
            roleTitle: '',
            criticality: 5,
            requiredSkills: ['', '', '']
          }
        ],

        // Sheet 3: Decision Matrix
        decisionMatrix: [],

        // Sheet 4: Action Plan
        actionPlan: {
          immediate: [],
          development: [],
          transition: []
        },

        // Sheet 5: PDPs
        pdps: []
      });

            useEffect(() => {
                async function loadDeps() {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId || !window.ToolDB || !window.DependencyInjection) return;
                    try {
                        await ToolDB.whenReady();
                        const config = DependencyInjection.getDependenciesConfig();
                        const toolConfig = config[CONFIG.TOOL_SLUG];
                        if (!toolConfig || !toolConfig.fields) return;
                        const loaded = [];
                        for (const field of toolConfig.fields) {
                            const val = await ToolDB.getDependency(userId, field.source_field);
                            if (val) {
                                loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                            }
                        }
                        setDeps(loaded);
                    } catch (err) {
                        console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
                    }
                }
                loadDeps();
            }, []);

      // Load from localStorage
      useEffect(() => {
        const saved = localStorage.getItem('organizational-redesign-data');
        if (saved) {
          try {
            const savedData = JSON.parse(saved);
            setData(savedData);
          } catch (e) {
            console.error('Error loading saved data:', e);
          }
        }
      }, []);

      // Auto-save every 2 seconds
      useEffect(() => {
        const interval = setInterval(() => {
          localStorage.setItem('organizational-redesign-data', JSON.stringify(data));
        }, 2000);
        return () => clearInterval(interval);
      }, [data]);

      const updateData = (field, value) => {
        setData({ ...data, [field]: value });
      };

      // Team Member Management
      const addTeamMember = () => {
        const newMember = {
          id: Date.now(),
          name: '',
          currentPosition: '',
          companyFit: 0,
          jobFit: 0,
          bossFit: 0,
          teamFit: 0,
          totalFit: 0
        };
        updateData('currentTeam', [...(data.currentTeam || []), newMember]);
      };

      const removeTeamMember = (id) => {
        if ((data.currentTeam || []).length > 1) {
          updateData('currentTeam', (data.currentTeam || []).filter(m => m.id !== id));
        }
      };

      const updateTeamMember = (id, field, value) => {
        const updated = (data.currentTeam || []).map(m => {
          if (m.id === id) {
            const updatedMember = { ...m, [field]: value };
            // Auto-calculate Total FIT
            if (['companyFit', 'jobFit', 'bossFit', 'teamFit'].includes(field)) {
              const total = (
                (parseFloat(updatedMember.companyFit) || 0) +
                (parseFloat(updatedMember.jobFit) || 0) +
                (parseFloat(updatedMember.bossFit) || 0) +
                (parseFloat(updatedMember.teamFit) || 0)
              ) / 4;
              updatedMember.totalFit = Math.round(total * 100) / 100;
            }
            return updatedMember;
          }
          return m;
        });
        updateData('currentTeam', updated);
      };

      // Role Management
      const addRole = () => {
        const newRole = {
          id: Date.now(),
          roleTitle: '',
          criticality: 5,
          requiredSkills: ['', '', '']
        };
        updateData('newRoles', [...(data.newRoles || []), newRole]);
      };

      const removeRole = (id) => {
        if ((data.newRoles || []).length > 1) {
          updateData('newRoles', (data.newRoles || []).filter(r => r.id !== id));
        }
      };

      const updateRole = (id, field, value) => {
        const updated = (data.newRoles || []).map(r => r.id === id ? { ...r, [field]: value } : r);
        updateData('newRoles', updated);
      };

      const addSkill = (roleId) => {
        const updated = (data.newRoles || []).map(r => {
          if (r.id === roleId && (r.requiredSkills || []).length < 7) {
            return { ...r, requiredSkills: [...(r.requiredSkills || []), ''] };
          }
          return r;
        });
        updateData('newRoles', updated);
      };

      const removeSkill = (roleId, skillIndex) => {
        const updated = (data.newRoles || []).map(r => {
          if (r.id === roleId && (r.requiredSkills || []).length > 3) {
            return {
              ...r,
              requiredSkills: (r.requiredSkills || []).filter((_, i) => i !== skillIndex)
            };
          }
          return r;
        });
        updateData('newRoles', updated);
      };

      const updateSkill = (roleId, skillIndex, value) => {
        const updated = (data.newRoles || []).map(r => {
          if (r.id === roleId) {
            const skills = [...(r.requiredSkills || [])];
            skills[skillIndex] = value;
            return { ...r, requiredSkills: skills };
          }
          return r;
        });
        updateData('newRoles', updated);
      };

      // Decision Matrix Management
      const initializeMatrix = () => {
        const matrix = (data.currentTeam || []).map(person => ({
          personId: person.id,
          personName: person.name || '',
          roleScores: {}
        }));
        updateData('decisionMatrix', matrix);
      };

      const updateMatrixScore = (personId, roleId, score) => {
        const updated = (data.decisionMatrix || []).map(entry => {
          if (entry.personId === personId) {
            return {
              ...entry,
              roleScores: { ...entry.roleScores, [roleId]: parseFloat(score) || 0 }
            };
          }
          return entry;
        });
        updateData('decisionMatrix', updated);
      };

      // Action Plan Management
      const categorizeActionPlan = () => {
        const immediate = [];
        const development = [];
        const transition = [];

        (data.decisionMatrix || []).forEach(entry => {
          const person = (data.currentTeam || []).find(p => p.id === entry.personId);
          if (!person) return;

          const scores = Object.entries(entry.roleScores || {});
          const bestScore = Math.max(...scores.map(([_, score]) => score), 0);
          const bestRole = scores.find(([_, score]) => score === bestScore);

          if (bestScore >= 5 && bestRole) {
            const roleTitle = (data.newRoles || []).find(r => r.id.toString() === bestRole[0])?.roleTitle || '';
            immediate.push({
              personId: person.id,
              name: person.name,
              assignedRole: roleTitle,
              fitScore: bestScore,
              startDate: '',
              successMetrics: ''
            });
          } else if (bestScore >= 4 && bestRole) {
            const roleTitle = (data.newRoles || []).find(r => r.id.toString() === bestRole[0])?.roleTitle || '';
            development.push({
              personId: person.id,
              name: person.name,
              targetRole: roleTitle,
              fitScore: bestScore,
              developmentTimeline: '',
              mentor: ''
            });
          } else {
            transition.push({
              personId: person.id,
              name: person.name,
              currentRole: person.currentPosition,
              transitionType: '',
              timeline: '',
              notes: ''
            });
          }
        });

        updateData('actionPlan', { immediate, development, transition });
      };

      const updateActionPlanItem = (category, personId, field, value) => {
        const updated = { ...data.actionPlan };
        updated[category] = (updated[category] || []).map(item =>
          item.personId === personId ? { ...item, [field]: value } : item
        );
        updateData('actionPlan', updated);
      };

      // PDP Management
      const initializePDPs = () => {
        const pdps = (data.actionPlan?.development || []).map(dev => ({
          personId: dev.personId,
          name: dev.name,
          targetRole: dev.targetRole,
          coreActivity: '',
          capabilities: [
            {
              id: 1,
              capability: '',
              currentFulfillment: 0,
              gap: 100,
              what: '',
              when: '',
              byWhom: ''
            }
          ],
          checkpoint30Days: '',
          checkpoint60Days: '',
          checkpoint90Days: ''
        }));
        updateData('pdps', pdps);
      };

      const updatePDP = (personId, field, value) => {
        const updated = (data.pdps || []).map(pdp =>
          pdp.personId === personId ? { ...pdp, [field]: value } : pdp
        );
        updateData('pdps', updated);
      };

      const addCapability = (personId) => {
        const updated = (data.pdps || []).map(pdp => {
          if (pdp.personId === personId) {
            return {
              ...pdp,
              capabilities: [...(pdp.capabilities || []), {
                id: Date.now(),
                capability: '',
                currentFulfillment: 0,
                gap: 100,
                what: '',
                when: '',
                byWhom: ''
              }]
            };
          }
          return pdp;
        });
        updateData('pdps', updated);
      };

      const removeCapability = (personId, capabilityId) => {
        const updated = (data.pdps || []).map(pdp => {
          if (pdp.personId === personId && (pdp.capabilities || []).length > 1) {
            return {
              ...pdp,
              capabilities: (pdp.capabilities || []).filter(c => c.id !== capabilityId)
            };
          }
          return pdp;
        });
        updateData('pdps', updated);
      };

      const updateCapability = (personId, capabilityId, field, value) => {
        const updated = (data.pdps || []).map(pdp => {
          if (pdp.personId === personId) {
            return {
              ...pdp,
              capabilities: (pdp.capabilities || []).map(cap => {
                if (cap.id === capabilityId) {
                  const updatedCap = { ...cap, [field]: value };
                  if (field === 'currentFulfillment') {
                    updatedCap.gap = 100 - (parseFloat(value) || 0);
                  }
                  return updatedCap;
                }
                return cap;
              })
            };
          }
          return pdp;
        });
        updateData('pdps', updated);
      };

      const goNext = async () => {
        if (step === 0.5) {
          setStep(1);
        } else if (step >= 1 && step <= 5) {
          // Step 1 (Team Assessment) handles per-member review internally — skip AI here
          if (step !== 1) {
            const userId = localStorage.getItem('ft_user_id');
            if (userId) {
              setAiReviewing(true);
              try {
                let stepAnswers = {};
                let stepName = '';
                if (step === 2) {
                  stepName = 'Define New Roles';
                  stepAnswers = { new_roles: (data.newRoles || []).map(r => ({ roleTitle: r.roleTitle, criticality: r.criticality, requiredSkills: r.requiredSkills })) };
                } else if (step === 3) {
                  stepName = 'Decision Matrix';
                  stepAnswers = { decision_matrix: data.decisionMatrix || [] };
                } else if (step === 4) {
                  stepName = 'Action Plan';
                  stepAnswers = { action_plan: data.actionPlan || {} };
                } else if (step === 5) {
                  stepName = 'PDPs';
                  stepAnswers = { pdps: data.pdps || [] };
                }
                const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
                if (!canProceed) {
                  setAiMessage(window.AIChallenge?.getLastFeedback?.()?.suggestion || 'Please expand your answer before continuing.');
                  setAiReviewing(false);
                  return;
                }
                setAiMessage('');
              } catch (err) {
                console.warn('[AIChallenge] Error, allowing passage:', err);
              } finally {
                setAiReviewing(false);
              }
            }
          }

          if (step === 1) {
            setStep(1.5);
          } else if (step === 2) {
            initializeMatrix();
            setStep(2.5);
          } else if (step === 3) {
            categorizeActionPlan();
            setStep(3.5);
          } else if (step === 4) {
            initializePDPs();
            setStep(4.5);
          } else if (step === 5) {
            setStep(5.5);
          }
        } else if (step === 0) {
          setStep(0.5);
        }
      };

      const goBack = () => {
        if (step === 6) {
          setStep(5);
        } else if (step > 1) {
          setStep(step - 1);
        } else if (step === 1) {
          setStep(0.5);
        }
      };

      // Validation functions
      const isStep1Valid = () => {
        return (data.currentTeam || []).length >= 1 &&
               (data.currentTeam || []).every(m =>
                 (m.name || '').trim().length >= 2 &&
                 (m.currentPosition || '').trim().length >= 2 &&
                 m.companyFit >= 0 && m.companyFit <= 1 &&
                 m.jobFit >= 0 && m.jobFit <= 1 &&
                 m.bossFit >= 0 && m.bossFit <= 1 &&
                 m.teamFit >= 0 && m.teamFit <= 1
               );
      };

      const isStep2Valid = () => {
        return (data.newRoles || []).length >= 1 &&
               (data.newRoles || []).every(r =>
                 (r.roleTitle || '').trim().length >= 2 &&
                 r.criticality >= 1 && r.criticality <= 10 &&
                 (r.requiredSkills || []).length >= 3 &&
                 (r.requiredSkills || []).filter(s => (s || '').trim().length > 0).length >= 3
               );
      };

      const isStep3Valid = () => {
        return (data.decisionMatrix || []).length > 0 &&
               (data.decisionMatrix || []).every(entry => {
                 const scores = Object.values(entry.roleScores || {});
                 return scores.length === (data.newRoles || []).length;
               });
      };

      const isStep4Valid = () => {
        const immediate = data.actionPlan?.immediate || [];
        const development = data.actionPlan?.development || [];
        const transition = data.actionPlan?.transition || [];
        return (immediate.length + development.length + transition.length) > 0;
      };

      const isStep5Valid = () => {
        const devCount = (data.actionPlan?.development || []).length;
        if (devCount === 0) return true;

        return (data.pdps || []).every(pdp =>
          (pdp.coreActivity || '').length >= 2 &&
          (pdp.capabilities || []).length >= 1 &&
          (pdp.capabilities || []).every(cap =>
            (cap.capability || '').length >= 2 &&
            cap.currentFulfillment >= 0 && cap.currentFulfillment <= 100
          )
        );
      };

      const exportPDF = async () => {
        try {
          const canvas = document.getElementById('canvas-content');
          if (!canvas) {
            alert('Canvas not found');
            return;
          }

          const canvasImage = await html2canvas(canvas, {
            scale: 2,
            logging: false,
            backgroundColor: '#ffffff'
          });

          const imgWidth = 190;
          const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');
          const imgData = canvasImage.toDataURL('image/png');

          pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
          pdf.save('organizational-redesign.pdf');
        } catch (error) {
          console.error('PDF export error:', error);
          alert('Failed to export PDF: ' + error.message);
        }
      };

      const handleSubmit = async () => {
        const userId = localStorage.getItem('ft_user_id');
        if (!userId) {
          alert('User not authenticated. Please return to the dashboard.');
          return false;
        }

        try {
          const questionMappings = {
            machine_blueprint: {
              currentTeam: (data.currentTeam || []).map(m => ({
                name: m.name,
                currentPosition: m.currentPosition,
                companyFit: m.companyFit,
                jobFit: m.jobFit,
                bossFit: m.bossFit,
                teamFit: m.teamFit,
                totalFit: m.totalFit
              })),
              newRoles: (data.newRoles || []).map(r => ({
                roleTitle: r.roleTitle,
                criticality: r.criticality,
                requiredSkills: r.requiredSkills
              }))
            },
            right_seats: {
              decisionMatrix: data.decisionMatrix || [],
              actionPlan: data.actionPlan || {}
            },
            strategy_shadow: {
              pdps: data.pdps || []
            }
          };
          await window.AIChallenge.submitWithChallenge(userId, CONFIG.TOOL_SLUG, questionMappings, {
            onReviewStart: () => {},
            onRevise: () => { setStep(5); },
            onSubmitAnyway: () => { setSubmitted(true); },
            onError: (err) => { alert('Submission failed: ' + err.message); }
          });
          return true;
        } catch (error) {
          console.error('Supabase submission error:', error);
          alert('Submission failed. Please try again.');
          return false;
        }
      };

      // Render different pages based on step
      if (submitted) {
        return (
          <div style={{ minHeight: '100vh', background: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '48px 32px' }}>
            <div className="submit-success" style={{ maxWidth: 480, width: '100%' }}>
              <div style={{ fontSize: 40, marginBottom: 8 }}>✓</div>
              <h2 className="plaak" style={{ fontSize: 28, marginBottom: 8 }}>SUBMITTED</h2>
              <p style={{ color: '#555', marginBottom: 16 }}>Your Org Redesign canvas has been saved.</p>
              <a href="\dashboard" style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#000', letterSpacing: '0.08em', textTransform: 'uppercase', textDecoration: 'none', borderBottom: '2px solid #000' }}>← Back to Dashboard</a>
            </div>
          </div>
        );
      }

      if ([1.5, 2.5, 3.5, 4.5, 5.5].includes(step)) {
        return window.renderTransitionScreen(step, CONFIG, 5, setStep);
      }

      if (step === 0) {
        return <CoverPage onStart={goNext} />;
      }

      if (step === 0.5) {
        return <IntroPage onNext={goNext} />;
      }

      // Steps 1-5: Wizard layout
      if (step >= 1 && step <= 5) {
        const stepLabels = ['Team Assessment', 'Define New Roles', 'Decision Matrix', 'Action Plan', 'Dev Plans'];
        // Step 1 uses internal per-member navigation — skip standard validation gate for footer
        const isValid = step === 1 ? true : step === 2 ? isStep2Valid() : step === 3 ? isStep3Valid() : step === 4 ? isStep4Valid() : isStep5Valid();
        const canProceed = !aiReviewing && isValid;
        const nextLabels = { 2: 'NEXT: DECISION MATRIX →', 3: 'NEXT: ACTION PLAN →', 4: 'NEXT: DEV PLANS →', 5: 'VIEW CANVAS →' };
        return (
          <div className="wizard-layout">
            <div className="wizard-main">
              <div className="step-content animate-in">
                <DependencyContext deps={deps} />
                {step === 1 && <Step1Page data={data} updateTeamMember={updateTeamMember} addTeamMember={addTeamMember} removeTeamMember={removeTeamMember} onAdvanceStep={goNext} />}
                {step === 2 && <Step2Page data={data} updateRole={updateRole} addRole={addRole} removeRole={removeRole} addSkill={addSkill} removeSkill={removeSkill} updateSkill={updateSkill} roleIdx={roleIdx} setRoleIdx={setRoleIdx} />}
                {step === 3 && <Step3Page data={data} updateMatrixScore={updateMatrixScore} />}
                {step === 4 && <Step4Page data={data} updateActionPlanItem={updateActionPlanItem} />}
                {step === 5 && <Step5Page data={data} updatePDP={updatePDP} addCapability={addCapability} removeCapability={removeCapability} updateCapability={updateCapability} />}
              </div>
              {step !== 1 && step !== 2 && (
                <div className="wizard-footer" style={{flexDirection:'column',alignItems:'stretch',gap:'0'}}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                    <button className="btn-wiz-back" onClick={goBack}>← BACK</button>
                    <button className="btn-wiz-next" disabled={!canProceed} onClick={goNext}>
                      {aiReviewing ? 'AI COACH REVIEWING...' : (nextLabels[step] || 'NEXT →')}
                    </button>
                  </div>
                  {aiMessage && <div style={{color:'#dc2626',fontSize:'13px',marginTop:'8px',padding:'8px 12px',background:'#fef2f2',borderRadius:'6px'}}>{aiMessage}</div>}
                </div>
              )}
              {step === 2 && (
                <div className="wizard-footer" style={{flexDirection:'column',alignItems:'stretch',gap:'0'}}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                    <button className="btn-wiz-back" onClick={() => {
                      if (roleIdx > 0) { setRoleIdx(roleIdx - 1); }
                      else { goBack(); }
                    }}>← BACK</button>
                    <button className="btn-wiz-next" disabled={!canProceed} onClick={() => {
                      if (roleIdx < (data.newRoles || []).length - 1) { setRoleIdx(roleIdx + 1); }
                      else { goNext(); }
                    }}>
                      {aiReviewing ? 'AI COACH REVIEWING...' : (roleIdx < (data.newRoles || []).length - 1 ? 'NEXT ROLE →' : (nextLabels[step] || 'NEXT →'))}
                    </button>
                  </div>
                  {aiMessage && <div style={{color:'#dc2626',fontSize:'13px',marginTop:'8px',padding:'8px 12px',background:'#fef2f2',borderRadius:'6px'}}>{aiMessage}</div>}
                </div>
              )}
              {step === 1 && (
                <div className="wizard-footer">
                  <button className="btn-wiz-back" onClick={goBack}>← BACK TO INTRO</button>
                </div>
              )}
            </div>
            <WizardSidebar currentStep={step} stepLabels={stepLabels} totalSteps={5} />
          </div>
        );
      }

      if (step === 6) {
        return (
          <CanvasPage
            data={data}
            onExport={exportPDF}
            onSubmit={handleSubmit}
          />
        );
      }

      return null;
    }

    // Cover Page Component
    function CoverPage({ onStart }) {
      return (
        <div style={{ position: 'relative', width: '100%', minHeight: '100vh', background: '#000', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }}>
          <div style={{ position: 'absolute', inset: 0, backgroundImage: 'url("https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1920&q=80")', backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.35 }} />
          <div style={{ position: 'relative', zIndex: 2, textAlign: 'center', padding: '0 32px', maxWidth: 800 }}>
            <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', letterSpacing: '0.15em', textTransform: 'uppercase', marginBottom: 24 }}>SPRINT 25</div>
            <h1 className="plaak animate-in" style={{ fontSize: 'clamp(48px, 8vw, 96px)', color: '#fff', marginBottom: 24, lineHeight: 1 }}>
              ORGANIZATIONAL REDESIGN
            </h1>
            <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48, lineHeight: 1.6 }} className="animate-in">
              Transform structure into reality. Match people to roles with precision and create a 90-day implementation roadmap.
            </p>
            <button onClick={onStart} className="plaak animate-in"
              style={{ background: '#FFF469', color: '#000', border: 'none', padding: '20px 56px', fontSize: 20, cursor: 'pointer', letterSpacing: '0.02em' }}>
              START →
            </button>
          </div>
        </div>
      );
    }

    // Intro Page Component
    function IntroPage({ onNext }) {
      return (
        <div style={{ background: '#000', color: '#fff', minHeight: '100vh', padding: '64px' }}>
          <div style={{ maxWidth: '1000px', margin: '0 auto' }}>
            <h1 className="plaak animate-in" style={{ fontSize: '100px', marginBottom: '64px' }}>
              BEFORE WE START
            </h1>

            {/* Sprint Info */}
            <div className="animate-in" style={{ marginBottom: '48px', animationDelay: '0.08s' }}>
              <h2 className="plaak" style={{ fontSize: '48px', color: '#FFF469', marginBottom: '24px' }}>SPRINT INFO</h2>
              <div style={{ background: '#fff', color: '#000', padding: '32px' }}>
                <p style={{ fontSize: '22px', fontWeight: 'bold', marginBottom: '16px' }}>Sprint 25: Organizational Redesign & PDPs</p>
                <p style={{ fontSize: '18px', lineHeight: 1.6, marginBottom: '16px' }}>
                  Only 12% of organisational transformations achieve their full potential — primarily because of failures in the people side of change. This sprint is where strategy meets reality: your ideal structure becomes operational through the right human capital decisions.
                </p>
                <div style={{ borderLeft: '4px solid #000', paddingLeft: '16px', fontStyle: 'italic', fontSize: '16px' }}>
                  This tool integrates Sprint 22 (structure), Sprint 23 (capabilities), and Sprint 24 (people assessment) into an actionable 90-day implementation roadmap.
                </div>
              </div>
            </div>

            {/* Integration Logic */}
            <div className="animate-in" style={{ marginBottom: '48px', animationDelay: '0.1s' }}>
              <h2 className="plaak" style={{ fontSize: '48px', marginBottom: '24px' }}>INTEGRATION LOGIC</h2>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px' }}>
                {[
                  ['SPRINT 22', 'Structure Foundation', ['5 core activities', '3 critical processes', '9 KPIs', 'Org chart']],
                  ['SPRINT 23', 'Capabilities Framework', ['Key decisions', 'Required capabilities', 'Gap analysis', 'Data requirements']],
                  ['SPRINT 24', 'People Assessment', ['FIT scores (4 dimensions)', 'ABC player ratings', 'Honest evaluation', 'Development potential']],
                ].map(([title, sub, items]) => (
                  <div key={title} style={{ border: '2px solid #fff', padding: '24px' }}>
                    <h3 className="plaak" style={{ fontSize: '24px', color: '#FFF469', marginBottom: '8px' }}>{title}</h3>
                    <p style={{ fontSize: '14px', fontWeight: 'bold', marginBottom: '12px', color: '#ccc' }}>{sub}</p>
                    <ul style={{ fontSize: '14px', listStyle: 'none', padding: 0, lineHeight: 1.8 }}>
                      {items.map(i => <li key={i}>• {i}</li>)}
                    </ul>
                  </div>
                ))}
              </div>
            </div>

            {/* The Journey */}
            <div className="animate-in" style={{ marginBottom: '48px', animationDelay: '0.15s' }}>
              <h2 className="plaak" style={{ fontSize: '48px', color: '#FFF469', marginBottom: '24px' }}>THE JOURNEY</h2>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                {[
                  ['01', 'CURRENT TEAM ASSESSMENT', 'Import FIT scores from Sprint 24. Calculate Total FIT. Identify at-risk placements.'],
                  ['02', 'DEFINE NEW ROLES', 'Document roles from Sprint 22 structure. Score criticality (1-10). List required skills.'],
                  ['03', 'DECISION MATRIX', 'Match people to roles with FIT scoring. Identify gaps, conflicts, and optimal placements.'],
                  ['04', 'ACTION PLAN', 'Categorise: Immediate (0.8+ FIT), Development (0.6–0.79), Transition (below 0.6).'],
                  ['05', 'PERSONAL DEVELOPMENT PLANS', 'Create PDPs for development category. Define capability gaps, 30-60-90 checkpoints.'],
                ].map(([num, title, desc]) => (
                  <div key={num} style={{ border: '2px solid #fff', padding: '20px 24px', display: 'flex', alignItems: 'flex-start', gap: '24px' }}>
                    <div className="plaak" style={{ fontSize: '40px', lineHeight: 1, flexShrink: 0 }}>{num}</div>
                    <div>
                      <p style={{ fontWeight: 'bold', fontSize: '16px', marginBottom: '4px' }}>{title}</p>
                      <p style={{ fontSize: '14px', color: '#ccc', lineHeight: 1.5 }}>{desc}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Mistakes */}
            <div className="animate-in" style={{ marginBottom: '64px', animationDelay: '0.2s' }}>
              <h2 className="plaak" style={{ fontSize: '48px', marginBottom: '24px' }}>MISTAKES TO AVOID</h2>
              <ul style={{ fontSize: '20px', listStyle: 'none', padding: 0 }}>
                {[
                  'Sugar-coating FIT scores — wrong placements fail fast and damage the whole team.',
                  'Designing the org around who you have rather than what the business needs.',
                  'Creating PDPs without clear owners, timelines, and quarterly reviews.',
                  'Skipping the tough conversations — ambiguity creates fear and inaction.',
                  'Treating compassionate exits as optional — how you exit people determines if A-players trust you.',
                ].map((item, i) => (
                  <li key={i} style={{ display: 'flex', alignItems: 'flex-start', marginBottom: '16px' }}>
                    <span style={{ fontSize: '32px', marginRight: '16px', lineHeight: 1, flexShrink: 0 }}>•</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
            </div>

            <button onClick={onNext} className="plaak"
              style={{ width: '100%', padding: '32px', background: '#FFF469', color: '#000', border: 'none', fontSize: '28px', cursor: 'pointer', letterSpacing: '0.05em' }}>
              LET'S START →
            </button>
          </div>
        </div>
      );
    }

    // Wizard Sidebar Component
    function WizardSidebar({ currentStep, stepLabels, totalSteps }) {
      const canvasStep = 'canvas';
      const allSteps = [...stepLabels.map((label, i) => ({ num: i + 1, label })), { num: canvasStep, label: 'Canvas' }];
      return (
        <div className="wizard-sidebar">
          <div className="sidebar-tool-num">SPRINT 25</div>
          <div className="sidebar-tool-title">ORG REDESIGN</div>
          {allSteps.map(s => {
            const isCanvas = s.num === canvasStep;
            const isDone   = isCanvas ? false : currentStep > s.num;
            const isActive = isCanvas ? currentStep === canvasStep : Math.floor(currentStep) === s.num;
            const isFuture = isCanvas ? false : currentStep < s.num;
            return (
              <div key={s.num} className="sidebar-step" style={{ opacity: isFuture ? 0.35 : 1 }}>
                <div className={`sidebar-step-dot ${isActive ? 'active' : isDone ? 'done' : ''}`} />
                <span className={`sidebar-step-label ${isActive ? 'active' : isDone ? 'done' : ''}`}>{s.label}</span>
              </div>
            );
          })}
        </div>
      );
    }

    // Helper function to get FIT interpretation
    function getFitInterpretation(fitScore) {
      if (fitScore >= 0.8) return { label: 'EXCELLENT FIT', class: 'fit-excellent', text: 'A-player in right seat' };
      if (fitScore >= 0.6) return { label: 'GOOD FIT', class: 'fit-good', text: 'B+ player with development potential' };
      if (fitScore >= 0.4) return { label: 'MODERATE FIT', class: 'fit-moderate', text: 'Needs significant development or role change' };
      return { label: 'POOR FIT', class: 'fit-poor', text: 'Likely wrong seat or wrong bus' };
    }

    // Helper function to get criticality label
    function getCriticalityLabel(score) {
      if (score === 10) return 'MISSION-CRITICAL';
      if (score >= 7) return 'HIGHLY IMPORTANT';
      if (score >= 4) return 'IMPORTANT';
      return 'NICE TO HAVE';
    }

    // Helper function to get matrix cell class (1-5 scale)
    function getMatrixCellClass(score) {
      if (score >= 5) return 'score-excellent';
      if (score >= 4) return 'score-good';
      if (score >= 3) return 'score-moderate';
      return 'score-poor';
    }

    // Step 1: Current Team Assessment Component — typeform-style, one member at a time
    function Step1Page({ data, updateTeamMember, addTeamMember, removeTeamMember, onAdvanceStep }) {
      const members = data.currentTeam || [];
      const [memberIndex, setMemberIndex] = useState(0);
      const [transitioning, setTransitioning] = useState(false);

      const currentMember = members[memberIndex] || {};
      const totalMembers = members.length;
      const fitInterpretation = getFitInterpretation(currentMember.totalFit || 0);

      // Validate current member before advancing
      const isMemberValid = () => {
        return (
          (currentMember.name || '').trim().length >= 2 &&
          (currentMember.currentPosition || '').trim().length >= 2 &&
          currentMember.companyFit >= 0 && currentMember.companyFit <= 1 &&
          currentMember.jobFit >= 0 && currentMember.jobFit <= 1 &&
          currentMember.bossFit >= 0 && currentMember.bossFit <= 1 &&
          currentMember.teamFit >= 0 && currentMember.teamFit <= 1
        );
      };

      const goNextMember = () => {
        if (transitioning) return;
        if (memberIndex < totalMembers - 1) {
          setTransitioning(true);
          setMemberIndex(memberIndex + 1);
          setTransitioning(false);
        } else {
          // All members done — advance wizard step
          if (onAdvanceStep) onAdvanceStep();
        }
      };

      const goPrevMember = () => {
        if (memberIndex > 0) {
          setMemberIndex(memberIndex - 1);
        }
      };

      const handleAddMember = () => {
        addTeamMember();
        // Navigate to the new member (will be last)
        setMemberIndex(totalMembers); // totalMembers is current length, new item will be at that index
      };

      const isLastMember = memberIndex === totalMembers - 1;
      const canAdvance = isMemberValid();

      if (!currentMember.id && totalMembers === 0) return null;

      return (
        <div>
          <div className="numbered-section mb-6 animate-in">STEP 01 — CURRENT TEAM ASSESSMENT</div>

          {/* Progress bar */}
          <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 28 }}>
            <div style={{ flex: 1, height: 4, background: '#E0E0E0', borderRadius: 2 }}>
              <div style={{ height: '100%', background: '#000', borderRadius: 2, width: `${((memberIndex + 1) / totalMembers) * 100}%`, transition: 'width 0.4s ease' }} />
            </div>
            <span className="monument" style={{ fontSize: 11, color: '#666', whiteSpace: 'nowrap' }}>
              {memberIndex + 1} / {totalMembers}
            </span>
          </div>

          {/* Science reveal */}
          {(currentMember.name || '').length >= 2 && (
            <div className="ft-reveal" style={{ marginBottom: 20 }}>
              <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
              <p className="ft-reveal-text">Research on person-environment fit shows that multi-dimensional assessment (Company-Job-Boss-Team) predicts job performance and retention significantly better than single-factor evaluations (Kristof-Brown et al., 2005, Personnel Psychology). Structured FIT scoring eliminates the subjectivity bias that causes 87% of restructurings to misalign people.</p>
            </div>
          )}

          {/* Member card */}
          <div key={currentMember.id} className="animate-in">

            {/* Member header */}
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 6 }}>
              <div className="monument" style={{ fontSize: 11, color: '#666', letterSpacing: '0.08em' }}>
                MEMBER {memberIndex + 1} OF {totalMembers}
              </div>
              {totalMembers > 1 && (
                <button
                  onClick={() => {
                    removeTeamMember(currentMember.id);
                    setMemberIndex(Math.max(0, memberIndex - 1));
                  }}
                  className="btn-remove"
                  style={{ padding: '4px 12px', fontSize: 12 }}
                >
                  REMOVE
                </button>
              )}
            </div>

            <div className="border-4 border-black p-6 mb-4">

              {/* Name + Position */}
              <div className="grid grid-cols-2 gap-6 mb-6">
                <div>
                  <label className="monument text-sm block mb-2">NAME <span style={{ color: '#EF4444' }}>*</span></label>
                  <input
                    type="text"
                    value={currentMember.name || ''}
                    onChange={(e) => updateTeamMember(currentMember.id, 'name', e.target.value)}
                    placeholder="Full name"
                    className="w-full"
                    autoFocus
                  />
                </div>
                <div>
                  <label className="monument text-sm block mb-2">CURRENT POSITION <span style={{ color: '#EF4444' }}>*</span></label>
                  <input
                    type="text"
                    value={currentMember.currentPosition || ''}
                    onChange={(e) => updateTeamMember(currentMember.id, 'currentPosition', e.target.value)}
                    placeholder="Current role"
                    className="w-full"
                  />
                </div>
              </div>

              {/* FIT Scores */}
              <div style={{ background: '#F9F9F9', borderLeft: '3px solid #000', padding: '10px 14px', marginBottom: 16, fontSize: 13, color: '#666' }}>
                Enter FIT scores using 0–1 scale (e.g., 0.85 = strong fit, 0.45 = weak fit). Total FIT auto-calculates.
              </div>

              <div className="grid grid-cols-4 gap-4 mb-4">
                <div>
                  <label className="monument text-sm block mb-2">COMPANY FIT</label>
                  <input
                    type="number"
                    min="0"
                    max="1"
                    step="0.01"
                    value={currentMember.companyFit || 0}
                    onChange={(e) => updateTeamMember(currentMember.id, 'companyFit', parseFloat(e.target.value) || 0)}
                    className="w-full"
                  />
                </div>
                <div>
                  <label className="monument text-sm block mb-2">JOB FIT</label>
                  <input
                    type="number"
                    min="0"
                    max="1"
                    step="0.01"
                    value={currentMember.jobFit || 0}
                    onChange={(e) => updateTeamMember(currentMember.id, 'jobFit', parseFloat(e.target.value) || 0)}
                    className="w-full"
                  />
                </div>
                <div>
                  <label className="monument text-sm block mb-2">BOSS FIT</label>
                  <input
                    type="number"
                    min="0"
                    max="1"
                    step="0.01"
                    value={currentMember.bossFit || 0}
                    onChange={(e) => updateTeamMember(currentMember.id, 'bossFit', parseFloat(e.target.value) || 0)}
                    className="w-full"
                  />
                </div>
                <div>
                  <label className="monument text-sm block mb-2">TEAM FIT</label>
                  <input
                    type="number"
                    min="0"
                    max="1"
                    step="0.01"
                    value={currentMember.teamFit || 0}
                    onChange={(e) => updateTeamMember(currentMember.id, 'teamFit', parseFloat(e.target.value) || 0)}
                    className="w-full"
                  />
                </div>
              </div>

              {/* Total FIT */}
              <div className="bg-gray-100 p-4 border-l-4 border-black">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="monument text-sm mb-1">TOTAL FIT SCORE</p>
                    <p className="text-4xl font-bold">{(currentMember.totalFit || 0).toFixed(2)}</p>
                  </div>
                  <div className="text-right">
                    <span className={`fit-indicator ${fitInterpretation.class}`}>
                      {fitInterpretation.label}
                    </span>
                    <p className="text-sm text-gray-600 mt-2">{fitInterpretation.text}</p>
                  </div>
                </div>
              </div>
            </div>

            {/* Navigation buttons */}
            <div style={{ display: 'flex', gap: 12, marginBottom: 12 }}>
              {memberIndex > 0 && (
                <button
                  className="btn-wiz-back"
                  onClick={goPrevMember}
                  style={{ flexShrink: 0 }}
                >
                  ← PREV MEMBER
                </button>
              )}
              <button
                className="btn-wiz-next"
                disabled={!canAdvance}
                onClick={goNextMember}
                style={{ flex: 1 }}
              >
                {isLastMember ? 'COMPLETE TEAM ASSESSMENT →' : 'NEXT MEMBER →'}
              </button>
            </div>

            {/* Add new member button */}
            <button
              onClick={handleAddMember}
              className="btn-add w-full py-3"
              style={{ fontSize: 15 }}
            >
              + ADD TEAM MEMBER
            </button>

            {!canAdvance && (
              <p className="monument" style={{ fontSize: 10, color: '#999', marginTop: 8, textAlign: 'center' }}>
                FILL IN NAME, POSITION AND ALL FIT SCORES TO CONTINUE
              </p>
            )}
          </div>
        </div>
      );
    }

    // Step 2: Define New Roles Component
    function Step2Page({ data, updateRole, addRole, removeRole, addSkill, removeSkill, updateSkill, roleIdx, setRoleIdx }) {
      const roles = data.newRoles || [];
      const role = roles[roleIdx];
      const criticalityLabel = role ? getCriticalityLabel(role.criticality || 5) : '';

      const handleAddRole = () => {
        addRole();
        setTimeout(() => setRoleIdx(roles.length), 0);
      };

      const handleRemoveRole = (id) => {
        removeRole(id);
        if (roleIdx >= roles.length - 1 && roleIdx > 0) {
          setRoleIdx(roleIdx - 1);
        }
      };

      return (
        <div>
            <div className="mb-8 animate-in">
              <div className="numbered-section mb-4">STEP 02 &middot; Role {roleIdx + 1} of {roles.length}</div>

              {(roles[0]?.roleTitle || '').length >= 5 && (
                  <div className="ft-reveal">
                      <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                      <p className="ft-reveal-text">Research on organizational design shows that optimal span of control is 5-7 direct reports for complex knowledge work and up to 15-20 for routine operational roles (Mintzberg, "The Structuring of Organizations"). The Scorecard Method from "Who" by Geoff Smart demonstrates that roles defined by specific outcomes and competencies lead to 90% hiring success rates versus 50% for traditional job descriptions. Criticality-based role prioritization ensures A-player talent is concentrated where it creates maximum leverage.</p>
                  </div>
              )}

              <h1 className="plaak text-6xl mb-4">DEFINE NEW ROLES</h1>
              <p className="text-2xl text-gray-600 mb-4">
                Document roles needed in your redesigned organization based on Sprint 22 structure.
              </p>
              <div style={{ background: '#F9F9F9', borderLeft: '4px solid #000', padding: '16px' }}>
                <p className="text-lg"><strong>Criticality Scale:</strong> 10 = Mission-Critical, 7-9 = Highly Important, 4-6 = Important, 1-3 = Nice to Have</p>
              </div>
            </div>

            {/* Role Navigator */}
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px', marginBottom: '24px', alignItems: 'center' }}>
              {roles.map((r, i) => {
                const isCurrent = i === roleIdx;
                const isFilled = (r.roleTitle || '').trim().length >= 2 && (r.requiredSkills || []).filter(s => (s || '').trim().length > 0).length >= 3;
                return (
                  <button key={r.id} onClick={() => setRoleIdx(i)} style={{
                    width: '40px', height: '40px', borderRadius: '50%', border: '2px solid #000', cursor: 'pointer',
                    fontFamily: "'Monument', monospace", fontSize: '13px', fontWeight: 'bold',
                    background: isCurrent ? '#000' : isFilled ? '#D1D5DB' : '#fff',
                    color: isCurrent ? '#FFF469' : '#000',
                    transition: 'all 0.2s ease'
                  }}>
                    {i + 1}
                  </button>
                );
              })}
              <button onClick={handleAddRole} style={{
                height: '40px', padding: '0 16px', borderRadius: '20px', border: '2px dashed #000',
                background: '#fff', cursor: 'pointer', fontFamily: "'Monument', monospace", fontSize: '11px',
                fontWeight: 'bold', letterSpacing: '0.05em', transition: 'all 0.2s ease'
              }}>
                + ADD ROLE
              </button>
            </div>

            {/* Single Role Card */}
            {role && (
              <div key={roleIdx} className="border-4 border-black p-6 animate-in mb-8">
                <div className="flex justify-between items-start mb-4">
                  <h3 className="plaak text-3xl">ROLE {roleIdx + 1}</h3>
                  {roles.length > 1 && (
                    <button
                      onClick={() => handleRemoveRole(role.id)}
                      className="btn-remove"
                    >
                      REMOVE
                    </button>
                  )}
                </div>

                <div className="mb-6">
                  <label className="monument text-sm block mb-2">ROLE TITLE</label>
                  <input
                    type="text"
                    value={role.roleTitle || ''}
                    onChange={(e) => updateRole(role.id, 'roleTitle', e.target.value)}
                    placeholder="E.g., Head of Operations"
                    className="w-full"
                  />
                </div>

                <div className="mb-6">
                  <label className="monument text-sm block mb-2">CRITICALITY (1-10): {role.criticality || 5}</label>
                  <div className="flex items-center gap-4">
                    <span className="text-sm">1</span>
                    <input
                      type="range"
                      min="1"
                      max="10"
                      step="1"
                      value={role.criticality || 5}
                      onChange={(e) => updateRole(role.id, 'criticality', parseInt(e.target.value))}
                      className="flex-1"
                    />
                    <span className="text-sm">10</span>
                  </div>
                  <div className="mt-2 text-center">
                    <span className="inline-block px-4 py-2 bg-black text-white monument text-sm">
                      {criticalityLabel}
                    </span>
                  </div>
                </div>

                <div className="mb-4">
                  <label className="monument text-sm block mb-2">REQUIRED SKILLS (3-7)</label>
                  <div className="space-y-3">
                    {(role.requiredSkills || []).map((skill, skillIndex) => (
                      <div key={skillIndex} className="flex gap-2">
                        <input
                          type="text"
                          value={skill || ''}
                          onChange={(e) => updateSkill(role.id, skillIndex, e.target.value)}
                          placeholder={'Skill ' + (skillIndex + 1)}
                          className="flex-1"
                        />
                        {(role.requiredSkills || []).length > 3 && (
                          <button
                            onClick={() => removeSkill(role.id, skillIndex)}
                            className="btn-remove"
                          >
                            X
                          </button>
                        )}
                      </div>
                    ))}
                  </div>
                  {(role.requiredSkills || []).length < 7 && (
                    <button
                      onClick={() => addSkill(role.id)}
                      className="btn-secondary mt-3 w-full"
                    >
                      + ADD SKILL
                    </button>
                  )}
                </div>
              </div>
            )}

        </div>
      );
    }

    // Step 3: Decision Matrix Component
    function Step3Page({ data, updateMatrixScore }) {
      return (
        <div>
            <div className="mb-8 animate-in">
              <div className="numbered-section mb-4">STEP 03</div>

              {/* Fast Track Insight */}

              {(data.decisionMatrix || []).some(entry => Object.values(entry.roleScores || {}).some(s => s > 0)) && (
                  <div className="ft-reveal">
                      <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                      <p className="ft-reveal-text">Decision matrix approaches reduce placement bias by 40-60% compared to unstructured "gut feel" decisions (Kahneman, "Thinking, Fast and Slow"). A meta-analysis by Schmidt &amp; Hunter (Psychological Bulletin, 1998) found that structured assessments predict job performance with 0.51 validity, versus 0.38 for unstructured interviews. Companies with highly engaged, well-placed teams are 59% more likely to exceed performance targets during organizational transitions (Gallup, 2023).</p>
                  </div>
              )}

              <h1 className="plaak text-6xl mb-4">DECISION MATRIX</h1>
              <p className="text-2xl text-gray-600 mb-4">
                For each person–role combination, enter a score from 1 to 5 to indicate how well that person fits that role.
              </p>
              <div style={{ background: '#F9F9F9', borderLeft: '4px solid #000', padding: '16px' }}>
                <p className="text-lg font-bold mb-2">SCORING SCALE:</p>
                <div className="grid grid-cols-5 gap-2 text-sm mt-2">
                  <div className="text-center p-2" style={{ border: '1px solid #E0E0E0' }}><strong>1 — Poor</strong><br/><span className="text-xs">Not recommended</span></div>
                  <div className="text-center p-2" style={{ border: '1px solid #E0E0E0' }}><strong>2 — Below Avg</strong><br/><span className="text-xs">High risk</span></div>
                  <div className="text-center p-2" style={{ border: '1px solid #E0E0E0' }}><strong>3 — Average</strong><br/><span className="text-xs">Needs development</span></div>
                  <div className="text-center p-2" style={{ border: '1px solid #E0E0E0' }}><strong>4 — Good</strong><br/><span className="text-xs">Solid fit</span></div>
                  <div className="text-center p-2" style={{ border: '1px solid #000', background: '#000', color: '#FFF469' }}><strong>5 — Excellent</strong><br/><span className="text-xs">Place immediately</span></div>
                </div>
              </div>
            </div>

            {/* Matrix Table */}
            <div className="overflow-x-auto mb-8 animate-in" style={{animationDelay: '0.1s'}}>
              <table className="w-full border-4 border-black">
                <thead>
                  <tr className="bg-black text-white">
                    <th className="p-4 text-left monument text-sm">PERSON</th>
                    {(data.newRoles || []).map((role) => (
                      <th key={role.id} className="p-4 text-center monument text-sm">
                        {(role.roleTitle || 'Role').substring(0, 20)}
                      </th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {(data.decisionMatrix || []).map((entry, index) => {
                    const person = (data.currentTeam || []).find(p => p.id === entry.personId);

                    return (
                      <tr key={entry.personId} className="border-b-2 border-black">
                        <td className="p-4 font-bold bg-gray-100">
                          {person?.name || 'Person'}
                        </td>
                        {(data.newRoles || []).map((role) => {
                          const score = entry.roleScores?.[role.id] || 0;
                          const cellClass = getMatrixCellClass(score);

                          return (
                            <td key={role.id} className={`matrix-cell ${cellClass}`}>
                              <input
                                type="number"
                                min="1"
                                max="5"
                                step="1"
                                value={score || ''}
                                placeholder="1-5"
                                onChange={(e) => updateMatrixScore(entry.personId, role.id, e.target.value)}
                                className="w-20 text-center p-2 border-2 border-black"
                              />
                            </td>
                          );
                        })}
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>

            {/* Legend */}
            <div className="grid grid-cols-4 gap-4 mb-8 animate-in" style={{animationDelay: '0.2s'}}>
              <div className="score-excellent p-4 text-center">
                <p className="font-bold mb-1">5 — EXCELLENT</p>
                <p className="text-xs">Immediate placement</p>
              </div>
              <div className="score-good p-4 text-center">
                <p className="font-bold mb-1">4 — GOOD</p>
                <p className="text-xs">Development needed</p>
              </div>
              <div className="score-moderate p-4 text-center">
                <p className="font-bold mb-1">3 — AVERAGE</p>
                <p className="text-xs">High risk</p>
              </div>
              <div className="score-poor p-4 text-center">
                <p className="font-bold mb-1">1–2 — POOR</p>
                <p className="text-xs">Not recommended</p>
              </div>
            </div>

        </div>
      );
    }

    // Step 4: Action Plan Component
    function Step4Page({ data, updateActionPlanItem }) {
      return (
        <div>
            <div className="mb-8 animate-in">
              <div className="numbered-section mb-4">STEP 04</div>

              {/* Fast Track Insight */}

              {((data.actionPlan?.immediate || []).length > 0 || (data.actionPlan?.development || []).length > 0 || (data.actionPlan?.transition || []).length > 0) && (
                  <div className="ft-reveal">
                      <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                      <p className="ft-reveal-text">Chip Heath and Dan Heath's "Switch" framework shows that successful change requires directing the rational mind (clear categories and timelines), motivating emotions (honest communication about why), and shaping the path (removing obstacles). Research from Kotter's 8-step change model confirms that organizations communicating changes within 2 weeks of decision see 73% higher adoption rates than those that delay (Harvard Business Review). The three-tier categorization approach reduces decision fatigue by 60% compared to case-by-case evaluation.</p>
                  </div>
              )}

              <h1 className="plaak text-6xl mb-4">ACTION PLAN</h1>
              <p className="text-2xl text-gray-600 mb-4">
                Auto-categorized based on Decision Matrix scores. Add timelines and details for each category.
              </p>
              <div style={{ background: '#F9F9F9', borderLeft: '4px solid #000', padding: '16px' }}>
                <p className="text-lg"><strong>Categories:</strong> Immediate (score 5), Development (score 4), Transition (score 1–3)</p>
              </div>
            </div>

            {/* Immediate Placement */}
            <div className="mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              <div className="flex items-center gap-4 mb-4">
                <span className="category-badge category-immediate">IMMEDIATE PLACEMENT</span>
                <span className="text-xl">Score 5 (Excellent) — Ready for immediate placement</span>
              </div>

              {(data.actionPlan?.immediate || []).length === 0 ? (
                <div className="border-2 border-dashed border-gray-300 p-8 text-center text-gray-500">
                  No team members scored 0.8+ in any role. Consider external hiring for critical positions.
                </div>
              ) : (
                <div className="space-y-4">
                  {(data.actionPlan?.immediate || []).map((item, index) => (
                    <div key={item.personId} className="border-2 border-black p-6 bg-gray-50">
                      <h3 className="text-2xl font-bold mb-4">{item.name} → {item.assignedRole}</h3>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="monument text-sm block mb-2">START DATE</label>
                          <input
                            type="date"
                            value={item.startDate || ''}
                            onChange={(e) => updateActionPlanItem('immediate', item.personId, 'startDate', e.target.value)}
                            className="w-full"
                          />
                        </div>
                        <div>
                          <label className="monument text-sm block mb-2">FIT SCORE</label>
                          <div className="text-3xl font-bold pt-2">{item.fitScore.toFixed(2)}</div>
                        </div>
                      </div>
                      <div className="mt-4">
                        <label className="monument text-sm block mb-2">SUCCESS METRICS (FIRST 90 DAYS)</label>
                        <textarea
                          value={item.successMetrics || ''}
                          onChange={(e) => updateActionPlanItem('immediate', item.personId, 'successMetrics', e.target.value)}
                          placeholder="Define measurable outcomes for first 90 days in role..."
                          className="w-full"
                        />
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Development Required */}
            <div className="mb-8 animate-in" style={{animationDelay: '0.1s'}}>
              <div className="flex items-center gap-4 mb-4">
                <span className="category-badge category-development">DEVELOPMENT REQUIRED</span>
                <span className="text-xl">Score 4 (Good) — Needs development plan (Step 5)</span>
              </div>

              {(data.actionPlan?.development || []).length === 0 ? (
                <div className="border-2 border-dashed border-gray-300 p-8 text-center text-gray-500">
                  No team members in development category.
                </div>
              ) : (
                <div className="space-y-4">
                  {(data.actionPlan?.development || []).map((item, index) => (
                    <div key={item.personId} style={{ border: '1px solid #E0E0E0', padding: '24px' }}>
                      <h3 className="text-2xl font-bold mb-4">{item.name} → {item.targetRole}</h3>
                      <div className="grid grid-cols-3 gap-4">
                        <div>
                          <label className="monument text-sm block mb-2">FIT SCORE</label>
                          <div className="text-3xl font-bold pt-2">{item.fitScore.toFixed(2)}</div>
                        </div>
                        <div>
                          <label className="monument text-sm block mb-2">DEVELOPMENT TIMELINE</label>
                          <select
                            value={item.developmentTimeline || ''}
                            onChange={(e) => updateActionPlanItem('development', item.personId, 'developmentTimeline', e.target.value)}
                            className="w-full"
                          >
                            <option value="">Select...</option>
                            <option value="1-3 months">1-3 months</option>
                            <option value="3-6 months">3-6 months</option>
                            <option value="6-12 months">6-12 months</option>
                          </select>
                        </div>
                        <div>
                          <label className="monument text-sm block mb-2">ASSIGNED MENTOR</label>
                          <input
                            type="text"
                            value={item.mentor || ''}
                            onChange={(e) => updateActionPlanItem('development', item.personId, 'mentor', e.target.value)}
                            placeholder="Mentor name"
                            className="w-full"
                          />
                        </div>
                      </div>
                      <div className="mt-4 bg-white p-4" style={{ borderLeft: '4px solid #000' }}>
                        <p className="text-sm font-bold">Note: Personal Development Plan will be created in Step 5</p>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Transition Out */}
            <div className="mb-8 animate-in" style={{animationDelay: '0.15s'}}>
              <div className="flex items-center gap-4 mb-4">
                <span className="category-badge category-transition">TRANSITION</span>
                <span className="text-xl">Score 1–3 for all roles — Needs transition plan</span>
              </div>

              {(data.actionPlan?.transition || []).length === 0 ? (
                <div className="border-2 border-dashed border-gray-300 p-8 text-center text-gray-500">
                  No team members in transition category.
                </div>
              ) : (
                <div className="space-y-4">
                  {(data.actionPlan?.transition || []).map((item, index) => (
                    <div key={item.personId} style={{ background: '#FEF2F2', borderLeft: '4px solid #DC2626', padding: '24px' }}>
                      <h3 className="text-2xl font-bold mb-4">{item.name} - Current: {item.currentRole}</h3>
                      <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                          <label className="monument text-sm block mb-2">TRANSITION TYPE</label>
                          <select
                            value={item.transitionType || ''}
                            onChange={(e) => updateActionPlanItem('transition', item.personId, 'transitionType', e.target.value)}
                            className="w-full"
                          >
                            <option value="">Select...</option>
                            <option value="reassign">Reassignment to different role</option>
                            <option value="exit">Exit with dignity</option>
                            <option value="eliminate">Role elimination</option>
                          </select>
                        </div>
                        <div>
                          <label className="monument text-sm block mb-2">TIMELINE</label>
                          <select
                            value={item.timeline || ''}
                            onChange={(e) => updateActionPlanItem('transition', item.personId, 'timeline', e.target.value)}
                            className="w-full"
                          >
                            <option value="">Select...</option>
                            <option value="30 days">30 days</option>
                            <option value="60 days">60 days</option>
                            <option value="90 days">90 days</option>
                          </select>
                        </div>
                      </div>
                      <div>
                        <label className="monument text-sm block mb-2">NOTES / TRANSITION PLAN</label>
                        <textarea
                          value={item.notes || ''}
                          onChange={(e) => updateActionPlanItem('transition', item.personId, 'notes', e.target.value)}
                          placeholder="Communication plan, severance details, transition support..."
                          className="w-full"
                        />
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

        </div>
      );
    }

    // Step 5: Personal Development Plans Component
    function Step5Page({ data, updatePDP, addCapability, removeCapability, updateCapability }) {
      const [currentPdpIndex, setCurrentPdpIndex] = useState(0);

      return (
        <div>
            <div className="mb-8 animate-in">
              <div className="numbered-section mb-4">STEP 05</div>

              {/* Fast Track Insight */}

              {(data.pdps || []).length > 0 && (
                  <div className="ft-reveal">
                      <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                      <p className="ft-reveal-text">Research on deliberate practice (Ericsson, "Peak") shows that targeted capability development with clear feedback loops accelerates skill acquisition by 3-5x compared to generic training. Lombardo and Eichinger's 70-20-10 model demonstrates that 70% of development comes from on-the-job challenges, 20% from mentoring and coaching, and only 10% from formal training. Organizations with structured PDPs and regular checkpoint reviews show 45% faster time-to-competence and 38% higher retention of high-potential employees (Corporate Leadership Council).</p>
                  </div>
              )}

              <h1 className="plaak text-6xl mb-4">PERSONAL DEVELOPMENT PLANS</h1>
              <p className="text-2xl text-gray-600 mb-4">
                Create development roadmaps for everyone in the "Development Required" category.
              </p>
              <div style={{ background: '#F9F9F9', borderLeft: '4px solid #000', padding: '16px' }}>
                <p className="text-lg"><strong>Structure:</strong> Core activity → Capabilities → Gap analysis → What/When/ByWhom → 30-60-90 checkpoints</p>
              </div>
            </div>

            {/* PDPs */}
            {(data.pdps || []).length === 0 ? (
              <div className="border-4 border-dashed border-gray-300 p-12 text-center text-gray-500 mb-8">
                <p className="text-2xl mb-4">No PDPs needed - no team members in Development Required category.</p>
                <p className="text-xl">You can proceed to the final canvas.</p>
              </div>
            ) : (
              <div className="mb-8">
                {/* PDP Navigation Header */}
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 20, padding: '12px 16px', background: '#f9f9f9', border: '1px solid #e0e0e0' }}>
                    <button
                        onClick={() => setCurrentPdpIndex(Math.max(0, currentPdpIndex - 1))}
                        disabled={currentPdpIndex === 0}
                        style={{ fontFamily: "'Monument', monospace", fontSize: 11, background: 'none', border: '1px solid #000', padding: '8px 16px', cursor: currentPdpIndex === 0 ? 'not-allowed' : 'pointer', opacity: currentPdpIndex === 0 ? 0.3 : 1 }}
                    >
                        ← PREV
                    </button>
                    <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.06em' }}>
                        TEAM MEMBER {currentPdpIndex + 1} OF {(data.pdps || []).length}
                    </span>
                    <button
                        onClick={() => setCurrentPdpIndex(Math.min((data.pdps || []).length - 1, currentPdpIndex + 1))}
                        disabled={currentPdpIndex === (data.pdps || []).length - 1}
                        style={{ fontFamily: "'Monument', monospace", fontSize: 11, background: 'none', border: '1px solid #000', padding: '8px 16px', cursor: currentPdpIndex === (data.pdps || []).length - 1 ? 'not-allowed' : 'pointer', opacity: currentPdpIndex === (data.pdps || []).length - 1 ? 0.3 : 1 }}
                    >
                        NEXT →
                    </button>
                </div>

                {/* Current PDP */}
                {(data.pdps || []).length > 0 && (data.pdps || [])[currentPdpIndex] && (() => {
                  const pdp = (data.pdps || [])[currentPdpIndex];
                  return (
                  <div key={pdp.personId} className="border-4 border-black p-8 animate-in">
                    <h2 className="plaak text-4xl mb-6">{pdp.name} - PDP</h2>

                    <div className="grid grid-cols-2 gap-6 mb-6">
                      <div>
                        <label className="monument text-sm block mb-2">TARGET ROLE</label>
                        <input
                          type="text"
                          value={pdp.targetRole || ''}
                          disabled
                          className="w-full bg-gray-100"
                        />
                      </div>
                      <div>
                        <label className="monument text-sm block mb-2">CORE ACTIVITY (FROM SPRINT 22)</label>
                        <input
                          type="text"
                          value={pdp.coreActivity || ''}
                          onChange={(e) => updatePDP(pdp.personId, 'coreActivity', e.target.value)}
                          placeholder="E.g., Customer Acquisition"
                          className="w-full"
                        />
                      </div>
                    </div>

                    {/* Capabilities */}
                    <div className="mb-6">
                      <h3 className="plaak text-2xl mb-4">CAPABILITY GAPS</h3>
                      <div className="space-y-6">
                        {(pdp.capabilities || []).map((cap, capIndex) => (
                          <div key={cap.id} className="border-2 border-gray-300 p-6 bg-gray-50">
                            <div className="flex justify-between items-start mb-4">
                              <h4 className="font-bold text-xl">Capability {capIndex + 1}</h4>
                              {(pdp.capabilities || []).length > 1 && (
                                <button
                                  onClick={() => removeCapability(pdp.personId, cap.id)}
                                  className="btn-remove"
                                >
                                  REMOVE
                                </button>
                              )}
                            </div>

                            <div className="grid grid-cols-3 gap-4 mb-4">
                              <div className="col-span-2">
                                <label className="monument text-sm block mb-2">CAPABILITY NAME</label>
                                <input
                                  type="text"
                                  value={cap.capability || ''}
                                  onChange={(e) => updateCapability(pdp.personId, cap.id, 'capability', e.target.value)}
                                  placeholder="E.g., Data analysis & forecasting"
                                  className="w-full"
                                />
                              </div>
                              <div>
                                <label className="monument text-sm block mb-2">CURRENT FULFILLMENT (%)</label>
                                <input
                                  type="number"
                                  min="0"
                                  max="100"
                                  value={cap.currentFulfillment || 0}
                                  onChange={(e) => updateCapability(pdp.personId, cap.id, 'currentFulfillment', parseInt(e.target.value) || 0)}
                                  className="w-full"
                                />
                              </div>
                            </div>

                            <div className="mb-4 p-4 bg-white border-l-4 border-black">
                              <p className="monument text-sm mb-1">GAP TO CLOSE</p>
                              <p className="text-3xl font-bold">{cap.gap || 100}%</p>
                            </div>

                            <div className="grid grid-cols-3 gap-4">
                              <div>
                                <label className="monument text-sm block mb-2">WHAT (ACTION)</label>
                                <textarea
                                  value={cap.what || ''}
                                  onChange={(e) => updateCapability(pdp.personId, cap.id, 'what', e.target.value)}
                                  placeholder="Specific training, course, mentorship..."
                                  className="w-full"
                                />
                              </div>
                              <div>
                                <label className="monument text-sm block mb-2">WHEN (DEADLINE)</label>
                                <input
                                  type="date"
                                  value={cap.when || ''}
                                  onChange={(e) => updateCapability(pdp.personId, cap.id, 'when', e.target.value)}
                                  className="w-full"
                                />
                              </div>
                              <div>
                                <label className="monument text-sm block mb-2">BY WHOM (OWNER)</label>
                                <input
                                  type="text"
                                  value={cap.byWhom || ''}
                                  onChange={(e) => updateCapability(pdp.personId, cap.id, 'byWhom', e.target.value)}
                                  placeholder="Manager, HR, Trainer..."
                                  className="w-full"
                                />
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>

                      <button
                        onClick={() => addCapability(pdp.personId)}
                        className="btn-secondary w-full mt-4"
                      >
                        + ADD CAPABILITY
                      </button>
                    </div>

                    {/* Checkpoints */}
                    <div className="space-y-4">
                      <h3 className="plaak text-2xl mb-4">30-60-90 DAY CHECKPOINTS</h3>

                      <div className="checkpoint-box">
                        <label className="monument text-sm block mb-2">30-DAY CHECKPOINT</label>
                        <textarea
                          value={pdp.checkpoint30Days || ''}
                          onChange={(e) => updatePDP(pdp.personId, 'checkpoint30Days', e.target.value)}
                          placeholder="What should be achieved after 30 days? Initial training started, mentor assigned..."
                          className="w-full"
                        />
                      </div>

                      <div className="checkpoint-box">
                        <label className="monument text-sm block mb-2">60-DAY CHECKPOINT</label>
                        <textarea
                          value={pdp.checkpoint60Days || ''}
                          onChange={(e) => updatePDP(pdp.personId, 'checkpoint60Days', e.target.value)}
                          placeholder="What should be achieved after 60 days? 50% of development activities completed..."
                          className="w-full"
                        />
                      </div>

                      <div className="checkpoint-box">
                        <label className="monument text-sm block mb-2">90-DAY CHECKPOINT</label>
                        <textarea
                          value={pdp.checkpoint90Days || ''}
                          onChange={(e) => updatePDP(pdp.personId, 'checkpoint90Days', e.target.value)}
                          placeholder="What should be achieved after 90 days? Ready for role transition or decision made..."
                          className="w-full"
                        />
                      </div>
                    </div>
                  </div>
                  );
                })()}
              </div>
            )}

        </div>
      );
    }

    // Canvas Page Component
    function CanvasPage({ data, onExport, onSubmit }) {
      const totalTeam = (data.currentTeam || []).length;
      const immediatePlacements = (data.actionPlan?.immediate || []).length;
      const developmentNeeded = (data.actionPlan?.development || []).length;
      const transitions = (data.actionPlan?.transition || []).length;
      const externalHires = (data.newRoles || []).length - immediatePlacements - developmentNeeded;

      return (
        <div className="step-content animate-in">
          <div id="canvas-content">
            {/* Header */}
            <div className="opening-box" style={{ marginBottom: 40 }}>
              <div className="step-indicator">SPRINT 25 · CANVAS</div>
              <div className="step-heading">ORGANIZATIONAL REDESIGN</div>
              <div className="step-hint">90-Day Implementation Canvas — your complete roadmap from current structure to optimized organization</div>
            </div>

            {/* Summary Stats */}
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 16, marginBottom: 48 }} className="animate-in">
              <div style={{ border: '4px solid #000', padding: 24, textAlign: 'center' }}>
                <div style={{ fontSize: 56, fontFamily: "'Plaak', sans-serif", lineHeight: 1 }}>{totalTeam}</div>
                <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, marginTop: 8, textTransform: 'uppercase', letterSpacing: '0.1em' }}>CURRENT TEAM</p>
              </div>
              <div style={{ border: '4px solid #000', padding: 24, textAlign: 'center', background: '#f9fafb' }}>
                <div style={{ fontSize: 56, fontFamily: "'Plaak', sans-serif", lineHeight: 1 }}>{immediatePlacements}</div>
                <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, marginTop: 8, textTransform: 'uppercase', letterSpacing: '0.1em' }}>IMMEDIATE</p>
              </div>
              <div style={{ border: '4px solid #000', padding: 24, textAlign: 'center', background: '#f9fafb' }}>
                <div style={{ fontSize: 56, fontFamily: "'Plaak', sans-serif", lineHeight: 1 }}>{developmentNeeded}</div>
                <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, marginTop: 8, textTransform: 'uppercase', letterSpacing: '0.1em' }}>DEVELOPMENT</p>
              </div>
              <div style={{ border: '4px solid #DC2626', padding: 24, textAlign: 'center', background: '#FEF2F2' }}>
                <div style={{ fontSize: 56, fontFamily: "'Plaak', sans-serif", lineHeight: 1 }}>{transitions}</div>
                <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, marginTop: 8, textTransform: 'uppercase', letterSpacing: '0.1em', color: '#DC2626' }}>TRANSITIONS</p>
              </div>
              <div style={{ border: '4px solid #000', padding: 24, textAlign: 'center', background: '#f9fafb' }}>
                <div style={{ fontSize: 56, fontFamily: "'Plaak', sans-serif", lineHeight: 1 }}>{Math.max(0, externalHires)}</div>
                <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, marginTop: 8, textTransform: 'uppercase', letterSpacing: '0.1em' }}>EXTERNAL HIRES</p>
              </div>
            </div>

            {/* FIT Score Distribution */}
            <div style={{ marginBottom: 48 }} className="animate-in">
              <h2 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 28, marginBottom: 20 }}>CURRENT TEAM FIT DISTRIBUTION</h2>
              <div style={{ border: '4px solid #000', padding: 24 }}>
                {(data.currentTeam || []).map((member) => {
                  const fitInterpretation = getFitInterpretation(member.totalFit || 0);
                  return (
                    <div key={member.id} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '12px 0', borderBottom: '2px solid #e5e7eb' }}>
                      <div style={{ flex: 1 }}>
                        <p style={{ fontWeight: 700, fontSize: 18, margin: 0 }}>{member.name || 'Team Member'}</p>
                        <p style={{ color: '#666', margin: '4px 0 0' }}>{member.currentPosition || 'Position'}</p>
                      </div>
                      <div style={{ textAlign: 'center', padding: '0 24px' }}>
                        <p style={{ fontSize: 28, fontWeight: 700, margin: 0 }}>{(member.totalFit || 0).toFixed(2)}</p>
                        <span className={`fit-indicator ${fitInterpretation.class}`} style={{ marginTop: 8, display: 'inline-block' }}>
                          {fitInterpretation.label}
                        </span>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Role Criticality */}
            <div style={{ marginBottom: 48 }} className="animate-in">
              <h2 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 28, marginBottom: 20 }}>NEW ROLES BY CRITICALITY</h2>
              <div style={{ border: '4px solid #000', padding: 24 }}>
                {(data.newRoles || [])
                  .sort((a, b) => (b.criticality || 0) - (a.criticality || 0))
                  .map((role) => (
                    <div key={role.id} style={{ padding: '16px 0', borderBottom: '2px solid #e5e7eb' }}>
                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 8 }}>
                        <p style={{ fontWeight: 700, fontSize: 22, margin: 0 }}>{role.roleTitle || 'Role'}</p>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                          <span style={{ fontSize: 28, fontWeight: 700 }}>{role.criticality || 5}</span>
                          <span style={{ padding: '6px 16px', background: '#000', color: '#fff', fontFamily: "'Monument', monospace", fontSize: 11, textTransform: 'uppercase', letterSpacing: '0.08em' }}>
                            {getCriticalityLabel(role.criticality || 5)}
                          </span>
                        </div>
                      </div>
                      <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, marginTop: 12 }}>
                        {(role.requiredSkills || []).filter(s => (s || '').trim().length > 0).map((skill, index) => (
                          <span key={index} className="skill-chip">{skill}</span>
                        ))}
                      </div>
                    </div>
                  ))}
              </div>
            </div>

            {/* Action Plan Breakdown */}
            <div style={{ marginBottom: 48 }} className="animate-in">
              <h2 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 28, marginBottom: 20 }}>ACTION PLAN BREAKDOWN</h2>

              {/* Immediate */}
              <div style={{ marginBottom: 24 }}>
                <div style={{ background: '#000', color: '#FFF469', padding: '16px 24px', fontFamily: "'Plaak', sans-serif", fontSize: 22 }}>
                  IMMEDIATE PLACEMENT ({immediatePlacements})
                </div>
                <div style={{ border: '4px solid #000', borderTop: 'none', padding: 24, background: '#f9fafb' }}>
                  {(data.actionPlan?.immediate || []).map((item) => (
                    <div key={item.personId} style={{ marginBottom: 16, paddingBottom: 16, borderBottom: '2px solid #e5e7eb' }}>
                      <p style={{ fontSize: 18, fontWeight: 700, margin: '0 0 4px' }}>{item.name} → {item.assignedRole}</p>
                      <p style={{ fontSize: 15, margin: '0 0 4px', color: '#444' }}>FIT Score: {item.fitScore.toFixed(2)} | Start: {item.startDate || 'TBD'}</p>
                      {item.successMetrics && (
                        <p style={{ fontSize: 14, color: '#666', margin: 0 }}>Success: {item.successMetrics}</p>
                      )}
                    </div>
                  ))}
                  {immediatePlacements === 0 && (
                    <p style={{ color: '#888', margin: 0 }}>No immediate placements. Consider external hiring.</p>
                  )}
                </div>
              </div>

              {/* Development */}
              <div style={{ marginBottom: 24 }}>
                <div style={{ background: '#555', color: '#fff', padding: '16px 24px', fontFamily: "'Plaak', sans-serif", fontSize: 22 }}>
                  DEVELOPMENT REQUIRED ({developmentNeeded})
                </div>
                <div style={{ border: '4px solid #555', borderTop: 'none', padding: 24, background: '#f9fafb' }}>
                  {(data.actionPlan?.development || []).map((item) => (
                    <div key={item.personId} style={{ marginBottom: 16, paddingBottom: 16, borderBottom: '2px solid #e5e7eb' }}>
                      <p style={{ fontSize: 18, fontWeight: 700, margin: '0 0 4px' }}>{item.name} → {item.targetRole}</p>
                      <p style={{ fontSize: 15, margin: '0 0 4px', color: '#444' }}>FIT Score: {item.fitScore.toFixed(2)} | Timeline: {item.developmentTimeline || 'TBD'}</p>
                      {item.mentor && (
                        <p style={{ fontSize: 14, color: '#666', margin: 0 }}>Mentor: {item.mentor}</p>
                      )}
                    </div>
                  ))}
                  {developmentNeeded === 0 && (
                    <p style={{ color: '#888', margin: 0 }}>No development candidates.</p>
                  )}
                </div>
              </div>

              {/* Transitions */}
              <div style={{ marginBottom: 24 }}>
                <div style={{ background: '#DC2626', color: '#fff', padding: '16px 24px', fontFamily: "'Plaak', sans-serif", fontSize: 22 }}>
                  TRANSITIONS ({transitions})
                </div>
                <div style={{ border: '4px solid #DC2626', borderTop: 'none', padding: 24, background: '#FEF2F2' }}>
                  {(data.actionPlan?.transition || []).map((item) => (
                    <div key={item.personId} style={{ marginBottom: 16, paddingBottom: 16, borderBottom: '2px solid #fecaca' }}>
                      <p style={{ fontSize: 18, fontWeight: 700, margin: '0 0 4px' }}>{item.name} - {item.currentRole}</p>
                      <p style={{ fontSize: 15, margin: '0 0 4px', color: '#7f1d1d' }}>Type: {item.transitionType || 'TBD'} | Timeline: {item.timeline || 'TBD'}</p>
                      {item.notes && (
                        <p style={{ fontSize: 14, color: '#991b1b', margin: 0 }}>{item.notes}</p>
                      )}
                    </div>
                  ))}
                  {transitions === 0 && (
                    <p style={{ color: '#991b1b', margin: 0 }}>No transitions needed.</p>
                  )}
                </div>
              </div>
            </div>

            {/* PDP Summary */}
            {(data.pdps || []).length > 0 && (
              <div style={{ marginBottom: 48 }} className="animate-in">
                <h2 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 28, marginBottom: 20 }}>PERSONAL DEVELOPMENT PLANS</h2>
                {(data.pdps || []).map((pdp) => (
                  <div key={pdp.personId} style={{ border: '4px solid #000', padding: 24, marginBottom: 24 }}>
                    <h3 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 24, margin: '0 0 12px' }}>{pdp.name} — {pdp.targetRole}</h3>
                    <p style={{ fontSize: 16, marginBottom: 16 }}><strong>Core Activity:</strong> {pdp.coreActivity || 'TBD'}</p>

                    <div style={{ marginBottom: 16 }}>
                      <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 8 }}>CAPABILITY GAPS ({(pdp.capabilities || []).length})</p>
                      {(pdp.capabilities || []).map((cap, index) => (
                        <div key={cap.id} style={{ background: '#f3f4f6', padding: 16, marginBottom: 8 }}>
                          <p style={{ fontWeight: 700, fontSize: 16, margin: '0 0 8px' }}>{cap.capability || `Capability ${index + 1}`}</p>
                          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 12, fontSize: 14 }}>
                            <div>
                              <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', display: 'block', color: '#666' }}>CURRENT</span>
                              <p style={{ fontWeight: 700, margin: '4px 0 0' }}>{cap.currentFulfillment || 0}%</p>
                            </div>
                            <div>
                              <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', display: 'block', color: '#666' }}>GAP</span>
                              <p style={{ fontWeight: 700, margin: '4px 0 0' }}>{cap.gap || 100}%</p>
                            </div>
                            <div>
                              <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', display: 'block', color: '#666' }}>WHAT</span>
                              <p style={{ margin: '4px 0 0' }}>{cap.what || 'TBD'}</p>
                            </div>
                            <div>
                              <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', display: 'block', color: '#666' }}>WHEN</span>
                              <p style={{ margin: '4px 0 0' }}>{cap.when || 'TBD'}</p>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 16 }}>
                      <div className="checkpoint-box">
                        <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 6 }}>30 DAYS</p>
                        <p style={{ fontSize: 14, margin: 0 }}>{pdp.checkpoint30Days || 'TBD'}</p>
                      </div>
                      <div className="checkpoint-box">
                        <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 6 }}>60 DAYS</p>
                        <p style={{ fontSize: 14, margin: 0 }}>{pdp.checkpoint60Days || 'TBD'}</p>
                      </div>
                      <div className="checkpoint-box">
                        <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 6 }}>90 DAYS</p>
                        <p style={{ fontSize: 14, margin: 0 }}>{pdp.checkpoint90Days || 'TBD'}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* 90-Day Timeline */}
            <div style={{ marginBottom: 48 }} className="animate-in">
              <h2 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 28, marginBottom: 20 }}>90-DAY IMPLEMENTATION TIMELINE</h2>
              <div style={{ border: '4px solid #000', padding: 32 }}>
                {[
                  { label: 'WEEK 1–2', items: [
                    'Announce organizational changes to full company',
                    `Confirm immediate placements (${immediatePlacements} people)`,
                    `Start exit conversations for transitions (${transitions} people)`,
                    `Launch PDPs for development candidates (${developmentNeeded} people)`,
                  ]},
                  { label: 'WEEK 3–4', items: [
                    `Begin recruitment for external hire roles (${Math.max(0, externalHires)} positions)`,
                    'Execute first wave of transitions',
                    '30-day PDP checkpoints completed',
                  ]},
                  { label: 'MONTH 2', items: [
                    'Continue development programs',
                    'Interview external candidates',
                    'Second wave of internal transitions',
                    '60-day PDP checkpoints completed',
                  ]},
                  { label: 'MONTH 3', items: [
                    'Complete development assessments (90-day checkpoints)',
                    'Make final promote/exit decisions',
                    'External hires start onboarding',
                    'New structure fully operational',
                  ]},
                ].map((phase) => (
                  <div key={phase.label} style={{ marginBottom: 32 }}>
                    <div style={{ background: '#000', color: '#fff', padding: '12px 20px', fontFamily: "'Plaak', sans-serif", fontSize: 20, marginBottom: 16 }}>{phase.label}</div>
                    <ul style={{ margin: 0, paddingLeft: 24, fontSize: 16, lineHeight: 2 }}>
                      {phase.items.map((item, i) => <li key={i}>{item}</li>)}
                    </ul>
                  </div>
                ))}
              </div>
            </div>

            {/* Critical Success Factors */}
            <div style={{ marginBottom: 48 }} className="animate-in">
              <h2 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 28, marginBottom: 20 }}>CRITICAL SUCCESS FACTORS</h2>
              <div style={{ border: '4px solid #000', padding: 32 }}>
                {[
                  { title: 'Brutal Honesty in Assessment', body: 'Sugar-coating FIT scores leads to wrong placements. Model honest self-assessment from CEO down.' },
                  { title: 'Speed Over Perfection', body: "Better to make good decision in 4 hours than perfect decision in 4 weeks. Market won't wait." },
                  { title: 'Clear Communication', body: 'People can handle hard truths if delivered with respect and clarity. Ambiguity creates fear.' },
                  { title: 'Follow-Through on PDPs', body: '60% of development plans fail due to lack of accountability. Weekly check-ins are essential.' },
                  { title: 'Compassionate Exits', body: 'How you treat people on the way out determines whether A-players trust you going forward.' },
                ].map((item, i) => (
                  <div key={i} style={{ display: 'flex', alignItems: 'flex-start', gap: 20, marginBottom: 24 }}>
                    <span style={{ fontSize: 28, fontWeight: 700, minWidth: 32 }}>{i + 1}.</span>
                    <div>
                      <p style={{ fontWeight: 700, fontSize: 18, margin: '0 0 4px' }}>{item.title}</p>
                      <p style={{ fontSize: 15, color: '#555', margin: 0, lineHeight: 1.7 }}>{item.body}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Next Steps */}
            <div style={{ marginBottom: 48 }} className="animate-in">
              <h2 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 28, marginBottom: 20 }}>IMMEDIATE NEXT STEPS</h2>
              <div style={{ border: '4px solid #000', padding: 32, display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 24 }}>
                {[
                  { label: 'THIS WEEK', items: ['Schedule all-hands meeting to announce organizational changes', 'Prepare individual conversation scripts for all affected team members', 'Confirm start dates for immediate placements'] },
                  { label: 'NEXT 2 WEEKS', items: ['Complete all one-on-one placement conversations', 'Launch job postings for external hire positions', 'Assign mentors and initiate PDP kick-off meetings'] },
                  { label: 'MONTH 1', items: ['Track immediate placement performance against 90-day metrics', 'Conduct 30-day PDP checkpoint reviews', 'Begin candidate interviews for external hires'] },
                ].map((col) => (
                  <div key={col.label} className="checkpoint-box">
                    <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 12 }}>{col.label}</p>
                    <ul style={{ margin: 0, paddingLeft: 20, fontSize: 14, lineHeight: 1.8 }}>
                      {col.items.map((item, i) => <li key={i}>{item}</li>)}
                    </ul>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Action Buttons */}
          <div style={{ display: 'flex', gap: 16, justifyContent: 'center', marginTop: 48 }}>
            <button onClick={onExport} className="btn-wiz-next" style={{ background: '#fff', color: '#000', border: '2px solid #000' }}>
              EXPORT PDF
            </button>
            <button onClick={onSubmit} className="btn-wiz-next">
              SUBMIT ANSWERS
            </button>
          </div>

          {/* Case Study */}
          <CaseStudy
              before={"A 200-person B2B services firm kept the same org chart for 5 years while tripling in size. Roles were designed around personalities, not functions. The CEO had 14 direct reports. Decision bottlenecks delayed client delivery by weeks, and B-players occupied mission-critical positions because nobody had the courage to make changes."}
              after={"Redesigned around 5 core value streams with clear process owners and optimal 5-7 span of control. Used four-dimensional FIT analysis to place A-players in critical roles, built 90-day PDPs for B+ players, and compassionately transitioned 3 poor-fit team members. Decision speed doubled. Client satisfaction rose 34%. Revenue per employee increased 28% within 6 months."}
              quote={"We finally stopped designing the org around who we had and started designing it around what the business needed. The hardest part was admitting our current structure was built for comfort, not performance. - CEO, B2B Services Company"}
          />
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<OrganizationalRedesignApp />);
  </script>
</body>
</html>
