<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Activities & Processes | Fast Track Program</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

    <style>
        @font-face { font-family: 'Plaak';    src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; }
        @font-face { font-family: 'Riforma';  src: url('RiformaLL-Regular.woff2')   format('woff2'); font-weight: normal; }
        @font-face { font-family: 'Riforma';  src: url('RiformaLL-Regular.woff2')   format('woff2'); font-weight: 600; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Riforma', -apple-system, sans-serif; font-size: 16px; color: #000; background: #000; -webkit-font-smoothing: antialiased; }

        .plaak   { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }

        .tool-frame { background: #fff; min-height: 100vh; }
        .tool-inner { background: #fff; min-height: 100vh; }

        /* â”€â”€ Wizard layout â”€â”€ */
        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; padding: 0 48px; }
        .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }

        /* â”€â”€ Step content â”€â”€ */
        .step-content { max-width: 100%; padding: 40px 0; flex: 1; }
        .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #666; margin-bottom: 8px; }
        .opening-box { margin-bottom: 32px; }
        .opening-box .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
        .opening-box .step-hint { font-size: 14px; color: #666; line-height: 1.5; margin: 0; }

        /* â”€â”€ Fields â”€â”€ */
        .field-group { margin-bottom: 40px; }
        .field-group:last-child { margin-bottom: 0; }
        .field-label { font-weight: 600; font-size: 16px; color: #000; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .field-input { border: 1px solid #E0E0E0; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; width: 100%; color: #000; background: #fff; transition: border-color 0.2s; }
        .field-input:focus { outline: none; border-color: #000; }
        .field-textarea { border: 1px solid #E0E0E0; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; width: 100%; min-height: 100px; resize: none !important; color: #000; background: #fff; transition: border-color 0.2s; }
        .field-textarea:focus { outline: none; border-color: #000; }
        .field-help  { font-size: 13px; color: #666; margin-top: 4px; }
        .field-error { font-size: 13px; color: #DC2626; margin-top: 4px; }

        /* â”€â”€ Closing box â”€â”€ */
        .closing-box { border-top: 1px solid #E0E0E0; padding: 20px 0 0 0; margin-top: 8px; text-align: center; }
        .closing-box p { font-size: 14px; color: #666; }
        .closing-box .closing-title { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #000; margin-bottom: 6px; }

        /* â”€â”€ Wizard footer / buttons â”€â”€ */
        .wizard-footer { display: flex; justify-content: space-between; align-items: center; padding: 24px 48px; border-top: 1px solid #e5e7eb; background: #fff; }
        .btn-wiz-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 12px 28px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-back:hover { border-color: #000; color: #000; }
        .btn-wiz-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 36px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-next:hover:not(:disabled) { background: #FFF469; color: #000; border-color: #FFF469; }
        .btn-wiz-next:disabled { background: #E0E0E0; color: #9CA3AF; border-color: #E0E0E0; cursor: not-allowed; }

        /* â”€â”€ Learn more â”€â”€ */
        .learn-more-toggle { font-family: 'Monument', monospace; font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; color: #000; background: #F5F5F5; border: 1px solid #E0E0E0; cursor: pointer; padding: 10px 14px; display: flex; align-items: center; gap: 8px; margin-bottom: 24px; width: 100%; }
        .learn-more-content { background: #F5F5F5; border: 1px solid #E0E0E0; border-top: none; padding: 16px; font-size: 14px; color: #333; line-height: 1.7; margin-bottom: 24px; }

        /* â”€â”€ Activity card â”€â”€ */
        .activity-card { border: 1px solid #E0E0E0; margin-bottom: 16px; }
        .activity-card-header { background: #000; color: #fff; padding: 14px 20px; display: flex; align-items: center; gap: 12px; }
        .activity-card-number { font-family: 'Plaak', sans-serif; font-size: 24px; color: #FFF469; min-width: 32px; }
        .activity-card-body { padding: 20px; }

        /* â”€â”€ Process row â”€â”€ */
        .process-row { background: #F9F9F9; border: 1px solid #E0E0E0; padding: 16px; margin-bottom: 12px; }
        .process-row-header { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.1em; color: #666; text-transform: uppercase; margin-bottom: 8px; }
        .kpi-row { display: flex; gap: 8px; margin-top: 8px; align-items: center; }
        .kpi-label { font-family: 'Monument', monospace; font-size: 10px; color: #999; letter-spacing: 0.08em; min-width: 40px; }

        /* â”€â”€ Brainstorm list â”€â”€ */
        .activity-row { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
        .activity-row-num { font-family: 'Monument', monospace; font-size: 11px; color: #999; min-width: 24px; }
        .btn-remove { background: none; border: none; color: #999; cursor: pointer; font-size: 18px; padding: 4px 8px; transition: color 0.2s; flex-shrink: 0; }
        .btn-remove:hover { color: #DC2626; }
        .btn-add { width: 100%; padding: 10px 0; border: 2px dashed #E0E0E0; background: none; font-family: 'Monument', monospace; font-size: 12px; color: #666; letter-spacing: 0.05em; text-transform: uppercase; cursor: pointer; margin-top: 4px; transition: all 0.2s; }
        .btn-add:hover { border-color: #000; color: #000; }

        /* â”€â”€ Checklist â”€â”€ */
        .checklist-item { border: 1px solid #E0E0E0; padding: 20px 24px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; gap: 16px; }
        .checklist-item-text { font-size: 15px; color: #000; line-height: 1.5; flex: 1; }
        .checklist-toggle { display: flex; gap: 8px; flex-shrink: 0; }
        .checklist-btn { padding: 8px 20px; border: 2px solid #E0E0E0; background: #fff; font-family: 'Monument', monospace; font-size: 11px; letter-spacing: 0.06em; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
        .checklist-btn.selected-yes { background: #000; color: #FFF469; border-color: #000; }
        .checklist-btn.selected-no  { background: #DC2626; color: #fff; border-color: #DC2626; }

        /* â”€â”€ Sidebar â”€â”€ */
        .sidebar-tool-num { font-family: 'Monument', monospace; font-size: 10px; color: #fff; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 8px; }
        .sidebar-tool-title { font-family: 'Plaak', sans-serif; font-size: 22px; color: #fff; margin-bottom: 32px; line-height: 1.1; }
        .sidebar-step { padding: 8px 0; border-bottom: 1px solid #2a2a2a; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s; }
        .sidebar-step:last-child { border-bottom: none; }
        .sidebar-step-dot { width: 6px; height: 6px; border-radius: 50%; background: #fff; flex-shrink: 0; transition: background 0.2s; }
        .sidebar-step-dot.active { background: #FFF469; }
        .sidebar-step-dot.done   { background: #4ade80; }
        .sidebar-step-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.08em; color: #fff; text-transform: uppercase; transition: color 0.2s; }
        .sidebar-step-label.active { color: #FFF469; }
        .sidebar-step-label.done   { color: #4ade80; }
        .sidebar-activity-list { margin-top: 24px; border-top: 1px solid #2a2a2a; padding-top: 16px; }
        .sidebar-activity-item { font-size: 12px; color: #fff; padding: 4px 0; line-height: 1.4; display: flex; gap: 8px; }
        .sidebar-activity-item.filled { color: #ccc; }
        .sidebar-activity-idx { font-family: 'Monument', monospace; font-size: 10px; color: #FFF469; flex-shrink: 0; }

        /* â”€â”€ Mobile step bar â”€â”€ */
        .mobile-step-bar { display: none; }
        @media (max-width: 768px) {
            .wizard-sidebar { display: none; }
            .wizard-main { padding: 0 24px; }
            .mobile-step-bar { display: flex; align-items: center; gap: 8px; padding: 16px 24px; background: #1a1a1a; }
            .mobile-step-dot { width: 8px; height: 8px; border-radius: 50%; background: #333; transition: background 0.2s; }
            .mobile-step-dot.active { background: #FFF469; }
            .mobile-step-dot.done   { background: #4ade80; }
            .mobile-step-text { font-family: 'Monument', monospace; font-size: 11px; color: #fff; letter-spacing: 0.06em; }
            .wizard-footer { padding: 16px 24px; }
        }

        /* â”€â”€ Transitions / cover â”€â”€ */
        .animate-in { animation: fadeSlideIn 0.4s ease both; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

        /* â”€â”€ AI message â”€â”€ */
        .ai-message { background: #FFF9C4; border: 1px solid #FFF469; border-left: 4px solid #FFF469; padding: 12px 16px; font-size: 14px; color: #333; margin-bottom: 16px; line-height: 1.6; }

        /* â”€â”€ Dependency context â”€â”€ */
        .dep-context { border: 1px solid #E0E0E0; margin-bottom: 24px; }
        .dep-context-header { background: #F5F5F5; padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .dep-context-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.1em; color: #666; text-transform: uppercase; }
        .dep-context-body { padding: 14px 16px; font-size: 14px; color: #333; line-height: 1.6; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const CONFIG = {
        TOOL_SLUG:    'core-activities',
        TOOL_TITLE:   'CORE ACTIVITIES',
        TOOL_SUBTITLE:'Define the 5 activities that drive 80% of your strategic success.',
        COVER_IMAGE:  'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=1600&q=80',
        TOTAL_STEPS:  3,
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'Most companies confuse activity with strategy. They are busy doing everything and excelling at nothing. If you cannot name the 5 things your company must do better than anyone else, your entire team is misdirected â€” and they have no idea.',
                peerProof: '"A â‚¬15M B2B services firm discovered that 70% of their team\'s effort went to activities unrelated to their core value proposition. After defining and communicating their 5 core activities, they cut operational waste by 30% in one quarter."'
            },
            2: {
                brutalTruth: 'A long list of activities is not a strategy. It is an excuse to avoid making hard choices. The discipline to choose only 5 â€” and to kill everything else â€” is where most leadership teams fail. They call it priorities. They have 20.',
                peerProof: '"Zara\'s global dominance was not built by doing everything in fashion. It was built by mastering 5 specific activities: customer insight, rapid design, fast manufacturing, consistent branding, and precise inventory. That focus is what made them unbeatable."'
            },
            3: {
                brutalTruth: 'Naming a core activity is not the same as owning it. Your Top 5 are only valuable if they are communicated, owned, and measured. Review your canvas. These 5 activities are the ones your entire organisation must align behind â€” every hire, every project, every budget decision.',
                peerProof: '"Companies that clearly define and communicate their 5 core activities achieve up to 25% higher operational efficiency. The difference is not talent â€” it is clarity. Your team cannot execute what they cannot name."'
            }
        },

        CLOSING_MESSAGES: {
            1: { title: 'CONTEXT LOCKED',       text: 'Your value proposition is the lens for every decision ahead. Keep it visible.' },
            2: { title: 'BRAINSTORM COMPLETE',   text: 'Good. You have mapped the landscape. Now comes the hard part â€” choosing what truly matters.' },
            3: { title: 'TOP 5 DEFINED',         text: 'These are the 5 activities your company must master. Time to capture it in your canvas.' },
        }
    };

    // â”€â”€ Default data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const makeDefaultData = () => ({
        valueProposition: '',
        activities: Array(8).fill(null).map(() => ({ name: '', impact: 0, ease: 0 })),
        coreActivities: Array(5).fill(null).map(() => ({
            name: '',
            processes: Array(3).fill(null).map(() => ({ name: '', kpis: ['', '', ''] }))
        })),
        checklist: { q1: null, q2: null, q3: null, q4: null }
    });

    // Activity score for sorting: (impactÃ—2)+ease, max 9
    const activityScore = (a) => (a.impact * 2) + a.ease;

    // Normalise activities array loaded from DB (may be old string[] format)
    const normaliseActivities = (raw) => {
        if (!Array.isArray(raw)) return makeDefaultData().activities;
        return raw.map(item => {
            if (typeof item === 'string') return { name: item, impact: 0, ease: 0 };
            return { name: item.name || '', impact: item.impact || 0, ease: item.ease || 0 };
        });
    };

    // â”€â”€ WizardSidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function WizardSidebar({ currentStep, data, onNavigate }) {
        const steps = [
            { num: 1, label: 'Value Proposition' },
            { num: 2, label: 'Activity Brainstorm' },
            { num: 3, label: 'Top 5 Activities' },
            { num: 'canvas', label: 'Canvas' },
        ];
        return (
            <div className="wizard-sidebar">
                <div className="sidebar-tool-num">SPRINT 22</div>
                <div className="sidebar-tool-title">{CONFIG.TOOL_TITLE}</div>
                {steps.map(s => {
                    const isCanvas = s.num === 'canvas';
                    const isDone   = isCanvas ? false : currentStep > s.num;
                    const isActive = isCanvas ? currentStep === 'canvas' : Math.floor(currentStep) === s.num;
                    const isFuture = isCanvas ? false : currentStep < s.num;
                    return (
                        <div key={s.num} className="sidebar-step"
                            onClick={() => isDone && onNavigate(s.num)}
                            style={{ opacity: isFuture ? 0.6 : 1, cursor: isDone ? 'pointer' : 'default' }}>
                            <div className={`sidebar-step-dot ${isActive ? 'active' : isDone ? 'done' : ''}`} />
                            <span className={`sidebar-step-label ${isActive ? 'active' : isDone ? 'done' : ''}`}>{s.label}</span>
                        </div>
                    );
                })}
                {currentStep >= 3 && (
                    <div className="sidebar-activity-list">
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#fff', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 8 }}>CORE ACTIVITIES</div>
                        {data.coreActivities.map((a, i) => (
                            <div key={i} className={`sidebar-activity-item ${a.name.trim() ? 'filled' : ''}`}>
                                <span className="sidebar-activity-idx">{String(i+1).padStart(2,'0')}</span>
                                <span>{a.name.trim() || 'â€”'}</span>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    }

    // â”€â”€ MobileStepBar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function MobileStepBar({ currentStep, totalSteps }) {
        return (
            <div className="mobile-step-bar">
                <span className="mobile-step-text">STEP {Math.ceil(currentStep)} OF {totalSteps}</span>
                {Array.from({ length: totalSteps }, (_, i) => {
                    const n = i + 1;
                    const isDone   = currentStep > n;
                    const isActive = Math.floor(currentStep) === n;
                    return <div key={n} className={`mobile-step-dot ${isActive ? 'active' : isDone ? 'done' : ''}`} />;
                })}
            </div>
        );
    }

    // â”€â”€ DependencyContext â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function DependencyContext({ deps }) {
        const [open, setOpen] = useState(false);
        if (!deps || Object.keys(deps).length === 0) return null;
        const entries = Object.entries(deps).filter(([, v]) => v);
        if (entries.length === 0) return null;
        return (
            <div className="dep-context">
                <div className="dep-context-header" onClick={() => setOpen(o => !o)}>
                    <span className="dep-context-label">Context from previous tools</span>
                    <span style={{ fontSize: 12, color: '#999' }}>{open ? 'â–²' : 'â–¼'}</span>
                </div>
                {open && (
                    <div className="dep-context-body">
                        {entries.map(([k, v]) => (
                            <div key={k} style={{ marginBottom: 8 }}>
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', textTransform: 'uppercase', letterSpacing: '0.08em' }}>{k.replace(/_/g,' ')}: </span>
                                <span>{typeof v === 'object' ? JSON.stringify(v) : String(v)}</span>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    }

    // â”€â”€ LearnMore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function LearnMore({ children }) {
        const [open, setOpen] = useState(false);
        return (
            <>
                <button className="learn-more-toggle" onClick={() => setOpen(o => !o)}>
                    <span>{open ? 'â–²' : 'â–¼'}</span> {open ? 'Hide context' : 'Why this matters'}
                </button>
                {open && <div className="learn-more-content">{children}</div>}
            </>
        );
    }

    // â”€â”€ Transition screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function TransitionScreen({ stepNum, onNext }) {
        const t = CONFIG.TRANSITION_CONTENT[stepNum];
        if (!t) { onNext(); return null; }
        return (
            <div style={{ position: 'fixed', inset: 0, background: '#000', color: '#fff', zIndex: 200, overflowY: 'auto', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '64px 32px' }}>
                <div style={{ maxWidth: 720, width: '100%' }} className="animate-in">
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#555', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 32 }}>
                        SPRINT 22 â€” CORE ACTIVITIES
                    </div>
                    <div style={{ borderLeft: '4px solid #DC2626', paddingLeft: 24, marginBottom: 48 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#DC2626', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 12 }}>BRUTAL TRUTH</div>
                        <p className="plaak" style={{ fontSize: 26, lineHeight: 1.35 }}>{t.brutalTruth}</p>
                    </div>
                    <div style={{ borderLeft: '4px solid #FFF469', paddingLeft: 24, marginBottom: 64 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 12 }}>PEER PROOF</div>
                        <p style={{ fontSize: 18, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic' }}>{t.peerProof}</p>
                    </div>
                    <button onClick={onNext} className="plaak"
                        style={{ background: '#FFF469', color: '#000', border: 'none', padding: '18px 48px', fontSize: 18, cursor: 'pointer', letterSpacing: '0.05em', transition: 'all 0.2s' }}>
                        CONTINUE â†’
                    </button>
                </div>
            </div>
        );
    }

    // â”€â”€ STEP 1: Value Proposition â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function Step1({ data, updateData, deps, aiMessage }) {
        return (
            <div className="step-content animate-in">
                <DependencyContext deps={deps} />
                <p className="step-indicator">STEP 1 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Value Proposition</h1>
                    <p className="step-hint">Your core activities must deliver your value proposition. Anchor everything to this statement before you proceed.</p>
                </div>
                <LearnMore>
                    Your organisational structure exists for one reason: to deliver your strategy. The strategy is embodied in your value proposition â€” the specific promise you make to customers that your competitors cannot easily replicate. Every core activity you define in this sprint must directly serve this promise. If an activity doesn't connect to the value proposition, it is overhead, not strategy.
                </LearnMore>
                <div className="questions-grid">
                    <div className="field-group">
                        <label className="field-label">Your Company's Value Proposition</label>
                        <textarea className="field-textarea" style={{ minHeight: 120 }}
                            value={data.valueProposition}
                            onChange={e => updateData('valueProposition', e.target.value)}
                            placeholder="e.g. We deliver fast, trend-responsive fashion at accessible prices â€” new collections every two weeks, always aligned with what customers actually want right now."
                            maxLength={600}
                        />
                        <p className="field-help">{data.valueProposition.length}/600 (min 20 characters)</p>
                        <p className="field-help" style={{ marginTop: 6, color: '#000', fontWeight: 600 }}>
                            ğŸ’¡ Tip: Be specific. "We provide great customer service" is not a value proposition. What is the specific promise that makes you different?
                        </p>
                    </div>
                </div>
                {aiMessage && <div className="ai-message">{aiMessage}</div>}
                {data.valueProposition.length >= 20 && (
                    <div className="closing-box animate-in">
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[1].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[1].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // â”€â”€ Rating button helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function RatingBtn({ label, value, selected, color, onClick }) {
        return (
            <button onClick={onClick} style={{
                padding: '5px 10px',
                border: `2px solid ${selected ? color : '#E0E0E0'}`,
                background: selected ? color : '#fff',
                color: selected ? (color === '#FFF469' ? '#000' : '#fff') : '#999',
                fontFamily: "'Monument', monospace",
                fontSize: 10,
                letterSpacing: '0.05em',
                cursor: 'pointer',
                transition: 'all 0.15s',
                textTransform: 'uppercase',
                whiteSpace: 'nowrap',
            }}>{label}</button>
        );
    }

    // â”€â”€ STEP 2: Brainstorm Activities (Impact / Ease Matrix) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function Step2({ data, updateData, aiMessage }) {
        const activities = data.activities;
        const filled = activities.filter(a => a.name.trim()).length;

        const updateActivity = (idx, field, val) => {
            const next = activities.map((a, i) => i === idx ? { ...a, [field]: val } : a);
            updateData('activities', next);
        };
        const addRow = () => {
            if (activities.length < 15) updateData('activities', [...activities, { name: '', impact: 0, ease: 0 }]);
        };
        const removeRow = (idx) => {
            if (activities.length <= 5) return;
            updateData('activities', activities.filter((_, i) => i !== idx));
        };

        const IMPACT_OPTS = [
            { label: 'Low',  val: 1, color: '#94a3b8' },
            { label: 'Med',  val: 2, color: '#f59e0b' },
            { label: 'High', val: 3, color: '#22c55e' },
        ];
        const EASE_OPTS = [
            { label: 'Hard', val: 1, color: '#DC2626' },
            { label: 'Med',  val: 2, color: '#f59e0b' },
            { label: 'Easy', val: 3, color: '#22c55e' },
        ];

        const scored = activities
            .map((a, i) => ({ ...a, idx: i, score: activityScore(a) }))
            .filter(a => a.name.trim())
            .sort((a, b) => b.score - a.score);

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 2 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Activity Brainstorm</h1>
                    <p className="step-hint">List every activity your company performs. Rate each by strategic impact and ease of execution. The top 5 by score will auto-fill your Core Activities in the next step.</p>
                </div>
                <LearnMore>
                    The Impact/Ease matrix helps you cut through bias. Impact = how much this activity drives your value proposition (1=Low, 2=Med, 3=High). Ease = how operationally feasible it is to execute well (1=Hard, 2=Med, 3=Easy). Score = (ImpactÃ—2)+Ease. The highest-scoring activities are your strategic priorities. Be honest â€” overrating ease is the most common mistake.
                </LearnMore>

                {/* Column headers */}
                <div style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 8, padding: '0 0 10px', borderBottom: '2px solid #000' }}>
                    <span style={{ minWidth: 28 }}></span>
                    <span style={{ flex: 1, fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.08em' }}>Activity</span>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 4, minWidth: 160, justifyContent: 'center' }}>
                        <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#22c55e', textTransform: 'uppercase', letterSpacing: '0.08em' }}>IMPACT</span>
                    </div>
                    <div style={{ width: 1, height: 16, background: '#E0E0E0', flexShrink: 0 }}></div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 4, minWidth: 160, justifyContent: 'center' }}>
                        <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#f59e0b', textTransform: 'uppercase', letterSpacing: '0.08em' }}>EASE</span>
                    </div>
                    <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.08em', minWidth: 48, textAlign: 'center' }}>Score</span>
                    <span style={{ minWidth: 28 }}></span>
                </div>

                {activities.map((a, idx) => {
                    const score = activityScore(a);
                    const isTop5 = a.name.trim() && scored.findIndex(s => s.idx === idx) < 5;
                    const scoreColor = (a.impact === 3 && a.ease === 3) ? '#22c55e' : score >= 7 ? '#22c55e' : score >= 5 ? '#f59e0b' : score > 0 ? '#94a3b8' : '#ddd';
                    const scoreBold  = score >= 7;
                    return (
                        <div key={idx} style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 10, padding: '10px 8px', background: isTop5 ? '#FFFDE7' : '#fff', border: `1px solid ${isTop5 ? '#FFF469' : '#E0E0E0'}`, transition: 'all 0.2s' }}>
                            <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: isTop5 ? '#000' : '#bbb', minWidth: 28 }}>{String(idx+1).padStart(2,'0')}</span>
                            <input type="text" className="field-input" style={{ padding: '8px 12px', fontSize: 14, flex: 1 }}
                                value={a.name}
                                onChange={e => updateActivity(idx, 'name', e.target.value)}
                                placeholder={idx === 0 ? 'e.g. B2B lead generation via LinkedIn' : idx === 1 ? 'e.g. Product development & roadmapping' : idx === 2 ? 'e.g. Customer onboarding & activation' : 'Add an activityâ€¦'}
                            />
                            <div style={{ display: 'flex', gap: 3, minWidth: 160, justifyContent: 'center' }}>
                                {IMPACT_OPTS.map(o => (
                                    <RatingBtn key={o.val} label={o.label} value={o.val} selected={a.impact === o.val} color={o.color}
                                        onClick={() => updateActivity(idx, 'impact', o.val)} />
                                ))}
                            </div>
                            <div style={{ width: 1, height: 32, background: '#E0E0E0', flexShrink: 0 }}></div>
                            <div style={{ display: 'flex', gap: 3, minWidth: 160, justifyContent: 'center' }}>
                                {EASE_OPTS.map(o => (
                                    <RatingBtn key={o.val} label={o.label} value={o.val} selected={a.ease === o.val} color={o.color}
                                        onClick={() => updateActivity(idx, 'ease', o.val)} />
                                ))}
                            </div>
                            <div style={{ textAlign: 'center', fontFamily: "'Monument', monospace", fontSize: scoreBold ? 18 : 14, fontWeight: scoreBold ? 'bold' : 'normal', color: scoreColor, minWidth: 48, transition: 'all 0.2s' }}>
                                {score > 0 ? score : 'â€”'}
                            </div>
                            <button className="btn-remove" onClick={() => removeRow(idx)} disabled={activities.length <= 5} style={{ opacity: activities.length <= 5 ? 0.2 : 1, minWidth: 28 }}>Ã—</button>
                        </div>
                    );
                })}

                {activities.length < 15 && (
                    <button className="btn-add" onClick={addRow} style={{ marginTop: 4 }}>+ Add Activity</button>
                )}

                <p className="field-help" style={{ marginTop: 12 }}>
                    {filled} activities added (min 5). Highlighted rows = current Top 5 by score â†’ these will auto-fill Step 3.
                </p>

                {/* Live ranking preview */}
                {scored.length >= 3 && (
                    <div style={{ marginTop: 24, border: '1px solid #E0E0E0', padding: 16 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 12 }}>CURRENT TOP 5 BY SCORE</div>
                        {scored.slice(0, 5).map((a, rank) => (
                            <div key={rank} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '6px 0', borderBottom: rank < 4 ? '1px solid #F0F0F0' : 'none' }}>
                                <span style={{ fontFamily: "'Plaak', sans-serif", fontSize: 20, color: '#FFF469', background: '#000', padding: '2px 8px', minWidth: 36, textAlign: 'center' }}>{rank+1}</span>
                                <span style={{ fontSize: 13, flex: 1 }}>{a.name}</span>
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 12, fontWeight: 'bold', color: '#DC2626' }}>{a.score}</span>
                            </div>
                        ))}
                    </div>
                )}

                {aiMessage && <div className="ai-message" style={{ marginTop: 16 }}>{aiMessage}</div>}
                {filled >= 5 && (
                    <div className="closing-box animate-in" style={{ marginTop: 24 }}>
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[2].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[2].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // â”€â”€ STEP 3: Top 5 Core Activities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function Step3({ data, updateData, aiMessage }) {
        const filledActivities = data.activities.filter(a => a.name.trim()).sort((a, b) => activityScore(b) - activityScore(a));
        const coreActivities = data.coreActivities;

        const updateCore = (idx, field, val) => {
            const next = coreActivities.map((a, i) => i === idx ? { ...a, [field]: val } : a);
            updateData('coreActivities', next);
        };
        const filledCount = coreActivities.filter(a => a.name.trim().length >= 3).length;

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 3 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Top 5 Core Activities</h1>
                    <p className="step-hint">From your brainstorm, select and precisely define the 5 activities that have the greatest impact on delivering your value proposition.</p>
                </div>
                <div style={{ background: '#FFFDE7', border: '1px solid #FFF469', borderLeft: '4px solid #FFF469', padding: '12px 16px', marginBottom: 20, fontSize: 13, color: '#333', lineHeight: 1.6 }}>
                    Your top 5 activities from the brainstorm have been auto-filled based on their scores. Review and refine each name â€” be specific and actionable.
                </div>
                <LearnMore>
                    These are the 20% of activities responsible for 80% of your strategic success. They must be specific, actionable, and directly linked to your value proposition. Avoid generic labels. "Marketing" is not a core activity. "Rapid trend-responsive product launches reaching stores within 2 weeks of customer insight" is a core activity. The precision of your language here determines the precision of your team's execution. Use your brainstorm list as reference â€” refine and sharpen each one.
                </LearnMore>

                {filledActivities.length > 0 && (
                    <div style={{ background: '#F5F5F5', border: '1px solid #E0E0E0', padding: 16, marginBottom: 28 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 10 }}>BRAINSTORM â€” SORTED BY SCORE â†“</div>
                        {filledActivities.map((a, i) => (
                            <div key={i} style={{ fontSize: 13, color: i < 5 ? '#000' : '#999', padding: '4px 0', display: 'flex', gap: 8, alignItems: 'center', borderBottom: '1px solid #eee' }}>
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', background: '#000', padding: '2px 5px', flexShrink: 0 }}>{String(i+1).padStart(2,'0')}</span>
                                <span style={{ flex: 1 }}>{a.name}</span>
                                {activityScore(a) > 0 && <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#DC2626', flexShrink: 0 }}>{activityScore(a)}</span>}
                                {i < 5 && <span style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#22c55e', flexShrink: 0 }}>â˜… TOP 5</span>}
                            </div>
                        ))}
                    </div>
                )}

                <div className="questions-grid">
                    {coreActivities.map((a, idx) => (
                        <div key={idx} className="activity-card" style={{ opacity: a.name.trim() ? 1 : 0.5 }}>
                            <div className="activity-card-header" style={{ background: a.name.trim() ? '#000' : '#555' }}>
                                <span className="activity-card-number">{String(idx+1).padStart(2,'0')}</span>
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.08em', color: '#ccc', textTransform: 'uppercase' }}>Core Activity {idx+1}</span>
                                {a.name.trim() && <span style={{ marginLeft: 'auto', fontFamily: "'Monument', monospace", fontSize: 9, color: '#FFF469', letterSpacing: '0.08em' }}>AUTO-FILLED âœ“</span>}
                            </div>
                            <div className="activity-card-body">
                                <div style={{ padding: '12px 16px', background: '#F9F9F9', border: '1px solid #E0E0E0', fontSize: 16, color: '#000', fontWeight: 600, minHeight: 48, display: 'flex', alignItems: 'center' }}>
                                    {a.name.trim() || <span style={{ color: '#999', fontWeight: 400 }}>Not filled from brainstorm</span>}
                                </div>
                                <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', marginTop: 6, letterSpacing: '0.06em' }}>
                                    LOCKED â€” auto-populated from your brainstorm scores. Go back to Step 2 to change.
                                </p>
                            </div>
                        </div>
                    ))}
                    {filledCount < 5 && <p className="field-error" style={{ marginTop: 4 }}>Only {filledCount} of 5 filled. Add more activities in Step 2.</p>}
                </div>
                {aiMessage && <div className="ai-message">{aiMessage}</div>}
                {filledCount === 5 && (
                    <div className="closing-box animate-in">
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[3].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[3].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // â”€â”€ CANVAS STEP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function CanvasStep({ data, onSubmit, submitState, aiMessage }) {
        const handlePrint = () => {
            const vp = data.valueProposition || 'â€”';
            const activities = data.coreActivities.map((a, i) => `<div style="display:flex;gap:16px;align-items:center;padding:14px 0;border-bottom:1px solid #eee"><span style="font-family:monospace;font-size:18px;font-weight:bold;color:#FFF469;background:#000;padding:4px 10px;min-width:36px;text-align:center">${i+1}</span><span style="font-size:16px;font-weight:600">${a.name || 'â€”'}</span></div>`).join('');
            const win = window.open('', '_blank');
            win.document.write(`<!DOCTYPE html><html><head><title>Core Activities Canvas</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;padding:48px;color:#000}h1{font-size:32px;font-weight:bold;letter-spacing:-0.01em;margin-bottom:32px}h2{font-size:13px;text-transform:uppercase;letter-spacing:0.1em;color:#666;margin-bottom:12px;border-bottom:2px solid #000;padding-bottom:6px}.section{margin-bottom:36px}.vp{font-size:16px;line-height:1.7;color:#333;padding:16px;background:#F9F9F9;border-left:4px solid #000}.case{background:#F9F9F9;padding:24px;border-left:4px solid #000;font-size:14px;line-height:1.7;color:#333}strong{font-weight:bold}</style></head><body><h1>CORE ACTIVITIES CANVAS</h1><div class="section"><h2>Value Proposition</h2><p class="vp">${vp}</p></div><div class="section"><h2>Top 5 Core Activities</h2>${activities}</div><div class="section"><h2>Case Study â€” Zara</h2><p class="case">Zara's global dominance was built on exactly 5 core activities: <strong>customer insight</strong> (store managers reporting daily on what customers asked for), <strong>rapid design</strong> (new items from trend to prototype in 2 weeks), <strong>fast manufacturing</strong> (60% produced in Europe, close to market), <strong>consistent branding</strong> (minimal advertising, store location as brand), and <strong>precise inventory</strong> (small batches, perpetual scarcity). Every other fashion company had more money and more designers. Zara won because they chose 5 things to be world-class at â€” and built their entire organisation around those 5.</p></div></body></html>`);
            win.document.close();
            win.print();
        };

        if (submitState === 'success') {
            return (
                <div className="step-content animate-in">
                    <div style={{ background: '#f0fdf4', border: '1px solid #86efac', padding: 48, textAlign: 'center', marginTop: 32 }}>
                        <div style={{ fontSize: 48, marginBottom: 16 }}>âœ“</div>
                        <h2 className="plaak" style={{ fontSize: 32, marginBottom: 16 }}>SUBMITTED</h2>
                        <p style={{ fontSize: 16, color: '#555', marginBottom: 32 }}>Your Core Activities Canvas has been saved. Your guru will review before Wednesday.</p>
                        <a href="/dashboard" style={{ fontFamily: "'Monument', monospace", fontSize: 12, color: '#000', letterSpacing: '0.06em', textDecoration: 'underline' }}>â† Back to Dashboard</a>
                    </div>
                </div>
            );
        }

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">CANVAS</p>
                <div className="opening-box">
                    <h1 className="step-heading">Core Activities Canvas</h1>
                    <p className="step-hint">Review your complete output. Download it as a PDF to share with your team, then submit your answers.</p>
                </div>

                {/* Canvas panel */}
                <div style={{ border: '2px solid #000', marginBottom: 32 }}>
                    {/* Value Proposition */}
                    <div style={{ padding: '24px 28px', borderBottom: '1px solid #E0E0E0' }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 12 }}>VALUE PROPOSITION</div>
                        <p style={{ fontSize: 16, lineHeight: 1.7, color: data.valueProposition ? '#000' : '#999' }}>
                            {data.valueProposition || 'Not filled'}
                        </p>
                    </div>

                    {/* Top 5 Core Activities */}
                    <div style={{ padding: '24px 28px', borderBottom: '1px solid #E0E0E0' }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 12 }}>TOP 5 CORE ACTIVITIES</div>
                        {data.coreActivities.map((a, i) => (
                            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 16, padding: '12px 0', borderBottom: i < 4 ? '1px solid #F0F0F0' : 'none' }}>
                                <span className="plaak" style={{ fontSize: 22, color: '#FFF469', background: '#000', padding: '4px 10px', minWidth: 44, textAlign: 'center' }}>{i+1}</span>
                                <span style={{ fontSize: 16, fontWeight: 600, color: a.name.trim() ? '#000' : '#999' }}>{a.name.trim() || 'â€”'}</span>
                            </div>
                        ))}
                    </div>

                    {/* Case Study */}
                    <div style={{ padding: '24px 28px', background: '#000', color: '#fff' }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 12 }}>CASE STUDY â€” ZARA</div>
                        <p style={{ fontSize: 14, lineHeight: 1.8, color: '#ccc' }}>
                            Zara's global dominance was built on exactly <strong style={{ color: '#fff' }}>5 core activities</strong>: <em>customer insight</em> (store managers reporting daily on what customers asked for), <em>rapid design</em> (new items from trend to prototype in 2 weeks), <em>fast manufacturing</em> (60% produced in Europe, close to market), <em>consistent branding</em> (minimal advertising, store location as brand), and <em>precise inventory</em> (small batches, perpetual scarcity). Every other fashion company had more money and more designers. Zara won because they chose 5 things to be world-class at â€” and built their entire organisation around those 5.
                        </p>
                    </div>
                </div>

                {aiMessage && <div className="ai-message" style={{ marginBottom: 16 }}>{aiMessage}</div>}

                {/* Action buttons */}
                <div className="canvas-actions" style={{ display: 'flex', gap: 16 }}>
                    <button onClick={handlePrint} className="btn-wiz-back"
                        style={{ flex: 1, padding: '16px', fontSize: 13, border: '2px solid #000', color: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8 }}>
                        â†“ DOWNLOAD PDF
                    </button>
                    <button onClick={onSubmit} disabled={submitState === 'saving'} className="btn-wiz-next"
                        style={{ flex: 2, padding: 16, fontSize: 13 }}>
                        {submitState === 'saving' ? 'SAVINGâ€¦' : 'SUBMIT ANSWERS â†’'}
                    </button>
                </div>
            </div>
        );
    }

    // â”€â”€ STEP 4 (old Processes) â€” REMOVED. Kept as placeholder to avoid reference errors â”€â”€
    function Step4({ data, updateData, activityIdx, setActivityIdx, aiMessage }) {
        const coreActivities = data.coreActivities;
        const current = coreActivities[activityIdx];

        const updateProcess = (pIdx, field, val) => {
            const next = coreActivities.map((a, ai) => {
                if (ai !== activityIdx) return a;
                const newProcesses = a.processes.map((p, pi) => {
                    if (pi !== pIdx) return p;
                    if (field === 'name') return { ...p, name: val };
                    const newKpis = [...p.kpis];
                    newKpis[field] = val;
                    return { ...p, kpis: newKpis };
                });
                return { ...a, processes: newProcesses };
            });
            updateData('coreActivities', next);
        };

        const filledProcesses = current.processes.filter(p => p.name.trim()).length;

        return (
            <div className="step-content animate-in" key={activityIdx}>
                <p className="step-indicator">STEP 4 OF {CONFIG.TOTAL_STEPS} â€” ACTIVITY {activityIdx + 1} OF 5</p>
                <div className="opening-box">
                    <h1 className="step-heading">Processes & KPIs</h1>
                    <p className="step-hint">For each core activity, define the 3 critical processes that make it happen â€” and the KPIs that prove it's working.</p>
                </div>
                <LearnMore>
                    Within each core activity there are a handful of processes that are truly critical â€” the sub-routines that must run smoothly and consistently for the activity to succeed. Your job here is to identify the top 3 processes per activity (those whose improvement would most significantly enhance performance), then set 3 measurable KPIs for each process. KPIs must create decisions â€” if you would not change behavior based on a shift in this number, choose a different KPI.
                </LearnMore>

                {/* Activity navigator */}
                <div style={{ display: 'flex', gap: 8, marginBottom: 24, flexWrap: 'wrap' }}>
                    {coreActivities.map((a, i) => {
                        const hasProceses = a.processes.some(p => p.name.trim());
                        return (
                            <button key={i}
                                onClick={() => setActivityIdx(i)}
                                style={{
                                    padding: '6px 14px',
                                    background: activityIdx === i ? '#000' : hasProceses ? '#F0F0F0' : '#fff',
                                    color: activityIdx === i ? '#FFF469' : hasProceses ? '#000' : '#999',
                                    border: `2px solid ${activityIdx === i ? '#000' : hasProceses ? '#000' : '#E0E0E0'}`,
                                    fontFamily: "'Monument', monospace",
                                    fontSize: 10,
                                    letterSpacing: '0.06em',
                                    cursor: 'pointer',
                                    transition: 'all 0.2s',
                                }}>
                                {String(i+1).padStart(2,'0')}
                            </button>
                        );
                    })}
                </div>

                {/* Current activity header */}
                <div style={{ background: '#000', color: '#fff', padding: '16px 20px', marginBottom: 24, display: 'flex', alignItems: 'center', gap: 16 }}>
                    <span className="plaak" style={{ fontSize: 32, color: '#FFF469' }}>{String(activityIdx+1).padStart(2,'0')}</span>
                    <div>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#555', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 4 }}>CORE ACTIVITY</div>
                        <div style={{ fontSize: 18, fontWeight: 600 }}>{current.name || 'â€”'}</div>
                    </div>
                </div>

                {/* Processes */}
                {current.processes.map((proc, pIdx) => (
                    <div key={pIdx} className="process-row">
                        <div className="process-row-header">PROCESS {pIdx + 1} OF 3</div>
                        <input type="text" className="field-input"
                            value={proc.name}
                            onChange={e => updateProcess(pIdx, 'name', e.target.value)}
                            placeholder={pIdx === 0 ? 'e.g. Small-batch production runs for flexibility' : pIdx === 1 ? 'e.g. Just-in-time inventory replenishment' : 'e.g. Vertically integrated logistics control'}
                            style={{ marginBottom: 12 }}
                            maxLength={150}
                        />
                        {proc.name.trim() && (
                            <div>
                                <div style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#999', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 6 }}>KPIs for this process</div>
                                {proc.kpis.map((kpi, kIdx) => (
                                    <div key={kIdx} className="kpi-row">
                                        <span className="kpi-label">KPI {kIdx+1}</span>
                                        <input type="text" className="field-input"
                                            value={kpi}
                                            onChange={e => updateProcess(pIdx, kIdx, e.target.value)}
                                            placeholder={kIdx === 0 ? 'e.g. Sell-through rate (%)' : kIdx === 1 ? 'e.g. Days inventory outstanding' : 'e.g. On-time delivery rate (%)'}
                                            maxLength={120}
                                        />
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                ))}
                <p className="field-help" style={{ marginTop: 8 }}>Fill at least 1 process with its KPIs for this activity. {filledProcesses}/3 processes filled.</p>
                {aiMessage && <div className="ai-message">{aiMessage}</div>}
                {filledProcesses >= 1 && activityIdx === 4 && (
                    <div className="closing-box animate-in">
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[4].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[4].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // â”€â”€ STEP 5: Sprint Checklist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function Step5({ data, updateData, onSubmit, submitState, aiMessage }) {
        const { checklist } = data;
        const questions = [
            { key: 'q1', text: 'We have identified 5 core activities that we need to master in order to execute our value proposition.' },
            { key: 'q2', text: 'The core activities are aligned with our strategy and outline the competitive advantage we will have over the competition.' },
            { key: 'q3', text: 'We have identified the 3 critical processes for each core activity.' },
            { key: 'q4', text: 'There is a clear, measurable KPI for each process that will drive accountability.' },
        ];
        const allAnswered = questions.every(q => checklist[q.key] !== null);

        const setAnswer = (key, val) => updateData('checklist', { ...checklist, [key]: val });

        if (submitState === 'success') {
            return (
                <div className="step-content animate-in">
                    <div style={{ background: '#f0fdf4', border: '1px solid #86efac', padding: 48, textAlign: 'center', marginTop: 32 }}>
                        <div style={{ fontSize: 48, marginBottom: 16 }}>âœ“</div>
                        <h2 className="plaak" style={{ fontSize: 32, marginBottom: 16 }}>SUBMITTED</h2>
                        <p style={{ fontSize: 16, color: '#555', marginBottom: 32 }}>Your Core Activities & Processes have been saved. Your guru will review before Wednesday.</p>
                        <a href="/dashboard" style={{ fontFamily: "'Monument', monospace", fontSize: 12, color: '#000', letterSpacing: '0.06em', textDecoration: 'underline' }}>â† Back to Dashboard</a>
                    </div>
                </div>
            );
        }

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 5 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Sprint Checklist</h1>
                    <p className="step-hint">Before you submit, confirm your team has genuinely completed each item. Be honest â€” partial credit is worse than no credit.</p>
                </div>
                <div className="questions-grid" style={{ marginTop: 24 }}>
                    {questions.map((q, i) => (
                        <div key={q.key} className="checklist-item">
                            <div style={{ display: 'flex', gap: 12, alignItems: 'flex-start', flex: 1 }}>
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', background: '#000', padding: '3px 7px', marginTop: 2, flexShrink: 0 }}>{String(i+1).padStart(2,'0')}</span>
                                <p className="checklist-item-text">{q.text}</p>
                            </div>
                            <div className="checklist-toggle">
                                <button className={`checklist-btn ${checklist[q.key] === true ? 'selected-yes' : ''}`}
                                    onClick={() => setAnswer(q.key, true)}>YES</button>
                                <button className={`checklist-btn ${checklist[q.key] === false ? 'selected-no' : ''}`}
                                    onClick={() => setAnswer(q.key, false)}>NO</button>
                            </div>
                        </div>
                    ))}
                </div>
                {aiMessage && <div className="ai-message" style={{ marginTop: 16 }}>{aiMessage}</div>}
                {allAnswered && (
                    <div style={{ marginTop: 32 }}>
                        {questions.some(q => checklist[q.key] === false) && (
                            <div style={{ background: '#FEF2F2', border: '1px solid #FCA5A5', borderLeft: '4px solid #DC2626', padding: 16, marginBottom: 20, fontSize: 14, color: '#333', lineHeight: 1.6 }}>
                                <strong>Some items are incomplete.</strong> You can still submit, but your guru will prioritise the gaps in your review.
                            </div>
                        )}
                        <button onClick={onSubmit} disabled={submitState === 'saving'} className="btn-wiz-next"
                            style={{ width: '100%', padding: 18, fontSize: 14 }}>
                            {submitState === 'saving' ? 'SAVINGâ€¦' : 'SUBMIT ANSWERS â†’'}
                        </button>
                    </div>
                )}
            </div>
        );
    }

    // â”€â”€ IntroPage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function IntroPage({ onNext }) {
        return (
            <div style={{ background: '#000', color: '#fff', minHeight: '100vh', padding: '64px' }}>
                <div style={{ maxWidth: '1000px', margin: '0 auto' }}>
                    <h1 className="plaak animate-in" style={{ fontSize: '100px', marginBottom: '64px' }}>
                        BEFORE WE START
                    </h1>

                    {/* Sprint Info */}
                    <div className="animate-in" style={{ marginBottom: '48px', animationDelay: '0.08s' }}>
                        <h2 className="plaak" style={{ fontSize: '48px', color: '#FFF469', marginBottom: '24px' }}>SPRINT INFO</h2>
                        <div style={{ background: '#fff', color: '#000', padding: '32px' }}>
                            <p style={{ fontSize: '22px', fontWeight: 'bold', marginBottom: '16px' }}>Sprint 22: Define Core Activities</p>
                            <p style={{ fontSize: '18px', lineHeight: 1.6, marginBottom: '16px' }}>
                                This is a team meeting tool. Your organisation's structure exists to deliver your strategy. This sprint identifies the 5 activities your company must master to execute your value proposition â€” then maps the processes and KPIs that make each one operational.
                            </p>
                            <div style={{ borderLeft: '4px solid #000', paddingLeft: '16px', fontStyle: 'italic', fontSize: '16px' }}>
                                "Strategy without process is a daydream. Process without strategy is a nightmare." â€” Sun Tzu
                            </div>
                        </div>
                    </div>

                    {/* Purpose */}
                    <div className="animate-in" style={{ marginBottom: '48px', animationDelay: '0.1s' }}>
                        <h2 className="plaak" style={{ fontSize: '48px', marginBottom: '24px' }}>PURPOSE</h2>
                        <div style={{ borderLeft: '4px solid #fff', paddingLeft: '24px', marginBottom: '24px' }}>
                            <p style={{ fontSize: '28px', fontStyle: 'italic', marginBottom: '8px' }}>
                                "Think of your organisation like a racing yacht â€” every rope, sail, and crew member aligned perfectly to cut swiftly through the water."
                            </p>
                            <p style={{ fontSize: '18px', color: '#999' }}>â€” Fast Track Program</p>
                        </div>
                        <p style={{ fontSize: '22px', lineHeight: 1.6, marginBottom: '16px' }}>
                            This sprint aligns your team's activities and processes to move faster and more efficiently toward your strategic goals. You will leave with a clear operational blueprint: 5 core activities, their critical processes, and the KPIs that keep execution honest.
                        </p>
                        <p style={{ fontSize: '18px', color: '#999' }}>
                            Companies that clearly define core activities achieve up to 25% higher operational efficiency. Organisations without this clarity are 3Ã— more likely to experience misalignment and wasted resources.
                        </p>
                    </div>

                    {/* Mistakes to Avoid */}
                    <div className="animate-in" style={{ marginBottom: '48px', animationDelay: '0.2s' }}>
                        <h2 className="plaak" style={{ fontSize: '48px', color: '#FFF469', marginBottom: '24px' }}>MISTAKES TO AVOID</h2>
                        <ul style={{ fontSize: '20px', listStyle: 'none', padding: 0 }}>
                            {[
                                'Over-generalising â€” "Marketing" is not a core activity. Be precise. Clearly define activities so they are actionable, not aspirational.',
                                'Rushing the process â€” give each step focused time. The quality of your output determines the quality of your execution for the next 90 days.',
                                'Ignoring team input â€” this is a collaborative tool. Every voice in the room strengthens the definitions. Push back on vague language.',
                                'Choosing KPIs that are easy to measure rather than meaningful â€” if a KPI does not change a decision, replace it.',
                            ].map((item, i) => (
                                <li key={i} style={{ display: 'flex', alignItems: 'flex-start', marginBottom: '16px' }}>
                                    <span style={{ fontSize: '32px', marginRight: '16px', lineHeight: 1, flexShrink: 0 }}>â€¢</span>
                                    <span>{item}</span>
                                </li>
                            ))}
                        </ul>
                    </div>

                    {/* The Journey */}
                    <div className="animate-in" style={{ marginBottom: '64px', animationDelay: '0.3s' }}>
                        <h2 className="plaak" style={{ fontSize: '48px', marginBottom: '32px' }}>THE JOURNEY</h2>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: '16px', textAlign: 'center' }}>
                            {[
                                ['01', 'VALUE PROP',  'Anchor to strategy'],
                                ['02', 'BRAINSTORM',  'Rate & rank activities'],
                                ['03', 'TOP 5',       'Auto-fill & confirm'],
                                ['04', 'CANVAS',      'Review, PDF & submit'],
                            ].map(([num, title, sub]) => (
                                <div key={num} style={{ border: '2px solid #fff', padding: '20px 12px' }}>
                                    <div className="plaak" style={{ fontSize: '52px', marginBottom: '12px' }}>{num}</div>
                                    <p style={{ fontWeight: 'bold', marginBottom: '6px', fontSize: '13px' }}>{title}</p>
                                    <p style={{ fontSize: '12px', color: '#999' }}>{sub}</p>
                                </div>
                            ))}
                        </div>
                    </div>

                    <button onClick={onNext} className="plaak"
                        style={{ width: '100%', padding: '32px', background: '#FFF469', color: '#000', border: 'none', fontSize: '28px', cursor: 'pointer', letterSpacing: '0.05em', transition: 'opacity 0.2s' }}>
                        LET'S START â†’
                    </button>
                </div>
            </div>
        );
    }

    // â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function CoreActivitiesApp() {
        const [step, setStep]               = useState(0);
        const [data, setData]               = useState(makeDefaultData());
        const [userId, setUserId]           = useState(null);
        const [deps, setDeps]               = useState({});
        const [authState, setAuthState]     = useState({ loading: true, authenticated: false, error: null });
        const [submitState, setSubmitState] = useState('idle'); // idle | saving | success | error
        const [aiReviewing, setAiReviewing] = useState(false);
        const [aiMessage, setAiMessage]     = useState('');

        const totalSteps = CONFIG.TOTAL_STEPS;

        // â”€â”€ Init â”€â”€
        useEffect(() => {
            ToolDB.init(CONFIG.TOOL_SLUG);

            ToolDB.whenReady().then(async () => {
                const uid = await ToolDB.identifyUser();
                if (!uid) {
                    setAuthState({ loading: false, authenticated: false, error: 'No active session found.' });
                    return;
                }
                setUserId(uid);
                setAuthState({ loading: false, authenticated: true, error: null });

                // Load saved data
                const saved = await ToolDB.load(uid);
                const defaults = makeDefaultData();
                if (saved && Object.keys(saved).length > 0) {
                    setData(prev => ({
                        valueProposition: saved.value_proposition || prev.valueProposition,
                        activities:       normaliseActivities(saved.brainstorm_activities) || prev.activities,
                        coreActivities:   saved.core_activities       || prev.coreActivities,
                        checklist:        saved.sprint_checklist      || prev.checklist,
                    }));
                    if (saved.core_activities) hasAutoFilled.current = true;
                }

                // Load dependencies
                try {
                    const vp = await ToolDB.getDependency(uid, 'value_proposition');
                    if (vp) {
                        setDeps(d => ({ ...d, 'Value Proposition (Tool 15)': vp }));
                        // Auto-fill value prop field if not already saved
                        setData(prev => ({
                            ...prev,
                            valueProposition: prev.valueProposition || (typeof vp === 'string' ? vp : JSON.stringify(vp))
                        }));
                    }
                    const seg = await ToolDB.getDependency(uid, 'target_segment');
                    if (seg) setDeps(d => ({ ...d, 'Target Segment (Tool 13)': seg }));
                } catch (_) {}
            });
        }, []);

        const updateData = useCallback((field, val) => {
            setData(prev => ({ ...prev, [field]: val }));
            setAiMessage('');
        }, []);

        // â”€â”€ Auto-fill top 5 when entering step 3 â”€â”€
        const hasAutoFilled = useRef(false);
        useEffect(() => {
            if (step !== 3) return;
            if (hasAutoFilled.current) return;
            const anyFilled = data.coreActivities.some(a => a.name.trim());
            if (anyFilled) { hasAutoFilled.current = true; return; }
            const top5 = [...data.activities]
                .filter(a => a.name.trim())
                .sort((a, b) => activityScore(b) - activityScore(a))
                .slice(0, 5);
            if (top5.length === 0) return;
            hasAutoFilled.current = true;
            setData(prev => ({
                ...prev,
                coreActivities: prev.coreActivities.map((ca, i) => ({
                    ...ca,
                    name: top5[i] ? top5[i].name : ca.name
                }))
            }));
        }, [step]);

        // â”€â”€ canProceed per step â”€â”€
        const canProceed = () => {
            if (step === 1) return data.valueProposition.trim().length >= 20;
            if (step === 2) return data.activities.filter(a => a.name.trim()).length >= 5;
            if (step === 3) return data.coreActivities.filter(a => a.name.trim().length >= 3).length >= 5;
            return true;
        };

        // â”€â”€ handleNext â”€â”€
        const handleNext = async () => {
            setAiMessage('');
            if (!canProceed()) {
                if (step === 1) setAiMessage('Please enter your value proposition (min 20 characters) before continuing.');
                if (step === 2) setAiMessage('Add at least 5 activities to your brainstorm before continuing.');
                if (step === 3) setAiMessage('All 5 core activities must be filled (auto-filled from brainstorm). Add more rated activities in Step 2 if fewer than 5 are shown.');
                return;
            }

            // AI review on step 2 â€” check brainstorm quality
            // answers must be a plain { key: value } object (z.record schema in backend)
            if (step === 2 && window.AIChallenge) {
                const named = data.activities.filter(a => a.name.trim());
                setAiReviewing(true);
                const ok = await window.AIChallenge.reviewStep(
                    userId,
                    CONFIG.TOOL_SLUG,
                    { brainstorm_activities: named.map((a, i) => `${i+1}. ${a.name}`).join('\n') },
                    'Activity Brainstorm'
                );
                setAiReviewing(false);
                if (!ok) { return; }
            }

            // AI review on step 3 â€” check core activity name specificity
            if (step === 3 && window.AIChallenge) {
                setAiReviewing(true);
                const ok = await window.AIChallenge.reviewStep(
                    userId,
                    CONFIG.TOOL_SLUG,
                    { core_activities: data.coreActivities.map((a, i) => `${i+1}. ${a.name}`).join('\n') },
                    'Core Activities'
                );
                setAiReviewing(false);
                if (!ok) { return; }
            }

            // After step 3, go to transition then canvas
            if (step === totalSteps) {
                setStep(step + 0.5);
                return;
            }
            setStep(step + 0.5);
        };

        // â”€â”€ handleTransitionNext â”€â”€
        const handleTransitionNext = () => {
            const next = Math.floor(step) + 1;
            // After transition 3.5, go to canvas
            if (Math.floor(step) === totalSteps) {
                setStep('canvas');
            } else {
                setStep(next);
            }
        };

        // â”€â”€ handleBack â”€â”€
        const handleBack = () => {
            if (step === 'canvas') { setStep(totalSteps); return; }
            if (step === 1) { setStep(0.5); return; }
            setStep(step - 1);
        };

        // â”€â”€ handleSubmit â”€â”€
        const handleSubmit = async () => {
            setSubmitState('saving');
            try {
                await ToolDB.save(userId, {
                    value_proposition:    data.valueProposition,
                    brainstorm_activities: data.activities.filter(a => a.name.trim()),
                    core_activities:      data.coreActivities,
                });
                await ToolDB.markComplete(userId);
                setSubmitState('success');
            } catch (err) {
                console.error('[CoreActivities] Submit error:', err);
                setSubmitState('error');
                setAiMessage('Submission failed. Please try again.');
            }
        };

        const isWizardStep = Number.isInteger(step) && step >= 1 && step <= totalSteps;
        const isTransition = (step === 1.5 || step === 2.5 || step === 3.5);

        // â”€â”€ Render â”€â”€
        return (
            <div className="tool-frame">
                {authState.loading && (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 12, color: '#555', letterSpacing: '0.1em', textTransform: 'uppercase' }}>Loadingâ€¦</div>
                    </div>
                )}

                {!authState.loading && !authState.authenticated && (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ textAlign: 'center', color: '#fff', padding: '0 32px', maxWidth: 640 }}>
                            <h1 className="plaak" style={{ fontSize: 48, marginBottom: 24 }}>AUTHENTICATION REQUIRED</h1>
                            <p style={{ fontSize: 20, marginBottom: 32 }}>Please access this tool from your LearnWorlds course.</p>
                            <p style={{ fontSize: 16, color: '#999' }}>{authState.error || 'No active session found'}</p>
                        </div>
                    </div>
                )}

                {step === 0 && authState.authenticated && (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative', overflow: 'hidden' }}>
                        <div style={{ position: 'absolute', inset: 0, backgroundImage: `url(${CONFIG.COVER_IMAGE})`, backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.4 }} />
                        <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                            <div style={{ fontFamily: "'Monument', monospace", fontSize: 12, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 24 }}>
                                SPRINT 22 / MODULE 6 â€” ORG STRUCTURE
                            </div>
                            <h1 className="plaak" style={{ fontSize: 80, marginBottom: 16 }}>{CONFIG.TOOL_TITLE}</h1>
                            <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48, maxWidth: 560, margin: '0 auto 48px' }}>{CONFIG.TOOL_SUBTITLE}</p>
                            <button onClick={() => setStep(0.5)}
                                style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s' }}
                                onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                onMouseOut={e => { e.target.style.background = '#fff'; }}>
                                START
                            </button>
                        </div>
                    </div>
                )}

                {step === 0.5 && authState.authenticated && (
                    <IntroPage onNext={() => setStep(1)} />
                )}

                {isTransition && (
                    <TransitionScreen stepNum={Math.floor(step)} onNext={handleTransitionNext} />
                )}

                {(isWizardStep || step === 'canvas') && (
                    <div className="tool-inner">
                        <div className="wizard-layout">
                            <div className="wizard-main">
                                <MobileStepBar currentStep={typeof step === 'number' ? step : totalSteps + 1} totalSteps={totalSteps} />
                                <div style={{ flex: 1 }}>
                                    {step === 1 && <Step1 data={data} updateData={updateData} deps={deps} aiMessage={aiMessage} />}
                                    {step === 2 && <Step2 data={data} updateData={updateData} aiMessage={aiMessage} />}
                                    {step === 3 && <Step3 data={data} updateData={updateData} aiMessage={aiMessage} />}
                                    {step === 'canvas' && <CanvasStep data={data} onSubmit={handleSubmit} submitState={submitState} aiMessage={aiMessage} />}
                                </div>
                                {submitState !== 'success' && (
                                    <div className="wizard-footer">
                                        <button className="btn-wiz-back" onClick={handleBack}>â† BACK</button>
                                        {step !== 'canvas' && (
                                            <button className="btn-wiz-next" onClick={handleNext} disabled={aiReviewing}>
                                                {aiReviewing ? 'REVIEWINGâ€¦' : 'NEXT â†’'}
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>
                            <WizardSidebar
                                currentStep={step}
                                data={data}
                                onNavigate={s => { setStep(s); setAiMessage(''); }}
                            />
                        </div>
                    </div>
                )}
            </div>
        );
    }

        ReactDOM.render(<CoreActivitiesApp />, document.getElementById('root'));
    </script>
</body>
</html>
