<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Values Tool | Fast Track</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

    <!-- Font preloading to prevent FOUT -->
    <link rel="preload" href="Plaak3Trial-43-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="RiformaLL-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="MonumentGrotesk-Mono.woff2" as="font" type="font/woff2" crossorigin>

    <style>
        /* === FONT FACES === */
        @font-face { font-family: 'Plaak'; src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: normal; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: 600; font-display: swap; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); font-display: swap; }

        /* === BASE RESET === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Riforma', -apple-system, sans-serif;
            font-size: 16px;
            color: #000;
            background: #000;
            -webkit-font-smoothing: antialiased;
        }

        /* === CUSTOM SCROLLBAR === */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }
        * { scrollbar-width: thin; scrollbar-color: #000 transparent; }

        /* === TYPOGRAPHY HELPERS === */
        .plaak { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }

        /* === LAYOUT FRAME === */
        .tool-frame { background: #fff; min-height: 100vh; }
        .tool-inner { background: #fff; min-height: 100vh; }

        /* === WIZARD LAYOUT === */
        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: #fff;
        }
        .wizard-content {
            max-width: 640px;
            width: 100%;
            margin: 0 auto;
            padding: 48px 32px;
            flex: 1;
        }

        /* === SIDEBAR === */
        .wizard-sidebar {
            width: 280px;
            background: #000;
            border-left: 1px solid #000;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow: hidden;
        }
        .wizard-sidebar-inner {
            padding: 32px 24px;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .sidebar-step-item {
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }
        .sidebar-step-item.active { border-left-color: #FFF469; background: #222; }
        .sidebar-step-item.completed { background: #fff; color: #000; border-left-color: #fff; cursor: pointer; }
        .sidebar-step-item.completed:hover { background: #E0E0E0; }
        .sidebar-step-item.locked { opacity: 0.5; }
        .sidebar-step-item .step-num { font-family: 'Riforma', sans-serif; font-size: 14px; }
        .sidebar-step-item .step-name { font-family: 'Riforma', sans-serif; font-size: 14px; }
        .sidebar-snippet { font-size: 12px; margin-top: 4px; opacity: 0.7; line-height: 1.3; }

        /* === STEP HEADER === */
        .step-indicator {
            font-family: 'Monument', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6B7280;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .step-time {
            font-family: 'Monument', monospace;
            font-size: 11px;
            color: #6B7280;
        }
        .step-heading {
            font-family: 'Plaak', sans-serif;
            font-weight: bold;
            font-size: 32px;
            text-transform: uppercase;
            letter-spacing: -0.01em;
            line-height: 1.2;
            color: #000;
            margin-bottom: 6px;
        }
        .step-hint {
            font-size: 16px;
            color: #6B7280;
            line-height: 1.5;
            margin: 0 0 32px 0;
        }

        /* === FORM ELEMENTS === */
        .ft-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'Monument', monospace;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #000;
            margin-bottom: 8px;
        }
        .ft-required { color: #DC2626; font-weight: 700; }

        .ft-input {
            width: 100%;
            height: 44px;
            padding: 8px 16px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            color: #000;
            background: #fff;
            border: 1px solid #E5E7EB;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .ft-input:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px #FFF469;
        }
        .ft-input.has-error {
            border: 2px solid #DC2626;
            padding-right: 40px;
        }
        .ft-input.has-error:focus {
            border-color: #DC2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
        }

        .ft-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px 16px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            color: #000;
            background: #fff;
            border: 1px solid #E5E7EB;
            resize: none !important;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .ft-textarea:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px #FFF469;
        }
        .ft-textarea.has-error {
            border: 2px solid #DC2626;
        }
        .ft-textarea.has-error:focus {
            border-color: #DC2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
        }

        .ft-help {
            font-size: 14px;
            color: #6B7280;
            margin-top: 4px;
            line-height: 1.5;
        }
        .ft-error-msg {
            font-size: 14px;
            font-weight: 600;
            color: #DC2626;
            margin-top: 4px;
            line-height: 1.4;
        }
        .ft-field-group {
            margin-bottom: 24px;
        }
        .ft-field-group:last-child { margin-bottom: 0; }
        .ft-section { margin-bottom: 32px; }

        /* === YELLOW INSIGHT BOX === */
        .ft-insight {
            background: #FFF469;
            border: 3px solid #000;
            padding: 16px;
            margin-bottom: 32px;
        }

        /* === EXAMPLE BOX === */
        .ft-example {
            background: #F3F4F6;
            padding: 16px;
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.6;
            color: #1F2937;
        }

        /* === ERROR SUMMARY === */
        .ft-error-summary {
            border: 2px solid #DC2626;
            background: #fff;
            padding: 16px;
            margin-bottom: 24px;
        }
        .ft-error-summary a {
            color: #DC2626;
            text-decoration: underline;
            cursor: pointer;
        }
        .ft-error-summary a:hover { text-decoration: none; }

        /* === BUTTON FOOTER === */
        .btn-footer {
            position: sticky;
            bottom: 0;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            border-top: 1px solid #E5E7EB;
            background: #fff;
            width: 100%;
        }
        .btn-back {
            background: #fff;
            color: #000;
            border: 2px solid #000;
            padding: 12px 24px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
        }
        .btn-back:hover { background: #F3F4F6; }
        .btn-next {
            background: #000;
            color: #fff;
            border: 2px solid #000;
            padding: 12px 24px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
        }
        .btn-next:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-next:disabled { background: #E5E7EB; color: #9CA3AF; border-color: #E5E7EB; cursor: not-allowed; }

        /* === CLOSING MESSAGE === */
        .closing-box {
            border-top: 1px solid #E5E7EB;
            padding: 20px 0 0 0;
            margin-top: 8px;
            text-align: center;
        }
        .closing-box p { font-size: 14px; color: #6B7280; }
        .closing-box .closing-title {
            font-family: 'Monument', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #000;
            margin-bottom: 6px;
        }

        /* === MOBILE STEP BAR === */
        .mobile-step-bar { display: none; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; background: #F3F4F6; }
        .mobile-step-bar .bar-text { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 6px; }
        .mobile-progress { height: 3px; background: #E5E7EB; width: 100%; }
        .mobile-progress-fill { height: 100%; background: #000; transition: width 0.3s ease; }

        /* === CANVAS STYLES === */
        .numbered-section { background: #000; color: #fff; padding: 8px 14px; font-size: 14px; font-weight: bold; letter-spacing: 0.5px; display: inline-block; font-family: 'Monument', monospace; }
        .canvas-section-box { border: 2px solid #000; background: #FAFAFA; padding: 16px; margin-bottom: 16px; }

        /* === ANIMATIONS === */
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-in { animation: fadeSlideIn 0.3s ease-out; }

        /* === PRINT === */
        @media print { .no-print { display: none !important; } }

        /* === RESPONSIVE === */
        @media (min-width: 769px) and (max-width: 1024px) {
            .wizard-sidebar { width: 220px; }
            .wizard-sidebar-inner { padding: 24px 16px; }
        }
        @media (max-width: 768px) {
            .wizard-sidebar { display: none; }
            .mobile-step-bar { display: block; }
            .wizard-content { padding: 24px 16px; }
            .step-heading { font-size: 24px; }
            .btn-footer { padding: 12px 16px; }
        }
        @media (max-width: 480px) {
            .step-heading { font-size: 20px; }
            .wizard-content { padding: 20px 12px; }
        }

        /* === TOOL-SPECIFIC: dependency injected highlight === */
        .dependency-injected {
            border-left: 3px solid #FFF469 !important;
            background-color: #fffde6 !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CONFIG = {
            SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
            TOOL_SLUG: 'values',
            AUTOSAVE_DELAY: 2000,
            STORAGE_KEY: 'fasttrack_company_values',
            TOOL_NAME: 'company_values_tool'
        };

        // Initialize Supabase client
        const { createClient } = supabase;
        const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

        // Make Supabase client globally available for dependency injection
        window.supabaseClient = supabaseClient;

        // Initialize ToolDB (dependency loading handled in React useEffect)
        ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        CognitiveLoad.init('values', {"insights":["Values are not aspirational - they describe who you actually are.","Fast Track way: 3-5 values maximum. More than 5 means you have not made hard choices."],"caseStudy":{"before":"A mid-size tech firm had 12 generic values like 'Integrity' and 'Innovation' on the wall, but employees couldn't name a single one. Decisions were made arbitrarily and new hires got no cultural guidance.","after":"After using the Core Values Identification Tool, they distilled to 3 sharp, behavior-driven values with clear 'Cool' and 'Not Cool' lists. These drove hiring, firing, promotion decisions, and weekly team check-ins.","quote":"Our values stopped being a poster and became our operating system — now every hire, every conflict, and every promotion runs through them."}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

        /* ============================================================
           TRANSITION CONTENT — VP-style screens between steps
           ============================================================ */
        const TRANSITION_CONTENT = {
            1: {
                title: 'VALUES IDENTIFIED.',
                text: "You've surfaced the behaviors that define your culture. Now let's see if they match your Dream.",
                brutalTruth: "Most companies list aspirational values they don't actually live. You started with observed behaviors first — that's the Fast Track way. Values extracted from real behavior are 3x more likely to be lived daily than top-down brainstormed lists.",
                peerProof: "Deloitte research shows values-driven companies experience 30% higher innovation rates and 40% higher employee retention. The key differentiator? Values derived from actual behaviors, not boardroom aspirations."
            },
            3: {
                title: 'BEHAVIORS DEFINED.',
                text: "Your values now have teeth — specific 'Cool' and 'Not Cool' behaviors everyone can observe.",
                brutalTruth: "A value without a behavior is just a word on a wall. Steven Bartlett's principle: values are the specific behaviors that accompany them. Your Cool/Not Cool lists are now the operating manual for your culture.",
                peerProof: "A meta-analysis of 200+ organizations found that defining values as explicit behavioral pairs increases cultural consistency by 35%. Written behavioral commitments create psychological accountability that abstract principles cannot."
            },
            4: {
                title: 'BOUNDARIES SET.',
                text: "Yellow and red lines drawn. Now create questions to protect your culture in hiring.",
                brutalTruth: "Red lines are your company's immune system. Without explicit boundaries, values erode through a thousand small compromises. Organizations with clear behavioral boundaries experience 60% fewer culture-related conflicts.",
                peerProof: "BCG longitudinal studies demonstrate that when consequences are defined in advance, enforcement becomes fair and consistent rather than reactive and political. Your red lines will save you from hiring mistakes that cost 3-5x annual salary."
            },
            5: {
                title: 'HIRING PROTECTED.',
                text: "Your recruitment questions will filter for values alignment. Now plan the rollout.",
                brutalTruth: "A highly skilled candidate who doesn't align with your values will disrupt the culture and cost you more than an empty seat. These questions test how candidates actually behave — not just what they say they believe.",
                peerProof: "Bain research confirms that companies using values-based interview techniques reduce mis-hires by 40% and see significantly faster cultural integration. You've built questions that reveal behavioral truth."
            },
            6: {
                title: 'SYSTEM COMPLETE.',
                text: "Your values system is built — from identification through behaviors, boundaries, and rollout.",
                brutalTruth: "Values are only real when they're reinforced daily. Your communication plan ensures values don't become another forgotten poster. The companies that win are the ones that talk about values in every meeting, every review, every decision.",
                peerProof: "Research shows that organizations with active values communication programs maintain 60% higher cultural alignment scores. Your plan creates the daily reinforcement that turns words into DNA."
            }
        };

        /* ============================================================
           SHARED COMPONENTS
           ============================================================ */

        function CheckIcon({ color = "#fff", size = 16 }) {
            return <svg width={size} height={size} viewBox="0 0 24 24" fill={color}><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>;
        }

        function ButtonFooter({ onBack, onNext, nextLabel = 'Next', showBack = true, disabled = false }) {
            return (
                <div className="btn-footer no-print">
                    {showBack ? <button className="btn-back" onClick={onBack}>&larr; Back</button> : <div />}
                    <button className="btn-next" disabled={disabled} onClick={onNext}>{nextLabel} &rarr;</button>
                </div>
            );
        }

        function MobileStepBar({ currentStep, totalSteps }) {
            const total = totalSteps || 6;
            const progress = currentStep >= 999 ? 100 : Math.round((currentStep / total) * 100);
            return (
                <div className="mobile-step-bar no-print">
                    <div className="bar-text">Step {Math.min(currentStep, total)} of {total}</div>
                    <div className="mobile-progress"><div className="mobile-progress-fill" style={{ width: `${progress}%` }} /></div>
                </div>
            );
        }

        function CoachFeedbackPanel() {
            const [expanded, setExpanded] = useState(false);
            const [feedback, setFeedback] = useState(null);

            useEffect(() => {
                const check = () => {
                    if (window.AIChallenge && window.AIChallenge.getLastFeedback) {
                        setFeedback(window.AIChallenge.getLastFeedback());
                    }
                };
                check();
                const interval = setInterval(check, 2000);
                return () => clearInterval(interval);
            }, []);

            if (!feedback) return null;

            return (
                <div style={{ marginTop: 24, borderTop: '1px solid #333', paddingTop: 16 }}>
                    <button
                        onClick={() => setExpanded(!expanded)}
                        style={{ background: 'none', border: 'none', color: '#FFF469', cursor: 'pointer', fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', display: 'flex', alignItems: 'center', gap: 6, padding: 0, width: '100%' }}
                    >
                        <span style={{ transform: expanded ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block' }}>&#9654;</span>
                        COACH FEEDBACK
                    </button>
                    {expanded && (
                        <div style={{ marginTop: 10, fontSize: 12, color: '#ccc', lineHeight: 1.5 }}>
                            {feedback.type === 'approved' && (
                                <p style={{ color: '#FFF469' }}>{feedback.message}</p>
                            )}
                            {feedback.type === 'challenges' && (
                                <>
                                    {feedback.encouragement && <p style={{ color: '#FFF469', marginBottom: 8 }}>{feedback.encouragement}</p>}
                                    {feedback.challenges && feedback.challenges.map((ch, i) => (
                                        <div key={i} style={{ marginBottom: 8, paddingLeft: 8, borderLeft: '2px solid #555' }}>
                                            <div style={{ fontSize: 10, color: '#999', marginBottom: 2 }}>{ch.question_text || ch.question_key}</div>
                                            <div>{ch.feedback}</div>
                                        </div>
                                    ))}
                                </>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        function WizardSidebar({ currentStep, formData, onNavigate }) {
            const steps = [
                { num: 1, label: 'Company Values', time: '~15 min', phase: 'individual' },
                { num: 2, label: 'Values Gap', time: '~10 min', phase: 'individual' },
                { num: 3, label: 'Behaviors', time: '~10 min', phase: 'team' },
                { num: 4, label: 'Red Lines', time: '~5 min', phase: 'team' },
                { num: 5, label: 'Recruitment', time: '~5 min', phase: 'team' },
                { num: 6, label: 'Comm Plan', time: '~5 min', phase: 'team' }
            ];

            const getSnippet = (n) => {
                if (n === 1 && formData.top5Values[0]) { const f = formData.top5Values.filter(v => v.trim()); return f.length + ' value' + (f.length !== 1 ? 's' : '') + ' defined'; }
                if (n === 2 && formData.gap) return '"' + formData.gap.substring(0, 50) + (formData.gap.length > 50 ? '...' : '') + '"';
                if (n === 3 && formData.valuesBehaviors[0].value) { const f = formData.valuesBehaviors.filter(v => v.value.trim()); return f.length + ' behavior pair' + (f.length !== 1 ? 's' : ''); }
                if (n === 4) { const y = formData.yellowLines.filter(l => l.trim()); const r = formData.redLines.filter(l => l.trim()); if (y.length || r.length) return y.length + ' yellow, ' + r.length + ' red'; }
                if (n === 5 && formData.recruitmentQuestions[0]) { const f = formData.recruitmentQuestions.filter(q => q.trim()); return f.length + ' question' + (f.length !== 1 ? 's' : ''); }
                if (n === 6 && formData.commPlan[0].idea) { const f = formData.commPlan.filter(p => p.idea.trim()); return f.length + ' action' + (f.length !== 1 ? 's' : '') + ' planned'; }
                return null;
            };

            let lastPhase = null;

            return (
                <div className="wizard-sidebar no-print">
                    <div className="wizard-sidebar-inner">
                        <div style={{ marginBottom: 24 }}>
                            <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', color: '#fff', marginBottom: 4 }}>COMPANY VALUES</div>
                            <div style={{ fontSize: 13, color: '#999' }}>~50 min total</div>
                        </div>
                        <div style={{ marginBottom: 16, fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', color: '#999' }}>Your journey</div>
                        {steps.map(s => {
                            const effectiveStep = Math.ceil(currentStep);
                            const isCompleted = effectiveStep > s.num, isActive = effectiveStep === s.num, isLocked = effectiveStep < s.num;
                            const snippet = isCompleted ? getSnippet(s.num) : null;
                            const showPhaseHeader = s.phase !== lastPhase;
                            lastPhase = s.phase;
                            return (
                                <React.Fragment key={s.num}>
                                    {showPhaseHeader && (
                                        <div style={{ marginTop: s.num === 1 ? 0 : 16, marginBottom: 8, fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.1em', color: '#FFF469' }}>
                                            {s.phase === 'individual' ? 'INDIVIDUAL PHASE' : 'TEAM PHASE'}
                                        </div>
                                    )}
                                    <div className={`sidebar-step-item ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''} ${isLocked ? 'locked' : ''}`}
                                        onClick={() => isCompleted && onNavigate && onNavigate(s.num)}
                                        title={isCompleted ? 'Click to review this step' : ''}
                                    >
                                        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                            {isCompleted ? <CheckIcon color="#000" size={14} /> : <span className="step-num" style={{ color: isActive ? '#fff' : '#ccc' }}>{String(s.num).padStart(2, '0')}</span>}
                                            <span className="step-name" style={{ color: isLocked ? '#666' : isCompleted ? '#000' : '#fff' }}>{s.label}</span>
                                        </div>
                                        {snippet && <div className="sidebar-snippet">{snippet}</div>}
                                    </div>
                                </React.Fragment>
                            );
                        })}

                        <CoachFeedbackPanel />
                    </div>
                </div>
            );
        }

        function DependencyContext({ deps }) {
            if (!deps || deps.length === 0) return null;
            return (
                <div style={{ marginBottom: '24px' }}>
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: '11px', textTransform: 'uppercase', letterSpacing: '0.05em', color: '#666', marginBottom: '8px' }}>
                        CONTEXT FROM PREVIOUS TOOLS
                    </div>
                    {deps.map((dep, i) => (
                        <div key={i} style={{ background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '12px 16px', marginBottom: '8px', fontSize: '14px' }}>
                            <div style={{ fontWeight: 600, marginBottom: '4px', color: '#333' }}>{dep.label}</div>
                            <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                        </div>
                    ))}
                </div>
            );
        }

        const ValuesTool = () => {
            const [step, setStep] = useState(0);
            const [userEmail, setUserEmail] = useState('');
            const [aiReviewing, setAiReviewing] = useState(false);
            const [formData, setFormData] = useState({
                // Section 1: Company Values
                behaviors: Array(10).fill(''),
                top5Values: Array(5).fill(''),
                
                // Section 2: Values Gap
                dream: '',
                requiredValues: '',
                gap: '',
                
                // Section 3: Values into Behaviors
                valuesBehaviors: Array(5).fill(null).map(() => ({ 
                    value: '', 
                    cool: '', 
                    notCool: '' 
                })),
                
                // Section 4: Red Lines
                yellowLines: Array(5).fill(''),
                redLines: Array(5).fill(''),
                
                // Section 5: Recruitment Questions
                recruitmentQuestions: Array(5).fill(''),
                
                // Section 6: Communication Plan
                commPlan: Array(5).fill(null).map(() => ({ 
                    idea: '', 
                    who: '', 
                    when: '' 
                }))
            });

            const [dreamLoaded, setDreamLoaded] = useState(false);

            // Load dream dependency from Dream tool on mount
            useEffect(() => {
                async function loadDreamDependency() {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId || !window.ToolDB) return;
                    try {
                        await ToolDB.whenReady();
                        const dreamValue = await ToolDB.getDependency(userId, 'identity.dream.one_sentence');
                        if (dreamValue) {
                            setFormData(prev => ({ ...prev, dream: String(dreamValue) }));
                            setDreamLoaded(true);
                            console.log('[Values] Loaded dream dependency:', dreamValue);
                        }
                    } catch (err) {
                        console.warn('[Values] Failed to load dream dependency:', err);
                    }
                }
                loadDreamDependency();
            }, []);

            // Auto-save
            useEffect(() => {
                const userId = localStorage.getItem('ft_user_id');
                const timer = setTimeout(() => {
                    if (userId) {
                        localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify({
                            formData, step, lastSaved: new Date().toISOString()
                        }));
                    }
                }, 2000);
                return () => clearTimeout(timer);
            }, [formData, step]);

            const updateField = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            const updateArrayField = (field, index, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: prev[field].map((item, i) => i === index ? value : item)
                }));
            };

            const updateObjectField = (field, index, key, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: prev[field].map((item, i) => 
                        i === index ? { ...item, [key]: value } : item
                    )
                }));
            };

            // Validation functions
            const validateStep1 = () => {
                const filledBehaviors = formData.behaviors.filter(b => b.trim().length >= 50);
                const filledValues = formData.top5Values.filter(v => v.trim().length >= 2);
                return filledBehaviors.length >= 3 && filledValues.length >= 3;
            };

            const validateStep2 = () => {
                return formData.dream.trim().length >= 50 &&
                       formData.requiredValues.trim().length >= 50 &&
                       formData.gap.trim().length >= 50;
            };

            const validateStep3 = () => {
                const validValues = formData.valuesBehaviors.filter(v => 
                    v.value.trim().length >= 2 &&
                    v.cool.trim().length >= 50 &&
                    v.notCool.trim().length >= 50
                );
                return validValues.length >= 3;
            };

            const validateStep4 = () => {
                const validYellow = formData.yellowLines.filter(l => l.trim().length >= 30);
                const validRed = formData.redLines.filter(l => l.trim().length >= 30);
                return validYellow.length >= 2 && validRed.length >= 2;
            };

            const validateStep5 = () => {
                const validQuestions = formData.recruitmentQuestions.filter(q => q.trim().length >= 50);
                return validQuestions.length >= 3;
            };

            const validateStep6 = () => {
                const validPlans = formData.commPlan.filter(p => 
                    p.idea.trim().length >= 30 &&
                    p.who.trim().length >= 2 &&
                    p.when.trim().length >= 2
                );
                return validPlans.length >= 3;
            };

            // AI-gated step navigation
            const handleStepNext = async (nextStepValue, stepAnswers, stepName) => {
                const userId = localStorage.getItem('ft_user_id');
                if (!userId) {
                    setStep(nextStepValue);
                    return;
                }
                setAiReviewing(true);
                try {
                    const canGo = await window.AIChallenge.reviewStep(userId, 'values', stepAnswers, stepName);
                    if (canGo) {
                        setStep(nextStepValue);
                    }
                } catch (err) {
                    console.warn('AI review error, allowing passage:', err);
                    setStep(nextStepValue);
                } finally {
                    setAiReviewing(false);
                }
            };

            const [submitStatus, setSubmitStatus] = useState(null);
            const [submitMessage, setSubmitMessage] = useState('');

            const handleSubmit = async () => {
                try {
                    // Get user ID from localStorage
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId) {
                        alert('User not authenticated. Please return to the dashboard.');
                        return;
                    }

                    const questionMappings = {
                        core_values_list: formData.top5Values,
                        cool_not_cool: formData.valuesBehaviors,
                        red_lines: { yellowLines: formData.yellowLines, redLines: formData.redLines },
                        recruitment_questions: formData.recruitmentQuestions,
                        rollout_plan: formData.commPlan
                    };

                    await window.AIChallenge.submitWithChallenge(userId, 'values', questionMappings, {
                        onReviewStart: () => { setSubmitMessage('AI coach is reviewing...'); },
                        onRevise: () => { setSubmitStatus(null); setSubmitMessage(''); },
                        onSubmitAnyway: () => { setSubmitStatus('success'); setSubmitMessage('Submitted successfully! Your values system has been saved.'); },
                        onError: (err) => { setSubmitStatus('error'); setSubmitMessage('Failed to save: ' + err.message); }
                    });

                } catch (error) {
                    console.error('Submit error:', error);
                    setSubmitStatus('error');
                    setSubmitMessage('Submit failed: ' + error.message);
                }
            };

            // Submit individual phase answers (steps 1-2) so guru can see them early
            const submitIndividualPhase = async () => {
                try {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId) return;

                    const individualAnswers = {
                        behaviors: formData.behaviors.filter(b => b.trim()),
                        top_5_values: formData.top5Values.filter(v => v.trim()),
                        dream_connection: formData.dream,
                        required_values: formData.requiredValues,
                        values_gap: formData.gap
                    };

                    await window.AIChallenge.submitWithChallenge(userId, 'values-individual', individualAnswers, {
                        onReviewStart: () => {},
                        onRevise: () => {},
                        onSubmitAnyway: () => { console.log('[Values] Individual phase submitted'); },
                        onError: (err) => { console.warn('[Values] Individual submit error:', err); }
                    });
                } catch (err) {
                    console.warn('[Values] Failed to submit individual phase:', err);
                }
            };

            const clearCache = () => {
                localStorage.removeItem(CONFIG.STORAGE_KEY);
                window.location.reload();
            };

            // COVER PAGE (step 0)
            if (step === 0) {
                return (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative', overflow: 'hidden' }}>
                        <div style={{ position: 'absolute', inset: 0, backgroundImage: 'url("https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=1920&q=80")', backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.3 }} />
                        <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                            <div className="monument" style={{ fontSize: 13, color: '#FFF469', letterSpacing: '0.15em', marginBottom: 16 }}>TOOL 03</div>
                            <div style={{ display: 'flex', gap: 8, justifyContent: 'center', marginBottom: 24 }}>
                                <div style={{ display: 'inline-block', border: '1px solid #FFF469', padding: '6px 16px' }}>
                                    <span className="monument" style={{ fontSize: 11, color: '#FFF469', letterSpacing: '0.15em', textTransform: 'uppercase' }}>INDIVIDUAL + TEAM TOOL</span>
                                </div>
                            </div>
                            <h1 className="plaak" style={{ fontSize: 80, marginBottom: 16, textTransform: 'uppercase' }}>COMPANY VALUES</h1>
                            <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48 }}>Transform your values from words into daily behaviors</p>
                            <button onClick={() => setStep(0.5)}
                                style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease', minHeight: 44 }}
                                onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                onMouseOut={e => { e.target.style.background = '#fff'; }}
                            >START</button>
                            <div style={{ marginTop: 24 }}>
                                <button onClick={clearCache}
                                    style={{ background: 'none', border: 'none', color: '#666', cursor: 'pointer', fontSize: 13, textDecoration: 'underline' }}
                                >Clear Saved Data</button>
                            </div>
                        </div>
                    </div>
                );
            }

            // INTRO PAGE (step 0.5) — Explain two phases
            if (step === 0.5) {
                return (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ maxWidth: 640, padding: '0 32px', textAlign: 'center', color: '#fff' }} className="animate-in">
                            <div className="monument" style={{ fontSize: 12, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 24 }}>HOW THIS TOOL WORKS</div>
                            <h1 className="plaak" style={{ fontSize: 40, marginBottom: 16 }}>TWO-PHASE JOURNEY</h1>
                            <p style={{ fontSize: 16, color: '#ccc', marginBottom: 40, lineHeight: 1.7 }}>
                                This tool is completed in two phases: first on your own, then together with your team.
                            </p>

                            {/* Phase 1 */}
                            <div style={{ background: '#111', border: '1px solid #333', padding: '24px', marginBottom: 16, textAlign: 'left' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 12 }}>
                                    <span className="monument" style={{ fontSize: 11, color: '#FFF469', letterSpacing: '0.1em' }}>PHASE 1: INDIVIDUAL</span>
                                    <span style={{ fontSize: 12, color: '#666' }}>Steps 1-2</span>
                                </div>
                                <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>
                                    Complete on your own before the team meeting. Reflect on what behaviors matter most and identify value gaps.
                                </p>
                            </div>

                            {/* Phase 2 */}
                            <div style={{ background: '#111', border: '1px solid #333', padding: '24px', marginBottom: 24, textAlign: 'left' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 12 }}>
                                    <span className="monument" style={{ fontSize: 11, color: '#FFF469', letterSpacing: '0.1em' }}>PHASE 2: TEAM</span>
                                    <span style={{ fontSize: 12, color: '#666' }}>Steps 3-6</span>
                                </div>
                                <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>
                                    Done together during the guru-led meeting. Your guru will review everyone's individual answers, then lead the team through defining behaviors, red lines, recruitment questions, and communication plans.
                                </p>
                            </div>

                            <div style={{ background: '#1a1a00', border: '1px solid #FFF469', padding: '16px 20px', marginBottom: 40, textAlign: 'left' }}>
                                <p style={{ fontSize: 13, color: '#FFF469', lineHeight: 1.6 }}>
                                    Your guru will see your full individual answers to prepare for the meeting.
                                </p>
                            </div>

                            {/* Journey overview */}
                            <div style={{ marginBottom: 40, textAlign: 'left' }}>
                                <div className="monument" style={{ fontSize: 10, color: '#666', letterSpacing: '0.1em', marginBottom: 16 }}>JOURNEY OVERVIEW</div>

                                <div className="monument" style={{ fontSize: 10, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 8 }}>INDIVIDUAL</div>
                                <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                                    <div style={{ flex: 1, background: '#111', border: '1px solid #333', padding: '12px', textAlign: 'center' }}>
                                        <div className="monument" style={{ fontSize: 10, color: '#FFF469', marginBottom: 4 }}>01</div>
                                        <div style={{ fontSize: 12, color: '#ccc' }}>Company Values</div>
                                    </div>
                                    <div style={{ flex: 1, background: '#111', border: '1px solid #333', padding: '12px', textAlign: 'center' }}>
                                        <div className="monument" style={{ fontSize: 10, color: '#FFF469', marginBottom: 4 }}>02</div>
                                        <div style={{ fontSize: 12, color: '#ccc' }}>Values Gap</div>
                                    </div>
                                </div>

                                <div className="monument" style={{ fontSize: 10, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 8 }}>TEAM</div>
                                <div style={{ display: 'flex', gap: 8 }}>
                                    <div style={{ flex: 1, background: '#111', border: '1px solid #333', padding: '12px', textAlign: 'center' }}>
                                        <div className="monument" style={{ fontSize: 10, color: '#666', marginBottom: 4 }}>03</div>
                                        <div style={{ fontSize: 12, color: '#666' }}>Behaviors</div>
                                    </div>
                                    <div style={{ flex: 1, background: '#111', border: '1px solid #333', padding: '12px', textAlign: 'center' }}>
                                        <div className="monument" style={{ fontSize: 10, color: '#666', marginBottom: 4 }}>04</div>
                                        <div style={{ fontSize: 12, color: '#666' }}>Red Lines</div>
                                    </div>
                                    <div style={{ flex: 1, background: '#111', border: '1px solid #333', padding: '12px', textAlign: 'center' }}>
                                        <div className="monument" style={{ fontSize: 10, color: '#666', marginBottom: 4 }}>05</div>
                                        <div style={{ fontSize: 12, color: '#666' }}>Recruitment</div>
                                    </div>
                                    <div style={{ flex: 1, background: '#111', border: '1px solid #333', padding: '12px', textAlign: 'center' }}>
                                        <div className="monument" style={{ fontSize: 10, color: '#666', marginBottom: 4 }}>06</div>
                                        <div style={{ fontSize: 12, color: '#666' }}>Comm Plan</div>
                                    </div>
                                </div>
                            </div>

                            <button
                                onClick={() => setStep(1)}
                                style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }}
                                onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                onMouseOut={e => { e.target.style.background = '#fff'; }}
                            >BEGIN</button>
                        </div>
                    </div>
                );
            }

            // PHASE GATE (step 2.5) — Individual Phase Complete
            if (step === 2.5) {
                return (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ maxWidth: 640, padding: '0 32px', textAlign: 'center', color: '#fff' }} className="animate-in">
                            <div style={{ width: 64, height: 64, borderRadius: '50%', border: '2px solid #FFF469', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 24px' }}>
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="#FFF469"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                            </div>
                            <div className="monument" style={{ fontSize: 12, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 16 }}>STEP 2 OF 2 COMPLETE</div>
                            <h1 className="plaak" style={{ fontSize: 44, marginBottom: 16 }}>INDIVIDUAL PHASE COMPLETE</h1>
                            <p style={{ fontSize: 16, color: '#ccc', marginBottom: 16, lineHeight: 1.7 }}>
                                Your answers have been submitted. Your guru can now see your reflections.
                            </p>
                            <p style={{ fontSize: 14, color: '#999', marginBottom: 48, lineHeight: 1.7 }}>
                                The Team Phase (Steps 3-6) will be completed together during your guru-led meeting.
                            </p>

                            <div style={{ display: 'flex', gap: 16, justifyContent: 'center', flexWrap: 'wrap' }}>
                                <button
                                    onClick={() => setStep(1)}
                                    style={{ background: 'transparent', color: '#fff', border: '2px solid #fff', padding: '16px 32px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }}
                                    onMouseOver={e => { e.target.style.background = '#222'; }}
                                    onMouseOut={e => { e.target.style.background = 'transparent'; }}
                                >REVIEW MY ANSWERS</button>
                                <button
                                    onClick={() => setStep(3)}
                                    style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 32px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }}
                                    onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                    onMouseOut={e => { e.target.style.background = '#fff'; }}
                                >Continue to Team Phase</button>
                            </div>
                        </div>
                    </div>
                );
            }

            // TRANSITION SCREENS (step X.5) — excludes 2.5 (phase gate) and 0.5 (intro)
            if ([1.5, 3.5, 4.5, 5.5, 6.5].includes(step)) {
                const completedStep = Math.floor(step);
                const nextStep = completedStep + 1;
                const t = TRANSITION_CONTENT[completedStep];
                return (
                    <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ maxWidth: 640, padding: '0 32px', textAlign: 'center', color: '#fff' }} className="animate-in">
                            <div className="monument" style={{ fontSize: 12, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 16 }}>
                                STEP {completedStep} OF 6 COMPLETE
                            </div>
                            <h1 className="plaak" style={{ fontSize: 48, marginBottom: 12 }}>{t.title}</h1>
                            <p style={{ fontSize: 16, color: '#ccc', marginBottom: 48 }}>{t.text}</p>

                            <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #FFF469', padding: '20px 24px', marginBottom: 24, textAlign: 'left' }}>
                                <span className="monument" style={{ fontSize: 10, color: '#FFF469', display: 'block', marginBottom: 8 }}>BRUTAL TRUTH</span>
                                <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>{t.brutalTruth}</p>
                            </div>

                            <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #666', padding: '20px 24px', marginBottom: 48, textAlign: 'left' }}>
                                <span className="monument" style={{ fontSize: 10, color: '#999', display: 'block', marginBottom: 8 }}>PEER PROOF</span>
                                <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic' }}>{t.peerProof}</p>
                            </div>

                            <button
                                onClick={() => setStep(nextStep <= 6 ? nextStep : 7)}
                                style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }}
                                onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                onMouseOut={e => { e.target.style.background = '#fff'; }}
                            >
                                {nextStep <= 6 ? `CONTINUE TO STEP ${nextStep}` : 'VIEW RESULTS'}
                            </button>
                        </div>
                    </div>
                );
            }

            // WIZARD STEPS 1-6
            if (step >= 1 && step <= 6) {
                return (
                    <div className="wizard-layout">
                        <div className="wizard-main">
                            <MobileStepBar currentStep={step} totalSteps={6} />

                            <div className="wizard-content animate-in">
                                {step === 1 && <Step1 formData={formData} updateArrayField={updateArrayField} />}
                                {step === 2 && <Step2 formData={formData} updateField={updateField} dreamLoaded={dreamLoaded} />}
                                {step === 3 && <Step3 formData={formData} updateObjectField={updateObjectField} />}
                                {step === 4 && <Step4 formData={formData} updateArrayField={updateArrayField} />}
                                {step === 5 && <Step5 formData={formData} updateArrayField={updateArrayField} />}
                                {step === 6 && <Step6 formData={formData} updateObjectField={updateObjectField} />}
                            </div>

                            <ButtonFooter
                                onBack={() => setStep(step === 1 ? 0.5 : step === 3 ? 2.5 : step - 1)}
                                onNext={() => {
                                    if (step === 1) {
                                        if (!validateStep1()) return;
                                        handleStepNext(1.5, { core_values_list: formData.top5Values, behaviors: formData.behaviors }, 'Company Values');
                                    } else if (step === 2) {
                                        if (!validateStep2()) return;
                                        submitIndividualPhase();
                                        handleStepNext(2.5, { values_gap: { dream: formData.dream, requiredValues: formData.requiredValues, gap: formData.gap } }, 'Values Gap');
                                    } else if (step === 3) {
                                        if (!validateStep3()) return;
                                        handleStepNext(3.5, { cool_not_cool: formData.valuesBehaviors }, 'Values Behaviors');
                                    } else if (step === 4) {
                                        if (!validateStep4()) return;
                                        handleStepNext(4.5, { red_lines: { yellowLines: formData.yellowLines, redLines: formData.redLines } }, 'Red Lines');
                                    } else if (step === 5) {
                                        if (!validateStep5()) return;
                                        handleStepNext(5.5, { recruitment_questions: formData.recruitmentQuestions }, 'Recruitment Questions');
                                    } else if (step === 6) {
                                        if (!validateStep6()) return;
                                        handleStepNext(6.5, { rollout_plan: formData.commPlan }, 'Communication Plan');
                                    }
                                }}
                                disabled={aiReviewing}
                                nextLabel={aiReviewing ? 'AI Coach Reviewing...' : step === 6 ? 'View Results' : 'Next'}
                                showBack={true}
                            />
                        </div>
                        <WizardSidebar currentStep={step} formData={formData} onNavigate={setStep} />
                    </div>
                );
            }

            // RESULTS PAGE (step 7)
            if (step === 7) {
                return <ResultsPage formData={formData} userEmail={userEmail} handleSubmit={handleSubmit} onBack={() => setStep(6)} submitStatus={submitStatus} submitMessage={submitMessage} />;
            }

            // Default fallback
            return null;
        };

        // STEP 1: COMPANY VALUES
        function Step1({ formData, updateArrayField }) {
            return (
                <div>
                    <div className="step-indicator"><span>INDIVIDUAL PHASE — STEP 1 OF 2</span><span className="step-time">~15 min</span></div>
                    <h2 className="step-heading">Company Values</h2>
                    <p className="step-hint">List 5-10 behaviors you commonly observe, then extract the values they represent.</p>

                    {/* Fast Track Insight */}
                    <FastTrackInsight>
                        Values are the invisible backbone of your organization — they act as a magnet attracting like-minded people and an immune system rejecting misaligned behaviors. Focus on the 20% of values that drive 80% of your results: keep them simple, clear, and tied to observable actions.
                    </FastTrackInsight>

                    {/* The Science */}
                    <ScienceBox collapsible={true}>
                        Deloitte research shows values-driven companies experience 30% higher innovation rates and 40% higher employee retention. Writing values as specific behaviors — not abstract words — activates deeper cognitive processing and makes them 3x more likely to be remembered and acted upon daily.
                    </ScienceBox>

                    {/* Common Mistake */}
                    <WarningBox>
                        Don't pick aspirational values you don't actually live — your team spots the hypocrisy instantly. <strong>Bad:</strong> Listing generic words like "Integrity" or "Excellence" that every company claims. <strong>Good:</strong> Describing specific, observable behaviors like "We admit our mistakes and learn from them quickly."
                    </WarningBox>


                    <div className="mb-8">
                        <label className="block font-bold mb-4 text-lg">List typical behaviors (good or bad)</label>
                        <ScienceBookmarkIcon>
                            Behavioral scientists confirm that observing actual behaviors first — before naming values — produces more authentic and actionable values than top-down brainstorming.
                        </ScienceBookmarkIcon>
                        <div className="space-y-3">
                            {formData.behaviors.slice(0, 10).map((behavior, i) => {
                                const placeholders = [
                                    'e.g., People respond to emails within 24 hours',
                                    'e.g., Team members always show up on time for meetings',
                                    'e.g., Leaders make decisions without consulting the team',
                                    'e.g., People help each other without being asked',
                                    'e.g., Employees work late nights regularly',
                                    'e.g., Mistakes are openly discussed in team meetings',
                                    'e.g., New ideas are immediately shot down',
                                    'e.g., People take ownership when things go wrong',
                                    'e.g., Everyone checks with their manager before acting',
                                    'e.g., Team celebrates wins together'
                                ];
                                return (
                                    <input
                                        key={i}
                                        className="ft-input text-lg"
                                        placeholder={placeholders[i]}
                                        value={behavior}
                                        onChange={(e) => updateArrayField('behaviors', i, e.target.value)}
                                    />
                                );
                            })}
                        </div>
                    </div>

                    <div className="mb-8">
                        <label className="block font-bold mb-4 text-lg">Your Company's Top 5 Core Values</label>
                        <ScienceBookmarkIcon>
                            Companies with 5 or fewer clearly defined core values outperform those with longer lists — simplicity drives recall and daily application.
                        </ScienceBookmarkIcon>
                        <div className="grid grid-cols-5 gap-4">
                            {formData.top5Values.map((value, i) => (
                                <input
                                    key={i}
                                    className="ft-input text-lg text-center"
                                    placeholder={`Value ${i + 1}`}
                                    value={value}
                                    onChange={(e) => updateArrayField('top5Values', i, e.target.value)}
                                />
                            ))}
                        </div>
                    </div>

                </div>
            );
        }

        // STEP 2: VALUES GAP
        function Step2({ formData, updateField, dreamLoaded }) {
            return (
                <div>
                    <div className="step-indicator"><span>INDIVIDUAL PHASE — STEP 2 OF 2</span><span className="step-time">~10 min</span></div>
                    <h2 className="step-heading">Values Gap Analysis</h2>
                    <p className="step-hint">Identify the gap between where you are and where you need to be.</p>

                    {/* Fast Track Insight */}
                    <FastTrackInsight>
                        Your Dream from Sprint 1 is your compass here. The gap between the values you currently live and the values your Dream demands is where the real work begins. Be brutally honest — closing this gap is the difference between a poster on the wall and a culture that performs.
                    </FastTrackInsight>

                    {/* The Science */}
                    <ScienceBox collapsible={true}>
                        McKinsey research shows that companies with clearly articulated and gap-analyzed values make strategic decisions 2.5x faster. When employees understand the distance between current culture and aspirational culture, alignment efforts become targeted rather than scattered.
                    </ScienceBox>


                    <div className="grid grid-cols-1 gap-8 mb-8">
                        <div>
                            <label className="block font-bold mb-2 text-lg">Your Company Dream</label>
                            {dreamLoaded && (
                                <div style={{background:'#FFF469',border:'2px solid #000',padding:'12px 16px',marginBottom:'8px',display:'flex',alignItems:'flex-start',gap:'10px'}}>
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#000" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{flexShrink:0,marginTop:'2px'}}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                    <div style={{flex:1}}>
                                        <div style={{fontFamily:"'Monument','Courier New',monospace",fontSize:'11px',textTransform:'uppercase',letterSpacing:'0.05em',fontWeight:700,color:'#000'}}>Auto-loaded from your Dream tool</div>
                                    </div>
                                </div>
                            )}
                            <textarea
                                className={`ft-input min-h-[120px] text-lg ${dreamLoaded ? 'dependency-injected' : ''}`}
                                placeholder="Copy-paste your dream reminder from Sprint 1..."
                                value={formData.dream}
                                onChange={(e) => updateField('dream', e.target.value)}
                            />
                        </div>

                        <div>
                            <label className="block font-bold mb-2 text-lg">Required Values for Your Dream</label>
                            <textarea
                                className="ft-input min-h-[120px] text-lg"
                                placeholder="What values MUST exist to achieve your dream?"
                                value={formData.requiredValues}
                                onChange={(e) => updateField('requiredValues', e.target.value)}
                            />
                        </div>

                        <div>
                            <label className="block font-bold mb-2 text-lg">The Gap</label>
                            <textarea
                                className="ft-input min-h-[120px] text-lg"
                                placeholder="What's the gap between current and required values?"
                                value={formData.gap}
                                onChange={(e) => updateField('gap', e.target.value)}
                            />
                        </div>
                    </div>

                </div>
            );
        }

        // STEP 3: VALUES INTO BEHAVIORS
        function Step3({ formData, updateObjectField }) {
            return (
                <div>
                    <div className="step-indicator"><span>TEAM PHASE — STEP 1 OF 4</span><span className="step-time">~10 min</span></div>
                    <h2 className="step-heading">Values Into Behaviors</h2>
                    <p className="step-hint">For each value, describe what "cool" and "not cool" behaviors look like.</p>

                    {/* Fast Track Insight */}
                    <FastTrackInsight>
                        This is the most critical step: translating abstract values into "Cool" and "Not Cool" behaviors. As Steven Bartlett says, values are not words — they are the specific behaviors that accompany them. If your team cannot point to an observable action, the value is not real yet.
                    </FastTrackInsight>

                    {/* The Science */}
                    <ScienceBox collapsible={true}>
                        A meta-analysis of 200+ organizations found that defining values as explicit behavioral pairs (desired vs. undesired) increases cultural consistency by 35% compared to values stated as single words. Written behavioral commitments create psychological accountability that abstract principles cannot.
                    </ScienceBox>

                    <div className="space-y-8 mb-8">
                        {formData.valuesBehaviors.map((item, i) => {
                            const valuePlaceholders = [
                                'e.g., Accountability',
                                'e.g., Transparency', 
                                'e.g., Excellence',
                                'e.g., Collaboration',
                                'e.g., Innovation'
                            ];
                            
                            const coolPlaceholders = [
                                'e.g., Taking ownership when things go wrong, proactively communicating delays, following through on commitments without reminders',
                                'e.g., Sharing information openly in meetings, admitting mistakes immediately, keeping everyone informed of changes',
                                'e.g., Delivering work that exceeds expectations, constantly seeking to improve, taking pride in every detail',
                                'e.g., Asking for help when needed, sharing credit generously, making time to support teammates',
                                'e.g., Experimenting with new approaches, challenging the status quo respectfully, turning failures into learning'
                            ];
                            
                            const notCoolPlaceholders = [
                                'e.g., Blaming others when projects fail, making excuses for missed deadlines, waiting to be chased for updates',
                                'e.g., Keeping information to themselves, hiding problems until they explode, surprising people with bad news',
                                'e.g., Delivering "good enough" work consistently, resisting feedback, cutting corners to save time',
                                'e.g., Working in silos, hoarding knowledge, taking all the credit for team wins',
                                'e.g., Responding to new ideas with "we tried that before", sticking to old ways, punishing failed experiments'
                            ];
                            
                            return (
                                <div key={i} className="border-2 border-gray-300 p-6 rounded">
                                    <input
                                        className="ft-input text-xl font-bold mb-4"
                                        placeholder={valuePlaceholders[i]}
                                        value={item.value}
                                        onChange={(e) => updateObjectField('valuesBehaviors', i, 'value', e.target.value)}
                                    />
                                    <div className="grid grid-cols-2 gap-6">
                                        <div>
                                            <label className="block font-bold mb-2 text-black">Cool Behavior</label>
                                            <textarea
                                                className="ft-input min-h-[100px] border-black"
                                                placeholder={coolPlaceholders[i]}
                                                value={item.cool}
                                                onChange={(e) => updateObjectField('valuesBehaviors', i, 'cool', e.target.value)}
                                            />
                                        </div>
                                        <div>
                                            <label className="block font-bold mb-2 text-red-600">Not Cool Behavior</label>
                                            <textarea
                                                className="ft-input min-h-[100px] border-red-600"
                                                placeholder={notCoolPlaceholders[i]}
                                                value={item.notCool}
                                                onChange={(e) => updateObjectField('valuesBehaviors', i, 'notCool', e.target.value)}
                                            />
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                </div>
            );
        }

        // STEP 4: RED LINES
        function Step4({ formData, updateArrayField }) {
            return (
                <div>
                    <div className="step-indicator"><span>TEAM PHASE — STEP 2 OF 4</span><span className="step-time">~5 min</span></div>
                    <h2 className="step-heading">Red Lines</h2>
                    <p className="step-hint">Define warning behaviors (yellow lines) and non-negotiables (red lines).</p>

                    {/* Fast Track Insight */}
                    <FastTrackInsight>
                        Red lines are your company's immune system. Values that are not consistently applied lose their power — leaders must enforce these boundaries visibly, or the entire values system erodes. Your red lines will feed directly into recruitment, performance management, and conflict resolution.
                    </FastTrackInsight>

                    {/* The Science */}
                    <ScienceBox collapsible={true}>
                        Longitudinal studies by BCG demonstrate that organizations with explicit behavioral boundaries — clear yellow and red lines — experience 60% fewer culture-related conflicts. When consequences are defined in advance, enforcement becomes fair and consistent rather than reactive and political.
                    </ScienceBox>


                    <div className="grid grid-cols-2 gap-8 mb-8">
                        <div>
                            <label className="block font-bold mb-4 text-lg text-yellow-600">Yellow Lines (Warnings)</label>
                            <div className="space-y-3">
                                {formData.yellowLines.map((line, i) => (
                                    <textarea
                                        key={i}
                                        className="ft-input min-h-[80px] border-yellow-600"
                                        placeholder={`Yellow line ${i + 1}`}
                                        value={line}
                                        onChange={(e) => updateArrayField('yellowLines', i, e.target.value)}
                                    />
                                ))}
                            </div>
                        </div>
                        <div>
                            <label className="block font-bold mb-4 text-lg text-red-600">Red Lines (Non-Negotiable)</label>
                            <div className="space-y-3">
                                {formData.redLines.map((line, i) => (
                                    <textarea
                                        key={i}
                                        className="ft-input min-h-[80px] border-red-600"
                                        placeholder={`Red line ${i + 1}`}
                                        value={line}
                                        onChange={(e) => updateArrayField('redLines', i, e.target.value)}
                                    />
                                ))}
                            </div>
                        </div>
                    </div>

                </div>
            );
        }

        // STEP 5: RECRUITMENT QUESTIONS
        function Step5({ formData, updateArrayField }) {
            return (
                <div>
                    <div className="step-indicator"><span>TEAM PHASE — STEP 3 OF 4</span><span className="step-time">~5 min</span></div>
                    <h2 className="step-heading">Recruitment Questions</h2>
                    <p className="step-hint">Create questions to test if candidates align with your values.</p>

                    {/* Fast Track Insight */}
                    <FastTrackInsight>
                        Hiring for values alignment is as important as hiring for skills. A highly skilled candidate who doesn't align with your values will disrupt the culture and cost you more than an empty seat. These questions should reveal how candidates actually behave — not just what they say they believe.
                    </FastTrackInsight>

                    {/* The Science */}
                    <ScienceBox collapsible={true}>
                        Bain research confirms that companies using values-based interview techniques reduce mis-hires by 40% and see significantly faster cultural integration. Scenario-based questions that test behavioral alignment outperform generic "tell me about yourself" approaches at predicting long-term cultural fit.
                    </ScienceBox>


                    <div className="mb-8">
                        <label className="block font-bold mb-4 text-lg">Interview Questions</label>
                        <div className="space-y-3">
                            {formData.recruitmentQuestions.map((q, i) => (
                                <textarea
                                    key={i}
                                    className="ft-input min-h-[100px] text-lg"
                                    placeholder={`Question ${i + 1}: e.g., Tell me about a time when...`}
                                    value={q}
                                    onChange={(e) => updateArrayField('recruitmentQuestions', i, e.target.value)}
                                />
                            ))}
                        </div>
                    </div>

                </div>
            );
        }

        // STEP 6: COMMUNICATION PLAN
        function Step6({ formData, updateObjectField }) {
            return (
                <div>
                    <div className="step-indicator"><span>TEAM PHASE — STEP 4 OF 4</span><span className="step-time">~5 min</span></div>
                    <h2 className="step-heading">Communication Plan</h2>
                    <p className="step-hint">Plan specific actions to communicate and reinforce your values.</p>
                    

                    <div className="mb-8">
                        <table className="w-full border-2 border-black">
                            <thead>
                                <tr className="bg-black text-white">
                                    <th className="p-4 text-left plaak text-lg">#</th>
                                    <th className="p-4 text-left plaak text-lg">Communication Idea</th>
                                    <th className="p-4 text-left plaak text-lg">Who Owns It</th>
                                    <th className="p-4 text-left plaak text-lg">When</th>
                                </tr>
                            </thead>
                            <tbody>
                                {formData.commPlan.map((plan, i) => (
                                    <tr key={i} className="border-t border-gray-300">
                                        <td className="p-4 font-bold">{i + 1}</td>
                                        <td className="p-4">
                                            <textarea
                                                className="ft-input min-h-[60px]"
                                                placeholder="e.g., Weekly values spotlight in team meetings"
                                                value={plan.idea}
                                                onChange={(e) => updateObjectField('commPlan', i, 'idea', e.target.value)}
                                            />
                                        </td>
                                        <td className="p-4">
                                            <input
                                                className="ft-input"
                                                placeholder="Name/Role"
                                                value={plan.who}
                                                onChange={(e) => updateObjectField('commPlan', i, 'who', e.target.value)}
                                            />
                                        </td>
                                        <td className="p-4">
                                            <input
                                                className="ft-input"
                                                placeholder="Deadline"
                                                value={plan.when}
                                                onChange={(e) => updateObjectField('commPlan', i, 'when', e.target.value)}
                                            />
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                </div>
            );
        }

        // RESULTS PAGE
        function ResultsPage({ formData, userEmail, handleSubmit, onBack, submitStatus, submitMessage }) {
            return (
                <div className="min-h-screen bg-white p-12">
                    <div className="max-w-6xl mx-auto">
                        <div className="mb-12 no-print">
                            <h1 className="plaak text-5xl mb-6">YOUR COMPANY VALUES SYSTEM</h1>
                            <div className="bg-black text-white p-6 mb-6 border-4 border-black">
                                <p className="text-xl mb-4">
                                    Review your values system below, then submit to save it to your Fast Track account.
                                </p>
                            </div>
                            {submitMessage && (
                                <div className={`p-4 mb-4 border-2 text-lg font-bold ${submitStatus === 'success' ? 'bg-gray-50 border-black text-black' : submitStatus === 'error' ? 'bg-red-50 border-red-500 text-red-700' : 'bg-yellow-50 border-yellow-500 text-yellow-800'}`}>
                                    {submitMessage}
                                </div>
                            )}
                            <div className="flex gap-4">
                                <button onClick={() => window.print()} className="btn-secondary text-xl py-4 px-8">
                                    Export PDF
                                </button>
                                <button onClick={handleSubmit} className="btn-primary text-xl py-6 px-12 plaak">
                                    SUBMIT TO GURU
                                </button>
                            </div>

                            {/* Case Study */}
                            <CaseStudy
                                before={"A company had a list of values including 'Integrity,' 'Innovation,' and 'Customer-Centricity' — but these were not reflected in daily behaviors. Employees felt decisions were made arbitrarily, and new hires received no cultural guidance beyond a poster in the break room."}
                                after={"Using the Core Values Identification Tool, they refined their values into specific Cool/Not Cool behaviors like 'We speak up when we see something wrong' vs. 'We avoid difficult conversations.' Values were integrated into workshops, performance reviews, and recruitment — resulting in a significant improvement in engagement and decision-making consistency."}
                                quote={"Our values stopped being a poster and became our operating system — now every hire, every conflict, and every promotion runs through them."}
                            />
                        </div>

                        {/* Top 5 Values */}
                        <div className="mb-12 border-4 border-black p-8">
                            <h2 className="plaak text-3xl mb-6">YOUR COMPANY'S TOP 5 CORE VALUES</h2>
                            <div className="grid grid-cols-5 gap-4">
                                {formData.top5Values.filter(v => v).map((v, i) => (
                                    <div key={i} className="text-center p-6 bg-black text-white">
                                        <div className="plaak text-5xl mb-2">{i + 1}</div>
                                        <div className="text-xl">{v}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Values Behaviors */}
                        <div className="mb-12">
                            <h2 className="plaak text-3xl mb-6">VALUES INTO BEHAVIORS</h2>
                            {formData.valuesBehaviors.filter(v => v.value).map((item, i) => (
                                <div key={i} className="mb-6 border-2 border-black p-6">
                                    <h3 className="plaak text-2xl mb-4">{item.value}</h3>
                                    <div className="grid grid-cols-2 gap-6">
                                        <div className="bg-gray-50 p-4 border-l-4 border-black">
                                            <h4 className="font-bold mb-2 text-black">Cool</h4>
                                            <p className="whitespace-pre-line">{item.cool}</p>
                                        </div>
                                        <div className="bg-red-50 p-4 border-l-4 border-red-600">
                                            <h4 className="font-bold mb-2 text-red-600">Not Cool</h4>
                                            <p className="whitespace-pre-line">{item.notCool}</p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Red Lines */}
                        <div className="mb-12 grid grid-cols-2 gap-8">
                            <div className="border-2 border-yellow-600 p-6">
                                <h3 className="plaak text-2xl mb-4 text-yellow-600">Yellow Lines</h3>
                                <ul className="space-y-2">
                                    {formData.yellowLines.filter(l => l).map((l, i) => (
                                        <li key={i} className="border-b pb-2">{l}</li>
                                    ))}
                                </ul>
                            </div>
                            <div className="border-2 border-red-600 p-6">
                                <h3 className="plaak text-2xl mb-4 text-red-600">Red Lines</h3>
                                <ul className="space-y-2">
                                    {formData.redLines.filter(l => l).map((l, i) => (
                                        <li key={i} className="border-b pb-2">{l}</li>
                                    ))}
                                </ul>
                            </div>
                        </div>

                        {/* Communication Plan */}
                        <div className="mb-12">
                            <h2 className="plaak text-3xl mb-6">COMMUNICATION PLAN</h2>
                            <table className="w-full border-2 border-black">
                                <thead>
                                    <tr className="bg-black text-white">
                                        <th className="p-4 text-left">Idea</th>
                                        <th className="p-4 text-left">Owner</th>
                                        <th className="p-4 text-left">Timeline</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {formData.commPlan.filter(p => p.idea).map((p, i) => (
                                        <tr key={i} className="border-t">
                                            <td className="p-4">{p.idea}</td>
                                            <td className="p-4">{p.who}</td>
                                            <td className="p-4">{p.when}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        <button onClick={onBack} className="btn-secondary text-lg py-3 px-6 no-print">
                            ← Edit
                        </button>
                    </div>
                </div>
            );
        }

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ValuesTool />);
    </script>
</body>
</html>
