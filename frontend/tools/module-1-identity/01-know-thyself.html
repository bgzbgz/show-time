<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Know Thyself | Fast Track Program</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

    <style>
        @font-face { font-family: 'Plaak';    src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; }
        @font-face { font-family: 'Riforma';  src: url('RiformaLL-Regular.woff2')   format('woff2'); font-weight: normal; }
        @font-face { font-family: 'Riforma';  src: url('RiformaLL-Regular.woff2')   format('woff2'); font-weight: 600; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Riforma', -apple-system, sans-serif; font-size: 16px; color: #000; background: #000; -webkit-font-smoothing: antialiased; }

        .plaak   { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }

        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; padding: 0 48px; }
        .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }

        .step-content { max-width: 100%; padding: 40px 0; flex: 1; }
        .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #666; margin-bottom: 8px; }
        .opening-box { margin-bottom: 32px; }
        .opening-box .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
        .opening-box .step-hint { font-size: 14px; color: #666; line-height: 1.5; margin: 0; }

        .field-group { margin-bottom: 32px; }
        .field-label { font-weight: 600; font-size: 16px; color: #000; margin-bottom: 8px; display: block; }
        .field-input { border: 1px solid #E0E0E0; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; width: 100%; color: #000; background: #fff; transition: border-color 0.2s; outline: none; }
        .field-input:focus { border-color: #000; }
        .field-textarea { border: 1px solid #E0E0E0; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; width: 100%; min-height: 80px; resize: none; color: #000; background: #fff; transition: border-color 0.2s; outline: none; overflow: hidden; }
        .field-textarea:focus { border-color: #000; }
        .field-help { font-size: 13px; color: #666; margin-top: 4px; }

        .closing-box { border-top: 1px solid #E0E0E0; padding: 20px 0 0 0; margin-top: 8px; text-align: center; }
        .closing-box .closing-title { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #000; margin-bottom: 6px; }
        .closing-box p { font-size: 14px; color: #666; }

        .wizard-footer { display: flex; justify-content: space-between; align-items: center; padding: 24px 48px; border-top: 1px solid #e5e7eb; background: #fff; }
        .btn-wiz-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 12px 28px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-back:hover { border-color: #000; color: #000; }
        .btn-wiz-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 36px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-next:hover:not(:disabled) { background: #FFF469; color: #000; border-color: #FFF469; }
        .btn-wiz-next:disabled { background: #E0E0E0; color: #9CA3AF; border-color: #E0E0E0; cursor: not-allowed; }

        .activity-row { display: flex; gap: 8px; align-items: flex-start; margin-bottom: 8px; }
        .activity-row-num { font-family: 'Monument', monospace; font-size: 11px; color: #999; min-width: 24px; padding-top: 14px; }
        .btn-remove { background: none; border: none; color: #999; cursor: pointer; font-size: 18px; padding: 6px 8px; transition: color 0.2s; flex-shrink: 0; }
        .btn-remove:hover { color: #DC2626; }
        .btn-add { width: 100%; padding: 10px 0; border: 2px dashed #E0E0E0; background: none; font-family: 'Monument', monospace; font-size: 12px; color: #666; letter-spacing: 0.05em; text-transform: uppercase; cursor: pointer; margin-top: 4px; transition: all 0.2s; }
        .btn-add:hover { border-color: #000; color: #000; }

        .sidebar-tool-num { font-family: 'Monument', monospace; font-size: 10px; color: #555; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 8px; }
        .sidebar-tool-title { font-family: 'Plaak', sans-serif; font-size: 22px; color: #fff; margin-bottom: 32px; line-height: 1.1; }
        .sidebar-step { padding: 8px 0; border-bottom: 1px solid #2a2a2a; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s; }
        .sidebar-step:last-child { border-bottom: none; }
        .sidebar-step-dot { width: 6px; height: 6px; border-radius: 50%; background: #555; flex-shrink: 0; transition: background 0.2s; }
        .sidebar-step-dot.active { background: #FFF469; }
        .sidebar-step-dot.done   { background: #4ade80; }
        .sidebar-step-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.08em; color: #555; text-transform: uppercase; transition: color 0.2s; }
        .sidebar-step-label.active { color: #FFF469; }
        .sidebar-step-label.done   { color: #4ade80; }

        .mobile-step-bar { display: none; }
        @media (max-width: 768px) {
            .wizard-sidebar { display: none; }
            .wizard-main { padding: 0 24px; }
            .mobile-step-bar { display: flex; align-items: center; gap: 8px; padding: 16px 24px; background: #1a1a1a; }
            .mobile-step-dot { width: 8px; height: 8px; border-radius: 50%; background: #333; transition: background 0.2s; }
            .mobile-step-dot.active { background: #FFF469; }
            .mobile-step-dot.done   { background: #4ade80; }
            .mobile-step-text { font-family: 'Monument', monospace; font-size: 11px; color: #fff; letter-spacing: 0.06em; }
            .wizard-footer { padding: 16px 24px; }
        }

        .animate-in { animation: fadeSlideIn 0.4s ease both; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

        .ai-message { background: #FFF9C4; border: 1px solid #FFF469; border-left: 4px solid #FFF469; padding: 12px 16px; font-size: 14px; color: #333; margin-top: 16px; line-height: 1.6; }

        .energy-btn { padding: 6px 14px; border: 2px solid #E0E0E0; background: #fff; font-family: 'Monument', monospace; font-size: 11px; letter-spacing: 0.04em; cursor: pointer; transition: all 0.15s; }
        .energy-btn.plus.active  { background: #22c55e; border-color: #22c55e; color: #fff; }
        .energy-btn.minus.active { background: #DC2626; border-color: #DC2626; color: #fff; }
        .energy-btn:not(.active) { color: #999; }

        .value-row { border: 1px solid #E0E0E0; padding: 16px; margin-bottom: 12px; }
        .value-row-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
        .value-number { font-family: 'Plaak', sans-serif; font-size: 22px; color: #000; min-width: 32px; }

        .align-track { display: flex; align-items: center; gap: 10px; }
        .align-track input[type=range] { flex: 1; accent-color: #000; }
        .align-track-val { font-family: 'Monument', monospace; font-size: 12px; min-width: 36px; text-align: right; }

        .goal-row { border: 1px solid #E0E0E0; padding: 16px; margin-bottom: 12px; }
        .goal-row-header { font-family: 'Plaak', sans-serif; font-size: 18px; margin-bottom: 12px; }

        .canvas-section { margin-bottom: 40px; }
        .canvas-section-title { font-family: 'Monument', monospace; font-size: 10px; color: #999; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #000; }
        .canvas-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .canvas-card { border: 1px solid #E0E0E0; padding: 16px; }
        .canvas-card-label { font-family: 'Monument', monospace; font-size: 9px; color: #999; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px; }
        .canvas-card-value { font-size: 14px; color: #333; line-height: 1.6; white-space: pre-wrap; }

        .submit-success { background: #f0fdf4; border: 1px solid #86efac; padding: 32px; text-align: center; margin-top: 24px; }

        .ft-reveal { margin-top: 24px; padding-top: 20px; border-top: 1px solid #e5e7eb; animation: ftRevealIn 0.4s ease; }
        .ft-reveal-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.12em; color: #888; text-transform: uppercase; margin-bottom: 8px; }
        .ft-reveal-text { font-size: 14px; color: #555; line-height: 1.8; }
        @keyframes ftRevealIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .dep-context { border: 1px solid #E0E0E0; margin-bottom: 24px; }
        .dep-context-header { background: #F5F5F5; padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .dep-context-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.1em; color: #666; text-transform: uppercase; }
        .dep-context-body { padding: 14px 16px; font-size: 14px; color: #333; line-height: 1.6; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CONFIG = {
        TOOL_SLUG:    'know-thyself',
        TOOL_TITLE:   'KNOW THYSELF',
        TOOL_SUBTITLE:'Uncover your dream, strengths, values, and growth plan — the foundation of exceptional leadership.',
        COVER_IMAGE:  'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&q=80',
        TOTAL_STEPS:  4,
        SUPABASE_URL:     'https://lutzzfaedkbsmbobmrzx.supabase.co',
        SUPABASE_ANON_KEY:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'Leaders who cannot articulate their dream make reactive decisions. They chase every opportunity, chase every market trend, and wonder why their team has no direction. Your 80th birthday vision is not a soft exercise — it is the emotional anchor every other decision in Fast Track is built on.',
                peerProof: '"Harvard Business Review research shows leaders who write down a vivid personal vision are 42% more likely to achieve their goals. The act of writing activates deeper cognitive processing and creates a psychological contract with yourself. Your dream is your North Star."'
            },
            2: {
                brutalTruth: 'The number one mistake leaders make is trying to fix weaknesses. Buckingham and Clifton proved this destroys engagement and limits performance. Focus on strengths and delegate the rest. The Gallup data is unambiguous: strength-based development is 3x more effective than fixing gaps.',
                peerProof: '"A €30M manufacturing CEO discovered his core strength was systems thinking, not the relationship building he had been trying to develop. He restructured his week to play to that strength, delegated relationship management to a COO, and revenue grew 22% in 18 months with less personal effort."'
            },
            3: {
                brutalTruth: 'Values-driven decisions eliminate internal conflict. When you keep saying yes to work that contradicts your values, you burn out — not because you worked too hard but because the work felt hollow. Most leaders cannot name their top 3 values without hesitation. That silence explains everything.',
                peerProof: '"Barrett Values Centre research across 6,000+ organisations shows companies with strong values alignment outperform peers by 4x in revenue growth. When actions align with core values, decisions become faster and more confident — and good talent stays longer."'
            },
            4: {
                brutalTruth: 'Goals without deadlines are confessions of low priority. Research on structured goal-setting shows specific, written action plans increase goal achievement by 42–78% compared to verbal intentions. Stop calling vague aspirations goals. A goal has a number and a date or it does not exist.',
                peerProof: '"A logistics company founder set three specific 90-day goals after this sprint — all with a named action and a hard date. Six months later, two were complete and one was 80% done. The year before, with four vague \"priorities\", she had completed none."'
            }
        },
        CLOSING_MESSAGES: {
            1: { title: 'DREAM DEFINED',      text: 'Your North Star is locked in. Now find what fuels you.' },
            2: { title: 'STRENGTHS MAPPED',   text: 'You know what energizes you. Now align your values.' },
            3: { title: 'VALUES ALIGNED',     text: 'Your compass is set. Now make the plan.' },
            4: { title: 'PLAN COMPLETE',      text: 'Self-knowledge locked in. Time to build your canvas.' },
        }
    };

    const { createClient } = supabase;
    const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
    window.supabaseClient = supabaseClient;

    ToolDB.init(CONFIG.TOOL_SLUG);
    ToolAccessControl.init(CONFIG.TOOL_SLUG);
    CognitiveLoad.init(CONFIG.TOOL_SLUG);

    const makeDefaultData = () => ({
        birthdayStory: '',
        whatLove: '',
        whatGoodAt: '',
        giveToWorld: '',
        paidFor: '',
        inspired: '',
        feltBest: '',
        likeAboutSelf: '',
        hardships: '',
        dream: '',
        activities: Array(5).fill(null).map(() => ({ activity: '', energy: '' })),
        strengthsList: ['', '', ''],
        doMore: '',
        doLess: '',
        startDoing: '',
        values: Array(5).fill(null).map(() => ({ value: '', howLive: '', alignment: 50 })),
        goals: Array(3).fill(null).map(() => ({ goal: '', actions: '', byWhen: '' })),
    });

    function autoGrow(el) {
        if (!el) return;
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
    }

    function AutoTextarea({ value, onChange, placeholder, minHeight = 80, style = {} }) {
        const ref = useRef(null);
        useEffect(() => { autoGrow(ref.current); }, [value]);
        return (
            <textarea ref={ref} className="field-textarea"
                style={Object.assign({ minHeight }, style)}
                value={value}
                onChange={onChange}
                placeholder={placeholder}
                onInput={e => autoGrow(e.target)}
            />
        );
    }

    function WizardSidebar({ currentStep, data, onNavigate }) {
        const steps = [
            { num: 1, label: 'Dream Launcher' },
            { num: 2, label: 'Strengths Amplifier' },
            { num: 3, label: 'Values Compass' },
            { num: 4, label: 'Growth Blueprint' },
            { num: 'canvas', label: 'Canvas' },
        ];
        return (
            <div className="wizard-sidebar">
                <div className="sidebar-tool-num">SPRINT 01</div>
                <div className="sidebar-tool-title">{CONFIG.TOOL_TITLE}</div>
                {steps.map(s => {
                    const isCanvas = s.num === 'canvas';
                    const isDone   = isCanvas ? false : (typeof currentStep === 'number' && currentStep > s.num);
                    const isActive = isCanvas ? currentStep === 'canvas' : (typeof currentStep === 'number' && Math.floor(currentStep) === s.num);
                    const isFuture = isCanvas ? false : (typeof currentStep === 'number' && currentStep < s.num);
                    return (
                        <div key={String(s.num)} className="sidebar-step"
                            onClick={() => isDone && onNavigate(s.num)}
                            style={{ opacity: isFuture ? 0.35 : 1, cursor: isDone ? 'pointer' : 'default' }}>
                            <div className={'sidebar-step-dot' + (isActive ? ' active' : isDone ? ' done' : '')} />
                            <span className={'sidebar-step-label' + (isActive ? ' active' : isDone ? ' done' : '')}>{s.label}</span>
                        </div>
                    );
                })}
                {data.dream && (
                    <div style={{ marginTop: 24, borderTop: '1px solid #2a2a2a', paddingTop: 16 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#555', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 8 }}>MY DREAM</div>
                        <div style={{ fontSize: 12, color: '#ccc', lineHeight: 1.5, fontStyle: 'italic' }}>
                            "{data.dream.substring(0, 80)}{data.dream.length > 80 ? '…' : ''}"
                        </div>
                    </div>
                )}
            </div>
        );
    }

    function TransitionScreen({ stepNum, onNext }) {
        const t = CONFIG.TRANSITION_CONTENT[stepNum];
        if (!t) { onNext(); return null; }
        return (
            <div style={{ position: 'fixed', inset: 0, background: '#000', color: '#fff', zIndex: 200, overflowY: 'auto', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '64px 32px' }}>
                <div style={{ maxWidth: 720, width: '100%' }} className="animate-in">
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#555', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 32 }}>
                        SPRINT 01 — KNOW THYSELF
                    </div>
                    <div style={{ borderLeft: '4px solid #DC2626', paddingLeft: 24, marginBottom: 48 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#DC2626', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 12 }}>BRUTAL TRUTH</div>
                        <p className="plaak" style={{ fontSize: 26, lineHeight: 1.35 }}>{t.brutalTruth}</p>
                    </div>
                    <div style={{ borderLeft: '4px solid #FFF469', paddingLeft: 24, marginBottom: 64 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 12 }}>PEER PROOF</div>
                        <p style={{ fontSize: 18, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic' }}>{t.peerProof}</p>
                    </div>
                    <button onClick={onNext} className="plaak"
                        style={{ background: '#FFF469', color: '#000', border: 'none', padding: '18px 48px', fontSize: 18, cursor: 'pointer', letterSpacing: '0.05em', transition: 'all 0.2s' }}>
                        CONTINUE →
                    </button>
                </div>
            </div>
        );
    }

    function IntroPage({ onNext }) {
        return (
            <div style={{ background: '#000', color: '#fff', minHeight: '100vh', padding: '64px 48px' }} className="animate-in">
                <div style={{ maxWidth: 720, margin: '0 auto' }}>
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#555', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 32 }}>
                        SPRINT 01 — INDIVIDUAL TOOL
                    </div>
                    <h1 className="plaak" style={{ fontSize: 72, marginBottom: 24, lineHeight: 1.05 }}>BEFORE WE START</h1>
                    <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48, lineHeight: 1.7 }}>
                        This sprint is one of the most crucial in the Fast Track program. You will delve into your personal strengths, values, and purpose. What you discover here is the foundation every other strategy decision in Fast Track is built on.
                    </p>
                    <div style={{ borderLeft: '4px solid #FFF469', paddingLeft: 24, marginBottom: 48 }}>
                        <p className="plaak" style={{ fontSize: 22, color: '#FFF469', marginBottom: 8 }}>
                            "The unexamined life is not worth living."
                        </p>
                        <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#555', letterSpacing: '0.1em', textTransform: 'uppercase' }}>SOCRATES</p>
                    </div>
                    <div style={{ marginBottom: 48 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#555', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 16 }}>YOUR JOURNEY TODAY</div>
                        {[
                            { num: '01', label: 'Dream Launcher',        desc: 'Define your reason to get up in the morning' },
                            { num: '02', label: 'Strengths Amplifier',   desc: 'Map what energizes you and where you truly excel' },
                            { num: '03', label: 'Values Compass',        desc: 'Identify the principles that drive your best decisions' },
                            { num: '04', label: 'Personal Growth Blueprint', desc: 'Set clear goals aligned to who you are' },
                        ].map(item => (
                            <div key={item.num} style={{ display: 'flex', gap: 16, padding: '12px 0', borderBottom: '1px solid #1a1a1a' }}>
                                <span style={{ fontFamily: "'Plaak', sans-serif", fontSize: 18, color: '#FFF469', minWidth: 32 }}>{item.num}</span>
                                <div>
                                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#fff', letterSpacing: '0.06em', textTransform: 'uppercase', marginBottom: 2 }}>{item.label}</div>
                                    <div style={{ fontSize: 13, color: '#666' }}>{item.desc}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                    <div style={{ background: '#111', border: '1px solid #222', padding: '20px 24px', marginBottom: 48 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#DC2626', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 8 }}>MISTAKES TO AVOID</div>
                        <ul style={{ fontSize: 14, color: '#888', lineHeight: 1.8, paddingLeft: 16 }}>
                            <li>Writing what you think you should say instead of what is true</li>
                            <li>Being vague — specificity is what makes insights actionable</li>
                            <li>Rushing — each section deserves genuine reflection</li>
                        </ul>
                    </div>
                    <button onClick={onNext} className="plaak"
                        style={{ background: '#fff', color: '#000', border: 'none', padding: '18px 48px', fontSize: 20, cursor: 'pointer', letterSpacing: '0.05em', transition: 'all 0.2s' }}
                        onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                        onMouseOut={e => { e.target.style.background = '#fff'; }}>
                        LET'S START →
                    </button>
                </div>
            </div>
        );
    }

    // ────────────────────────────────────────────────────────────
    // STEP 1: Dream Launcher
    // ────────────────────────────────────────────────────────────
    function Step1({ data, updateData, aiMessage }) {
        const update = (field, val) => updateData(field, val);

        const GUIDING = [
            { key: 'whatLove',      label: 'What do you love doing?',                         ph: 'e.g. Building things from scratch, solving complex problems…' },
            { key: 'whatGoodAt',    label: 'What are you naturally good at?',                  ph: 'e.g. Strategic thinking, connecting people, simplifying complexity…' },
            { key: 'giveToWorld',   label: 'What can you give to the world?',                  ph: 'e.g. A more efficient system, leadership that empowers others…' },
            { key: 'paidFor',       label: 'What can you be paid well for?',                   ph: 'e.g. Building high-performance teams, creating profitable businesses…' },
            { key: 'inspired',      label: 'What or who inspires you most?',                   ph: 'e.g. Entrepreneurs who built from nothing, leaders who serve others…' },
            { key: 'feltBest',      label: 'When did you feel most alive and at your best?',   ph: 'e.g. Leading a major turnaround, launching a new product…' },
            { key: 'likeAboutSelf', label: 'What do you like most about yourself as a leader?', ph: 'e.g. My honesty, my drive, my ability to stay calm under pressure…' },
            { key: 'hardships',     label: 'What hardships have shaped you most?',             ph: 'e.g. Losing a business taught me resilience and financial discipline…' },
        ];

        const dreamFilled = (data.dream || '').length >= 20;

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 1 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Dream Launcher</h1>
                    <p className="step-hint">Reflect on the guiding questions, then crystallize your dream — your reason to get up in the morning. Be specific and vivid.</p>
                </div>

                <div className="field-group">
                    <label className="field-label">Your 80th Birthday Vision</label>
                    <p className="field-help" style={{ marginBottom: 10 }}>Imagine your 80th birthday. The people who matter most are celebrating you. What do they say about the life you lived, the leader you were, the impact you made?</p>
                    <AutoTextarea
                        value={data.birthdayStory}
                        onChange={e => update('birthdayStory', e.target.value)}
                        placeholder="e.g. At my 80th birthday, my team said I was the leader who showed them that business could be built with integrity and purpose. My children said I was fully present. I had built a company that outlasted me, employed 500 people, and changed an industry…"
                        minHeight={140}
                    />
                    {(data.birthdayStory || '').length >= 50 && (
                        <div className="ft-reveal">
                            <div className="ft-reveal-label">FAST TRACK INSIGHT</div>
                            <p className="ft-reveal-text">The 80th birthday exercise creates what psychologists call a "future self" anchor. Leaders who write vivid future visions make faster, more aligned decisions — because they have a destination to navigate toward. Vagueness is the enemy of leadership clarity.</p>
                        </div>
                    )}
                </div>

                <div style={{ background: '#F5F5F5', borderLeft: '4px solid #000', padding: '14px 20px', marginBottom: 24 }}>
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 6 }}>GUIDING QUESTIONS</div>
                    <p style={{ fontSize: 13, color: '#555', lineHeight: 1.6 }}>Answer these to uncover the raw material for your dream. Your answers to each question feed into the final statement below.</p>
                </div>

                {GUIDING.map(q => (
                    <div key={q.key} className="field-group">
                        <label className="field-label" style={{ fontWeight: 'normal', fontSize: 14 }}>{q.label}</label>
                        <AutoTextarea
                            value={data[q.key] || ''}
                            onChange={e => update(q.key, e.target.value)}
                            placeholder={q.ph}
                            minHeight={60}
                        />
                    </div>
                ))}

                <div className="field-group" style={{ background: '#000', padding: '24px', marginTop: 8 }}>
                    <label className="field-label" style={{ color: '#FFF469', fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.1em', textTransform: 'uppercase' }}>
                        My Dream — Reason to Get Up Every Morning
                    </label>
                    <p style={{ fontSize: 13, color: '#888', marginBottom: 12, lineHeight: 1.6 }}>
                        Synthesize everything above into one clear statement. Not a company goal — a personal north star. Be concrete.
                    </p>
                    <AutoTextarea
                        value={data.dream}
                        onChange={e => update('dream', e.target.value)}
                        placeholder="e.g. My dream is to build a €50M company that creates 300 jobs in my region and proves that integrity-based leadership outperforms in the long run."
                        minHeight={80}
                        style={{ background: '#111', color: '#fff', borderColor: '#333', fontSize: 16 }}
                    />
                </div>

                {aiMessage && <div className="ai-message">{aiMessage}</div>}

                {dreamFilled && (
                    <div className="closing-box animate-in" style={{ marginTop: 16 }}>
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[1].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[1].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // ────────────────────────────────────────────────────────────
    // STEP 2: Strengths Amplifier
    // ────────────────────────────────────────────────────────────
    function Step2({ data, updateData, aiMessage }) {
        const updateActivity = (idx, field, val) => {
            const next = data.activities.map((a, i) => i === idx ? Object.assign({}, a, { [field]: val }) : a);
            updateData('activities', next);
        };
        const addActivity = () => {
            if (data.activities.length < 10) updateData('activities', data.activities.concat([{ activity: '', energy: '' }]));
        };
        const removeActivity = idx => {
            if (data.activities.length <= 3) return;
            updateData('activities', data.activities.filter((_, i) => i !== idx));
        };
        const updateStrength = (idx, val) => {
            const next = data.strengthsList.slice();
            next[idx] = val;
            updateData('strengthsList', next);
        };
        const addStrength = () => {
            if (data.strengthsList.length < 7) updateData('strengthsList', data.strengthsList.concat(['']));
        };

        const filledActivities = data.activities.filter(a => a.activity.trim()).length;
        const filledStrengths  = data.strengthsList.filter(s => s.trim()).length;

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 2 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Strengths Amplifier</h1>
                    <p className="step-hint">Map what energizes you, identify your core strengths, and decide what to do more, less, and differently.</p>
                </div>

                <div className="field-group">
                    <label className="field-label">Activities — Energy Audit</label>
                    <p className="field-help" style={{ marginBottom: 12 }}>List activities you do regularly. Mark whether each gives you energy (+) or drains you (−).</p>
                    <div style={{ display: 'flex', gap: 8, padding: '6px 0 8px', borderBottom: '2px solid #000', marginBottom: 8 }}>
                        <span style={{ minWidth: 24 }}></span>
                        <span style={{ flex: 1, fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.08em' }}>Activity</span>
                        <span style={{ minWidth: 100, fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.08em', textAlign: 'center' }}>Energy</span>
                        <span style={{ minWidth: 32 }}></span>
                    </div>
                    {data.activities.map((a, idx) => (
                        <div key={idx} className="activity-row" style={{ alignItems: 'center' }}>
                            <span className="activity-row-num" style={{ paddingTop: 0 }}>{String(idx+1).padStart(2,'0')}</span>
                            <input type="text" className="field-input"
                                style={{ padding: '8px 12px', fontSize: 14, flex: 1 }}
                                value={a.activity}
                                onChange={e => updateActivity(idx, 'activity', e.target.value)}
                                placeholder="e.g. Presenting strategy to the team"
                            />
                            <div style={{ display: 'flex', gap: 4, minWidth: 100, justifyContent: 'center' }}>
                                <button className={'energy-btn plus' + (a.energy === '+' ? ' active' : '')}
                                    onClick={() => updateActivity(idx, 'energy', a.energy === '+' ? '' : '+')}>+ GIVES</button>
                                <button className={'energy-btn minus' + (a.energy === '-' ? ' active' : '')}
                                    onClick={() => updateActivity(idx, 'energy', a.energy === '-' ? '' : '-')}>− DRAINS</button>
                            </div>
                            <button className="btn-remove" onClick={() => removeActivity(idx)} disabled={data.activities.length <= 3} style={{ opacity: data.activities.length <= 3 ? 0.2 : 1 }}>×</button>
                        </div>
                    ))}
                    {data.activities.length < 10 && (
                        <button className="btn-add" onClick={addActivity}>+ Add Activity</button>
                    )}
                    <p className="field-help" style={{ marginTop: 8 }}>{filledActivities} activities listed. Rate each to reveal your energy pattern.</p>
                </div>

                <div className="field-group">
                    <label className="field-label">My Top Strengths</label>
                    <p className="field-help" style={{ marginBottom: 12 }}>What do you do naturally that others find exceptional? Focus on what energizes you AND what you're skilled at.</p>
                    {data.strengthsList.map((s, idx) => (
                        <div key={idx} className="activity-row" style={{ alignItems: 'center', marginBottom: 8 }}>
                            <span className="activity-row-num" style={{ paddingTop: 0 }}>{String(idx+1).padStart(2,'0')}</span>
                            <input type="text" className="field-input"
                                style={{ padding: '8px 12px', fontSize: 14, flex: 1 }}
                                value={s}
                                onChange={e => updateStrength(idx, e.target.value)}
                                placeholder="e.g. Strategic pattern recognition, Building trust quickly, Systems design"
                            />
                        </div>
                    ))}
                    {data.strengthsList.length < 7 && (
                        <button className="btn-add" onClick={addStrength}>+ Add Strength</button>
                    )}
                    <p className="field-help" style={{ marginTop: 8 }}>{filledStrengths} strengths defined (aim for 3–5).</p>
                    {filledStrengths >= 2 && (
                        <div className="ft-reveal">
                            <div className="ft-reveal-label">FAST TRACK INSIGHT</div>
                            <p className="ft-reveal-text">Gallup research shows people who use their strengths daily are 6x more engaged at work. The goal is not to list skills you think you should have — list what you naturally do better than 90% of people and find energizing.</p>
                        </div>
                    )}
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 16 }}>
                    {[
                        { key: 'doMore',     label: 'Do MORE of',    ph: 'e.g. Strategic planning sessions, mentoring team members' },
                        { key: 'doLess',     label: 'Do LESS of',    ph: 'e.g. Operational firefighting, low-leverage meetings' },
                        { key: 'startDoing', label: 'START doing',   ph: 'e.g. Weekly 1:1s focused on development, reading strategy' },
                    ].map(item => (
                        <div key={item.key} className="field-group" style={{ marginBottom: 0 }}>
                            <label className="field-label" style={{ fontSize: 13, fontFamily: "'Monument', monospace", letterSpacing: '0.06em', textTransform: 'uppercase' }}>{item.label}</label>
                            <AutoTextarea value={data[item.key]} onChange={e => updateData(item.key, e.target.value)} placeholder={item.ph} minHeight={80} />
                        </div>
                    ))}
                </div>

                {aiMessage && <div className="ai-message">{aiMessage}</div>}

                {filledStrengths >= 2 && (
                    <div className="closing-box animate-in" style={{ marginTop: 24 }}>
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[2].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[2].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // ────────────────────────────────────────────────────────────
    // STEP 3: Values Compass
    // ────────────────────────────────────────────────────────────
    function Step3({ data, updateData, aiMessage }) {
        const updateValue = (idx, field, val) => {
            const next = data.values.map((v, i) => i === idx ? Object.assign({}, v, { [field]: val }) : v);
            updateData('values', next);
        };

        const filledValues = data.values.filter(v => v.value.trim()).length;

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 3 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Values Compass</h1>
                    <p className="step-hint">Identify your 5 core personal values, describe how you live each one, and assess how aligned your current actions are.</p>
                </div>

                <div style={{ background: '#F5F5F5', borderLeft: '4px solid #000', padding: '14px 20px', marginBottom: 24 }}>
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#666', textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 6 }}>HOW TO CHOOSE YOUR VALUES</div>
                    <p style={{ fontSize: 13, color: '#555', lineHeight: 1.6 }}>Choose values that are genuinely yours — not values you think a leader should have. Ask: when you violated this value, did it feel wrong? When you lived it fully, did it feel right? Common examples: integrity, creativity, courage, independence, impact, family, growth, service, excellence.</p>
                </div>

                {data.values.map((v, idx) => (
                    <div key={idx} className="value-row">
                        <div className="value-row-header">
                            <span className="value-number">{String(idx+1).padStart(2,'0')}</span>
                            <input type="text" className="field-input"
                                style={{ padding: '10px 14px', fontSize: 16, fontWeight: 600, flex: 1 }}
                                value={v.value}
                                onChange={e => updateValue(idx, 'value', e.target.value)}
                                placeholder="Value name (e.g. Integrity, Growth, Courage)"
                            />
                        </div>
                        <div style={{ marginBottom: 12 }}>
                            <label className="field-label" style={{ fontSize: 13, color: '#666', fontWeight: 'normal', marginBottom: 6 }}>How do you live this value daily?</label>
                            <AutoTextarea
                                value={v.howLive}
                                onChange={e => updateValue(idx, 'howLive', e.target.value)}
                                placeholder="e.g. I give honest feedback even when it's uncomfortable. I keep commitments even when inconvenient."
                                minHeight={60}
                            />
                        </div>
                        <div>
                            <label className="field-label" style={{ fontSize: 13, color: '#666', fontWeight: 'normal', marginBottom: 8 }}>How aligned are your current actions with this value?</label>
                            <div className="align-track">
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#DC2626' }}>0%</span>
                                <input type="range" min={0} max={100} step={5}
                                    value={v.alignment}
                                    onChange={e => updateValue(idx, 'alignment', Number(e.target.value))}
                                    style={{ flex: 1 }}
                                />
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#22c55e' }}>100%</span>
                                <span className="align-track-val" style={{ color: v.alignment >= 80 ? '#22c55e' : v.alignment >= 50 ? '#f59e0b' : '#DC2626', fontFamily: "'Monument', monospace", fontSize: 14, fontWeight: 'bold' }}>{v.alignment}%</span>
                            </div>
                        </div>
                    </div>
                ))}

                {filledValues >= 3 && (
                    <div className="ft-reveal">
                        <div className="ft-reveal-label">FAST TRACK INSIGHT</div>
                        <p className="ft-reveal-text">Look at your alignment scores. Any value below 60% is a source of internal tension — it means you know what matters but your daily behavior contradicts it. That gap is a leadership drain. Closing the gap is not a soft goal; it is a performance lever.</p>
                    </div>
                )}

                {aiMessage && <div className="ai-message">{aiMessage}</div>}

                {filledValues >= 3 && (
                    <div className="closing-box animate-in" style={{ marginTop: 24 }}>
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[3].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[3].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // ────────────────────────────────────────────────────────────
    // STEP 4: Personal Growth Blueprint
    // ────────────────────────────────────────────────────────────
    function Step4({ data, updateData, aiMessage }) {
        const updateGoal = (idx, field, val) => {
            const next = data.goals.map((g, i) => i === idx ? Object.assign({}, g, { [field]: val }) : g);
            updateData('goals', next);
        };

        const filledGoals = data.goals.filter(g => g.goal.trim()).length;

        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 4 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Personal Growth Blueprint</h1>
                    <p className="step-hint">Set 2–3 specific goals aligned to your strengths and values. Each goal needs a concrete action and a hard deadline.</p>
                </div>

                <div style={{ background: '#FFFDE7', border: '1px solid #FFF469', borderLeft: '4px solid #FFF469', padding: '12px 16px', marginBottom: 24, fontSize: 13, color: '#333', lineHeight: 1.6 }}>
                    <strong>Good example:</strong> "Develop executive presence — join Toastmasters and deliver 2 company-wide presentations by June 30."<br/>
                    <strong>Common pitfall:</strong> "Be better at leadership." (vague, no action, no deadline — not a goal)
                </div>

                {data.goals.map((g, idx) => (
                    <div key={idx} className="goal-row">
                        <div className="goal-row-header">GOAL {String(idx+1).padStart(2,'0')}</div>
                        <div className="field-group" style={{ marginBottom: 12 }}>
                            <label className="field-label" style={{ fontSize: 13, fontWeight: 'normal', color: '#666', marginBottom: 6 }}>What is your goal?</label>
                            <AutoTextarea
                                value={g.goal}
                                onChange={e => updateGoal(idx, 'goal', e.target.value)}
                                placeholder="e.g. Improve leadership presence and public speaking confidence"
                                minHeight={60}
                            />
                        </div>
                        <div className="field-group" style={{ marginBottom: 12 }}>
                            <label className="field-label" style={{ fontSize: 13, fontWeight: 'normal', color: '#666', marginBottom: 6 }}>How will you achieve it? (Specific actions)</label>
                            <AutoTextarea
                                value={g.actions}
                                onChange={e => updateGoal(idx, 'actions', e.target.value)}
                                placeholder="e.g. Join Toastmasters by end of month. Deliver 2 company presentations by Q2. Hire executive coach for 6 sessions."
                                minHeight={60}
                            />
                        </div>
                        <div>
                            <label className="field-label" style={{ fontSize: 13, fontWeight: 'normal', color: '#666', marginBottom: 6 }}>By when?</label>
                            <input type="text" className="field-input"
                                style={{ padding: '8px 12px', fontSize: 14 }}
                                value={g.byWhen}
                                onChange={e => updateGoal(idx, 'byWhen', e.target.value)}
                                placeholder="e.g. June 30, 2026"
                            />
                        </div>
                    </div>
                ))}

                {filledGoals >= 2 && (
                    <div className="ft-reveal">
                        <div className="ft-reveal-label">FAST TRACK INSIGHT</div>
                        <p className="ft-reveal-text">Research by Dr. Gail Matthews found that people who write down specific goals with action steps and deadlines are 76% more likely to achieve them. Longitudinal studies show individuals who review and adjust their growth plans quarterly maintain 60% higher alignment between intentions and actual behavior.</p>
                    </div>
                )}

                {aiMessage && <div className="ai-message">{aiMessage}</div>}

                {filledGoals >= 2 && (
                    <div className="closing-box animate-in" style={{ marginTop: 24 }}>
                        <p className="closing-title">{CONFIG.CLOSING_MESSAGES[4].title}</p>
                        <p>{CONFIG.CLOSING_MESSAGES[4].text}</p>
                    </div>
                )}
            </div>
        );
    }

    // ────────────────────────────────────────────────────────────
    // CANVAS
    // ────────────────────────────────────────────────────────────
    function CanvasPage({ data, userId, onBack }) {
        const [submitStatus, setSubmitStatus] = useState(null);

        const handleSubmit = async () => {
            setSubmitStatus('saving');
            try {
                await ToolDB.save(userId, {
                    birthday_story: data.birthdayStory,
                    dream:          data.dream,
                    activities:     data.activities,
                    strengths:      data.strengthsList,
                    values:         data.values,
                    goals:          data.goals,
                });
                await ToolDB.markComplete(userId);
                setSubmitStatus('done');
            } catch(e) {
                setSubmitStatus('error');
            }
        };

        const filledStrengths = data.strengthsList.filter(s => s.trim());
        const filledValues    = data.values.filter(v => v.value.trim());
        const filledGoals     = data.goals.filter(g => g.goal.trim());

        return (
            <div style={{ background: '#fff', minHeight: '100vh', padding: '48px' }} className="animate-in">
                <div style={{ maxWidth: 900, margin: '0 auto' }}>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 40 }}>
                        <div>
                            <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 6 }}>SPRINT 01</div>
                            <h1 className="plaak" style={{ fontSize: 48 }}>KNOW THYSELF</h1>
                        </div>
                        <button onClick={onBack} className="btn-wiz-back">← Back to Edit</button>
                    </div>

                    <div className="canvas-section">
                        <div className="canvas-section-title">MY DREAM</div>
                        <div style={{ background: '#000', color: '#FFF469', padding: '24px 28px' }}>
                            <p className="plaak" style={{ fontSize: 22, lineHeight: 1.4 }}>
                                {data.dream || '—'}
                            </p>
                        </div>
                        {data.birthdayStory && (
                            <div style={{ padding: '16px 20px', background: '#F9F9F9', borderLeft: '4px solid #E0E0E0', marginTop: 8, fontSize: 14, color: '#555', lineHeight: 1.7, fontStyle: 'italic' }}>
                                {data.birthdayStory}
                            </div>
                        )}
                    </div>

                    <div className="canvas-section">
                        <div className="canvas-section-title">STRENGTHS & ENERGY</div>
                        <div className="canvas-grid">
                            <div className="canvas-card">
                                <div className="canvas-card-label">Top Strengths</div>
                                <div className="canvas-card-value">
                                    {filledStrengths.length > 0
                                        ? filledStrengths.map((s, i) => <div key={i} style={{ marginBottom: 4 }}>• {s}</div>)
                                        : '—'}
                                </div>
                            </div>
                            <div className="canvas-card">
                                <div className="canvas-card-label">Energy Map</div>
                                <div>
                                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#22c55e', letterSpacing: '0.1em', marginBottom: 6 }}>GIVES ENERGY</div>
                                    {data.activities.filter(a => a.energy === '+' && a.activity.trim()).map((a, i) => <div key={i} style={{ fontSize: 13, marginBottom: 2 }}>+ {a.activity}</div>)}
                                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 9, color: '#DC2626', letterSpacing: '0.1em', margin: '10px 0 6px' }}>DRAINS ENERGY</div>
                                    {data.activities.filter(a => a.energy === '-' && a.activity.trim()).map((a, i) => <div key={i} style={{ fontSize: 13, marginBottom: 2 }}>− {a.activity}</div>)}
                                </div>
                            </div>
                        </div>
                        <div className="canvas-grid" style={{ marginTop: 12 }}>
                            {[
                                { label: 'Do More', value: data.doMore },
                                { label: 'Do Less', value: data.doLess },
                                { label: 'Start Doing', value: data.startDoing },
                            ].map(item => (
                                <div key={item.label} className="canvas-card">
                                    <div className="canvas-card-label">{item.label}</div>
                                    <div className="canvas-card-value">{item.value || '—'}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="canvas-section">
                        <div className="canvas-section-title">VALUES COMPASS</div>
                        {filledValues.length > 0 ? (
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(260px, 1fr))', gap: 12 }}>
                                {filledValues.map((v, i) => (
                                    <div key={i} className="canvas-card">
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                                            <div className="canvas-card-label">{v.value}</div>
                                            <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, fontWeight: 'bold', color: v.alignment >= 80 ? '#22c55e' : v.alignment >= 50 ? '#f59e0b' : '#DC2626' }}>{v.alignment}%</span>
                                        </div>
                                        <div className="canvas-card-value">{v.howLive || '—'}</div>
                                    </div>
                                ))}
                            </div>
                        ) : <div style={{ color: '#999', fontSize: 14 }}>No values defined yet.</div>}
                    </div>

                    <div className="canvas-section">
                        <div className="canvas-section-title">PERSONAL GROWTH BLUEPRINT</div>
                        {filledGoals.length > 0 ? (
                            filledGoals.map((g, i) => (
                                <div key={i} style={{ border: '1px solid #E0E0E0', padding: '16px', marginBottom: 8 }}>
                                    <div style={{ display: 'flex', gap: 12, alignItems: 'flex-start' }}>
                                        <span style={{ fontFamily: "'Plaak', sans-serif", fontSize: 22, color: '#000', minWidth: 32 }}>0{i+1}</span>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontWeight: 600, marginBottom: 6 }}>{g.goal}</div>
                                            {g.actions && <div style={{ fontSize: 13, color: '#555', marginBottom: 4 }}>→ {g.actions}</div>}
                                            {g.byWhen  && <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#DC2626', letterSpacing: '0.06em' }}>BY: {g.byWhen}</div>}
                                        </div>
                                    </div>
                                </div>
                            ))
                        ) : <div style={{ color: '#999', fontSize: 14 }}>No goals defined yet.</div>}
                    </div>

                    <div className="canvas-section">
                        <div className="canvas-section-title">FAST TRACK REMINDER</div>
                        <div style={{ background: '#F5F5F5', padding: '20px 24px', borderLeft: '4px solid #000' }}>
                            <p style={{ fontSize: 14, color: '#333', lineHeight: 1.8 }}>
                                Your dream, strengths, values, and growth plan are the foundation of every decision you will make in Fast Track. When you are unsure which market to enter, which team to build, or which strategy to choose — come back here. The answer is usually hidden in what you know about yourself.
                            </p>
                        </div>
                    </div>

                    {submitStatus === 'done' ? (
                        <div className="submit-success">
                            <div style={{ fontSize: 40, marginBottom: 8 }}>✓</div>
                            <h2 className="plaak" style={{ fontSize: 28, marginBottom: 8 }}>SUBMITTED</h2>
                            <p style={{ color: '#555', marginBottom: 16 }}>Your self-knowledge profile has been saved. Bring your Dream and Strengths to the team meeting.</p>
                            <a href="/dashboard" style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#000', letterSpacing: '0.08em', textTransform: 'uppercase', textDecoration: 'none', borderBottom: '2px solid #000' }}>← Back to Dashboard</a>
                        </div>
                    ) : (
                        <div style={{ textAlign: 'center', padding: '32px 0' }}>
                            {submitStatus === 'error' && (
                                <div style={{ background: '#fef2f2', border: '1px solid #fca5a5', padding: '12px 16px', marginBottom: 16, fontSize: 14, color: '#DC2626' }}>
                                    Failed to save. Please check your connection and try again.
                                </div>
                            )}
                            <button onClick={handleSubmit} disabled={submitStatus === 'saving'} className="btn-wiz-next" style={{ padding: '16px 48px', fontSize: 14 }}>
                                {submitStatus === 'saving' ? 'SAVING…' : 'SUBMIT ANSWERS'}
                            </button>
                        </div>
                    )}
                </div>
            </div>
        );
    }

    // ────────────────────────────────────────────────────────────
    // APP
    // ────────────────────────────────────────────────────────────
    function App() {
        const [step, setStep] = useState(0);
        const [userId, setUserId] = useState(null);
        const [data, setData] = useState(makeDefaultData());
        const [aiReviewing, setAiReviewing] = useState(false);
        const [aiMessage, setAiMessage] = useState('');

        useEffect(() => {
            ToolDB.whenReady().then(async () => {
                const uid = await ToolDB.identifyUser();
                setUserId(uid);
                if (uid) {
                    const saved = await ToolDB.load(uid);
                    if (saved && Object.keys(saved).length > 0) {
                        setData(prev => {
                            const next = Object.assign({}, prev);
                            if (saved.birthday_story !== undefined) next.birthdayStory = saved.birthday_story;
                            if (saved.dream         !== undefined) next.dream          = saved.dream;
                            if (saved.activities    !== undefined) next.activities     = saved.activities.length ? saved.activities : prev.activities;
                            if (saved.strengths     !== undefined) next.strengthsList  = saved.strengths.length  ? saved.strengths  : prev.strengthsList;
                            if (saved.values        !== undefined) next.values         = saved.values.length     ? saved.values     : prev.values;
                            if (saved.goals         !== undefined) next.goals          = saved.goals.length      ? saved.goals      : prev.goals;
                            // legacy compat
                            ['whatLove','whatGoodAt','giveToWorld','paidFor','inspired','feltBest','likeAboutSelf','hardships','doMore','doLess','startDoing'].forEach(k => {
                                if (saved[k] !== undefined) next[k] = saved[k];
                            });
                            return next;
                        });
                    }
                }
            });
        }, []);

        const updateData = (field, val) => {
            setData(prev => Object.assign({}, prev, { [field]: val }));
        };

        const handleNext = async (currentStep) => {
            setAiMessage('');
            const uid = userId || 'anon-' + Date.now();
            const stepAnswers = {
                1: { birthday_story: data.birthdayStory, dream: data.dream },
                2: { strengths: data.strengthsList.filter(Boolean).join(', '), activities: data.activities.filter(a=>a.activity).map(a=>`${a.activity}(${a.energy})`).join(', ') },
                3: { values: data.values.filter(v=>v.value).map(v=>`${v.value}(${v.alignment}%)`).join(', ') },
                4: { goals: data.goals.filter(g=>g.goal).map(g=>g.goal).join(', ') },
            };
            const stepNames = { 1: 'Dream Launcher', 2: 'Strengths Amplifier', 3: 'Values Compass', 4: 'Growth Blueprint' };
            const answers = stepAnswers[currentStep];
            const hasText = answers && Object.values(answers).some(v => v && v.length > 10);
            if (!hasText) {
                setStep(currentStep + 0.5);
                return;
            }
            setAiReviewing(true);
            try {
                const ok = await window.AIChallenge.reviewStep(uid, CONFIG.TOOL_SLUG, answers, stepNames[currentStep]);
                setAiReviewing(false);
                if (ok) {
                    setAiMessage('');
                    setStep(currentStep + 0.5);
                } else {
                    setAiMessage(window.AIChallenge?.getLastFeedback?.()?.suggestion || 'Please add more detail before continuing.');
                }
            } catch(e) {
                setAiReviewing(false);
                setStep(currentStep + 0.5);
            }
        };

        const handleBack = (currentStep) => {
            setAiMessage('');
            if (currentStep === 1) setStep(0.5);
            else setStep(currentStep - 1);
        };

        const stepCanAdvance = {
            1: (data.dream || '').length >= 20,
            2: data.strengthsList.filter(s => s.trim()).length >= 2,
            3: data.values.filter(v => v.value.trim()).length >= 3,
            4: data.goals.filter(g => g.goal.trim()).length >= 2,
        };

        // Cover
        if (step === 0) {
            return (
                <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative', overflow: 'hidden' }}>
                    <div style={{ position: 'absolute', inset: 0, backgroundImage: `url("${CONFIG.COVER_IMAGE}")`, backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.3 }} />
                    <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#555', letterSpacing: '0.15em', textTransform: 'uppercase', marginBottom: 16 }}>SPRINT 01</div>
                        <h1 className="plaak" style={{ fontSize: 80, marginBottom: 16, textTransform: 'uppercase' }}>KNOW THYSELF</h1>
                        <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48 }}>The foundation of exceptional leadership</p>
                        <button onClick={() => setStep(0.5)}
                            style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s' }}
                            onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                            onMouseOut={e => { e.target.style.background = '#fff'; }}>
                            START
                        </button>
                    </div>
                </div>
            );
        }

        // Intro
        if (step === 0.5) {
            return <IntroPage onNext={() => setStep(1)} />;
        }

        // Transitions
        if (!Number.isInteger(step) && step > 0.5) {
            const stepNum = Math.floor(step);
            return <TransitionScreen stepNum={stepNum} onNext={() => setStep(stepNum + 1 > CONFIG.TOTAL_STEPS ? 'canvas' : stepNum + 1)} />;
        }

        // Canvas
        if (step === 'canvas') {
            return <CanvasPage data={data} userId={userId} onBack={() => setStep(CONFIG.TOTAL_STEPS)} />;
        }

        // Wizard steps 1–4
        if (Number.isInteger(step) && step >= 1 && step <= CONFIG.TOTAL_STEPS) {
            const stepComponents = {
                1: <Step1 data={data} updateData={updateData} aiMessage={aiMessage} />,
                2: <Step2 data={data} updateData={updateData} aiMessage={aiMessage} />,
                3: <Step3 data={data} updateData={updateData} aiMessage={aiMessage} />,
                4: <Step4 data={data} updateData={updateData} aiMessage={aiMessage} />,
            };
            return (
                <div className="wizard-layout">
                    <div className="mobile-step-bar" style={{ display: 'none' }}>
                        <span className="mobile-step-text">STEP {step} OF {CONFIG.TOTAL_STEPS}</span>
                        {Array.from({ length: CONFIG.TOTAL_STEPS }, (_, i) => {
                            const n = i + 1;
                            return <div key={n} className={'mobile-step-dot' + (step === n ? ' active' : step > n ? ' done' : '')} />;
                        })}
                    </div>
                    <WizardSidebar currentStep={step} data={data} onNavigate={s => setStep(s)} />
                    <div className="wizard-main">
                        <div style={{ flex: 1, padding: '0 0', overflowY: 'auto' }}>
                            <div style={{ padding: '0 48px' }}>
                                {stepComponents[step]}
                            </div>
                        </div>
                        <div className="wizard-footer">
                            <button className="btn-wiz-back" onClick={() => handleBack(step)}>← BACK</button>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                                {aiReviewing && (
                                    <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#666', letterSpacing: '0.06em' }}>AI REVIEWING…</span>
                                )}
                                {step < CONFIG.TOTAL_STEPS ? (
                                    <button className="btn-wiz-next"
                                        disabled={!stepCanAdvance[step] || aiReviewing}
                                        onClick={() => handleNext(step)}>
                                        NEXT →
                                    </button>
                                ) : (
                                    <button className="btn-wiz-next"
                                        disabled={!stepCanAdvance[step] || aiReviewing}
                                        onClick={() => { setAiMessage(''); setStep('canvas'); }}>
                                        VIEW CANVAS →
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        return null;
    }

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
