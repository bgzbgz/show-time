<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5 Dysfunctions of a Team | Fast Track</title>

    <!-- Chart.js for radar -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* === FONTS === */
        @font-face {
            font-family: 'Plaak';
            src: url('Plaak3Trial-43-Bold.woff2') format('woff2');
            font-weight: bold;
        }
        @font-face {
            font-family: 'Riforma';
            src: url('RiformaLL-Regular.woff2') format('woff2');
            font-weight: normal;
        }
        @font-face {
            font-family: 'Monument';
            src: url('MonumentGrotesk-Mono.woff2') format('woff2');
            font-weight: normal;
        }

        /* === RESET & BASE === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ft-black: #000000;
            --ft-white: #FFFFFF;
            --ft-yellow: #FFF469;
            --ft-grey: #B2B2B2;
            --ft-grey-light: #F5F5F5;
            --ft-green: #10B981;
            --ft-red: #EF4444;
            --sidebar-width: 280px;
            --spacing-unit: 8px;
        }

        body {
            font-family: 'Riforma', -apple-system, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--ft-black);
            background: var(--ft-white);
            -webkit-font-smoothing: antialiased;
        }

        /* === LAYOUT === */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* === LEFT SIDEBAR NAV === */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--ft-black);
            color: var(--ft-white);
            padding: calc(var(--spacing-unit) * 4);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-logo {
            font-family: 'Plaak', sans-serif;
            font-size: 24px;
            margin-bottom: calc(var(--spacing-unit) * 6);
            letter-spacing: -0.02em;
        }

        .sidebar-section {
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .sidebar-title {
            font-family: 'Monument', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--ft-grey);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .nav-item {
            padding: calc(var(--spacing-unit) * 2);
            margin-bottom: calc(var(--spacing-unit));
            background: rgba(255,255,255,0.05);
            border-left: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-item.active {
            background: rgba(255,244,105,0.1);
            border-left-color: var(--ft-yellow);
        }

        .nav-item.completed {
            border-left-color: var(--ft-green);
        }

        .nav-item-check {
            float: right;
            color: var(--ft-green);
        }

        .progress-bar-container {
            margin-top: calc(var(--spacing-unit) * 3);
        }

        .progress-bar {
            background: rgba(255,255,255,0.1);
            height: 6px;
            overflow: hidden;
            margin-top: calc(var(--spacing-unit) * 2);
        }

        .progress-fill {
            height: 100%;
            background: var(--ft-yellow);
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 12px;
            color: var(--ft-grey);
            margin-top: calc(var(--spacing-unit));
        }

        .help-link {
            display: block;
            padding: calc(var(--spacing-unit) * 2);
            background: rgba(255,244,105,0.1);
            border: 1px solid var(--ft-yellow);
            text-align: center;
            cursor: pointer;
            margin-top: calc(var(--spacing-unit) * 4);
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .help-link:hover {
            background: rgba(255,244,105,0.2);
        }

        /* === MAIN CONTENT === */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: calc(var(--spacing-unit) * 6);
            max-width: 900px;
        }

        .section {
            margin-bottom: calc(var(--spacing-unit) * 8);
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === TYPOGRAPHY === */
        h1 {
            font-family: 'Plaak', sans-serif;
            font-size: 42px;
            line-height: 1.1;
            letter-spacing: -0.02em;
            margin-bottom: calc(var(--spacing-unit) * 3);
            text-transform: uppercase;
        }

        h2 {
            font-family: 'Plaak', sans-serif;
            font-size: 32px;
            line-height: 1.2;
            letter-spacing: -0.01em;
            margin-bottom: calc(var(--spacing-unit) * 4);
            text-transform: uppercase;
        }

        h3 {
            font-family: 'Riforma', sans-serif;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        h4 {
            font-family: 'Riforma', sans-serif;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        p {
            margin-bottom: calc(var(--spacing-unit) * 2);
            font-size: 16px;
            line-height: 1.7;
        }

        .lead {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .label {
            font-family: 'Monument', monospace;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: calc(var(--spacing-unit));
            display: block;
            font-weight: 600;
        }

        ul, ol {
            margin-left: 24px;
            margin-bottom: calc(var(--spacing-unit) * 3);
            line-height: 1.8;
        }

        li {
            margin-bottom: calc(var(--spacing-unit));
        }

        /* === INFO BOXES (Sharp Corners) === */
        .info-box {
            position: relative;
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 4);
            border: 2px solid var(--ft-black);
        }

        .info-box-header {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 2);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .info-box-icon {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        .info-box-label {
            font-family: 'Monument', monospace;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        .info-box-body {
            font-size: 16px;
            line-height: 1.6;
        }

        .info-box-yellow {
            background: var(--ft-yellow);
            border-color: var(--ft-black);
        }

        .info-box-grey {
            background: var(--ft-grey);
            border-color: var(--ft-black);
        }

        .info-box-black {
            background: var(--ft-black);
            color: var(--ft-white);
            border-color: var(--ft-yellow);
        }

        .info-box-expandable {
            cursor: pointer;
        }

        .info-box-expand {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit));
            margin-top: calc(var(--spacing-unit) * 2);
            font-size: 14px;
            font-weight: 600;
        }

        .info-box-expand-icon {
            transition: transform 0.3s ease;
        }

        .info-box-expandable.expanded .info-box-expand-icon {
            transform: rotate(180deg);
        }

        .info-box-expanded-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .info-box-expandable.expanded .info-box-expanded-content {
            max-height: 2000px;
        }

        /* === CONTENT BLOCKS === */
        .content-block {
            background: var(--ft-grey-light);
            padding: calc(var(--spacing-unit) * 4);
            margin-bottom: calc(var(--spacing-unit) * 4);
            border-left: 3px solid var(--ft-black);
        }

        .highlight-box {
            background: var(--ft-yellow);
            padding: calc(var(--spacing-unit) * 3);
            border: 2px solid var(--ft-black);
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        /* === INPUTS === */
        .input-group {
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        input[type="text"],
        input[type="email"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: calc(var(--spacing-unit) * 2);
            border: 2px solid var(--ft-grey-light);
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--ft-black);
            box-shadow: 0 0 0 3px rgba(0,0,0,0.1);
        }

        input.error,
        select.error,
        textarea.error {
            border-color: var(--ft-red);
        }

        input.success,
        select.success,
        textarea.success {
            border-color: var(--ft-green);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .char-counter {
            font-size: 14px;
            color: var(--ft-grey);
            margin-top: calc(var(--spacing-unit));
            text-align: right;
        }

        .char-counter.success {
            color: var(--ft-green);
            font-weight: 600;
        }

        .char-counter.error {
            color: var(--ft-red);
            font-weight: 600;
        }

        /* === BUTTONS === */
        .btn {
            padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 4);
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid var(--ft-black);
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--ft-black);
            color: var(--ft-white);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--ft-white);
            color: var(--ft-black);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background: var(--ft-white);
            color: var(--ft-black);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--ft-black);
            color: var(--ft-white);
        }

        .btn-small {
            padding: calc(var(--spacing-unit)) calc(var(--spacing-unit) * 3);
            font-size: 14px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: calc(var(--spacing-unit) * 2);
            margin-top: calc(var(--spacing-unit) * 6);
        }

        /* === MEMBER CARD === */
        .member-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: calc(var(--spacing-unit) * 2);
            background: var(--ft-grey-light);
            border-left: 3px solid var(--ft-black);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .member-name {
            font-weight: 600;
            font-size: 16px;
        }

        .member-remove {
            background: none;
            border: none;
            color: var(--ft-red);
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
        }

        /* === SCORE CARD === */
        .score-card {
            background: var(--ft-white);
            border: 2px solid var(--ft-black);
            padding: calc(var(--spacing-unit) * 4);
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .score-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: calc(var(--spacing-unit) * 4);
            padding-bottom: calc(var(--spacing-unit) * 2);
            border-bottom: 2px solid var(--ft-grey-light);
        }

        .score-card-title {
            font-family: 'Plaak', sans-serif;
            font-size: 24px;
            text-transform: uppercase;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: calc(var(--spacing-unit) * 2) 0;
            border-bottom: 1px solid var(--ft-grey-light);
        }

        .score-item:last-child {
            border-bottom: none;
        }

        .score-label {
            font-size: 16px;
            flex: 1;
        }

        .score-input-wrapper {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 2);
        }

        .score-input {
            width: 80px;
            text-align: center;
        }

        .score-scale {
            font-size: 12px;
            color: var(--ft-grey);
        }

        /* === TABLE === */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: calc(var(--spacing-unit) * 3) 0;
            border: 2px solid var(--ft-black);
        }

        .data-table th,
        .data-table td {
            padding: calc(var(--spacing-unit) * 2);
            text-align: left;
            border: 1px solid var(--ft-grey-light);
        }

        .data-table th {
            font-family: 'Monument', monospace;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: var(--ft-black);
            color: var(--ft-white);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            border: 1px solid var(--ft-black);
        }

        .badge-green {
            background: #D1FAE5;
            color: #065F46;
        }

        .badge-yellow {
            background: var(--ft-yellow);
            color: var(--ft-black);
        }

        .badge-red {
            background: #FEE2E2;
            color: #991B1B;
        }

        /* === CHART === */
        .chart-container {
            background: var(--ft-white);
            padding: calc(var(--spacing-unit) * 4);
            border: 2px solid var(--ft-black);
            margin: calc(var(--spacing-unit) * 4) 0;
        }

        /* === ACTION CARD === */
        .action-card {
            background: var(--ft-white);
            border: 2px solid var(--ft-black);
            padding: calc(var(--spacing-unit) * 4);
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .action-card.complete {
            border-color: var(--ft-green);
            border-width: 3px;
        }

        .action-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: calc(var(--spacing-unit) * 3);
            padding-bottom: calc(var(--spacing-unit) * 2);
            border-bottom: 2px solid var(--ft-grey-light);
        }

        .action-number {
            font-family: 'Plaak', sans-serif;
            font-size: 28px;
        }

        .status-icon {
            font-size: 24px;
            color: var(--ft-green);
        }

        /* === COMMITMENT === */
        .commitment-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 2);
            background: var(--ft-grey-light);
            border-left: 3px solid var(--ft-grey);
        }

        .commitment-row.committed {
            background: #F0FDF4;
            border-left-color: var(--ft-green);
        }

        /* === MODAL === */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: var(--ft-white);
            border: 3px solid var(--ft-black);
            padding: calc(var(--spacing-unit) * 6);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            float: right;
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            line-height: 1;
        }

        /* === SUCCESS === */
        .success-message {
            background: #F0FDF4;
            border: 3px solid var(--ft-green);
            padding: calc(var(--spacing-unit) * 6);
            text-align: center;
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        /* === LOADING === */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid var(--ft-yellow);
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === UTILITIES === */
        .hidden {
            display: none !important;
        }

        .mt-4 { margin-top: calc(var(--spacing-unit) * 4); }
        .mt-6 { margin-top: calc(var(--spacing-unit) * 6); }
        .mb-2 { margin-bottom: calc(var(--spacing-unit) * 2); }
        .mb-4 { margin-bottom: calc(var(--spacing-unit) * 4); }
        .mb-6 { margin-bottom: calc(var(--spacing-unit) * 6); }

        /* === RESPONSIVE === */
        @media (max-width: 968px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .main-content {
                margin-left: 0;
                padding: calc(var(--spacing-unit) * 3);
            }

            h1 { font-size: 32px; }
            h2 { font-size: 24px; }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container" id="app">

        <!-- LEFT SIDEBAR NAVIGATION -->
        <nav class="sidebar">
            <div class="sidebar-logo">FAST TRACK</div>

            <div class="sidebar-section">
                <div class="sidebar-title">Navigation</div>
                <div id="nav-items"></div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Progress</div>
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progress-text">0% Complete</div>
                </div>
            </div>

            <button class="help-link" onclick="app.showHelp()">
                ? Help & Instructions
            </button>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="main-content" id="main-content">
            <!-- Content dynamically loaded here -->
        </main>

        <!-- HELP MODAL -->
        <div id="help-modal" class="modal-overlay hidden" onclick="if(event.target===this) app.hideHelp()">
            <div class="modal">
                <button class="modal-close" onclick="app.hideHelp()">√ó</button>
                <div id="help-content"></div>
            </div>
        </div>

        <!-- LOADING -->
        <div id="loading" class="loading-overlay hidden">
            <div class="spinner"></div>
        </div>

    </div>

    <script>
        // Supabase Config
        const SUPABASE_URL = 'https://lutzzfaedkbsmbobmrzx.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U';

        let supabaseClient;
        if (window.supabase) {
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        }

        const STORAGE_KEY = 'fasttrack_team_tool_v3';

        // Fast Track Logo SVG (F mark)
        const FT_LOGO_SVG = `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="4" fill="black"/>
            <rect y="14" width="24" height="4" fill="black"/>
            <rect y="28" width="16" height="4" fill="black"/>
        </svg>`;

        // App State
        const app = {
            currentSection: 0,
            userEmail: '',
            teamName: '',
            members: [],
            newMemberName: '',
            currentMemberIndex: 0,
            improvements: {},
            actions: [
                { what: '', who: '', when: '' },
                { what: '', who: '', when: '' },
                { what: '', who: '', when: '' }
            ],
            commitments: {},
            submitted: false,
            chart: null,

            sections: [
                { id: 0, title: 'Introduction', completed: false },
                { id: 1, title: 'Setup: Email & Team Name', completed: false },
                { id: 2, title: 'Setup: Add Team Members', completed: false },
                // Dynamic sections for each member's scores will be added
                { id: 'analysis', title: 'Team Analysis', completed: false },
                { id: 'improvement', title: 'Improvement Plan', completed: false },
                { id: 'actions', title: 'Action Commitments', completed: false },
                { id: 'commitment', title: 'Commitment Lock', completed: false },
                { id: 'export', title: 'Summary & Export', completed: false }
            ],

            init() {
                this.loadFromStorage();
                this.updateMemberSections();
                this.render();
                this.renderNav();
                this.updateProgress();

                // URL params
                const urlParams = new URLSearchParams(window.location.search);
                const emailParam = urlParams.get('email');
                if (emailParam) {
                    this.userEmail = emailParam;
                    this.loadFromSupabase(emailParam);
                }
            },

            updateMemberSections() {
                // Remove old member sections
                this.sections = this.sections.filter(s => typeof s.id !== 'string' || !s.id.startsWith('member-'));

                // Add new member sections after "Add Team Members"
                const insertIndex = 3;
                this.members.forEach((member, index) => {
                    this.sections.splice(insertIndex + index, 0, {
                        id: `member-${index}`,
                        title: `Scores: ${member.name}`,
                        completed: this.isMemberScoresComplete(index)
                    });
                });
            },

            isMemberScoresComplete(index) {
                const member = this.members[index];
                if (!member || !member.scores) return false;
                return member.scores.trust && member.scores.conflict &&
                       member.scores.commitment && member.scores.accountability &&
                       member.scores.results;
            },

            goToSection(sectionId) {
                if (typeof sectionId === 'number') {
                    this.currentSection = sectionId;
                } else {
                    const section = this.sections.find(s => s.id === sectionId);
                    if (section) {
                        this.currentSection = this.sections.indexOf(section);
                    }
                }
                this.render();
                this.renderNav();
                window.scrollTo(0, 0);
            },

            nextSection() {
                if (this.currentSection < this.sections.length - 1) {
                    this.sections[this.currentSection].completed = true;
                    this.currentSection++;
                    this.render();
                    this.renderNav();
                    this.updateProgress();
                    window.scrollTo(0, 0);
                    this.autoSave();
                }
            },

            prevSection() {
                if (this.currentSection > 0) {
                    this.currentSection--;
                    this.render();
                    this.renderNav();
                    window.scrollTo(0, 0);
                }
            },

            render() {
                const section = this.sections[this.currentSection];
                const content = document.getElementById('main-content');

                if (section.id === 0) {
                    content.innerHTML = this.renderIntro();
                } else if (section.id === 1) {
                    content.innerHTML = this.renderSetup1();
                } else if (section.id === 2) {
                    content.innerHTML = this.renderSetup2();
                } else if (typeof section.id === 'string' && section.id.startsWith('member-')) {
                    const memberIndex = parseInt(section.id.split('-')[1]);
                    content.innerHTML = this.renderMemberScores(memberIndex);
                } else if (section.id === 'analysis') {
                    content.innerHTML = this.renderAnalysis();
                    setTimeout(() => this.renderChart(), 100);
                } else if (section.id === 'improvement') {
                    content.innerHTML = this.renderImprovement();
                } else if (section.id === 'actions') {
                    content.innerHTML = this.renderActions();
                } else if (section.id === 'commitment') {
                    content.innerHTML = this.renderCommitment();
                } else if (section.id === 'export') {
                    content.innerHTML = this.renderExport();
                }
            },

            renderIntro() {
                return `
                    <div class="section">
                        <h1>5 Dysfunctions of a Team</h1>
                        <p class="lead">
                            Patrick Lencioni's framework reveals why teams fail and how to fix them.
                            This tool diagnoses your team's dysfunctions, prioritizes improvements, and creates concrete commitments.
                        </p>

                        <div class="info-box info-box-yellow">
                            <div class="info-box-header">
                                ${FT_LOGO_SVG}
                                <div class="info-box-label">FAST TRACK INSIGHT</div>
                            </div>
                            <div class="info-box-body">
                                <strong>The 80/20 Principle:</strong> 80% of team dysfunction comes from 20% of root causes.
                                This tool finds your critical 20% so you stop wasting energy on symptoms.
                            </div>
                        </div>

                        <h3>The 5 Dysfunctions Pyramid</h3>
                        <div class="content-block">
                            <ol>
                                <li><strong>Absence of Trust:</strong> Team members don't feel safe being vulnerable with each other</li>
                                <li><strong>Fear of Conflict:</strong> Teams avoid productive ideological debate</li>
                                <li><strong>Lack of Commitment:</strong> Without conflict, there's no genuine buy-in to decisions</li>
                                <li><strong>Avoidance of Accountability:</strong> Without commitment, peers don't call out poor performance</li>
                                <li><strong>Inattention to Results:</strong> Without accountability, team members prioritize ego over collective success</li>
                            </ol>
                        </div>

                        <h3>What You'll Create:</h3>
                        <ul>
                            <li>Visual radar chart of your team's dysfunction profile</li>
                            <li>Top 3 priorities ranked by severity (focus on what matters)</li>
                            <li>3 concrete actions with single-person ownership and real deadlines</li>
                            <li>Digital commitment from every team member (100% buy-in required)</li>
                            <li>Exportable PDF for permanent records</li>
                        </ul>

                        <div class="highlight-box">
                            <strong>BEFORE YOU START:</strong> Each team member must complete their individual 5 Dysfunctions assessment first.
                            If assessments aren't done, stop now and reschedule.
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="app.nextSection()">
                                Begin Assessment ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            },

            renderSetup1() {
                return `
                    <div class="section">
                        <h2>Setup: Email & Team Name</h2>

                        <div class="info-box info-box-yellow">
                            <div class="info-box-header">
                                ${FT_LOGO_SVG}
                                <div class="info-box-label">FAST TRACK INSIGHT</div>
                            </div>
                            <div class="info-box-body">
                                <strong>Die Empty:</strong> This assessment means nothing without action.
                                Your email ensures you get a PDF copy and can resume if interrupted.
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="label">Your Email Address</label>
                            <input
                                type="email"
                                id="user-email"
                                value="${this.userEmail}"
                                placeholder="your.email@company.com"
                                oninput="app.userEmail = this.value; app.autoSave()">
                            <p style="font-size: 14px; color: #666; margin-top: 8px;">
                                Used to save your progress and send you the final PDF
                            </p>
                        </div>

                        <div class="input-group">
                            <label class="label">Team Name *</label>
                            <input
                                type="text"
                                id="team-name"
                                value="${this.teamName}"
                                placeholder="Product Team, Engineering, Leadership Team..."
                                oninput="app.teamName = this.value; app.autoSave()">
                        </div>

                        <div class="content-block">
                            <h4>Why This Matters</h4>
                            <p>
                                Naming your team creates identity and ownership. "The leadership team" is more powerful than "us".
                                This small act of definition starts the transformation process.
                            </p>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">
                                ‚Üê Back
                            </button>
                            <button
                                class="btn btn-primary"
                                onclick="app.nextSection()"
                                ${!this.teamName.trim() ? 'disabled' : ''}>
                                Continue to Add Members ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            },

            renderSetup2() {
                return `
                    <div class="section">
                        <h2>Setup: Add Team Members</h2>

                        <p class="lead">
                            Add everyone who completed an individual assessment. You'll enter their scores on the next screens
                            (one person per screen to reduce cognitive load).
                        </p>

                        <div class="input-group">
                            <label class="label">Add Team Member</label>
                            <div style="display: flex; gap: 12px;">
                                <input
                                    type="text"
                                    id="new-member-name"
                                    value="${this.newMemberName}"
                                    placeholder="Full name"
                                    oninput="app.newMemberName = this.value"
                                    onkeypress="if(event.key==='Enter') app.addMember()">
                                <button class="btn btn-primary" onclick="app.addMember()">
                                    Add Member
                                </button>
                            </div>
                        </div>

                        ${this.members.length > 0 ? `
                            <h3>Team Members (${this.members.length})</h3>
                            ${this.members.map((m, i) => `
                                <div class="member-list-item">
                                    <span class="member-name">${m.name}</span>
                                    <button class="member-remove" onclick="app.removeMember(${i})">Remove</button>
                                </div>
                            `).join('')}
                        ` : `
                            <div class="content-block">
                                <p>No members added yet. Add at least one team member to continue.</p>
                            </div>
                        `}

                        <div class="info-box info-box-grey">
                            <div class="info-box-header">
                                <div style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üî¨</div>
                                <div class="info-box-label">THE SCIENCE</div>
                            </div>
                            <div class="info-box-body">
                                Lencioni's research shows optimal team size is 3-12 people. Below 3, there's insufficient diversity.
                                Above 12, sub-groups form and trust breaks down.
                            </div>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">
                                ‚Üê Back
                            </button>
                            <button
                                class="btn btn-primary"
                                onclick="app.nextSection()"
                                ${this.members.length === 0 ? 'disabled' : ''}>
                                Continue to Enter Scores ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            },

            renderMemberScores(memberIndex) {
                const member = this.members[memberIndex];
                if (!member.scores) {
                    member.scores = { trust: null, conflict: null, commitment: null, accountability: null, results: null };
                }

                const isComplete = this.isMemberScoresComplete(memberIndex);
                const remaining = this.members.length - memberIndex - 1;

                return `
                    <div class="section">
                        <h2>Individual Scores: ${member.name}</h2>

                        <p class="lead">
                            Enter ${member.name}'s individual assessment scores below.
                            ${remaining > 0 ? `After this, you'll enter scores for ${remaining} more ${remaining === 1 ? 'person' : 'people'}.` : 'This is the last person!'}
                        </p>

                        <div class="score-card">
                            <div class="score-card-header">
                                <div class="score-card-title">${member.name}</div>
                                ${isComplete ? '<span style="color: var(--ft-green); font-size: 24px;">‚úì</span>' : ''}
                            </div>

                            <p class="mb-4" style="font-size: 14px; color: #666;">
                                <strong>Scale:</strong> 1 = Low dysfunction (healthy), 10 = High dysfunction (critical issue)
                            </p>

                            ${this.renderScoreItem('trust', 'Absence of Trust', member.scores.trust, memberIndex, 'Team members hide weaknesses and mistakes from one another')}
                            ${this.renderScoreItem('conflict', 'Fear of Conflict', member.scores.conflict, memberIndex, 'Team avoids uncomfortable conversations and debates')}
                            ${this.renderScoreItem('commitment', 'Lack of Commitment', member.scores.commitment, memberIndex, 'Team members are ambiguous about decisions and priorities')}
                            ${this.renderScoreItem('accountability', 'Avoidance of Accountability', member.scores.accountability, memberIndex, 'Team members hesitate to call out peers on behaviors')}
                            ${this.renderScoreItem('results', 'Inattention to Results', member.scores.results, memberIndex, 'Team members prioritize individual goals over collective success')}
                        </div>

                        <div class="info-box info-box-yellow">
                            <div class="info-box-header">
                                ${FT_LOGO_SVG}
                                <div class="info-box-label">FAST TRACK INSIGHT</div>
                            </div>
                            <div class="info-box-body">
                                <strong>Brutal Honesty Required:</strong> Inflating scores to "look good" defeats the purpose.
                                The tool only works if you're willing to face reality.
                            </div>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">
                                ‚Üê Back
                            </button>
                            <button
                                class="btn btn-primary"
                                onclick="app.nextSection()"
                                ${!isComplete ? 'disabled' : ''}>
                                ${remaining > 0 ? `Next Person (${remaining} remaining) ‚Üí` : 'Continue to Analysis ‚Üí'}
                            </button>
                        </div>
                    </div>
                `;
            },

            renderScoreItem(key, label, value, memberIndex, description) {
                return `
                    <div class="score-item">
                        <div class="score-label">
                            <strong>${label}</strong>
                            <div style="font-size: 13px; color: #666; margin-top: 4px;">${description}</div>
                        </div>
                        <div class="score-input-wrapper">
                            <input
                                type="number"
                                class="score-input ${value ? 'success' : ''}"
                                value="${value || ''}"
                                min="1"
                                max="10"
                                placeholder="1-10"
                                oninput="app.updateMemberScore(${memberIndex}, '${key}', this.value)">
                            <span class="score-scale">1-10</span>
                        </div>
                    </div>
                `;
            },

            updateMemberScore(memberIndex, key, value) {
                if (!this.members[memberIndex].scores) {
                    this.members[memberIndex].scores = {};
                }
                this.members[memberIndex].scores[key] = parseInt(value) || null;
                this.updateMemberSections();
                this.renderNav();
                this.autoSave();
            },

            renderAnalysis() {
                const scores = this.calculateTeamScores();
                if (!scores) {
                    return `
                        <div class="section">
                            <h2>Team Analysis</h2>
                            <div class="content-block">
                                <p>Please enter scores for all team members first.</p>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-secondary" onclick="app.prevSection()">‚Üê Back</button>
                            </div>
                        </div>
                    `;
                }

                const sorted = this.sortedDysfunctions();

                return `
                    <div class="section">
                        <h2>Team Analysis</h2>

                        <p class="lead">
                            Below is your team's collective dysfunction profile. Higher scores = bigger problems.
                            Focus on the red and yellow zones first.
                        </p>

                        <div class="info-box info-box-grey info-box-expandable" onclick="this.classList.toggle('expanded')">
                            <div class="info-box-header">
                                <div style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üî¨</div>
                                <div class="info-box-label">THE SCIENCE</div>
                            </div>
                            <div class="info-box-body">
                                Lencioni's model is based on organizational psychology research showing dysfunctions build hierarchically.
                                <div class="info-box-expand">
                                    <span>Read more</span>
                                    <span class="info-box-expand-icon">‚ñº</span>
                                </div>
                                <div class="info-box-expanded-content">
                                    <p class="mt-2">
                                        Without trust, teams avoid conflict. Without conflict, there's no genuine commitment.
                                        Without commitment, accountability fails. Without accountability, team results suffer.
                                        The model has been validated across 1000+ organizations since 2002. Start at the bottom of the pyramid (trust) and work up.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <h3>Dysfunction Scores</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Dysfunction</th>
                                    <th>Score</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sorted.map(item => `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td><strong>${item.score.toFixed(1)}</strong></td>
                                        <td><span class="badge badge-${item.badge.color}">${item.badge.label}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>

                        <div class="chart-container">
                            <h3 style="margin-bottom: 24px;">Team Dysfunction Profile</h3>
                            <canvas id="radarChart"></canvas>
                        </div>

                        <div class="content-block">
                            <h4>How to Read This Chart</h4>
                            <p>
                                <strong>Green (1-3.9):</strong> Strengths. Your team excels here.<br>
                                <strong>Yellow (4-6.9):</strong> Opportunities. Room for improvement.<br>
                                <strong>Red (7-10):</strong> Priorities. Critical issues requiring immediate attention.
                            </p>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="app.nextSection()">Continue to Improvement Plan ‚Üí</button>
                        </div>
                    </div>
                `;
            },

            renderImprovement() {
                const top3 = this.top3Dysfunctions();

                return `
                    <div class="section">
                        <h2>Improvement Plan</h2>

                        <div class="info-box info-box-yellow">
                            <div class="info-box-header">
                                ${FT_LOGO_SVG}
                                <div class="info-box-label">FAST TRACK INSIGHT</div>
                            </div>
                            <div class="info-box-body">
                                <strong>The 80/20 Rule:</strong> Fixing your top 3 dysfunctions will solve 80% of your team's problems.
                                Trying to fix all 5 at once guarantees failure. Focus creates momentum.
                            </div>
                        </div>

                        <p class="lead">
                            Focus exclusively on your top 3 dysfunctions. For each, describe specific strategies your team will implement.
                        </p>

                        ${top3.map((item, index) => `
                            <div class="score-card">
                                <div class="score-card-header">
                                    <div class="score-card-title">Priority #${index + 1}: ${item.name}</div>
                                    <div>
                                        <span style="font-size: 20px; font-weight: bold;">${item.score.toFixed(1)}</span>
                                        <span class="badge badge-${item.badge.color}" style="margin-left: 8px;">${item.badge.label}</span>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label class="label">How will your team improve in this area?</label>
                                    <textarea
                                        oninput="app.improvements['${item.key}'] = this.value; app.autoSave()"
                                        placeholder="Describe specific strategies, behaviors to change, or practices to implement...">${this.improvements[item.key] || ''}</textarea>
                                    <p style="font-size: 13px; color: #666; margin-top: 8px;">
                                        Be specific: "Weekly vulnerability exercises" not "build more trust"
                                    </p>
                                </div>
                            </div>
                        `).join('')}

                        <div class="content-block">
                            <h4>What Makes a Good Improvement Strategy?</h4>
                            <ul>
                                <li><strong>Specific:</strong> "15-minute daily standups" not "communicate more"</li>
                                <li><strong>Behavioral:</strong> What will people DO differently?</li>
                                <li><strong>Measurable:</strong> How will you know it's working?</li>
                            </ul>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="app.nextSection()">Continue to Action Commitments ‚Üí</button>
                        </div>
                    </div>
                `;
            },

            renderActions() {
                const validCount = this.validActionsCount();

                return `
                    <div class="section">
                        <h2>Action Commitments</h2>

                        <div class="info-box info-box-yellow">
                            <div class="info-box-header">
                                ${FT_LOGO_SVG}
                                <div class="info-box-label">FAST TRACK INSIGHT</div>
                            </div>
                            <div class="info-box-body">
                                <strong>No Vague Commitments:</strong> "Improve communication" never happens. "Who" must be one person. "When" must be a date. "What" must be specific (30+ characters). Constraints create accountability.
                            </div>
                        </div>

                        <div class="highlight-box">
                            <strong>Progress:</strong> ${validCount} of 3 actions complete
                        </div>

                        ${[0, 1, 2].map(index => {
                            const action = this.actions[index];
                            const isValid = this.isActionValid(index);
                            return `
                                <div class="action-card ${isValid ? 'complete' : ''}">
                                    <div class="action-card-header">
                                        <span class="action-number">Action #${index + 1}</span>
                                        ${isValid ? '<span class="status-icon">‚úì</span>' : ''}
                                    </div>

                                    <div class="input-group">
                                        <label class="label">What specific action will be taken? *</label>
                                        <textarea
                                            oninput="app.actions[${index}].what = this.value; app.autoSave(); app.render()"
                                            class="${action.what.trim().length >= 30 ? 'success' : action.what.trim().length > 0 ? 'error' : ''}"
                                            placeholder="Be specific: What exactly will happen? What's the desired outcome?">${action.what}</textarea>
                                        <div class="char-counter ${action.what.trim().length >= 30 ? 'success' : action.what.trim().length > 0 ? 'error' : ''}">
                                            ${action.what.trim().length} / 30 minimum characters
                                        </div>
                                    </div>

                                    <div class="input-group">
                                        <label class="label">Who is responsible? *</label>
                                        <select
                                            onchange="app.actions[${index}].who = this.value; app.autoSave(); app.render()"
                                            class="${action.who ? 'success' : ''}">
                                            <option value="">Select person...</option>
                                            ${this.members.map(m => `
                                                <option value="${m.name}" ${action.who === m.name ? 'selected' : ''}>${m.name}</option>
                                            `).join('')}
                                        </select>
                                        <p style="font-size: 13px; color: #666; margin-top: 8px;">
                                            Single-person ownership only (no "All" or "Team" option)
                                        </p>
                                    </div>

                                    <div class="input-group">
                                        <label class="label">When will it be done? *</label>
                                        <input
                                            type="date"
                                            value="${action.when}"
                                            onchange="app.actions[${index}].when = this.value; app.autoSave(); app.render()"
                                            class="${action.when ? 'success' : ''}"
                                            min="${new Date().toISOString().split('T')[0]}">
                                        <p style="font-size: 13px; color: #666; margin-top: 8px;">
                                            Specific date required (no "Ongoing" or "TBD" allowed)
                                        </p>
                                    </div>
                                </div>
                            `;
                        }).join('')}

                        <div class="content-block">
                            <h4>Why These Constraints Matter</h4>
                            <p>
                                Research shows vague commitments have a 5% completion rate. Specific commitments with
                                single-person ownership and deadlines have a 65% completion rate. The constraints aren't bureaucracy‚Äîthey're what makes change actually happen.
                            </p>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">‚Üê Back</button>
                            <button
                                class="btn btn-primary"
                                onclick="app.nextSection()"
                                ${validCount < 3 ? 'disabled' : ''}>
                                Continue to Commitment Lock ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            },

            renderCommitment() {
                const committedCount = Object.keys(this.commitments).length;
                const totalCount = this.members.length;
                const percent = totalCount > 0 ? (committedCount / totalCount) * 100 : 0;
                const allCommitted = committedCount === totalCount && totalCount > 0;

                return `
                    <div class="section">
                        <h2>Commitment Check</h2>

                        <div class="info-box info-box-black">
                            <div class="info-box-header">
                                <div style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--ft-yellow);">‚ö†Ô∏è</div>
                                <div class="info-box-label" style="color: var(--ft-yellow);">CRITICAL REQUIREMENT</div>
                            </div>
                            <div class="info-box-body">
                                <strong>100% Commitment or Nothing:</strong> One uncommitted person undermines the entire team.
                                Everyone must digitally sign off. No exceptions.
                            </div>
                        </div>

                        <div class="highlight-box">
                            <h3 style="margin-bottom: 16px;">${committedCount} of ${totalCount} committed</h3>
                            <div class="progress-bar" style="height: 12px; background: #E5E5E5;">
                                <div class="progress-fill" style="width: ${percent}%; background: var(--ft-green);"></div>
                            </div>
                        </div>

                        ${this.members.map(m => {
                            const isCommitted = !!this.commitments[m.id];
                            return `
                                <div class="commitment-row ${isCommitted ? 'committed' : ''}">
                                    <span style="font-size: 18px; font-weight: 600;">${m.name}</span>
                                    <button
                                        class="btn btn-small ${isCommitted ? 'btn-primary' : 'btn-secondary'}"
                                        onclick="app.commit('${m.id}')"
                                        ${isCommitted ? 'disabled' : ''}>
                                        ${isCommitted ? '‚úì Committed' : 'I Commit'}
                                    </button>
                                </div>
                            `;
                        }).join('')}

                        ${allCommitted ? `
                            <div class="content-block" style="background: #F0FDF4; border-left-color: var(--ft-green);">
                                <h4>üéâ 100% Team Commitment Achieved!</h4>
                                <p>
                                    Every team member has signed off. This is where most teams fail‚Äîgetting to 100%.
                                    Your team just demonstrated they're serious about change.
                                </p>
                            </div>
                        ` : ''}

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">‚Üê Back</button>
                            <button
                                class="btn btn-primary"
                                onclick="app.nextSection()"
                                ${!allCommitted ? 'disabled' : ''}>
                                Continue to Summary ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            },

            renderExport() {
                const top3 = this.top3Dysfunctions();

                if (this.submitted) {
                    return `
                        <div class="section">
                            <div class="success-message">
                                <div class="success-icon">üéâ</div>
                                <h2 style="margin-bottom: 16px;">Assessment Complete!</h2>
                                <p style="margin-bottom: 32px;">
                                    Your team analysis has been saved. Export your PDF and share it with the team immediately.
                                </p>
                                <div class="btn-group">
                                    <button class="btn btn-primary" onclick="app.exportPDF()">
                                        üìÑ Export PDF
                                    </button>
                                    <button class="btn btn-secondary" onclick="window.location.href='https://fasttrack.learnworlds.com'">
                                        ‚Üê Back to LMS
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="section">
                        <h2>Summary & Export</h2>

                        <div class="info-box info-box-yellow">
                            <div class="info-box-header">
                                ${FT_LOGO_SVG}
                                <div class="info-box-label">NEXT STEPS</div>
                            </div>
                            <div class="info-box-body">
                                <strong>After clicking "Save & Submit":</strong><br>
                                1. Export PDF and email it to the entire team within 24 hours<br>
                                2. Schedule a 30-day check-in to review progress on the 3 actions<br>
                                3. Re-run this assessment quarterly to track improvement
                            </div>
                        </div>

                        <div class="score-card">
                            <div class="score-card-header">
                                <h3>Team: ${this.teamName}</h3>
                            </div>
                            <p>${this.members.length} members ‚Ä¢ ${this.validActionsCount()} actions ‚Ä¢ ${Object.keys(this.commitments).length} commitments</p>
                        </div>

                        <div class="content-block">
                            <h4>Top 3 Dysfunctions</h4>
                            <ol>
                                ${top3.map(item => `
                                    <li><strong>${item.name}</strong>: ${item.score.toFixed(1)} (${item.badge.label})</li>
                                `).join('')}
                            </ol>
                        </div>

                        <div class="content-block">
                            <h4>Action Commitments</h4>
                            ${this.actions.filter(a => a.what).map((action, i) => `
                                <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #ddd;">
                                    <strong>Action #${i + 1}:</strong> ${action.what.substring(0, 80)}...<br>
                                    <strong>Who:</strong> ${action.who} | <strong>When:</strong> ${action.when}
                                </div>
                            `).join('')}
                        </div>

                        <div class="info-box info-box-black">
                            <div class="info-box-header">
                                <div style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--ft-yellow);">üìñ</div>
                                <div class="info-box-label" style="color: var(--ft-yellow);">REAL EXAMPLE</div>
                            </div>
                            <div class="info-box-body">
                                <p><strong>Company:</strong> 50-person SaaS startup</p>
                                <p><strong>Problem:</strong> Executive team scored 8.5 on "Avoidance of Accountability"</p>
                                <p><strong>Action:</strong> Implemented weekly accountability check-ins where each exec publicly stated if they hit their commitments</p>
                                <p><strong>Result:</strong> After 90 days, score dropped to 4.2. Product launch timeline improved from 6 months to 4 months.</p>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="app.prevSection()">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="app.saveAndSubmit()">
                                Save & Submit
                            </button>
                        </div>
                    </div>
                `;
            },

            renderNav() {
                const navItems = document.getElementById('nav-items');
                navItems.innerHTML = this.sections.map((section, index) => `
                    <div
                        class="nav-item ${this.currentSection === index ? 'active' : ''} ${section.completed ? 'completed' : ''}"
                        onclick="app.goToSection(${typeof section.id === 'number' ? section.id : `'${section.id}'`})">
                        <span>${section.title}</span>
                        ${section.completed ? '<span class="nav-item-check">‚úì</span>' : ''}
                    </div>
                `).join('');
            },

            updateProgress() {
                const completed = this.sections.filter(s => s.completed).length;
                const total = this.sections.length;
                const percent = (completed / total) * 100;

                document.getElementById('progress-fill').style.width = `${percent}%`;
                document.getElementById('progress-text').textContent = `${Math.round(percent)}% Complete`;
            },

            addMember() {
                if (this.newMemberName.trim()) {
                    this.members.push({
                        id: Date.now().toString(),
                        name: this.newMemberName.trim(),
                        scores: { trust: null, conflict: null, commitment: null, accountability: null, results: null }
                    });
                    this.newMemberName = '';
                    this.updateMemberSections();
                    this.render();
                    this.renderNav();
                    this.autoSave();
                }
            },

            removeMember(index) {
                this.members.splice(index, 1);
                this.updateMemberSections();
                this.render();
                this.renderNav();
                this.autoSave();
            },

            calculateTeamScores() {
                const membersWithScores = this.members.filter(m =>
                    m.scores && m.scores.trust && m.scores.conflict &&
                    m.scores.commitment && m.scores.accountability && m.scores.results
                );

                if (membersWithScores.length === 0) return null;

                const scores = { trust: 0, conflict: 0, commitment: 0, accountability: 0, results: 0 };

                membersWithScores.forEach(member => {
                    scores.trust += member.scores.trust;
                    scores.conflict += member.scores.conflict;
                    scores.commitment += member.scores.commitment;
                    scores.accountability += member.scores.accountability;
                    scores.results += member.scores.results;
                });

                const count = membersWithScores.length;
                return {
                    trust: scores.trust / count,
                    conflict: scores.conflict / count,
                    commitment: scores.commitment / count,
                    accountability: scores.accountability / count,
                    results: scores.results / count
                };
            },

            sortedDysfunctions() {
                const scores = this.calculateTeamScores();
                if (!scores) return [];

                const dysfunctions = [
                    { key: 'trust', name: 'Absence of Trust', score: scores.trust },
                    { key: 'conflict', name: 'Fear of Conflict', score: scores.conflict },
                    { key: 'commitment', name: 'Lack of Commitment', score: scores.commitment },
                    { key: 'accountability', name: 'Avoidance of Accountability', score: scores.accountability },
                    { key: 'results', name: 'Inattention to Results', score: scores.results }
                ];

                return dysfunctions.map(d => ({
                    ...d,
                    badge: this.getSeverityBadge(d.score)
                })).sort((a, b) => b.score - a.score);
            },

            top3Dysfunctions() {
                return this.sortedDysfunctions().slice(0, 3);
            },

            getSeverityBadge(score) {
                if (score >= 1 && score < 4) return { color: 'green', label: 'Strength' };
                if (score >= 4 && score < 7) return { color: 'yellow', label: 'Opportunity' };
                if (score >= 7 && score <= 10) return { color: 'red', label: 'Priority' };
                return { color: 'grey', label: 'Unknown' };
            },

            renderChart() {
                const scores = this.calculateTeamScores();
                if (!scores) return;

                const canvas = document.getElementById('radarChart');
                if (!canvas) return;

                if (this.chart) {
                    this.chart.destroy();
                }

                const ctx = canvas.getContext('2d');
                this.chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: [
                            'Absence of Trust',
                            'Fear of Conflict',
                            'Lack of Commitment',
                            'Avoidance of Accountability',
                            'Inattention to Results'
                        ],
                        datasets: [{
                            label: 'Team Scores',
                            data: [scores.trust, scores.conflict, scores.commitment, scores.accountability, scores.results],
                            backgroundColor: 'rgba(255, 244, 105, 0.2)',
                            borderColor: '#000000',
                            borderWidth: 3,
                            pointBackgroundColor: '#000000',
                            pointRadius: 5
                        }]
                    },
                    options: {
                        scales: {
                            r: {
                                min: 0,
                                max: 10,
                                ticks: { stepSize: 2 }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            },

            isActionValid(index) {
                const action = this.actions[index];
                return action.what.trim().length >= 30 && action.who !== '' && action.when !== '';
            },

            validActionsCount() {
                return this.actions.filter((_, i) => this.isActionValid(i)).length;
            },

            commit(memberId) {
                this.commitments[memberId] = new Date().toISOString();
                this.render();
                this.autoSave();
            },

            autoSave() {
                const data = {
                    userEmail: this.userEmail,
                    teamName: this.teamName,
                    members: this.members,
                    improvements: this.improvements,
                    actions: this.actions,
                    commitments: this.commitments,
                    sections: this.sections,
                    currentSection: this.currentSection
                };

                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                this.updateProgress();

                clearTimeout(this.saveTimer);
                this.saveTimer = setTimeout(() => {
                    if (this.userEmail && this.teamName) {
                        this.saveToSupabase();
                    }
                }, 2000);
            },

            loadFromStorage() {
                try {
                    const saved = localStorage.getItem(STORAGE_KEY);
                    if (saved) {
                        const data = JSON.parse(saved);
                        Object.assign(this, data);
                    }
                } catch (e) {
                    console.error('Error loading from storage:', e);
                }
            },

            async saveToSupabase() {
                if (!supabaseClient) return;
                try {
                    await supabaseClient.from('sprint_04_team').upsert({
                        user_email: this.userEmail,
                        tool_slug: 'team',
                        sprint_number: 4,
                        data: {
                            teamName: this.teamName,
                            members: this.members,
                            improvements: this.improvements,
                            actions: this.actions,
                            commitments: this.commitments
                        },
                        updated_at: new Date().toISOString()
                    }, {
                        onConflict: 'user_email,tool_slug,sprint_number'
                    });
                } catch (e) {
                    console.error('Supabase save error:', e);
                }
            },

            async loadFromSupabase(email) {
                if (!supabaseClient) return;
                try {
                    const { data, error } = await supabaseClient
                        .from('sprint_04_team')
                        .select('data')
                        .eq('user_email', email)
                        .eq('tool_slug', 'team')
                        .single();

                    if (data && !error) {
                        Object.assign(this, data.data);
                        this.render();
                        this.renderNav();
                    }
                } catch (e) {
                    console.error('Supabase load error:', e);
                }
            },

            async saveAndSubmit() {
                document.getElementById('loading').classList.remove('hidden');
                await this.saveToSupabase();
                setTimeout(() => {
                    document.getElementById('loading').classList.add('hidden');
                    this.submitted = true;
                    this.render();
                }, 1000);
            },

            async exportPDF() {
                document.getElementById('loading').classList.remove('hidden');
                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();

                    // Page 1: Cover
                    pdf.setFontSize(24);
                    pdf.text('5 Dysfunctions of a Team', 20, 40);
                    pdf.setFontSize(16);
                    pdf.text(`Team: ${this.teamName}`, 20, 55);
                    pdf.setFontSize(12);
                    pdf.text(`Date: ${new Date().toLocaleDateString()}`, 20, 70);
                    pdf.text('Fast Track Leadership Development', 20, 85);

                    // Page 2: Scores
                    pdf.addPage();
                    pdf.setFontSize(18);
                    pdf.text('Dysfunction Scores', 20, 20);

                    let yPos = 35;
                    this.sortedDysfunctions().forEach(d => {
                        pdf.setFontSize(12);
                        pdf.text(`${d.name}: ${d.score.toFixed(1)} (${d.badge.label})`, 25, yPos);
                        yPos += 10;
                    });

                    // Page 3: Chart
                    const canvas = document.getElementById('radarChart');
                    if (canvas) {
                        const chartImg = await html2canvas(canvas, { scale: 2 });
                        const imgData = chartImg.toDataURL('image/png');
                        pdf.addPage();
                        pdf.setFontSize(18);
                        pdf.text('Team Dysfunction Profile', 20, 20);
                        pdf.addImage(imgData, 'PNG', 20, 35, 170, 170);
                    }

                    // Page 4: Actions
                    pdf.addPage();
                    pdf.setFontSize(18);
                    pdf.text('Action Commitments', 20, 20);

                    yPos = 35;
                    this.actions.forEach((action, i) => {
                        if (action.what) {
                            pdf.setFontSize(14);
                            pdf.text(`Action #${i + 1}`, 20, yPos);
                            yPos += 8;
                            pdf.setFontSize(11);
                            const lines = pdf.splitTextToSize(`What: ${action.what}`, 170);
                            pdf.text(lines, 25, yPos);
                            yPos += lines.length * 6;
                            pdf.text(`Who: ${action.who}`, 25, yPos);
                            yPos += 7;
                            pdf.text(`When: ${action.when}`, 25, yPos);
                            yPos += 15;
                        }
                    });

                    // Save
                    const filename = `FastTrack_Team_${this.teamName.replace(/\s+/g, '')}_${new Date().toISOString().split('T')[0]}.pdf`;
                    pdf.save(filename);
                } catch (e) {
                    console.error('PDF export error:', e);
                    alert('PDF export failed. Please try again.');
                } finally {
                    document.getElementById('loading').classList.add('hidden');
                }
            },

            showHelp() {
                const helpContent = `
                    <h2>How to Use This Tool</h2>
                    <h3>Before You Start</h3>
                    <ul>
                        <li>Each team member must complete their individual 5 Dysfunctions assessment privately</li>
                        <li>Block 45-60 minutes for the full workshop</li>
                        <li>Have the facilitator lead the session on one shared screen</li>
                    </ul>

                    <h3>During the Workshop</h3>
                    <ol>
                        <li><strong>Enter scores together:</strong> Build trust by discussing scores openly (or privately if team isn't ready)</li>
                        <li><strong>Review the radar chart:</strong> Identify which dysfunctions are red/yellow zones</li>
                        <li><strong>Focus on top 3:</strong> Resist the urge to fix everything at once</li>
                        <li><strong>Create specific actions:</strong> Vague commitments fail‚Äîbe ruthlessly specific</li>
                        <li><strong>Require 100% commitment:</strong> One holdout undermines the entire team</li>
                        <li><strong>Export immediately:</strong> Email the PDF to everyone within 24 hours</li>
                    </ol>

                    <h3>After the Workshop</h3>
                    <ul>
                        <li>Schedule a 30-day check-in to review progress on the 3 actions</li>
                        <li>Re-run this assessment quarterly to track improvement</li>
                        <li>Celebrate wins publicly when dysfunction scores improve</li>
                    </ul>

                    <h3>Common Mistakes</h3>
                    <ul>
                        <li><strong>Inflating scores:</strong> The tool only works with brutal honesty</li>
                        <li><strong>Trying to fix everything:</strong> Focus on top 3 dysfunctions only</li>
                        <li><strong>Vague actions:</strong> "Improve communication" never happens</li>
                        <li><strong>Skipping commitment:</strong> Get 100% or don't proceed</li>
                    </ul>
                `;
                document.getElementById('help-content').innerHTML = helpContent;
                document.getElementById('help-modal').classList.remove('hidden');
            },

            hideHelp() {
                document.getElementById('help-modal').classList.add('hidden');
            }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>