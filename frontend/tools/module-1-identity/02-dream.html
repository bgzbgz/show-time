<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Dream Tool | Fast Track</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <!-- LearnWorlds Auth Module -->
    <script src="../../js/auth.js"></script>
    <!-- Tool Access Control -->
    <script src="../../js/tool-access-control.js"></script>

    <!-- Font preloading to prevent FOUT -->
    <link rel="preload" href="Plaak3Trial-43-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="RiformaLL-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="MonumentGrotesk-Mono.woff2" as="font" type="font/woff2" crossorigin>

    <style>
        /* === FONT FACES === */
        @font-face { font-family: 'Plaak'; src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: normal; font-display: swap; }
        @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: 600; font-display: swap; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); font-display: swap; }

        /* === BASE RESET === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Riforma', -apple-system, sans-serif;
            font-size: 16px;
            color: #000;
            background: #000;
            -webkit-font-smoothing: antialiased;
        }

        /* === CUSTOM SCROLLBAR === */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }
        * { scrollbar-width: thin; scrollbar-color: #000 transparent; }

        /* === TYPOGRAPHY HELPERS === */
        .plaak { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }

        /* === LAYOUT FRAME === */
        .tool-frame { background: #fff; min-height: 100vh; }
        .tool-inner { background: #fff; min-height: 100vh; }

        /* === WIZARD LAYOUT === */
        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: #fff;
        }
        .wizard-content {
            max-width: 640px;
            width: 100%;
            margin: 0 auto;
            padding: 48px 32px;
            flex: 1;
        }

        /* === SIDEBAR === */
        .wizard-sidebar {
            width: 280px;
            background: #000;
            border-left: 1px solid #000;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow: hidden;
        }
        .wizard-sidebar-inner {
            padding: 32px 24px;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .sidebar-step-item {
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }
        .sidebar-step-item.active { border-left-color: #FFF469; background: #222; }
        .sidebar-step-item.completed { background: #fff; color: #000; border-left-color: #fff; cursor: pointer; }
        .sidebar-step-item.completed:hover { background: #E0E0E0; }
        .sidebar-step-item.locked { opacity: 0.5; }
        .sidebar-step-item .step-num { font-family: 'Riforma', sans-serif; font-size: 14px; }
        .sidebar-step-item .step-name { font-family: 'Riforma', sans-serif; font-size: 14px; }
        .sidebar-snippet { font-size: 12px; margin-top: 4px; opacity: 0.7; line-height: 1.3; }

        /* === STEP HEADER === */
        .step-indicator {
            font-family: 'Monument', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6B7280;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .step-time {
            font-family: 'Monument', monospace;
            font-size: 11px;
            color: #6B7280;
        }
        .step-heading {
            font-family: 'Plaak', sans-serif;
            font-weight: bold;
            font-size: 32px;
            text-transform: uppercase;
            letter-spacing: -0.01em;
            line-height: 1.2;
            color: #000;
            margin-bottom: 6px;
        }
        .step-hint {
            font-size: 16px;
            color: #6B7280;
            line-height: 1.5;
            margin: 0 0 32px 0;
        }

        /* === FORM ELEMENTS === */
        .ft-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'Monument', monospace;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #000;
            margin-bottom: 8px;
        }
        .ft-required { color: #DC2626; font-weight: 700; }

        .ft-input {
            width: 100%;
            height: 44px;
            padding: 8px 16px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            color: #000;
            background: #fff;
            border: 1px solid #E5E7EB;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .ft-input:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px #FFF469;
        }
        .ft-input.has-error {
            border: 2px solid #DC2626;
            padding-right: 40px;
        }
        .ft-input.has-error:focus {
            border-color: #DC2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
        }

        .ft-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px 16px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            color: #000;
            background: #fff;
            border: 1px solid #E5E7EB;
            resize: none !important;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .ft-textarea:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px #FFF469;
        }
        .ft-textarea.has-error {
            border: 2px solid #DC2626;
        }
        .ft-textarea.has-error:focus {
            border-color: #DC2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
        }

        .ft-help {
            font-size: 14px;
            color: #6B7280;
            margin-top: 4px;
            line-height: 1.5;
        }
        .ft-error-msg {
            font-size: 14px;
            font-weight: 600;
            color: #DC2626;
            margin-top: 4px;
            line-height: 1.4;
        }
        .ft-field-group {
            margin-bottom: 24px;
        }
        .ft-field-group:last-child { margin-bottom: 0; }
        .ft-section { margin-bottom: 32px; }

        /* === YELLOW INSIGHT BOX === */
        .ft-insight {
            background: #FFF469;
            border: 3px solid #000;
            padding: 16px;
            margin-bottom: 32px;
        }

        /* === EXAMPLE BOX === */
        .ft-example {
            background: #F3F4F6;
            padding: 16px;
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.6;
            color: #1F2937;
        }

        /* === ERROR SUMMARY === */
        .ft-error-summary {
            border: 2px solid #DC2626;
            background: #fff;
            padding: 16px;
            margin-bottom: 24px;
        }
        .ft-error-summary a {
            color: #DC2626;
            text-decoration: underline;
            cursor: pointer;
        }
        .ft-error-summary a:hover { text-decoration: none; }

        /* === BUTTON FOOTER === */
        .btn-footer {
            position: sticky;
            bottom: 0;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            border-top: 1px solid #E5E7EB;
            background: #fff;
            width: 100%;
        }
        .btn-back {
            background: #fff;
            color: #000;
            border: 2px solid #000;
            padding: 12px 24px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
        }
        .btn-back:hover { background: #F3F4F6; }
        .btn-next {
            background: #000;
            color: #fff;
            border: 2px solid #000;
            padding: 12px 24px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
        }
        .btn-next:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-next:disabled { background: #E5E7EB; color: #9CA3AF; border-color: #E5E7EB; cursor: not-allowed; }

        /* === CLOSING MESSAGE === */
        .closing-box {
            border-top: 1px solid #E5E7EB;
            padding: 20px 0 0 0;
            margin-top: 8px;
            text-align: center;
        }
        .closing-box p { font-size: 14px; color: #6B7280; }
        .closing-box .closing-title {
            font-family: 'Monument', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #000;
            margin-bottom: 6px;
        }

        /* === MOBILE STEP BAR === */
        .mobile-step-bar { display: none; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; background: #F3F4F6; }
        .mobile-step-bar .bar-text { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 6px; }
        .mobile-progress { height: 3px; background: #E5E7EB; width: 100%; }
        .mobile-progress-fill { height: 100%; background: #000; transition: width 0.3s ease; }

        /* === CANVAS STYLES === */
        .numbered-section { background: #000; color: #fff; padding: 8px 14px; font-size: 14px; font-weight: bold; letter-spacing: 0.5px; display: inline-block; font-family: 'Monument', monospace; }
        .canvas-section-box { border: 2px solid #000; background: #FAFAFA; padding: 16px; margin-bottom: 16px; }

        /* === DREAM-SPECIFIC STYLES === */
        .word-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: #000;
            color: #fff;
            font-weight: bold;
            font-size: 13px;
            margin: 3px;
        }
        .ai-option {
            border: 2px solid #E5E7EB;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .ai-option:hover {
            border-color: #000;
            background: #F3F4F6;
        }
        .ai-option.selected {
            border-color: #000;
            border-width: 3px;
            background: #FFF469;
        }
        .jargon-warning {
            background: #FEF2F2;
            border-left: 4px solid #EF4444;
            padding: 12px;
            margin-top: 8px;
            font-size: 14px;
        }
        .jargon-highlight {
            background: #FEE2E2;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: bold;
            color: #DC2626;
        }
        .strength-bar {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }
        .strength-fill {
            height: 100%;
            background: linear-gradient(to right, #EF4444, #F59E0B, #10B981);
            transition: width 0.3s ease;
        }
        .checkmark {
            display: inline-block;
            color: #10B981;
            font-size: 20px;
            font-weight: bold;
        }

        /* === ANIMATIONS === */
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-in { animation: fadeSlideIn 0.3s ease-out; }

        /* === PRINT === */
        @media print { .no-print { display: none !important; } }

        /* === RESPONSIVE === */
        @media (min-width: 769px) and (max-width: 1024px) {
            .wizard-sidebar { width: 220px; }
            .wizard-sidebar-inner { padding: 24px 16px; }
        }
        @media (max-width: 768px) {
            .wizard-sidebar { display: none; }
            .mobile-step-bar { display: block; }
            .wizard-content { padding: 24px 16px; }
            .step-heading { font-size: 24px; }
            .btn-footer { padding: 12px 16px; }
        }
        @media (max-width: 480px) {
            .step-heading { font-size: 20px; }
            .wizard-content { padding: 20px 12px; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /* ============================================================
           PRESERVED: Configuration & Initialization — do not modify
           ============================================================ */
        const CONFIG = {
            SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
            TOOL_SLUG: 'dream',
            AUTOSAVE_DELAY: 2000
        };

        // Initialize Supabase client
        const { createClient } = supabase;
        const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

        // Make Supabase client globally available for dependency injection
        window.supabaseClient = supabaseClient;

        // Initialize ToolDB and dependency injection
        ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        CognitiveLoad.init('dream', {"insights":["A company without a dream is just a job. Dreams create energy and alignment across the entire organization.","Your dream must be specific enough to measure but inspiring enough to energize."],"caseStudy":{"before":"A retail operator in Mexico had a generic vision statement: 'To be a leading retail operator providing unparalleled customer service.' Each department interpreted it differently, pulling in conflicting directions with no shared energy.","after":"After crafting a vivid one-page Dream story describing their company in 10 years — the culture, the customer experience, the talent they attract — all teams aligned around one narrative. Employee engagement rose 45% and strategic execution accelerated within two quarters.","quote":"When everyone can see the same vivid picture of the future, they make aligned decisions without waiting for the CEO. The Dream becomes the decision-making filter."}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

        /* ============================================================
           PRESERVED: Helper constants and functions — do not modify
           ============================================================ */

        /* VP-style transition content between steps */
        const TRANSITION_CONTENT = {
            1: {
                title: 'PURPOSE DEFINED.',
                text: "You've articulated your Golden Circle. WHY \u2192 HOW \u2192 WHAT. Now let's paint a vivid picture of the future.",
                brutalTruth: "The Dream starts with WHY, not WHAT. Sinek's Golden Circle principle tells us: if you can't articulate what disappears when your company is gone, your Dream will lack emotional power and fail to align your team.",
                peerProof: "Sinek's research in 'Start with Why' demonstrates that organizations where employees emotionally connect to the company's purpose show 3x higher engagement and 2.5x lower turnover."
            },
            2: {
                title: 'FUTURE VISUALIZED.',
                text: "You've painted a vivid picture of what success looks like in 5 years. Now capture it in words.",
                brutalTruth: "Vague dreams produce vague results. Specific, measurable dream descriptions are 3x more likely to be achieved because they create neural pathways that your brain actively works toward.",
                peerProof: "Collins & Porras in 'Built to Last' found that companies with vivid, specific visions outperform comparison companies by 6x over a 50-year period."
            },
            3: {
                title: 'DREAM CAPTURED.',
                text: "Your Dream is in words. Now make it visual with a Dream Board that you'll see every day.",
                brutalTruth: "A Dream that only exists in words will fade. The human brain processes images 60,000x faster than text. When you surround yourself with visual reminders of your Dream, it becomes embedded in your daily decisions.",
                peerProof: "The Dream Visualization tool is grounded in dual-coding theory: when information is encoded both verbally and visually, recall improves by up to 65%."
            }
        };

        const WORD_SUGGESTIONS = [
            'Innovation', 'Excellence', 'Global', 'Trusted',
            'Disruptive', 'Sustainable', 'Bold', 'Agile',
            'Market-Leader', 'Category-Defining', 'Unstoppable',
            'Transformative', 'Pioneering', 'Resilient', 'Visionary'
        ];

        const JARGON_PHRASES = [
            'best in class', 'world class', 'world-class',
            'market leader', 'market leading', 'industry leader',
            'shareholder value', 'shareholder return',
            'synergy', 'synergies', 'leverage',
            'going forward', 'moving forward',
            'paradigm shift', 'game changer', 'game-changer',
            'thought leader', 'best practice',
            'low hanging fruit', 'circle back',
            'touch base', 'drill down',
            'premier', 'leading provider',
            'solutions provider', 'end-to-end solutions',
            'maximize', 'optimize', 'streamline'
        ];

        const detectJargon = (text) => {
            if (!text) return { hasJargon: false, found: [] };
            const textLower = text.toLowerCase();
            const found = JARGON_PHRASES.filter(phrase => textLower.includes(phrase));
            return { hasJargon: found.length > 0, found };
        };

        const hasBulletPoints = (text) => {
            if (!text) return false;
            const bulletPatterns = [
                /^[\s]*[-•*]\s/m,
                /^[\s]*\d+\.\s/m,
                /^[\s]*[a-z]\.\s/m,
            ];
            return bulletPatterns.some(pattern => pattern.test(text));
        };

        const analyzeText = (text, minLength = 20) => {
            if (!text) return { strength: 0, label: 'Empty', color: '#9CA3AF' };
            const length = text.length;
            const hasNumbers = /\d/.test(text);
            const hasSpecifics = /\$|€|%|#/.test(text);
            const genericWords = ['leading', 'best', 'top', 'premier', 'world-class'];
            const hasGeneric = genericWords.some(word => text.toLowerCase().includes(word));
            let score = 0;
            if (length > minLength) score += 25;
            if (length > minLength * 2) score += 25;
            if (hasNumbers || hasSpecifics) score += 25;
            if (!hasGeneric) score += 25;
            if (score >= 75) return { strength: score, label: 'BOLD', color: '#10B981' };
            if (score >= 50) return { strength: score, label: 'Good', color: '#F59E0B' };
            if (score >= 25) return { strength: score, label: 'Weak', color: '#EF4444' };
            return { strength: score, label: 'Too Generic', color: '#EF4444' };
        };

        const calculateOverallProgress = (data) => {
            let completed = 0;
            let total = 16; // 3 golden circle + 10 dream answers + 1 oneSentence + 1 dreamNarrative + 1 words
            if (data.goldenCircle?.why) completed++;
            if (data.goldenCircle?.how) completed++;
            if (data.goldenCircle?.what) completed++;
            if (data.dreamAnswers.achievement) completed++;
            if (data.dreamAnswers.customersSay) completed++;
            if (data.dreamAnswers.employeesSay) completed++;
            if (data.dreamAnswers.marketPosition) completed++;
            if (data.dreamAnswers.officeFeelsLike) completed++;
            if (data.dreamAnswers.capabilities) completed++;
            if (data.dreamAnswers.howItFeels) completed++;
            if (data.dreamAnswers.teamFeeling) completed++;
            if (data.dreamAnswers.personalAchievement) completed++;
            if (data.dreamAnswers.whoYouveBecome) completed++;
            if (data.oneSentence && data.oneSentence.length > 50) completed++;
            if (data.dreamNarrative && data.dreamNarrative.length > 100) completed++;
            if (data.moodBoard?.words?.filter(w => w).length >= 3) completed++;
            return Math.round((completed / total) * 100);
        };

        const generate3Sentences = (data) => {
            const { achievement, customersSay, employeesSay, marketPosition } = data.dreamAnswers;
            const why = (data.goldenCircle?.why || '').toLowerCase();
            return [
                {
                    type: 'Conservative',
                    text: `In 5 years, we're ${marketPosition.toLowerCase() || 'a respected industry player'}, with ${achievement.toLowerCase() || 'steady growth'}, driven by our purpose: ${why || 'making a difference'}.`,
                    desc: 'Safe, achievable, conventional'
                },
                {
                    type: 'Bold',
                    text: `In 5 years, because we believe ${why || 'in our mission'}, we're ${marketPosition.toLowerCase() || 'the category leader'}, where ${employeesSay.toLowerCase() || 'our team feels inspired'}, serving customers who say "${customersSay || 'they changed everything'}", and we've achieved ${achievement.toLowerCase() || 'what seemed impossible'}.`,
                    desc: 'Ambitious, vivid, inspirational'
                },
                {
                    type: 'Audacious',
                    text: `In 5 years, we've redefined the industry as ${marketPosition.toLowerCase() || 'the undisputed category king'}, ${achievement.toLowerCase() || 'dominating every key metric'}, where ${employeesSay.toLowerCase() || 'people fight to work here'} and customers ${customersSay.toLowerCase() || "can't imagine life without us"}.`,
                    desc: 'Aggressive, moonshot, game-changing'
                }
            ];
        };

        /* ============================================================
           SHARED COMPONENTS
           ============================================================ */

        function CheckIcon({ color = "#fff", size = 16 }) {
            return <svg width={size} height={size} viewBox="0 0 24 24" fill={color}><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>;
        }

        function YellowInsight({ children }) {
            return (
                <div className="ft-insight">
                    <div style={{ display: 'flex', gap: 12, alignItems: 'flex-start' }}>
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAI0ElEQVR42u3dQW8bZRrA8eeZsRuspkIV4sYNceLMHSQ+xJ72vN9hP8OeV4IvsjfEjVN72BtCCImVqmpXICFoSTzzvnuoxztxnTRJHTbJ+/tJVZvEHo9fz/vPZDLj5uPHj2sATeoMAQgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIAjVtERN38ux5geVdZRl7zfvyx8pY/9m3fdvIWrcNrY7Xo+/5vmy+U6U+tdfr4vAGvm9vEgQJSD3yfP3KjuA0v8E2td+77ODNz8/JnZu67bY1XG8mZ12J248zM3a/nZrnTY3SbZeY56zrdr1ywzvUGxyyvOYYxG7Pt12fz6arrUfcsPyOim71G5653fvXVV93p6Wl88MEHcXx8HA8fPox33323LhaLm5i0h3018q7Ovf+/q21vVw7HW1uv1/HixYv8/fffY71ev7a+fd/H0dFRLJfL6LpXP8mWUmIcx6i1RmbGYrGIruui1hrDMGw/3/f9dtsZxzFKKZfa1jIzxnGMYRji2bNn8eLFi+3jzsd1/vF0v/nHDx48yPntMzOGYajjOJ653fSc5/evtW4/Pz3v+djM7pfDMEQpJfq+365nKSVqrdF1XZZSaj59+jR+++23eO+992K5XMZ6vY7T09OotW7/njs5OYmTk5O3nrjr9Tp+/vnng2/Uq9UqPv3003jnnXduNDzPnz+Pb7755lIbz23WdV08fvw4+r6/VBRWq1Usl8u3ftzFYhHDMJz53NHRUWRmdF0Xy+VyO1kvMp/w84m9u13sPtZ1XvP58n/66adrzYPM3Dt+02Q91Gs6fQOfQjh//K7rtmEEAAAAAAAAAO6PdDIAd2qDdfYntOfBgwdRa41vv/3WYBzQ4vPPP/9TrXU6B3F7kc/8POTN+cfzizouXOibvn7eXsd596u11pvYU9k8Xu4+1l19MfMGvj3uG46u63LP7XJnXPeN45mr0qbtaudc9/lVRllrzVLKSdd1TzLzXz/++KNZe8gAPH369Mv5lVnzixAu2i4M3b2Wb3mfvdvH7kUtl9imMjOzlPJytVr9NSK+9NIcOACllGPDwG2WmUfDMDystcazZ88MyAF5RyDugpqZJTPv/NWXAgDXKcDmRwa/tRIAGubXgAJAo3N/8042RkIAAAEABAAQAEAAuK8ueZYqAsA9VCPCiUACAAgAIAA0ww//AgAIAK3x3V8AAAEABAAQAEAAuO/u8rs1CwAgAIAAwJV5L0ABoPEGGAIBAAQAEABaYfdfAAABAAQAEABAAGiAA4ECAAgAIACAAAACwH02/b+AXWeTFQCaDgECQINz3xAIAI3yloACAAgAIACAANAMBwEFABAAQAAAAQAEgPssN+cAuxZAAAABAAQAEABAAAABAAQAEABAALjbXA0oAIAA0Kp0KrAA0OjkNwQCgMmPAAACQEsyImIcRyMhALTql19+MQgCQIMcBxAAmp393hFIAGi7AYZAAGg8APYABIAGJ39mdvG/nwQQAFqLwKYERkIAaG72Zy4iImqtBkMAaEmttYuIZUTkcrk0IAe06Pv+PxFRz/mz9/W4xHLftJ9Wz3mhD/bEdnYVL7PfWKd12Nx338rk7Ovz5c7/znOe6+6YXmcc8y3G/Cbuk9dY13z9pcqcjd2ZMa21Zmau+75/ERFxenpq1h4yAB9//PGfa62l1jrWV0qttZRStiHYmZjTx/UtNqK9E+ASAajT5NvcNi87+Tefy4sm/vz5Zeb2ec+Xt9kg5xtuZGaXmdm9OkSd8yNVszGtEVE2H++OX919jM3R7t3AvFp4ZtRa86qhu+gI2s467x/8zWPO1m3+XHPP4nLPY+TO6zId4Ot2lpmZmaWUiIh1RPwzIsZHjx6ZtQd07gaxXC5jtVrFzne8dgbmnOe8b3K8fPky1uv1pZb76NGjvcuex6aUEr/++qutc88Yfffdd/HRRx8ZjENt52/6ruuo65s3ymsN/BUCg+0RAAAAAAAAAOBN8smTJ7FcLrcnoJRSzpyMkplXfhOGxWLxhz6JWuvB3i2267q9z3ccxyilbMen1hp930ff9zEMQwzDEH3fb28TEfHJJ584cYVbbfH9998vVqvVdsMvpdRpA54CsFgsds+HP3Pq6ubc9Om04ez7fhuT+X0uO5mnZV52wtZaYxiGyMw6//xVAlJrjVLK9lz3ad2n9RnHMTKzTqfqzuTJyUmM45hHR0dxfHxcP/vss8HE5y7I999//+8RMcbOVWu7ewEXLmQTgDh7Tcm+04yvdZXgmx47Xr9g6TrL2r1QZf7vM1dJ1ldXBE1fmy5k6SOiOzo6+veHH374xddff/1Dq9dRcHcshmH4i2E4jE2Envd9/4+I+MGIcNt5Q5ADTv7NnlBdr9eu6EEAWjIdG+i6rvZ9b78fAWgxAhERmzdTAQEABKA19gAQgGZnv3f1QQAEAASg0QYYAgSgXX4NiAA0O/ud/osAtMsxAASg4fkfjgEgAO0GYH5ZMghAawXwIwAC0O7krwqAAAAC0B7f/RGAljkPAAEABAAQAEAAmuFAIAIACAAgAE3xe0AEABCA5rgUAAFol91/BAAQgOZkZnRdZy8AAWg5AiAAjaq1KgACAAhAa3z3RwAAAQAEABAAQAAAAQAEABAAQAAAAbizaq3pWgAEABAAQAAAAQAE4B7zbkAIgAgYBAQAEABAAAABaGFQO8OKADTLqcAIACAAgAAAAgAIACAAgADcN34FiACIAAiAyQ8C0FgBXA+MADQdAIOAALQ6/10LgAC0XAB7AAhAu/M/HAhEAJoOAAiACIAAtDf7HQNAAJoOgAIgAA3Pf+OKALSq1moQuBP+C5RjFfeF2nvXAAAAAElFTkSuQmCC" alt="FT" style={{ width: 24, height: 24, flexShrink: 0, objectFit: 'contain' }} />
                        <div style={{ fontSize: 16, color: '#000', lineHeight: 1.5, fontWeight: 500 }}>{children}</div>
                    </div>
                </div>
            );
        }

        function ExampleBox({ bad, good }) {
            return (
                <div className="ft-example">
                    <div style={{ marginBottom: 6 }}>
                        <span style={{ color: '#DC2626', fontWeight: 700, fontSize: 14 }}>Bad:</span>{' '}
                        <span style={{ color: '#6B7280' }}>{bad}</span>
                    </div>
                    <div>
                        <span style={{ color: '#16A34A', fontWeight: 700, fontSize: 14 }}>Good:</span>{' '}
                        {good}
                    </div>
                </div>
            );
        }

        function ButtonFooter({ onBack, onNext, nextLabel = 'Next', showBack = true, disabled = false }) {
            return (
                <div className="btn-footer no-print">
                    {showBack ? <button className="btn-back" onClick={onBack}>&larr; Back</button> : <div />}
                    <button className="btn-next" disabled={disabled} onClick={onNext}>{nextLabel} &rarr;</button>
                </div>
            );
        }

        function MobileStepBar({ currentStep, totalSteps }) {
            const total = totalSteps || 4;
            const progress = currentStep >= 999 ? 100 : Math.round((currentStep / total) * 100);
            return (
                <div className="mobile-step-bar no-print">
                    <div className="bar-text">Step {Math.min(currentStep, total)} of {total}</div>
                    <div className="mobile-progress"><div className="mobile-progress-fill" style={{ width: `${progress}%` }} /></div>
                </div>
            );
        }

        function DependencyContext({ deps }) {
            const [open, setOpen] = React.useState(false);
            if (!deps || deps.length === 0) return null;
            return (
                <div style={{ marginBottom: '16px' }}>
                    <button onClick={() => setOpen(o => !o)} style={{ display: 'flex', alignItems: 'center', gap: 8, background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '8px 14px', fontSize: 12, fontFamily: "'Monument', monospace", letterSpacing: '0.05em', textTransform: 'uppercase', cursor: 'pointer', color: '#555', width: '100%' }}>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#DAA520" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        CONTEXT FROM PREVIOUS TOOLS ({deps.length})
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#999" strokeWidth="2" style={{ marginLeft: 'auto', transform: open ? 'rotate(180deg)' : 'none', transition: 'transform 0.2s' }}><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    {open && (
                        <div style={{ border: '1px solid #F0E68C', borderTop: 'none', padding: '12px 14px' }}>
                            {deps.map((dep, i) => (
                                <div key={i} style={{ background: '#fff', padding: '8px 0', borderBottom: i < deps.length - 1 ? '1px solid #F0E68C' : 'none', fontSize: '13px' }}>
                                    <div style={{ fontWeight: 600, marginBottom: '2px', color: '#333', fontSize: '11px', fontFamily: "'Monument', monospace", letterSpacing: '0.04em', textTransform: 'uppercase' }}>{dep.label}</div>
                                    <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function CoachFeedbackPanel() {
            const [expanded, setExpanded] = useState(false);
            const [feedback, setFeedback] = useState(null);

            useEffect(() => {
                const check = () => {
                    if (window.AIChallenge && window.AIChallenge.getLastFeedback) {
                        setFeedback(window.AIChallenge.getLastFeedback());
                    }
                };
                check();
                const interval = setInterval(check, 2000);
                return () => clearInterval(interval);
            }, []);

            if (!feedback) return null;

            return (
                <div style={{ marginTop: 24, borderTop: '1px solid #333', paddingTop: 16 }}>
                    <button
                        onClick={() => setExpanded(!expanded)}
                        style={{ background: 'none', border: 'none', color: '#FFF469', cursor: 'pointer', fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', display: 'flex', alignItems: 'center', gap: 6, padding: 0, width: '100%' }}
                    >
                        <span style={{ transform: expanded ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block' }}>&#9654;</span>
                        COACH FEEDBACK
                    </button>
                    {expanded && (
                        <div style={{ marginTop: 10, fontSize: 12, color: '#ccc', lineHeight: 1.5 }}>
                            {feedback.type === 'approved' && (
                                <p style={{ color: '#FFF469' }}>{feedback.message}</p>
                            )}
                            {feedback.type === 'challenges' && (
                                <>
                                    {feedback.encouragement && <p style={{ color: '#FFF469', marginBottom: 8 }}>{feedback.encouragement}</p>}
                                    {feedback.challenges && feedback.challenges.map((ch, i) => (
                                        <div key={i} style={{ marginBottom: 8, paddingLeft: 8, borderLeft: '2px solid #555' }}>
                                            <div style={{ fontSize: 10, color: '#999', marginBottom: 2 }}>{ch.question_text || ch.question_key}</div>
                                            <div>{ch.feedback}</div>
                                        </div>
                                    ))}
                                </>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        function WizardSidebar({ currentStep, data, onNavigate }) {
            const steps = [
                { num: 1, label: 'Golden Circle', time: '~5 min' },
                { num: 2, label: 'Company Dream', time: '~5 min' },
                { num: 3, label: 'Dream Story', time: '~3 min' },
                { num: 4, label: 'Dream Board', time: '~3 min' }
            ];

            const getSnippet = (n) => {
                if (n === 1 && data.goldenCircle?.why) return '"' + data.goldenCircle.why.substring(0, 50) + (data.goldenCircle.why.length > 50 ? '...' : '') + '"';
                if (n === 2 && data.dreamAnswers.achievement) {
                    const count = Object.values(data.dreamAnswers).filter(v => v && v.length > 0).length;
                    return count + ' of 10 questions answered';
                }
                if (n === 3 && data.oneSentence) return '"' + data.oneSentence.substring(0, 50) + (data.oneSentence.length > 50 ? '...' : '') + '"';
                if (n === 4 && data.moodBoard.words.length > 0) return data.moodBoard.words.length + ' words, ' + data.moodBoard.people.length + ' figures';
                return null;
            };

            return (
                <div className="wizard-sidebar no-print">
                    <div className="wizard-sidebar-inner">
                        <div style={{ marginBottom: 24 }}>
                            <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', color: '#fff', marginBottom: 4 }}>COMPANY DREAM</div>
                            <div style={{ fontSize: 13, color: '#999' }}>~16 min total</div>
                        </div>
                        <div style={{ marginBottom: 16, fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', color: '#999' }}>Your journey</div>
                        {steps.map(s => {
                            const effectiveStep = Math.ceil(currentStep);
                            const isCompleted = effectiveStep > s.num, isActive = effectiveStep === s.num, isLocked = effectiveStep < s.num;
                            const snippet = isCompleted ? getSnippet(s.num) : null;
                            return (
                                <div key={s.num} className={`sidebar-step-item ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''} ${isLocked ? 'locked' : ''}`}
                                    onClick={() => isCompleted && onNavigate && onNavigate(s.num)}
                                    title={isCompleted ? 'Click to review this step' : ''}
                                >
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                        {isCompleted ? <CheckIcon color="#000" size={14} /> : <span className="step-num" style={{ color: isActive ? '#fff' : '#ccc' }}>{String(s.num).padStart(2, '0')}</span>}
                                        <span className="step-name" style={{ color: isLocked ? '#666' : isCompleted ? '#000' : '#fff' }}>{s.label}</span>
                                    </div>
                                    {snippet && <div className="sidebar-snippet">{snippet}</div>}
                                </div>
                            );
                        })}

                        <CoachFeedbackPanel />
                    </div>
                </div>
            );
        }

        /* ============================================================
           MAIN APPLICATION
           ============================================================ */
        function CompanyDreamTool() {
            const [deps, setDeps] = useState([]);
            const [step, setStep] = useState(0);
            const [submissionStatus, setSubmissionStatus] = useState(null);
            const [aiReviewing, setAiReviewing] = useState(false);

            const [data, setData] = useState({
                userEmail: '',
                goldenCircle: {
                    why: '',
                    how: '',
                    what: ''
                },
                dreamAnswers: {
                    achievement: '',
                    customersSay: '',
                    employeesSay: '',
                    marketPosition: '',
                    officeFeelsLike: '',
                    capabilities: '',
                    howItFeels: '',
                    teamFeeling: '',
                    personalAchievement: '',
                    whoYouveBecome: ''
                },
                oneSentence: '',
                moodBoard: {
                    words: [],
                    people: [],
                    images: []
                },
                dreamNarrative: ''
            });

            /* PRESERVED: Dependency loading */
            useEffect(() => {
                async function loadDeps() {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId || !window.ToolDB || !window.DependencyInjection) return;
                    try {
                        await ToolDB.whenReady();
                        const config = DependencyInjection.getDependenciesConfig();
                        const toolConfig = config[CONFIG.TOOL_SLUG];
                        if (!toolConfig || !toolConfig.fields) return;
                        const loaded = [];
                        for (const field of toolConfig.fields) {
                            const val = await ToolDB.getDependency(userId, field.source_field);
                            if (val) {
                                loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                            }
                        }
                        setDeps(loaded);
                    } catch (err) {
                        console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
                    }
                }
                loadDeps();
            }, []);

            /* PRESERVED: Auto-save to localStorage (with migration from old structure) */
            useEffect(() => {
                const saved = localStorage.getItem('ftDreamTool');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        // Migration: if old data has corporateKiller but no goldenCircle, reset
                        if (parsed.corporateKiller && !parsed.goldenCircle) {
                            console.warn('[dream] Old data structure detected (corporateKiller). Clearing saved data for new structure.');
                            localStorage.removeItem('ftDreamTool');
                            return;
                        }
                        // Ensure new dreamAnswer fields exist
                        if (parsed.dreamAnswers && !('capabilities' in parsed.dreamAnswers)) {
                            parsed.dreamAnswers.capabilities = '';
                            parsed.dreamAnswers.howItFeels = '';
                            parsed.dreamAnswers.teamFeeling = '';
                            parsed.dreamAnswers.whoYouveBecome = '';
                        }
                        setData(parsed);
                    } catch (e) {}
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('ftDreamTool', JSON.stringify(data));
            }, [data]);

            /* PRESERVED: Data update helper (supports dot paths) */
            const updateData = (path, value) => {
                setData(prev => {
                    const newData = { ...prev };
                    const keys = path.split('.');
                    let current = newData;
                    for (let i = 0; i < keys.length - 1; i++) {
                        current = current[keys[i]];
                    }
                    current[keys[keys.length - 1]] = value;
                    return newData;
                });
            };

            /* Clear Cache/Reset Function */
            const clearCache = () => {
                if (confirm('This will delete all saved data and reset the form. Are you sure?')) {
                    localStorage.removeItem('ftDreamTool');
                    window.location.reload();
                }
            };

            /* PRESERVED: AI-gated step navigation — do not modify */
            const handleStepNext = async (nextStepValue, stepAnswers, stepName) => {
                const userId = localStorage.getItem('ft_user_id');
                if (!userId) {
                    setStep(nextStepValue);
                    return;
                }
                setAiReviewing(true);
                try {
                    const canProceed = await window.AIChallenge.reviewStep(userId, 'dream', stepAnswers, stepName);
                    if (canProceed) {
                        setStep(nextStepValue);
                    }
                } catch (err) {
                    console.warn('AI review error, allowing passage:', err);
                    setStep(nextStepValue);
                } finally {
                    setAiReviewing(false);
                }
            };

            /* PRESERVED: Webhook Submission Function — do not modify */
            const submitToWebhook = async () => {
                setSubmissionStatus('loading');

                try {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId) {
                        alert('User not authenticated. Please return to the dashboard.');
                        setSubmissionStatus('error');
                        return;
                    }

                    const questionMappings = {
                        golden_circle: data.goldenCircle,
                        dream_answers: data.dreamAnswers,
                        one_sentence: data.oneSentence,
                        dream_narrative: data.dreamNarrative,
                        mood_board: data.moodBoard
                    };

                    await window.AIChallenge.submitWithChallenge(userId, 'dream', questionMappings, {
                        onReviewStart: () => { setSubmissionStatus('loading'); },
                        onRevise: () => { setSubmissionStatus(null); },
                        onSubmitAnyway: () => { setSubmissionStatus('success'); setTimeout(() => setSubmissionStatus(null), 5000); },
                        onError: (err) => { setSubmissionStatus('error'); setTimeout(() => setSubmissionStatus(null), 5000); }
                    });

                } catch (error) {
                    console.error('Webhook submission error:', error);
                    setSubmissionStatus('error');
                    setTimeout(() => setSubmissionStatus(null), 5000);
                }
            };

            return (
                <div className="tool-frame">
                    <div className="tool-inner">
                        {/* Step 0: Cover */}
                        {step === 0 && (
                            <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative', overflow: 'hidden' }}>
                                <div style={{ position: 'absolute', inset: 0, backgroundImage: 'url(cover.jpg)', backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.5 }} />
                                <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                                    <h1 className="plaak" style={{ fontSize: 80, marginBottom: 16, textTransform: 'uppercase' }}>COMPANY DREAM</h1>
                                    <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48 }}>Craft your bold, simple, energizing 5-year vision</p>
                                    <button onClick={() => setStep(0.5)}
                                        style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease', minHeight: 44 }}
                                        onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                        onMouseOut={e => { e.target.style.background = '#fff'; }}
                                    >START</button>
                                </div>
                            </div>
                        )}

                        {/* Step 0.5: Intro / Team Tool */}
                        {step === 0.5 && (
                            <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                <div style={{ maxWidth: 640, padding: '0 32px', textAlign: 'center', color: '#fff' }} className="animate-in">
                                    <div style={{ display: 'inline-block', border: '2px solid #FFF469', padding: '8px 24px', marginBottom: 24 }}>
                                        <span className="monument" style={{ fontSize: 13, color: '#FFF469', letterSpacing: '0.15em' }}>TEAM TOOL</span>
                                    </div>
                                    <p style={{ fontSize: 16, color: '#ccc', lineHeight: 1.7, marginBottom: 40 }}>
                                        This tool is completed together as a leadership team. All answers will be shared with your team and visible to your guru.
                                    </p>
                                    <div style={{ textAlign: 'left', marginBottom: 40 }}>
                                        <div className="monument" style={{ fontSize: 11, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 16, textAlign: 'center' }}>YOUR JOURNEY</div>
                                        {[
                                            { num: 1, label: 'Golden Circle', desc: 'Define WHY, HOW, and WHAT' },
                                            { num: 2, label: 'Company Dream', desc: '10 vision questions about your future' },
                                            { num: 3, label: 'Dream Story', desc: 'One sentence + full narrative' },
                                            { num: 4, label: 'Dream Board', desc: 'Words, people, and images' }
                                        ].map(s => (
                                            <div key={s.num} style={{ display: 'flex', alignItems: 'center', gap: 16, padding: '12px 0', borderBottom: '1px solid #333' }}>
                                                <span className="monument" style={{ fontSize: 14, color: '#FFF469', width: 28 }}>{String(s.num).padStart(2, '0')}</span>
                                                <div>
                                                    <div style={{ fontWeight: 600, fontSize: 15 }}>{s.label}</div>
                                                    <div style={{ fontSize: 13, color: '#999' }}>{s.desc}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <button
                                        onClick={() => setStep(1)}
                                        style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease', minHeight: 44 }}
                                        onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                        onMouseOut={e => { e.target.style.background = '#fff'; }}
                                    >BEGIN</button>
                                </div>
                            </div>
                        )}

                        {/* Steps 1-4: Wizard */}
                        {[1,2,3,4].includes(step) && (
                            <div className="wizard-layout">
                                <div className="wizard-main">
                                    <MobileStepBar currentStep={step} totalSteps={4} />

                                    <div className="wizard-content animate-in">
                                        {step === 1 && <><DependencyContext deps={deps} /><Step1GoldenCircle data={data} updateData={updateData} /></>}
                                        {step === 2 && <Step2CompanyDream data={data} updateData={updateData} />}
                                        {step === 3 && <Step3DreamStory data={data} updateData={updateData} />}
                                        {step === 4 && <Step4DreamBoard data={data} updateData={updateData} />}
                                    </div>

                                    <ButtonFooter
                                        onBack={() => setStep(step === 1 ? 0.5 : step - 1)}
                                        onNext={() => {
                                            if (step === 1) {
                                                if (!data.goldenCircle.why || !data.goldenCircle.how || !data.goldenCircle.what) return;
                                                handleStepNext(1.5, { golden_circle: data.goldenCircle }, 'Golden Circle');
                                            } else if (step === 2) {
                                                const allAnswered = Object.values(data.dreamAnswers).every(v => v && v.length >= 5);
                                                if (!allAnswered) return;
                                                handleStepNext(2.5, { dream_answers: data.dreamAnswers }, 'Company Dream');
                                            } else if (step === 3) {
                                                const canProceed = data.oneSentence && data.oneSentence.length > 50;
                                                if (!canProceed) return;
                                                handleStepNext(3.5, { one_sentence: data.oneSentence, dream_narrative: data.dreamNarrative }, 'Dream Story');
                                            } else if (step === 4) {
                                                const canProceed = data.moodBoard.words.length >= 3;
                                                if (!canProceed) return;
                                                setStep(999);
                                            }
                                        }}
                                        disabled={aiReviewing}
                                        nextLabel={aiReviewing ? 'AI Coach Reviewing...' : step === 4 ? 'View Canvas' : 'Next'}
                                        showBack={true}
                                    />
                                </div>
                                <WizardSidebar currentStep={step} data={data} onNavigate={setStep} />
                            </div>
                        )}

                        {/* VP-style transition screens between steps */}
                        {[1.5, 2.5, 3.5].includes(step) && (() => {
                            const completedStep = Math.floor(step);
                            const nextStep = completedStep + 1;
                            const t = TRANSITION_CONTENT[completedStep];
                            return (
                                <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                    <div style={{ maxWidth: 640, padding: '0 32px', textAlign: 'center', color: '#fff' }} className="animate-in">
                                        <div className="monument" style={{ fontSize: 12, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 16 }}>
                                            STEP {completedStep} OF 4 COMPLETE
                                        </div>
                                        <h1 className="plaak" style={{ fontSize: 48, marginBottom: 12 }}>{t.title}</h1>
                                        <p style={{ fontSize: 16, color: '#ccc', marginBottom: 48 }}>{t.text}</p>

                                        <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #FFF469', padding: '20px 24px', marginBottom: 24, textAlign: 'left' }}>
                                            <span className="monument" style={{ fontSize: 10, color: '#FFF469', display: 'block', marginBottom: 8 }}>BRUTAL TRUTH</span>
                                            <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>{t.brutalTruth}</p>
                                        </div>

                                        <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #666', padding: '20px 24px', marginBottom: 48, textAlign: 'left' }}>
                                            <span className="monument" style={{ fontSize: 10, color: '#999', display: 'block', marginBottom: 8 }}>PEER PROOF</span>
                                            <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic' }}>{t.peerProof}</p>
                                        </div>

                                        <button
                                            onClick={() => setStep(nextStep)}
                                            style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }}
                                            onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                                            onMouseOut={e => { e.target.style.background = '#fff'; }}
                                        >
                                            CONTINUE TO STEP {nextStep}
                                        </button>
                                    </div>
                                </div>
                            );
                        })()}

                        {/* Step 999: Canvas */}
                        {step === 999 && <CanvasView data={data} onBack={() => setStep(4)} onSubmit={submitToWebhook} submissionStatus={submissionStatus} />}
                    </div>
                </div>
            );
        }

        /* ============================================================
           STEP 1: THE GOLDEN CIRCLE
           ============================================================ */
        function Step1GoldenCircle({ data, updateData }) {
            const analysisWhy = analyzeText(data.goldenCircle.why, 30);
            const analysisHow = analyzeText(data.goldenCircle.how, 30);
            const analysisWhat = analyzeText(data.goldenCircle.what, 30);

            const jargonWhy = detectJargon(data.goldenCircle.why);
            const jargonHow = detectJargon(data.goldenCircle.how);
            const jargonWhat = detectJargon(data.goldenCircle.what);

            const bulletsWhy = hasBulletPoints(data.goldenCircle.why);
            const bulletsHow = hasBulletPoints(data.goldenCircle.how);
            const bulletsWhat = hasBulletPoints(data.goldenCircle.what);

            return (
                <>
                    <p className="step-indicator">STEP 1 OF 4 <span className="step-time">~5 MIN</span></p>
                    <h1 className="step-heading">The Golden Circle</h1>
                    <p className="step-hint">Start from the inside out. Define WHY your company exists, HOW you do it differently, then WHAT you actually do.</p>

                    {/* Visual hint of the Golden Circle */}
                    <div style={{ textAlign: 'center', margin: '0 0 32px 0', padding: '20px', background: '#F9FAFB', border: '1px solid #E5E7EB' }}>
                        <div style={{ display: 'inline-block', position: 'relative', width: 180, height: 180 }}>
                            <div style={{ position: 'absolute', inset: 0, borderRadius: '50%', border: '2px solid #D1D5DB', display: 'flex', alignItems: 'flex-end', justifyContent: 'center', paddingBottom: 8 }}>
                                <span className="monument" style={{ fontSize: 10, color: '#9CA3AF' }}>WHAT</span>
                            </div>
                            <div style={{ position: 'absolute', top: 30, left: 30, right: 30, bottom: 30, borderRadius: '50%', border: '2px solid #6B7280', display: 'flex', alignItems: 'flex-end', justifyContent: 'center', paddingBottom: 6 }}>
                                <span className="monument" style={{ fontSize: 10, color: '#6B7280' }}>HOW</span>
                            </div>
                            <div style={{ position: 'absolute', top: 60, left: 60, right: 60, bottom: 60, borderRadius: '50%', background: '#FFF469', border: '2px solid #000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                <span className="monument" style={{ fontSize: 11, fontWeight: 700, color: '#000' }}>WHY</span>
                            </div>
                        </div>
                        <p style={{ fontSize: 13, color: '#6B7280', marginTop: 12 }}>People don't buy WHAT you do, they buy WHY you do it.</p>
                    </div>

                    {/* WHY */}
                    <div className="ft-field-group">
                        <label className="ft-label">
                            WHY does your company exist? <span className="ft-required">*</span>
                        </label>
                        <ExampleBox
                            bad={'"To make money" or "To be the best" (generic, uninspiring)'}
                            good={'"To empower every small business owner to compete with giants through accessible technology"'}
                        />
                        <textarea
                            className="ft-textarea"
                            placeholder="Why does your company exist? What motivates you beyond profit?"
                            value={data.goldenCircle.why}
                            onChange={(e) => updateData('goldenCircle.why', e.target.value)}
                        />
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 4 }}>
                            <p className="ft-help">Your purpose, cause, or belief beyond profit</p>
                            {data.goldenCircle.why && (
                                <span style={{ fontSize: 13, fontWeight: 700, color: analysisWhy.color }}>{analysisWhy.label}</span>
                            )}
                        </div>
                        {bulletsWhy && (
                            <div className="jargon-warning">
                                <strong>BULLET POINTS DETECTED</strong>
                                <p style={{ marginTop: 4 }}>Tell a story, don't write a list. Remove bullet points and write in narrative form.</p>
                            </div>
                        )}
                        {jargonWhy.hasJargon && (
                            <div className="jargon-warning">
                                <strong>MARKETING JARGON DETECTED</strong>
                                <p style={{ marginTop: 4 }}>Found: <span className="jargon-highlight">{jargonWhy.found.join(', ')}</span></p>
                                <p style={{ marginTop: 4 }}>Rewrite for your team, not investors.</p>
                            </div>
                        )}
                    </div>

                    {/* HOW */}
                    <div className="ft-field-group">
                        <label className="ft-label">
                            HOW do you do it differently? <span className="ft-required">*</span>
                        </label>
                        <textarea
                            className="ft-textarea"
                            placeholder="What unique processes, values, or strategies set you apart?"
                            value={data.goldenCircle.how}
                            onChange={(e) => updateData('goldenCircle.how', e.target.value)}
                        />
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 4 }}>
                            <p className="ft-help">Your unique approach, values, or differentiating process</p>
                            {data.goldenCircle.how && (
                                <span style={{ fontSize: 13, fontWeight: 700, color: analysisHow.color }}>{analysisHow.label}</span>
                            )}
                        </div>
                        {bulletsHow && (
                            <div className="jargon-warning">
                                <strong>BULLET POINTS DETECTED</strong>
                                <p style={{ marginTop: 4 }}>Tell a story, don't write a list.</p>
                            </div>
                        )}
                        {jargonHow.hasJargon && (
                            <div className="jargon-warning">
                                <strong>MARKETING JARGON DETECTED</strong>
                                <p style={{ marginTop: 4 }}>Found: <span className="jargon-highlight">{jargonHow.found.join(', ')}</span></p>
                            </div>
                        )}
                    </div>

                    {/* WHAT */}
                    <div className="ft-field-group">
                        <label className="ft-label">
                            WHAT do you do? <span className="ft-required">*</span>
                        </label>
                        <textarea
                            className="ft-textarea"
                            placeholder="What exactly do you do? Your primary products or services?"
                            value={data.goldenCircle.what}
                            onChange={(e) => updateData('goldenCircle.what', e.target.value)}
                        />
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 4 }}>
                            <p className="ft-help">Your primary products, services, or offerings</p>
                            {data.goldenCircle.what && (
                                <span style={{ fontSize: 13, fontWeight: 700, color: analysisWhat.color }}>{analysisWhat.label}</span>
                            )}
                        </div>
                        {bulletsWhat && (
                            <div className="jargon-warning">
                                <strong>BULLET POINTS DETECTED</strong>
                                <p style={{ marginTop: 4 }}>Tell a story, don't write a list.</p>
                            </div>
                        )}
                        {jargonWhat.hasJargon && (
                            <div className="jargon-warning">
                                <strong>MARKETING JARGON DETECTED</strong>
                                <p style={{ marginTop: 4 }}>Found: <span className="jargon-highlight">{jargonWhat.found.join(', ')}</span></p>
                            </div>
                        )}
                    </div>
                </>
            );
        }

        /* ============================================================
           STEP 2: COMPANY DREAM (10 Vision Questions)
           ============================================================ */
        function Step2CompanyDream({ data, updateData }) {
            const questions = [
                { id: 'achievement', label: 'What have you achieved?', placeholder: '€50M revenue | 500 employees | 40% market share', hint: 'The accomplishment you are most proud of' },
                { id: 'customersSay', label: 'What do customers say about you?', placeholder: 'They solved a problem nobody else could solve', hint: 'The one quote from your best customer' },
                { id: 'employeesSay', label: 'What do your employees say?', placeholder: "I'm learning more here than I ever could elsewhere", hint: 'Why your best people choose to stay' },
                { id: 'marketPosition', label: 'What is your market position?', placeholder: 'The category-defining leader in sustainable retail', hint: "How you're known in your industry" },
                { id: 'officeFeelsLike', label: 'How do your offices look like?', placeholder: 'Open, creative, buzzing with energy', hint: 'Describe the physical space and atmosphere' },
                { id: 'capabilities', label: 'What capabilities does the achievement provide you with?', placeholder: 'Global reach, top talent magnet, innovation engine', hint: 'What new powers do you have?' },
                { id: 'howItFeels', label: 'How does it feel to achieve your dream?', placeholder: 'Fulfilled, unstoppable, deeply proud', hint: 'The emotion when you look back' },
                { id: 'teamFeeling', label: 'How does the team feel about the achievement?', placeholder: 'Ownership, pride, we built something incredible together', hint: "Your team's collective emotion" },
                { id: 'personalAchievement', label: 'What is your own personal achievement?', placeholder: 'I became the leader I always aspired to be', hint: 'Your personal transformation' },
                { id: 'whoYouveBecome', label: 'Who is the person you have become along this journey?', placeholder: 'A confident, purpose-driven leader', hint: 'Your identity at the end of this journey' }
            ];

            const [qIdx, setQIdx] = useState(() => {
                // Start at the first unanswered question
                const firstEmpty = questions.findIndex(q => !data.dreamAnswers[q.id] || data.dreamAnswers[q.id].trim() === '');
                return firstEmpty === -1 ? questions.length - 1 : firstEmpty;
            });

            const q = questions[qIdx];
            const currentValue = data.dreamAnswers[q.id] || '';
            const analysis = analyzeText(currentValue, 10);
            const isLast = qIdx === questions.length - 1;
            const answeredCount = questions.filter(q2 => data.dreamAnswers[q2.id] && data.dreamAnswers[q2.id].trim().length > 0).length;

            const handleNext = () => {
                if (qIdx < questions.length - 1) setQIdx(qIdx + 1);
            };

            const handleBack = () => {
                if (qIdx > 0) setQIdx(qIdx - 1);
            };

            return (
                <div style={{ minHeight: 400, display: 'flex', flexDirection: 'column' }}>
                    {/* Header */}
                    <p className="step-indicator">STEP 2 OF 4 <span className="step-time">~5 MIN</span></p>

                    {/* Progress dots */}
                    <div style={{ display: 'flex', gap: 6, marginBottom: 32 }}>
                        {questions.map((q2, i) => {
                            const answered = data.dreamAnswers[q2.id] && data.dreamAnswers[q2.id].trim().length > 0;
                            return (
                                <button
                                    key={i}
                                    onClick={() => setQIdx(i)}
                                    title={q2.label}
                                    style={{
                                        width: 24,
                                        height: 6,
                                        border: 'none',
                                        borderRadius: 3,
                                        cursor: 'pointer',
                                        background: i === qIdx ? '#000' : answered ? '#FFF469' : '#ddd',
                                        transition: 'background 0.2s',
                                        padding: 0
                                    }}
                                />
                            );
                        })}
                        <span style={{ fontSize: 11, color: '#999', fontFamily: "'Monument', monospace", marginLeft: 8, alignSelf: 'center' }}>{answeredCount}/{questions.length}</span>
                    </div>

                    {/* Question number */}
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', background: '#000', display: 'inline-block', padding: '4px 10px', marginBottom: 20, letterSpacing: '0.1em' }}>
                        QUESTION {qIdx + 1} OF {questions.length}
                    </div>

                    {/* Question */}
                    <h1 style={{ fontFamily: "'Plaak', sans-serif", fontSize: 32, fontWeight: 700, lineHeight: 1.2, marginBottom: 8, textTransform: 'uppercase' }}>
                        {q.label}
                    </h1>
                    <p style={{ color: '#888', fontSize: 14, marginBottom: 28, fontStyle: 'italic' }}>{q.hint}</p>

                    {/* Input */}
                    <input
                        key={q.id}
                        type="text"
                        className="ft-input"
                        placeholder={q.placeholder}
                        value={currentValue}
                        autoFocus
                        onChange={(e) => updateData(`dreamAnswers.${q.id}`, e.target.value)}
                        onKeyDown={(e) => {
                            if (e.key === 'Enter' && currentValue.trim()) handleNext();
                        }}
                        style={{ fontSize: 18, padding: '16px 18px' }}
                    />
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 8, marginBottom: 32 }}>
                        <p className="ft-help">{currentValue && <span style={{ fontWeight: 700, color: analysis.color }}>{analysis.label}</span>}</p>
                        <p style={{ fontSize: 12, color: '#aaa' }}>Press Enter to continue</p>
                    </div>

                    {/* Question navigation */}
                    <div style={{ display: 'flex', gap: 12, marginTop: 8 }}>
                        {qIdx > 0 && (
                            <button onClick={handleBack} className="btn-back" style={{ flex: 'none', padding: '10px 20px' }}>
                                ←
                            </button>
                        )}
                        <button
                            onClick={handleNext}
                            disabled={!currentValue.trim() || isLast}
                            style={{
                                flex: 1,
                                background: currentValue.trim() && !isLast ? '#000' : '#e0e0e0',
                                color: currentValue.trim() && !isLast ? '#fff' : '#999',
                                border: 'none',
                                padding: '12px 24px',
                                fontSize: 13,
                                fontFamily: "'Monument', monospace",
                                letterSpacing: '0.08em',
                                textTransform: 'uppercase',
                                cursor: currentValue.trim() && !isLast ? 'pointer' : 'default',
                                transition: 'all 0.2s'
                            }}
                        >
                            {isLast ? (answeredCount === questions.length ? '✓ All Questions Answered — Click NEXT →' : 'Last Question') : 'Next Question →'}
                        </button>
                    </div>
                </div>
            );
        }

        /* ============================================================
           STEP 3: DREAM STORY
           ============================================================ */
        function Step3DreamStory({ data, updateData }) {
            const [selectedVersion, setSelectedVersion] = useState(null);
            const [showOptions, setShowOptions] = useState(false);
            const [aiSentences, setAiSentences] = useState([]);

            const analysis = analyzeText(data.oneSentence, 50);
            const jargonCheck = detectJargon(data.oneSentence);
            const bulletsCheck = hasBulletPoints(data.oneSentence);

            const handleGenerate = () => {
                const sentences = generate3Sentences(data);
                setAiSentences(sentences);
                setShowOptions(true);
            };

            const handleSelectVersion = (sentence, index) => {
                updateData('oneSentence', sentence);
                setSelectedVersion(index);
            };

            return (
                <>
                    <p className="step-indicator">STEP 3 OF 4 <span className="step-time">~3 MIN</span></p>
                    <h1 className="step-heading">Dream Story</h1>
                    <p className="step-hint">Summarize your Dream in one bold, simple sentence. Then write a full narrative below it.</p>

                    {!showOptions ? (
                        <>
                            <div className="ft-field-group">
                                <label className="ft-label">
                                    Your Dream in one sentence <span className="ft-required">*</span>
                                </label>
                                <textarea
                                    className="ft-textarea"
                                    style={{ minHeight: 100 }}
                                    placeholder="In 10 years, we're..."
                                    value={data.oneSentence}
                                    onChange={(e) => updateData('oneSentence', e.target.value)}
                                    maxLength={300}
                                />
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 4 }}>
                                    <p className="ft-help">{data.oneSentence.length}/300 characters</p>
                                    {data.oneSentence && (
                                        <span style={{ fontSize: 13, fontWeight: 700, color: analysis.color }}>{analysis.label}</span>
                                    )}
                                </div>
                                {bulletsCheck && (
                                    <div className="jargon-warning">
                                        <strong>BULLET POINTS DETECTED</strong>
                                        <p style={{ marginTop: 4 }}>Your Dream should be a narrative story, not a list.</p>
                                    </div>
                                )}
                                {jargonCheck.hasJargon && (
                                    <div className="jargon-warning">
                                        <strong>MARKETING JARGON DETECTED</strong>
                                        <p style={{ marginTop: 4 }}>Found: <span className="jargon-highlight">{jargonCheck.found.join(', ')}</span></p>
                                        <p style={{ marginTop: 4 }}>Rewrite for your team, not for investors.</p>
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={handleGenerate}
                                style={{ width: '100%', padding: '12px 0', border: '2px solid #000', background: '#fff', fontSize: 14, cursor: 'pointer', marginBottom: 24, fontFamily: "'Riforma', sans-serif", minHeight: 44 }}
                                onMouseOver={e => e.target.style.background = '#F3F4F6'}
                                onMouseOut={e => e.target.style.background = '#fff'}
                            >
                                AI Assist: Generate 3 versions
                            </button>
                        </>
                    ) : (
                        <>
                            <div style={{ marginBottom: 24 }}>
                                <p className="ft-label" style={{ marginBottom: 16 }}>Choose your dream style</p>
                                {aiSentences.map((option, i) => (
                                    <div
                                        key={i}
                                        className={`ai-option ${selectedVersion === i ? 'selected' : ''}`}
                                        onClick={() => handleSelectVersion(option.text, i)}
                                        style={{ marginBottom: 8 }}
                                    >
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 4 }}>
                                            <span style={{ fontWeight: 700 }}>{option.type}</span>
                                            <span style={{ fontSize: 12, color: '#6B7280' }}>{option.desc}</span>
                                        </div>
                                        <p style={{ lineHeight: 1.5 }}>{option.text}</p>
                                        {selectedVersion === i && (
                                            <div style={{ marginTop: 6, fontSize: 13, fontWeight: 700, color: '#000' }}>Selected</div>
                                        )}
                                    </div>
                                ))}
                            </div>

                            <button
                                onClick={() => setShowOptions(false)}
                                style={{ width: '100%', padding: '12px 0', border: '2px solid #000', background: '#fff', fontSize: 14, cursor: 'pointer', marginBottom: 24, fontFamily: "'Riforma', sans-serif", minHeight: 44 }}
                            >
                                Write my own instead
                            </button>
                        </>
                    )}

                    {/* Dream Narrative */}
                    <div className="ft-field-group">
                        <label className="ft-label">
                            One-page Dream Narrative
                        </label>
                        <p className="ft-help" style={{ marginBottom: 8, marginTop: 0 }}>Write your company Dream as a vivid, present-tense story. Describe what success looks like in 10 years.</p>
                        <textarea
                            className="ft-textarea"
                            style={{ minHeight: 180 }}
                            placeholder="It's 2035, and our company has become... Our customers say... Our team feels... We are known for..."
                            value={data.dreamNarrative || ''}
                            onChange={(e) => updateData('dreamNarrative', e.target.value)}
                            maxLength={3000}
                        />
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 4 }}>
                            <p className="ft-help">{(data.dreamNarrative || '').length}/3000 characters</p>
                            {(data.dreamNarrative || '').length > 100 && (
                                <span style={{ fontSize: 13, fontWeight: 700, color: '#10B981' }}>Good length</span>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        /* ============================================================
           STEP 4: DREAM BOARD
           ============================================================ */
        function Step4DreamBoard({ data, updateData }) {
            const addWord = (word) => {
                if (data.moodBoard.words.length < 10 && !data.moodBoard.words.includes(word)) {
                    updateData('moodBoard.words', [...data.moodBoard.words, word]);
                }
            };

            const removeWord = (index) => {
                updateData('moodBoard.words', data.moodBoard.words.filter((_, i) => i !== index));
            };

            return (
                <>
                    <p className="step-indicator">STEP 4 OF 4 <span className="step-time">~3 MIN</span></p>
                    <h1 className="step-heading">Dream Board</h1>
                    <p className="step-hint">Make your Dream visual. Choose words, inspirational figures, and images that capture the essence of your 10-year vision.</p>


                    {/* Words Section */}
                    <div className="ft-section">
                        <div className="ft-field-group">
                            <label className="ft-label">
                                7-10 Words that capture your Dream <span className="ft-required">*</span>
                            </label>
                            <input
                                type="text"
                                className="ft-input"
                                placeholder="Type a word and press Enter"
                                onKeyPress={(e) => {
                                    if (e.key === 'Enter' && e.target.value && data.moodBoard.words.length < 10) {
                                        addWord(e.target.value);
                                        e.target.value = '';
                                    }
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: 4, marginBottom: 16 }}>
                            {data.moodBoard.words.map((word, i) => (
                                <span key={i} className="word-tag">
                                    #{word}
                                    <button
                                        onClick={() => removeWord(i)}
                                        style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', fontWeight: 700, padding: 0, fontSize: 14 }}
                                    >x</button>
                                </span>
                            ))}
                        </div>

                        <p style={{ fontSize: 12, fontWeight: 700, marginBottom: 8, fontFamily: "'Monument', monospace", textTransform: 'uppercase', letterSpacing: '0.05em', color: '#6B7280' }}>SUGGESTIONS (CLICK TO ADD)</p>
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: 6, marginBottom: 8 }}>
                            {WORD_SUGGESTIONS.map((word, i) => (
                                <button
                                    key={i}
                                    onClick={() => addWord(word)}
                                    disabled={data.moodBoard.words.includes(word) || data.moodBoard.words.length >= 10}
                                    style={{
                                        padding: '4px 10px', fontSize: 13, border: '1px solid #E5E7EB', background: '#fff', cursor: 'pointer',
                                        opacity: data.moodBoard.words.includes(word) || data.moodBoard.words.length >= 10 ? 0.4 : 1,
                                        fontFamily: "'Riforma', sans-serif",
                                        transition: 'background 0.15s'
                                    }}
                                    onMouseOver={e => e.target.style.background = '#F3F4F6'}
                                    onMouseOut={e => e.target.style.background = '#fff'}
                                >
                                    #{word}
                                </button>
                            ))}
                        </div>
                        <p className="ft-help">{data.moodBoard.words.length}/10 words selected (min 3)</p>
                    </div>

                    {/* People Section */}
                    <div className="ft-section">
                        <div className="ft-field-group">
                            <label className="ft-label">
                                Inspirational Figures
                            </label>
                            <p className="ft-help" style={{ marginBottom: 8, marginTop: 0 }}>Who inspires the spirit of your Dream?</p>
                            <input
                                type="text"
                                className="ft-input"
                                placeholder="e.g., Steve Jobs, Frida Kahlo — press Enter to add"
                                onKeyPress={(e) => {
                                    if (e.key === 'Enter' && e.target.value && data.moodBoard.people.length < 10) {
                                        updateData('moodBoard.people', [...data.moodBoard.people, e.target.value]);
                                        e.target.value = '';
                                    }
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: 4, marginBottom: 8 }}>
                            {data.moodBoard.people.map((person, i) => (
                                <span key={i} className="word-tag">
                                    {person}
                                    <button
                                        onClick={() => updateData('moodBoard.people', data.moodBoard.people.filter((_, idx) => idx !== i))}
                                        style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', fontWeight: 700, padding: 0, fontSize: 14 }}
                                    >x</button>
                                </span>
                            ))}
                        </div>
                        <p className="ft-help">{data.moodBoard.people.length}/10 people selected</p>
                    </div>

                    {/* Images Section */}
                    <div className="ft-field-group">
                        <label className="ft-label">
                            Inspirational Images
                        </label>
                        <p className="ft-help" style={{ marginBottom: 8, marginTop: 0 }}>Describe scenes, places, or moments that represent your Dream. Press Enter to add.</p>
                        <input
                            type="text"
                            className="ft-input"
                            placeholder="e.g., Team celebrating a product launch on stage"
                            onKeyPress={(e) => {
                                if (e.key === 'Enter' && e.target.value && (data.moodBoard.images || []).length < 10) {
                                    updateData('moodBoard.images', [...(data.moodBoard.images || []), e.target.value]);
                                    e.target.value = '';
                                }
                            }}
                        />

                        <div style={{ marginTop: 8 }}>
                            {(data.moodBoard.images || []).map((img, i) => (
                                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 8, background: '#F3F4F6', border: '1px solid #E5E7EB', padding: '8px 12px', marginBottom: 4 }}>
                                    <span style={{ flex: 1, fontSize: 14 }}>{img}</span>
                                    <button
                                        onClick={() => updateData('moodBoard.images', (data.moodBoard.images || []).filter((_, idx) => idx !== i))}
                                        style={{ background: 'none', border: 'none', cursor: 'pointer', color: '#DC2626', fontWeight: 700, fontSize: 16 }}
                                    >x</button>
                                </div>
                            ))}
                        </div>
                        <p className="ft-help">{(data.moodBoard.images || []).length}/10 images described</p>
                    </div>
                </>
            );
        }

        /* ============================================================
           CANVAS VIEW (Step 999)
           ============================================================ */
        function CanvasView({ data, onBack, onSubmit, submissionStatus }) {
            /* Dream Strength Analyzer (merged into canvas) */
            const sentenceAnalysis = analyzeText(data.oneSentence, 50);
            const achievementAnalysis = analyzeText(data.dreamAnswers.achievement, 10);
            const marketAnalysis = analyzeText(data.dreamAnswers.marketPosition, 15);
            const customerAnalysis = analyzeText(data.dreamAnswers.customersSay, 15);

            const avgStrength = Math.round((
                sentenceAnalysis.strength +
                achievementAnalysis.strength +
                marketAnalysis.strength +
                customerAnalysis.strength
            ) / 4);

            let overallLabel = 'NEEDS WORK';
            let overallColor = '#EF4444';
            if (avgStrength >= 75) { overallLabel = 'CATEGORY-DEFINING'; overallColor = '#10B981'; }
            else if (avgStrength >= 60) { overallLabel = 'BOLD'; overallColor = '#10B981'; }
            else if (avgStrength >= 40) { overallLabel = 'GETTING THERE'; overallColor = '#F59E0B'; }

            return (
                <div className="tool-frame">
                    <div className="tool-inner">
                        {/* Hero Header */}
                        <div style={{ background: '#000', color: '#fff', padding: '64px 32px', textAlign: 'center' }} className="no-print">
                            <h1 className="plaak" style={{ fontSize: 48, marginBottom: 8 }}>YOUR DREAM CANVAS</h1>
                            <p style={{ fontSize: 16, color: '#999' }}>This is your North Star for the next 10 years</p>

                            {/* Strength bar */}
                            <div style={{ maxWidth: 400, margin: '24px auto 0' }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
                                    <span className="monument" style={{ fontSize: 11, color: '#999' }}>DREAM STRENGTH</span>
                                    <span className="plaak" style={{ fontSize: 16, color: overallColor }}>{overallLabel}</span>
                                </div>
                                <div className="strength-bar">
                                    <div className="strength-fill" style={{ width: `${avgStrength}%` }}></div>
                                </div>
                            </div>

                            {/* Submission Status */}
                            {submissionStatus === 'success' && (
                                <div style={{ marginTop: 16, padding: 12, background: '#fff', color: '#000', fontWeight: 700, display: 'inline-block' }} className="animate-in">
                                    Submission saved successfully!
                                </div>
                            )}
                            {submissionStatus === 'error' && (
                                <div style={{ marginTop: 16, padding: 12, border: '2px solid #DC2626', color: '#DC2626', fontWeight: 700, display: 'inline-block' }} className="animate-in">
                                    Submission failed. Please try again.
                                </div>
                            )}
                        </div>

                        {/* Canvas Grid */}
                        <div style={{ maxWidth: 960, margin: '0 auto', padding: '48px 32px' }}>
                            {/* Company Name + Dream Sentence */}
                            <div style={{ textAlign: 'center', marginBottom: 48, paddingBottom: 32, borderBottom: '4px solid #000' }}>
                                <div className="plaak" style={{ fontSize: 36, marginBottom: 8 }}>YOUR DREAM</div>
                                <div className="monument" style={{ fontSize: 11, color: '#6B7280', marginBottom: 16 }}>10-YEAR VISION</div>
                                <div style={{ fontSize: 24, fontWeight: 700, lineHeight: 1.4 }}>{data.oneSentence}</div>
                            </div>

                            {/* Dream Narrative */}
                            {data.dreamNarrative && (
                                <div style={{ marginBottom: 32 }}>
                                    <div className="numbered-section" style={{ marginBottom: 12 }}>FULL DREAM NARRATIVE</div>
                                    <div className="canvas-section-box" style={{ whiteSpace: 'pre-wrap', lineHeight: 1.6 }}>{data.dreamNarrative}</div>
                                </div>
                            )}

                            {/* Two-column grid */}
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 24, marginBottom: 32 }}>
                                {/* The Golden Circle */}
                                <div>
                                    <div className="numbered-section" style={{ marginBottom: 12 }}>THE GOLDEN CIRCLE</div>
                                    <div className="canvas-section-box">
                                        <div style={{ marginBottom: 12 }}>
                                            <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', color: '#6B7280', marginBottom: 4 }}>WHY</div>
                                            <div>{data.goldenCircle?.why}</div>
                                        </div>
                                        <div style={{ marginBottom: 12 }}>
                                            <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', color: '#6B7280', marginBottom: 4 }}>HOW</div>
                                            <div>{data.goldenCircle?.how}</div>
                                        </div>
                                        <div>
                                            <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', color: '#6B7280', marginBottom: 4 }}>WHAT</div>
                                            <div>{data.goldenCircle?.what}</div>
                                        </div>
                                    </div>
                                </div>

                                {/* What Success Looks Like */}
                                <div>
                                    <div className="numbered-section" style={{ marginBottom: 12 }}>WHAT SUCCESS LOOKS LIKE</div>
                                    <div className="canvas-section-box">
                                        <div style={{ marginBottom: 8 }}><strong>Achievement:</strong> {data.dreamAnswers.achievement}</div>
                                        <div style={{ marginBottom: 8 }}><strong>Customers:</strong> "{data.dreamAnswers.customersSay}"</div>
                                        <div style={{ marginBottom: 8 }}><strong>Team says:</strong> "{data.dreamAnswers.employeesSay}"</div>
                                        <div style={{ marginBottom: 8 }}><strong>Market:</strong> {data.dreamAnswers.marketPosition}</div>
                                        <div style={{ marginBottom: 8 }}><strong>Offices:</strong> {data.dreamAnswers.officeFeelsLike}</div>
                                        <div style={{ marginBottom: 8 }}><strong>Capabilities:</strong> {data.dreamAnswers.capabilities}</div>
                                        <div style={{ marginBottom: 8 }}><strong>How it feels:</strong> {data.dreamAnswers.howItFeels}</div>
                                        <div style={{ marginBottom: 8 }}><strong>Team feeling:</strong> {data.dreamAnswers.teamFeeling}</div>
                                        <div style={{ marginBottom: 8 }}><strong>Personal:</strong> {data.dreamAnswers.personalAchievement}</div>
                                        <div><strong>Who you've become:</strong> {data.dreamAnswers.whoYouveBecome}</div>
                                    </div>
                                </div>
                            </div>

                            {/* Essence Words */}
                            <div style={{ marginBottom: 32 }}>
                                <div className="numbered-section" style={{ marginBottom: 12 }}>THE ESSENCE</div>
                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: 6 }}>
                                    {data.moodBoard.words.map((word, i) => (
                                        <span key={i} className="word-tag">#{word}</span>
                                    ))}
                                </div>
                            </div>

                            {/* Inspirational Figures */}
                            {data.moodBoard.people.length > 0 && (
                                <div style={{ marginBottom: 32 }}>
                                    <div className="numbered-section" style={{ marginBottom: 12 }}>INSPIRED BY</div>
                                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8 }}>
                                        {data.moodBoard.people.map((person, i) => (
                                            <span key={i} style={{ padding: '6px 14px', background: '#F3F4F6', border: '1px solid #E5E7EB', fontSize: 14 }}>{person}</span>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Vision Images */}
                            {(data.moodBoard.images || []).length > 0 && (
                                <div style={{ marginBottom: 32 }}>
                                    <div className="numbered-section" style={{ marginBottom: 12 }}>DREAM VISION IMAGES</div>
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 8 }}>
                                        {(data.moodBoard.images || []).map((img, i) => (
                                            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 8, background: '#F3F4F6', border: '1px solid #E5E7EB', padding: '8px 12px' }}>
                                                <span style={{ fontWeight: 700, color: '#6B7280' }}>{i + 1}.</span>
                                                <span style={{ fontSize: 14 }}>{img}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Actions */}
                            <div className="btn-footer no-print" style={{ position: 'static', marginTop: 32, borderTop: '2px solid #000', paddingTop: 24 }}>
                                <button className="btn-back" onClick={onBack}>&larr; Edit</button>
                                <div style={{ display: 'flex', gap: 12 }}>
                                    <button className="btn-back" onClick={() => window.print()} disabled={submissionStatus === 'loading'}>Download PDF</button>
                                    <button className="btn-next" onClick={onSubmit} disabled={submissionStatus === 'loading'}
                                        style={{ opacity: submissionStatus === 'loading' ? 0.6 : 1 }}
                                    >
                                        {submissionStatus === 'loading' ? 'Submitting...' : 'Submit Answers'} &rarr;
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render App
        ReactDOM.render(<CompanyDreamTool />, document.getElementById('root'));
    </script>
</body>
</html>
