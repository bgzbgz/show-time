<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Digitalization | Fast Track Program</title>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="../../shared/js/tool-db.js"></script>
  <script src="../../shared/js/ai-challenge.js"></script>
  <script src="../../shared/js/dependency-injection.js"></script>
  <script src="../../shared/js/transition-screen.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    /* Font Face Declarations */
    @font-face {
      font-family: 'Plaak';
      src: url('Plaak3Trial-43-Bold.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
    }

    @font-face {
      font-family: 'Riforma';
      src: url('RiformaLL-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Monument';
      src: url('MonumentGrotesk-Mono.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Riforma', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .plaak {
      font-family: 'Plaak', sans-serif;
      text-transform: uppercase;
      font-weight: bold;
      letter-spacing: -0.02em;
    }

    .riforma-bold {
      font-family: 'Riforma', sans-serif;
      font-weight: bold;
    }

    .monument {
      font-family: 'Monument', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }

    .transition-animate-in {
      animation: slideIn 0.6s ease-out;
    }

    /* Button Styles */
    .btn-primary {
      background: #000000;
      color: #FFFFFF;
      padding: 16px 32px;
      border: 2px solid #000000;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: normal;
    }

    .btn-primary:hover:not(:disabled) {
      transform: scale(1.02);
    }

    .btn-primary:disabled {
      background: #E0E0E0;
      border-color: #E0E0E0;
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #FFFFFF;
      color: #000000;
      padding: 12px 24px;
      border: 2px solid #000000;
      font-size: 16px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: #F8F8F8;
    }

    .btn-small {
      background: #FFFFFF;
      color: #000000;
      padding: 8px 16px;
      border: 1px solid #000000;
      font-size: 14px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-small:hover {
      background: #F8F8F8;
    }

    .btn-remove {
      background: #FFFFFF;
      color: #000000;
      padding: 8px 16px;
      border: 1px solid #E0E0E0;
      font-size: 14px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-remove:hover {
      border-color: #EF4444;
      color: #EF4444;
    }

    /* Form Styles */
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="date"],
    textarea,
    select {
      border: 1px solid #E0E0E0;
      padding: 12px 16px;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      width: 100%;
      transition: border-color 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #000000;
    }

    textarea {
      min-height: 120px;
      resize: none !important;
    }

    textarea::placeholder {
      white-space: pre-line;
    }

    /* Numbered Section Badge */
    .numbered-section {
      background: #000000;
      color: #FFFFFF;
      padding: 10px 16px;
      font-family: 'Plaak', sans-serif;
      font-size: 26px;
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }

    /* Progress Indicator */
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #E0E0E0;
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: #000000;
      transform: scale(1.3);
    }

    .progress-dot.completed {
      background: #000000;
    }

    .progress-line {
      height: 2px;
      background: #E0E0E0;
      flex: 1;
    }

    /* Character Counter */
    .char-counter {
      font-size: 14px;
      color: #666;
      margin-top: 4px;
    }

    .char-counter.invalid {
      color: #EF4444;
    }

    /* Choice Button */
    .choice-button {
      background: #FFFFFF;
      color: #000000;
      border: 4px solid #000000;
      padding: 48px 64px;
      font-family: 'Plaak', sans-serif;
      font-size: 48px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      width: 100%;
      max-width: 500px;
    }

    .choice-button:hover {
      background: #000000;
      color: #FFF469;
      transform: scale(1.05);
    }

    /* Item Card */
    .item-card {
      border: 2px solid #E0E0E0;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.2s ease;
      background: #FFFFFF;
    }

    .item-card:hover {
      border-color: #000000;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 24px;
    }

    .modal-content {
      background: #FFFFFF;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 32px;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #000000;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      color: #EF4444;
    }

    /* Canvas Styles */
    .canvas-section {
      border: 2px solid #000000;
      padding: 24px;
      margin-bottom: 24px;
      background: #FFFFFF;
    }

    /* Print Styles */
    @media print {
      .no-print {
        display: none !important;
      }
    }

    /* Wizard Layout */
    .wizard-layout { display: flex; min-height: 100vh; }
    .wizard-main { flex: 1; overflow-y: auto; padding: 0 48px; }
    .wizard-content { max-width: 100%; padding: 40px 0; flex: 1; }
    .wizard-footer { display: flex; justify-content: space-between; align-items: center; padding: 24px 48px; border-top: 1px solid #E5E7EB; background: #fff; }
    .btn-wiz-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 12px 28px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
    .btn-wiz-back:hover { border-color: #000; color: #000; }
    .btn-wiz-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 36px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
    .btn-wiz-next:hover:not(:disabled) { background: #FFF469; color: #000; border-color: #FFF469; }
    .btn-wiz-next:disabled { background: #E0E0E0; color: #9CA3AF; border-color: #E0E0E0; cursor: not-allowed; }
    .opening-box { margin-bottom: 32px; }
        .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }
        .sidebar-tool-num { font-family: 'Monument', monospace; font-size: 10px; color: #fff; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 8px; }
        .sidebar-tool-title { font-family: 'Plaak', sans-serif; font-size: 22px; color: #fff; margin-bottom: 32px; line-height: 1.1; }
        .sidebar-step { padding: 8px 0; border-bottom: 1px solid #2a2a2a; cursor: default; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s; }
        .sidebar-step:last-child { border-bottom: none; }
        .sidebar-step-dot { width: 6px; height: 6px; border-radius: 50%; background: #555; flex-shrink: 0; transition: background 0.2s; }
        .sidebar-step-dot.active { background: #FFF469; }
        .sidebar-step-dot.done { background: #4ade80; }
        .sidebar-step-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.08em; color: #555; text-transform: uppercase; transition: color 0.2s; }
        .sidebar-step-label.active { color: #FFF469; }
        .sidebar-step-label.done { color: #4ade80; }
        .sidebar-divider { width: 100%; height: 1px; background: #333; margin: 12px 0; }
    /* Dark theme inputs */
    input[type="text"], input[type="number"], input[type="email"], textarea, select {
        background: #1a1a1a !important;
        color: #fff !important;
        border-color: #444 !important;
    }
    input::placeholder, textarea::placeholder { color: #666 !important; }
    input:focus, textarea:focus, select:focus {
        outline: 2px solid #FFF469 !important;
        border-color: #FFF469 !important;
    }
    select option { background: #1a1a1a; color: #fff; }
    /* Fix bg-yellow-50 cards on dark bg */
    .bg-yellow-50 { background: #2a2500 !important; }
    /* Fix canvas content (keep white for PDF) */
    #canvas-content { background: #fff !important; color: #000 !important; }
    #canvas-content input, #canvas-content textarea { background: #fff !important; color: #000 !important; }

    .field-label { font-weight: 600; font-size: 16px; color: #000; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
    .field-input:focus { outline: none; border-color: #000; }
    .field-textarea:focus { outline: none; border-color: #000; }
    .step-content { max-width: 100%; padding: 40px 0; flex: 1; }
    @media (max-width: 768px) { .wizard-sidebar { display: none; } .wizard-main { padding: 0 24px; } }

  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, Fragment } = React;

    const CONFIG = {
        TOOL_SLUG: 'digitalization',
        AUTOSAVE_DELAY: 2000,
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'Digital transformation does not fail for technical reasons — it fails because nobody changed how people work. Technology amplifies existing processes: broken processes become broken processes, faster.',
                peerProof: '"A €25M logistics company spent €400k on a new ERP. Adoption was 30% after 6 months. They paused, ran process mapping, eliminated 40% of their workflow steps, then relaunched. Adoption hit 85% in 8 weeks."'
            },
            2: {
                brutalTruth: 'Most companies digitalize isolated functions rather than end-to-end value chains. Digitizing your invoicing while your quoting is still manual is like adding a turbocharger to a car with a flat tire.',
                peerProof: '"A €8M services firm mapped their full customer journey before selecting any tools. They found 12 handoff points — 9 manual, 3 digital. Automating just 4 of the manual handoffs cut their average project delivery time by 22%."'
            },
            3: {
                brutalTruth: 'Data without decisions is just storage. Most companies have more data than they can act on. The question is not how much you are collecting — it is whether the right people have the right numbers to make faster decisions.',
                peerProof: '"A retail chain had 6 dashboards that nobody read. They replaced them with one weekly \'5 number\' email — revenue, margin, conversion, returns, and NPS. Three managers described it as \'the first time I knew what was actually happening.\'"'
            },
            4: {
                brutalTruth: 'Most AI implementations stall not because the technology failed — but because nobody owned the outcome. Without a clear 3-week plan and named owners, digitalization stays a slide deck.',
                peerProof: '"A €12M professional services firm assigned every AI action item to a named person with a deadline in their first team session. Within 3 weeks, 7 out of 9 action items were complete. The two that slipped had no named owner."'
            }
        },
        CLOSING_MESSAGES: {
            1: { title: 'DECISIONS MAPPED', text: 'Your AI decision map is complete. Next: identify the processes to automate.' },
            2: { title: 'PROCESSES MAPPED', text: 'Automation opportunities identified. Next: select your AI tools.' },
            3: { title: 'TOOLS SELECTED', text: 'Your AI toolkit is defined. View your digitalization strategy.' },
            4: { title: 'PHASE 4 COMPLETE', text: 'Implementation roadmap defined. View the final strategy canvas.' }
        }
    };

    // Make Supabase client globally available for dependency injection
    // Initialize dependency injection to load data from previous tools
    ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        window.CognitiveLoad && CognitiveLoad.init('digitalization', {"insights":["Digital transformation is not about technology. It is about serving your strategy.","Start with the process, then find the technology."],"caseStudy":{"before":"RetailMax had invested in scattered digital tools across departments \u2014 a CRM nobody updated, an analytics dashboard no one checked, and data trapped in disconnected spreadsheets. Manual processes consumed 60% of management time while competitors moved faster.","after":"After identifying top 3 decisions and top 3 processes per employee for AI optimization, RetailMax achieved 60% reduction in manual work within 90 days. Customer satisfaction rose 30% while operational costs dropped 25%. Every employee became AI-enabled, not just IT.","quote":"We stopped buying technology and started solving business problems. When every person identified their own AI opportunities, the transformation happened from the ground up. \u2014 Operations Director, RetailMax"}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

        function DependencyContext({ deps }) {
            const [open, setOpen] = React.useState(false);
            if (!deps || deps.length === 0) return null;
            return (
                <div style={{ marginBottom: '16px' }}>
                    <button onClick={() => setOpen(o => !o)} style={{ display: 'flex', alignItems: 'center', gap: 8, background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '8px 14px', fontSize: 12, fontFamily: "'Monument', monospace", letterSpacing: '0.05em', textTransform: 'uppercase', cursor: 'pointer', color: '#555', width: '100%' }}>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#DAA520" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        CONTEXT FROM PREVIOUS TOOLS ({deps.length})
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#999" strokeWidth="2" style={{ marginLeft: 'auto', transform: open ? 'rotate(180deg)' : 'none', transition: 'transform 0.2s' }}><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    {open && (
                        <div style={{ border: '1px solid #F0E68C', borderTop: 'none', padding: '12px 14px' }}>
                            {deps.map((dep, i) => (
                                <div key={i} style={{ background: '#fff', padding: '8px 0', borderBottom: i < deps.length - 1 ? '1px solid #F0E68C' : 'none', fontSize: '13px' }}>
                                    <div style={{ fontWeight: 600, marginBottom: '2px', color: '#333', fontSize: '11px', fontFamily: "'Monument', monospace", letterSpacing: '0.04em', textTransform: 'uppercase' }}>{dep.label}</div>
                                    <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

    function WizardSidebar({ currentStep, totalSteps, phase }) {
        const indSteps = [
            { num: 1, label: 'AI Decision Map' },
            { num: 2, label: 'Process Automation' },
            { num: 3, label: 'Tool Selection' },
        ];
        const teamSteps = [
            { num: 1, label: 'Team Analyses' },
            { num: 2, label: 'Shared Patterns' },
            { num: 3, label: 'Team Strategy' },
            { num: 4, label: 'Implementation' },
        ];
        const steps = phase === 'team' ? teamSteps : indSteps;
        const cur = typeof currentStep === 'number' ? Math.floor(currentStep) : 0;
        return (
            <div className="wizard-sidebar no-print">
                <div className="sidebar-tool-num">SPRINT 28</div>
                <div className="sidebar-tool-title">TECH & AI</div>
                {steps.map(s => {
                    const isActive = cur === s.num;
                    const isDone = cur > s.num;
                    return (
                        <div key={s.num} className="sidebar-step" style={{ opacity: isDone || isActive ? 1 : 0.5 }}>
                            <div className={`sidebar-step-dot ${isActive ? 'active' : isDone ? 'done' : ''}`} />
                            <span className={`sidebar-step-label ${isActive ? 'active' : isDone ? 'done' : ''}`}>{s.label}</span>
                        </div>
                    );
                })}
            </div>
        );
    }

    // Main App Component
    function AIDigitalizationApp() {
            const [deps, setDeps] = useState([]);
      const [step, setStep] = useState(0);
      const [aiReviewing, setAiReviewing] = useState(false);
      const [aiMessage, setAiMessage] = useState('');
      const [decisionIdx, setDecisionIdx] = useState(0);
      const [processIdx, setProcessIdx] = useState(0);
      const [toolIdx, setToolIdx] = useState(0);

      const [data, setData] = useState({
        toolType: '', // 'individual' or 'team'

        // Individual Tool Data
        individual: {
          decisions: [
            {
              id: 1,
              decisionName: '',
              frequency: '',
              impact: '',
              dataNeeded: '',
              currentDataSource: '',
              aiOpportunity: '',
              aiTool: ''
            }
          ],
          processes: [
            {
              id: 1,
              processName: '',
              timeConsumed: '',
              repetition: '',
              currentSteps: '',
              automationOpportunity: '',
              kpis: '',
              aiTool: ''
            }
          ],
          implementation: {
            aiTools: [
              { id: 1, tool: '', purpose: '', cost: '', timeline: '' }
            ],
            successMetrics: '',
            obstacles: '',
            supportNeeded: '',
            startDate: ''
          }
        },

        // Team Tool Data
        team: {
          individualAnalyses: [
            {
              id: 1,
              memberName: '',
              role: '',
              top3Decisions: '',
              top3Processes: '',
              aiOpportunities: ''
            }
          ],
          patterns: {
            commonDecisions: '',
            commonProcesses: '',
            sharedAITools: '',
            collaborationOpportunities: ''
          },
          strategy: {
            companyGoals: '',
            priorityAreas: '',
            crossFunctionalOpportunities: '',
            unifiedApproach: ''
          },
          implementationPlan: {
            week1Actions: '',
            week2Actions: '',
            week3Actions: '',
            owners: [
              { id: 1, action: '', owner: '', deadline: '' }
            ],
            reviewSchedule: '',
            successMetrics: ''
          }
        }
      });

            useEffect(() => {
                async function loadDeps() {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId || !window.ToolDB || !window.DependencyInjection) return;
                    try {
                        await ToolDB.whenReady();
                        const config = DependencyInjection.getDependenciesConfig();
                        const toolConfig = config[CONFIG.TOOL_SLUG];
                        if (!toolConfig || !toolConfig.fields) return;
                        const loaded = [];
                        for (const field of toolConfig.fields) {
                            const val = await ToolDB.getDependency(userId, field.source_field);
                            if (val) {
                                loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                            }
                        }
                        setDeps(loaded);
                    } catch (err) {
                        console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
                    }
                }
                loadDeps();
            }, []);

      // Auto-save
      useEffect(() => {
        const interval = setInterval(() => {
          localStorage.setItem('aiDigitalizationData', JSON.stringify({
            data,
            timestamp: new Date().toISOString()
          }));
        }, 2000);

        return () => clearInterval(interval);
      }, [data]);

      // Load saved data
      useEffect(() => {
        const saved = localStorage.getItem('aiDigitalizationData');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            if (parsed.data) {
              setData(parsed.data);
            }
          } catch (e) {
            console.error('Failed to parse saved data');
          }
        }
      }, []);

      const updateData = (field, value) => {
        setData(prev => ({ ...prev, [field]: value }));
      };

      const updateIndividual = (field, value) => {
        setData(prev => ({
          ...prev,
          individual: { ...prev.individual, [field]: value }
        }));
      };

      const updateTeam = (field, value) => {
        setData(prev => ({
          ...prev,
          team: { ...prev.team, [field]: value }
        }));
      };

      // Individual Tool - Decision Management
      const addDecision = () => {
        const newDecision = {
          id: Date.now(),
          decisionName: '',
          frequency: '',
          impact: '',
          dataNeeded: '',
          currentDataSource: '',
          aiOpportunity: '',
          aiTool: ''
        };
        updateIndividual('decisions', [...(data.individual.decisions || []), newDecision]);
      };

      const removeDecision = (id) => {
        if ((data.individual.decisions || []).length > 1) {
          updateIndividual('decisions', (data.individual.decisions || []).filter(d => d.id !== id));
        }
      };

      const updateDecision = (id, field, value) => {
        const updated = (data.individual.decisions || []).map(d =>
          d.id === id ? { ...d, [field]: value } : d
        );
        updateIndividual('decisions', updated);
      };

      // Individual Tool - Process Management
      const addProcess = () => {
        const newProcess = {
          id: Date.now(),
          processName: '',
          timeConsumed: '',
          repetition: '',
          currentSteps: '',
          automationOpportunity: '',
          kpis: '',
          aiTool: ''
        };
        updateIndividual('processes', [...(data.individual.processes || []), newProcess]);
      };

      const removeProcess = (id) => {
        if ((data.individual.processes || []).length > 1) {
          updateIndividual('processes', (data.individual.processes || []).filter(p => p.id !== id));
        }
      };

      const updateProcess = (id, field, value) => {
        const updated = (data.individual.processes || []).map(p =>
          p.id === id ? { ...p, [field]: value } : p
        );
        updateIndividual('processes', updated);
      };

      // Individual Tool - AI Tools Management
      const addAITool = () => {
        const newTool = { id: Date.now(), tool: '', purpose: '', cost: '', timeline: '' };
        setData(prev => ({
          ...prev,
          individual: {
            ...prev.individual,
            implementation: {
              ...prev.individual.implementation,
              aiTools: [...(prev.individual.implementation.aiTools || []), newTool]
            }
          }
        }));
      };

      const removeAITool = (id) => {
        if ((data.individual.implementation?.aiTools || []).length > 1) {
          setData(prev => ({
            ...prev,
            individual: {
              ...prev.individual,
              implementation: {
                ...prev.individual.implementation,
                aiTools: (prev.individual.implementation.aiTools || []).filter(t => t.id !== id)
              }
            }
          }));
        }
      };

      const updateAITool = (id, field, value) => {
        const updated = (data.individual.implementation?.aiTools || []).map(t =>
          t.id === id ? { ...t, [field]: value } : t
        );
        setData(prev => ({
          ...prev,
          individual: {
            ...prev.individual,
            implementation: {
              ...prev.individual.implementation,
              aiTools: updated
            }
          }
        }));
      };

      // Team Tool - Individual Analyses Management
      const addTeamMember = () => {
        const newMember = {
          id: Date.now(),
          memberName: '',
          role: '',
          top3Decisions: '',
          top3Processes: '',
          aiOpportunities: ''
        };
        setData(prev => ({
          ...prev,
          team: {
            ...prev.team,
            individualAnalyses: [...(prev.team.individualAnalyses || []), newMember]
          }
        }));
      };

      const removeTeamMember = (id) => {
        if ((data.team.individualAnalyses || []).length > 1) {
          setData(prev => ({
            ...prev,
            team: {
              ...prev.team,
              individualAnalyses: (prev.team.individualAnalyses || []).filter(m => m.id !== id)
            }
          }));
        }
      };

      const updateTeamMember = (id, field, value) => {
        const updated = (data.team.individualAnalyses || []).map(m =>
          m.id === id ? { ...m, [field]: value } : m
        );
        setData(prev => ({
          ...prev,
          team: {
            ...prev.team,
            individualAnalyses: updated
          }
        }));
      };

      // Team Tool - Action Owners Management
      const addActionOwner = () => {
        const newOwner = { id: Date.now(), action: '', owner: '', deadline: '' };
        setData(prev => ({
          ...prev,
          team: {
            ...prev.team,
            implementationPlan: {
              ...prev.team.implementationPlan,
              owners: [...(prev.team.implementationPlan.owners || []), newOwner]
            }
          }
        }));
      };

      const removeActionOwner = (id) => {
        if ((data.team.implementationPlan?.owners || []).length > 1) {
          setData(prev => ({
            ...prev,
            team: {
              ...prev.team,
              implementationPlan: {
                ...prev.team.implementationPlan,
                owners: (prev.team.implementationPlan.owners || []).filter(o => o.id !== id)
              }
            }
          }));
        }
      };

      const updateActionOwner = (id, field, value) => {
        const updated = (data.team.implementationPlan?.owners || []).map(o =>
          o.id === id ? { ...o, [field]: value } : o
        );
        setData(prev => ({
          ...prev,
          team: {
            ...prev.team,
            implementationPlan: {
              ...prev.team.implementationPlan,
              owners: updated
            }
          }
        }));
      };

      const goNext = async () => {
        if (step === 0) {
          setStep(0.5);
        } else if (step === 0.5) {
          setDecisionIdx(0); setProcessIdx(0); setToolIdx(0);
          setStep(1);
        } else if (data.toolType === 'individual') {
          if (step >= 1 && step <= 3) {
            // Paginate through items before advancing step
            if (step === 1) {
              const decisions = data.individual.decisions || [];
              if (decisionIdx < decisions.length - 1) { setDecisionIdx(decisionIdx + 1); return; }
            }
            if (step === 2) {
              const processes = data.individual.processes || [];
              if (processIdx < processes.length - 1) { setProcessIdx(processIdx + 1); return; }
            }
            if (step === 3) {
              const tools = data.individual.implementation?.aiTools || [];
              if (toolIdx < tools.length - 1) { setToolIdx(toolIdx + 1); return; }
            }
            const userId = localStorage.getItem('ft_user_id');
            if (userId) {
              setAiReviewing(true);
              try {
                let stepAnswers = {};
                let stepName = '';
                if (step === 1) {
                  stepName = 'Individual Decisions';
                  stepAnswers = { decisions: data.individual.decisions };
                } else if (step === 2) {
                  stepName = 'Individual Processes';
                  stepAnswers = { processes: data.individual.processes };
                } else if (step === 3) {
                  stepName = 'Individual Implementation';
                  stepAnswers = { implementation: data.individual.implementation };
                }
                const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
                if (!canProceed) {
                  setAiMessage(window.AIChallenge?.getLastFeedback?.()?.suggestion || 'Please expand your answer before continuing.');
                  setAiReviewing(false);
                  return;
                }
                setAiMessage('');
              } catch (err) {
                console.warn('[AIChallenge] Error, allowing passage:', err);
              } finally {
                setAiReviewing(false);
              }
            }
            if (step < 3) {
              if (step === 1) setProcessIdx(0);
              if (step === 2) setToolIdx(0);
              setStep(step + 0.5);
            } else if (step === 3) {
              setStep(4);
            }
          }
        } else if (data.toolType === 'team') {
          if (step >= 1 && step <= 4) {
            const userId = localStorage.getItem('ft_user_id');
            if (userId) {
              setAiReviewing(true);
              try {
                let stepAnswers = {};
                let stepName = '';
                if (step === 1) {
                  stepName = 'Team Individual Analyses';
                  stepAnswers = { individualAnalyses: data.team.individualAnalyses };
                } else if (step === 2) {
                  stepName = 'Team Patterns';
                  stepAnswers = { patterns: data.team.patterns };
                } else if (step === 3) {
                  stepName = 'Team Strategy';
                  stepAnswers = { strategy: data.team.strategy };
                } else if (step === 4) {
                  stepName = 'Team Implementation Plan';
                  stepAnswers = { implementationPlan: data.team.implementationPlan };
                }
                const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
                if (!canProceed) {
                  setAiMessage(window.AIChallenge?.getLastFeedback?.()?.suggestion || 'Please expand your answer before continuing.');
                  setAiReviewing(false);
                  return;
                }
                setAiMessage('');
              } catch (err) {
                console.warn('[AIChallenge] Error, allowing passage:', err);
              } finally {
                setAiReviewing(false);
              }
            }
            if (step < 4) {
              setStep(step + 0.5);
            } else if (step === 4) {
              setStep(5);
            }
          }
        }
      };

      const goBack = () => {
        if (data.toolType === 'individual') {
          if (step === 1 && decisionIdx > 0) { setDecisionIdx(decisionIdx - 1); return; }
          if (step === 2 && processIdx > 0) { setProcessIdx(processIdx - 1); return; }
          if (step === 3 && toolIdx > 0) { setToolIdx(toolIdx - 1); return; }
        }
        if (step === 4 || step === 5) {
          setStep(step - 1);
        } else if (step > 1) {
          // Reset idx to last item of previous step
          if (data.toolType === 'individual') {
            if (step === 2) setDecisionIdx(Math.max(0, (data.individual.decisions || []).length - 1));
            if (step === 3) setProcessIdx(Math.max(0, (data.individual.processes || []).length - 1));
          }
          setStep(step - 1);
        } else if (step === 1) {
          setStep(0.5);
        } else if (step === 0.5) {
          setStep(0);
        }
      };

      // Validation functions
      const canProceedFromChoice = () => {
        return data.toolType.length > 0;
      };

      const canProceedIndividualStep1 = () => {
        return (data.individual.decisions || []).length === 3 &&
               (data.individual.decisions || []).every(d =>
                 (d.decisionName || '').length >= 50 &&
                 (d.frequency || '').length > 0 &&
                 (d.impact || '').length > 0 &&
                 (d.dataNeeded || '').length >= 100 &&
                 (d.currentDataSource || '').length >= 50 &&
                 (d.aiOpportunity || '').length >= 100 &&
                 (d.aiTool || '').length >= 10
               );
      };

      const canProceedIndividualStep2 = () => {
        return (data.individual.processes || []).length === 3 &&
               (data.individual.processes || []).every(p =>
                 (p.processName || '').length >= 50 &&
                 (p.timeConsumed || '').length > 0 &&
                 (p.repetition || '').length > 0 &&
                 (p.currentSteps || '').length >= 200 &&
                 (p.automationOpportunity || '').length >= 150 &&
                 (p.kpis || '').length >= 100 &&
                 (p.aiTool || '').length >= 10
               );
      };

      const canProceedIndividualStep3 = () => {
        return (data.individual.implementation?.aiTools || []).length >= 1 &&
               (data.individual.implementation?.aiTools || []).every(t =>
                 (t.tool || '').length >= 5 &&
                 (t.purpose || '').length >= 20 &&
                 (t.cost || '').length >= 5 &&
                 (t.timeline || '').length >= 10
               ) &&
               (data.individual.implementation?.successMetrics || '').length >= 200 &&
               (data.individual.implementation?.obstacles || '').length >= 150 &&
               (data.individual.implementation?.supportNeeded || '').length >= 100 &&
               (data.individual.implementation?.startDate || '').length > 0;
      };

      const canProceedTeamStep1 = () => {
        return (data.team.individualAnalyses || []).length >= 3 &&
               (data.team.individualAnalyses || []).every(m =>
                 (m.memberName || '').length >= 5 &&
                 (m.role || '').length >= 5 &&
                 (m.top3Decisions || '').length >= 100 &&
                 (m.top3Processes || '').length >= 100 &&
                 (m.aiOpportunities || '').length >= 100
               );
      };

      const canProceedTeamStep2 = () => {
        return (data.team.patterns?.commonDecisions || '').length >= 100 &&
               (data.team.patterns?.commonProcesses || '').length >= 100 &&
               (data.team.patterns?.sharedAITools || '').length >= 100 &&
               (data.team.patterns?.collaborationOpportunities || '').length >= 100;
      };

      const canProceedTeamStep3 = () => {
        return (data.team.strategy?.companyGoals || '').length >= 150 &&
               (data.team.strategy?.priorityAreas || '').length >= 150 &&
               (data.team.strategy?.crossFunctionalOpportunities || '').length >= 150 &&
               (data.team.strategy?.unifiedApproach || '').length >= 150;
      };

      const canProceedTeamStep4 = () => {
        return (data.team.implementationPlan?.week1Actions || '').length >= 200 &&
               (data.team.implementationPlan?.week2Actions || '').length >= 200 &&
               (data.team.implementationPlan?.week3Actions || '').length >= 200 &&
               (data.team.implementationPlan?.owners || []).length >= 5 &&
               (data.team.implementationPlan?.owners || []).every(o =>
                 (o.action || '').length >= 10 &&
                 (o.owner || '').length >= 3 &&
                 (o.deadline || '').length > 0
               ) &&
               (data.team.implementationPlan?.reviewSchedule || '').length >= 50 &&
               (data.team.implementationPlan?.successMetrics || '').length >= 150;
      };

      const handleSubmit = async () => {
        const userId = localStorage.getItem('ft_user_id');
        if (!userId) {
          alert('User not authenticated. Please return to the dashboard.');
          return false;
        }

        try {
          const questionMappings = {
            digital_audit: {
              toolType: data.toolType,
              individual: data.individual,
              team: data.team
            },
            baby_ai: {
              individual: data.individual,
              team: data.team
            }
          };

          await window.AIChallenge.submitWithChallenge(userId, CONFIG.TOOL_SLUG, questionMappings, {
            onReviewStart: () => {},
            onRevise: () => { setStep(data.toolType === 'individual' ? 3 : 4); },
            onSubmitAnyway: () => { alert('AI Digitalization plan submitted successfully!'); },
            onError: (err) => { alert('Submission failed: ' + err.message); }
          });
          return true;
        } catch (error) {
          console.error('Supabase submission error:', error);
          alert('Submission failed. Please try again.');
          return false;
        }
      };

      const exportPDF = async () => {
        try {
          const canvas = document.getElementById('canvas-content');
          if (!canvas) {
            alert('Canvas not found');
            return;
          }

          const images = canvas.querySelectorAll('img');
          const imageStates = [];
          images.forEach(img => {
            imageStates.push({ img, display: img.style.display });
            img.style.display = 'none';
          });

          const canvasImage = await html2canvas(canvas, {
            scale: 2,
            logging: false,
            backgroundColor: '#ffffff'
          });

          imageStates.forEach(({ img, display }) => {
            img.style.display = display;
          });

          const imgWidth = 190;
          const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');
          const imgData = canvasImage.toDataURL('image/png');

          pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
          pdf.save('ai-digitalization-strategy.pdf');
        } catch (error) {
          console.error('PDF export error:', error);
          alert('Failed to export PDF: ' + error.message);
        }
      };

      // Render different pages based on step
      if (step === 0) {
        return <CoverPage onStart={goNext} />;
      }

      if (step === 0.5) {
        return <ChoicePage data={data} updateData={updateData} onNext={goNext} onBack={goBack} canProceed={canProceedFromChoice()} />;
      }

      const transitionRender = window.renderTransitionScreen(step, CONFIG, data.toolType === 'individual' ? 3 : 4, setStep);
      if (transitionRender) return transitionRender;

      // Individual path
      if (data.toolType === 'individual' && step >= 1 && step <= 3) {
        const stepLabels = ['AI Decision Map', 'Process Automation', 'Tool Selection'];
        const nextLabels = { 1: 'NEXT: PROCESS AUTOMATION →', 2: 'NEXT: TOOL SELECTION →', 3: 'VIEW CANVAS →' };
        const isValid = step === 1 ? canProceedIndividualStep1() : step === 2 ? canProceedIndividualStep2() : canProceedIndividualStep3();
        return (
          <div className="wizard-layout">
            <WizardSidebar currentStep={step} totalSteps={3} phase="individual" />
            <div className="wizard-main">
              <div style={{ flex: 1 }} className="animate-in">
                {step === 1 && <><DependencyContext deps={deps} /><IndividualStep1 data={data} updateDecision={updateDecision} addDecision={addDecision} removeDecision={removeDecision} idx={decisionIdx} setIdx={setDecisionIdx} /></>}
                {step === 2 && <IndividualStep2 data={data} updateProcess={updateProcess} addProcess={addProcess} removeProcess={removeProcess} idx={processIdx} setIdx={setProcessIdx} />}
                {step === 3 && <IndividualStep3 data={data} setData={setData} updateAITool={updateAITool} addAITool={addAITool} removeAITool={removeAITool} idx={toolIdx} setIdx={setToolIdx} />}
              </div>
              <div className="wizard-footer" style={{flexDirection:'column',alignItems:'stretch',gap:'0'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <button className="btn-wiz-back" onClick={goBack}>← BACK</button>
                  <button className="btn-wiz-next" disabled={aiReviewing || !isValid} onClick={goNext}>
                    {aiReviewing ? 'AI COACH REVIEWING...' : (nextLabels[step] || 'NEXT →')}
                  </button>
                </div>
                {aiMessage && <div style={{color:'#dc2626',fontSize:'13px',marginTop:'8px',padding:'8px 12px',background:'#fef2f2',borderRadius:'6px'}}>{aiMessage}</div>}
              </div>
            </div>
          </div>
        );
      }
      if (data.toolType === 'individual' && step === 4) { return <IndividualCanvas data={data} onExport={exportPDF} onSubmit={handleSubmit} />; }

      // Team path
      if (data.toolType === 'team' && step >= 1 && step <= 4) {
        const stepLabels = ['Team Decisions', 'Process Automation', 'Tool Selection', 'Implementation'];
        const nextLabels = { 1: 'NEXT: PROCESS AUTOMATION →', 2: 'NEXT: TOOL SELECTION →', 3: 'NEXT: IMPLEMENTATION →', 4: 'VIEW CANVAS →' };
        const isValid = step === 1 ? canProceedTeamStep1() : step === 2 ? canProceedTeamStep2() : step === 3 ? canProceedTeamStep3() : canProceedTeamStep4();
        return (
          <div className="wizard-layout">
            <WizardSidebar currentStep={step} totalSteps={4} phase="team" />
            <div className="wizard-main">
              <div style={{ flex: 1 }} className="animate-in">
                {step === 1 && <><DependencyContext deps={deps} /><TeamStep1 data={data} updateTeamMember={updateTeamMember} addTeamMember={addTeamMember} removeTeamMember={removeTeamMember} /></>}
                {step === 2 && <TeamStep2 data={data} setData={setData} />}
                {step === 3 && <TeamStep3 data={data} setData={setData} />}
                {step === 4 && <TeamStep4 data={data} setData={setData} updateActionOwner={updateActionOwner} addActionOwner={addActionOwner} removeActionOwner={removeActionOwner} />}
              </div>
              <div className="wizard-footer" style={{flexDirection:'column',alignItems:'stretch',gap:'0'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <button className="btn-wiz-back" onClick={goBack}>← BACK</button>
                  <button className="btn-wiz-next" disabled={aiReviewing || !isValid} onClick={goNext}>
                    {aiReviewing ? 'AI COACH REVIEWING...' : (nextLabels[step] || 'NEXT →')}
                  </button>
                </div>
                {aiMessage && <div style={{color:'#dc2626',fontSize:'13px',marginTop:'8px',padding:'8px 12px',background:'#fef2f2',borderRadius:'6px'}}>{aiMessage}</div>}
              </div>
            </div>
          </div>
        );
      }
      if (data.toolType === 'team' && step === 5) { return <TeamCanvas data={data} onExport={exportPDF} onSubmit={handleSubmit} />; }

      return null;
    }

    // Cover Page Component
    function CoverPage({ onStart }) {
      return (
        <div style={{ minHeight: '100vh', background: '#000', display: 'flex', flexDirection: 'column', justifyContent: 'center', padding: 48, color: '#fff' }} className="animate-in">
            <div style={{ fontFamily: "'Monument', monospace", fontSize: 12, color: '#FFF469', letterSpacing: '0.15em', marginBottom: 24, textTransform: 'uppercase' }}>SPRINT 28</div>
            <h1 className="plaak" style={{ fontSize: 64, marginBottom: 24, textTransform: 'uppercase', lineHeight: 1.05, maxWidth: 780 }}>APPLY AGGRESSIVELY<br/>TECH &amp; AI</h1>
            <p style={{ fontSize: 20, fontStyle: 'italic', color: '#ccc', marginBottom: 48, maxWidth: 600, lineHeight: 1.5 }}>"AI is not about robots — it's about machines using data to support decision-making."</p>
            <button onClick={onStart} style={{ background: '#FFF469', color: '#000', border: 'none', padding: '16px 40px', fontSize: 18, fontFamily: "'Monument', monospace", letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer', fontWeight: 700, alignSelf: 'flex-start' }}>START</button>
        </div>
      );
    }

    // Choice Page Component
    function ChoicePage({ data, updateData, onNext, onBack, canProceed }) {
      const [selected, setSelected] = useState(data.toolType);

      const handleChoice = (type) => {
        setSelected(type);
        updateData('toolType', type);
      };

      return (
        <div style={{ background: '#000', color: '#fff', minHeight: '100vh', padding: '48px' }} className="animate-in">
          {/* BEFORE WE START */}
          <h1 className="plaak" style={{ fontSize: 56, marginBottom: 48, textTransform: 'uppercase' }}>BEFORE WE START</h1>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 24, marginBottom: 56 }}>
            <div style={{ background: '#111', border: '1px solid #333', padding: 32 }}>
              <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 16 }}>SPRINT INFO</div>
              <div style={{ fontSize: 15, lineHeight: 1.7, color: '#ccc' }}>
                <strong style={{ color: '#fff' }}>Sprint 28: Apply Aggressively Tech &amp; AI</strong><br/><br/>
                Map your key decisions and processes to AI opportunities. Build an implementation roadmap that turns digitalization from a slide deck into operational reality within 90 days.
              </div>
            </div>
            <div style={{ background: '#111', border: '1px solid #333', padding: 32 }}>
              <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 16 }}>PURPOSE</div>
              <div style={{ fontSize: 15, lineHeight: 1.7, color: '#ccc' }}>
                Companies that systematically apply AI to their top decisions and processes achieve 40–60% reduction in manual work within the first 90 days. This sprint ensures every person and process is AI-enabled — not just IT.<br/><br/>
                AI amplifies process quality. Bad processes become bad processes, faster.
              </div>
            </div>
            <div style={{ background: '#111', border: '1px solid #333', padding: 32 }}>
              <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 16 }}>MISTAKES TO AVOID</div>
              <ul style={{ fontSize: 14, lineHeight: 1.8, color: '#ccc', paddingLeft: 0, listStyle: 'none' }}>
                <li style={{ marginBottom: 10 }}>① Underestimating data quality &amp; infrastructure needs before deploying AI.</li>
                <li style={{ marginBottom: 10 }}>② Tech knowledge without business/domain expertise — AI alone doesn't solve bad strategy.</li>
                <li>③ Skipping pilot before full rollout — test at small scale before company-wide deployment.</li>
              </ul>
            </div>
            <div style={{ background: '#111', border: '1px solid #333', padding: 32 }}>
              <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 16 }}>CHOOSE YOUR PATH</div>
              <div style={{ display: 'flex', gap: 16, marginBottom: 16 }}>
                <button onClick={() => handleChoice('individual')} style={{ flex: 1, padding: '16px 8px', background: selected === 'individual' ? '#FFF469' : '#fff', color: '#000', border: 'none', fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer', fontWeight: 700 }}>
                  INDIVIDUAL<br/>TOOL
                </button>
                <button onClick={() => handleChoice('team')} style={{ flex: 1, padding: '16px 8px', background: selected === 'team' ? '#FFF469' : '#fff', color: '#000', border: 'none', fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.08em', textTransform: 'uppercase', cursor: 'pointer', fontWeight: 700 }}>
                  TEAM<br/>TOOL
                </button>
              </div>
              <p style={{ fontSize: 13, color: '#888', lineHeight: 1.5 }}>
                {selected === 'individual' ? 'Personal AI decision + process mapping (3 steps)' : selected === 'team' ? 'Collaborative team AI strategy session (4 steps)' : 'Select individual or team mode above'}
              </p>
            </div>
          </div>
          <div style={{ display: 'flex', gap: 16 }}>
            <button onClick={onBack} style={{ background: 'transparent', border: '2px solid #444', color: '#888', padding: '14px 28px', fontFamily: "'Monument', monospace", fontSize: 12, letterSpacing: '0.06em', cursor: 'pointer' }}>← BACK</button>
            <button onClick={onNext} disabled={!canProceed} style={{ background: canProceed ? '#FFF469' : '#333', color: canProceed ? '#000' : '#666', border: 'none', padding: '14px 40px', fontFamily: "'Monument', monospace", fontSize: 12, letterSpacing: '0.08em', textTransform: 'uppercase', cursor: canProceed ? 'pointer' : 'not-allowed', fontWeight: 700 }}>
              CONTINUE →
            </button>
          </div>
        </div>
      );
    }

    // Progress Indicator Component
    function ProgressIndicator({ currentStep, totalSteps }) {
      return (
        <div className="flex items-center justify-center gap-2 mb-12">
          {Array.from({ length: totalSteps }).map((_, index) => (
            <Fragment key={index}>
              <div
                className={`progress-dot ${
                  index + 1 < currentStep ? 'completed' : index + 1 === currentStep ? 'active' : ''
                }`}
              />
              {index < totalSteps - 1 && <div className="progress-line" style={{ width: '40px' }} />}
            </Fragment>
          ))}
        </div>
      );
    }

    // Transition Screen Component
    function TransitionScreen({ message, progress, stepNum }) {
      const t = stepNum && CONFIG.TRANSITION_CONTENT && CONFIG.TRANSITION_CONTENT[stepNum];
      return (
        <div style={{ position: 'fixed', inset: 0, background: '#000', color: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 9999, padding: '48px 32px' }}>
          <div style={{ maxWidth: 640, width: '100%', textAlign: 'center' }} className="animate-in">
            <h1 className="plaak" style={{ fontSize: 64, marginBottom: 24, textTransform: 'uppercase', lineHeight: 1.1 }}>STEP COMPLETE</h1>
            <div style={{ marginBottom: 32 }}>
              <div style={{ height: 4, background: '#333', marginBottom: 8 }}>
                <div style={{ height: '100%', background: '#FFF469', width: progress + '%', transition: 'width 1s ease' }} />
              </div>
              <p style={{ fontFamily: "'Monument', monospace", fontSize: 12, color: '#ccc', letterSpacing: '0.08em', textTransform: 'uppercase' }}>{message}</p>
            </div>
            {t && t.brutalTruth && (
              <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #FFF469', padding: '20px 24px', marginBottom: 20, textAlign: 'left' }}>
                <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', display: 'block', marginBottom: 8, letterSpacing: '0.08em', textTransform: 'uppercase' }}>BRUTAL TRUTH</span>
                <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7, margin: 0 }}>{t.brutalTruth}</p>
              </div>
            )}
            {t && t.peerProof && (
              <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #666', padding: '20px 24px', textAlign: 'left' }}>
                <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', display: 'block', marginBottom: 8, letterSpacing: '0.08em', textTransform: 'uppercase' }}>PEER PROOF</span>
                <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic', margin: 0 }}>{t.peerProof}</p>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Character Counter Component
    function CharCounter({ current, min, optional = false }) {
      if (optional && current === 0) return null;
      const isValid = current >= min;
      return (
        <div className={`char-counter ${!isValid ? 'invalid' : ''}`}>
          {current} / {min} characters {!isValid && '(minimum required)'}
        </div>
      );
    }

    // Individual Step 1: Top 3 Decisions Analysis
    function IndividualStep1({ data, updateDecision, addDecision, removeDecision, idx, setIdx }) {
      const decisions = data.individual.decisions || [];
      const decision = decisions[idx] || decisions[0];
      const hasFilled = (i) => {
        const d = decisions[i];
        return d && ((d.decisionName || '').length > 0 || (d.dataNeeded || '').length > 0);
      };

      return (
        <div>
            <div className="opening-box">
              <div className="numbered-section">01</div>
              <h1 className="plaak text-6xl mt-4 mb-4">TOP 3 DECISIONS ANALYSIS</h1>
              <p className="text-2xl text-gray-300">
                Identify your three most important decisions that AI can optimize for speed and accuracy. You must have exactly 3 decisions.
              </p>
            </div>

            <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#999', letterSpacing: '0.06em', textTransform: 'uppercase', marginBottom: 12 }}>
              DECISION {idx + 1} OF {decisions.length}
            </div>

            <div style={{ display: 'flex', gap: 8, marginBottom: 24, flexWrap: 'wrap' }}>
              {decisions.map((_, i) => (
                <button key={i} onClick={() => setIdx(i)} style={{
                  width: 44, height: 44, border: `2px solid ${idx === i ? '#000' : hasFilled(i) ? '#000' : '#E5E7EB'}`,
                  background: idx === i ? '#000' : hasFilled(i) ? '#F0F0F0' : '#fff',
                  color: idx === i ? '#FFF469' : hasFilled(i) ? '#000' : '#999',
                  fontFamily: "'Monument', monospace", fontSize: 14, fontWeight: 700, cursor: 'pointer', transition: 'all 0.2s'
                }}>{String(i + 1).padStart(2, '0')}</button>
              ))}
              {decisions.length < 3 && (
                <button onClick={() => { addDecision(); setTimeout(() => setIdx(decisions.length), 0); }} style={{
                  width: 44, height: 44, border: '2px dashed #E5E7EB', background: '#fff', color: '#999',
                  fontFamily: "'Monument', monospace", fontSize: 11, fontWeight: 700, cursor: 'pointer', transition: 'all 0.2s'
                }}>+</button>
              )}
            </div>

            {decision && (
            <div key={idx} className="animate-in">
              <div className="item-card">
                <div className="flex justify-between items-start mb-4">
                  <h3 className="plaak text-2xl">DECISION {idx + 1}</h3>
                  {decisions.length > 1 && (
                    <button onClick={() => { removeDecision(decision.id); if (idx >= decisions.length - 1) setIdx(Math.max(0, idx - 1)); }} className="btn-remove">REMOVE</button>
                  )}
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="monument text-sm block mb-2">DECISION NAME</label>
                    <ScienceBookmarkIcon>
                        Naming decisions precisely is critical. Iansiti &amp; Lakhani (Competing in the Age of AI) show that AI-driven organizations outperform because they operate on specific data flows, not vague goals. Define the exact decision, not the category.
                    </ScienceBookmarkIcon>
                    <input type="text" value={decision.decisionName || ''} onChange={(e) => updateDecision(decision.id, 'decisionName', e.target.value)} placeholder="What specific decision do you make regularly?" />
                    <CharCounter current={(decision.decisionName || '').length} min={50} />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="monument text-sm block mb-2">FREQUENCY</label>
                      <ScienceBookmarkIcon>
                          High-frequency decisions yield the fastest AI ROI. Daugherty &amp; Wilson (Human + Machine) found that deploying AI on repetitive, high-volume tasks first delivers the quickest payback — daily decisions should be prioritized over monthly ones.
                      </ScienceBookmarkIcon>
                      <select value={decision.frequency || ''} onChange={(e) => updateDecision(decision.id, 'frequency', e.target.value)}>
                        <option value="">Select frequency</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                      </select>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">IMPACT</label>
                      <ScienceBookmarkIcon>
                          Focus on high-impact decisions first. McKinsey (2023) reports that AI applied to high-impact business decisions delivers 3x the ROI compared to low-impact automation. Rank by revenue effect, customer impact, or strategic value.
                      </ScienceBookmarkIcon>
                      <select value={decision.impact || ''} onChange={(e) => updateDecision(decision.id, 'impact', e.target.value)}>
                        <option value="">Select impact</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">DATA NEEDED</label>
                    <textarea value={decision.dataNeeded || ''} onChange={(e) => updateDecision(decision.id, 'dataNeeded', e.target.value)} placeholder="What data would make this decision faster and more accurate?" />
                    <CharCounter current={(decision.dataNeeded || '').length} min={100} />
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">CURRENT DATA SOURCE</label>
                    <input type="text" value={decision.currentDataSource || ''} onChange={(e) => updateDecision(decision.id, 'currentDataSource', e.target.value)} placeholder="Where does this data exist today?" />
                    <CharCounter current={(decision.currentDataSource || '').length} min={50} />
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">AI OPPORTUNITY</label>
                    <textarea value={decision.aiOpportunity || ''} onChange={(e) => updateDecision(decision.id, 'aiOpportunity', e.target.value)} placeholder="How could AI collect, analyze, and present insights to improve this decision?" />
                    <CharCounter current={(decision.aiOpportunity || '').length} min={100} />
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">SPECIFIC AI TOOL</label>
                    <input type="text" value={decision.aiTool || ''} onChange={(e) => updateDecision(decision.id, 'aiTool', e.target.value)} placeholder="Which AI tool would you use? (e.g., ChatGPT, Salesforce Einstein, custom solution)" />
                    <CharCounter current={(decision.aiTool || '').length} min={10} />
                  </div>
                </div>
              </div>
            </div>
            )}
        </div>
      );
    }

    // Individual Step 2: Top 3 Processes Analysis
    function IndividualStep2({ data, updateProcess, addProcess, removeProcess, idx, setIdx }) {
      const processes = data.individual.processes || [];
      const process = processes[idx] || processes[0];
      const hasFilled = (i) => {
        const p = processes[i];
        return p && ((p.processName || '').length > 0 || (p.currentSteps || '').length > 0);
      };

      return (
        <div>
            <div className="opening-box">
              <div className="numbered-section">02</div>
              <h1 className="plaak text-6xl mt-4 mb-4">TOP 3 PROCESSES ANALYSIS</h1>
              <p className="text-2xl text-gray-300">
                Identify your three most time-consuming processes that AI can automate. You must have exactly 3 processes.
              </p>
            </div>

            <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#999', letterSpacing: '0.06em', textTransform: 'uppercase', marginBottom: 12 }}>
              PROCESS {idx + 1} OF {processes.length}
            </div>

            <div style={{ display: 'flex', gap: 8, marginBottom: 24, flexWrap: 'wrap' }}>
              {processes.map((_, i) => (
                <button key={i} onClick={() => setIdx(i)} style={{
                  width: 44, height: 44, border: `2px solid ${idx === i ? '#000' : hasFilled(i) ? '#000' : '#E5E7EB'}`,
                  background: idx === i ? '#000' : hasFilled(i) ? '#F0F0F0' : '#fff',
                  color: idx === i ? '#FFF469' : hasFilled(i) ? '#000' : '#999',
                  fontFamily: "'Monument', monospace", fontSize: 14, fontWeight: 700, cursor: 'pointer', transition: 'all 0.2s'
                }}>{String(i + 1).padStart(2, '0')}</button>
              ))}
              {processes.length < 3 && (
                <button onClick={() => { addProcess(); setTimeout(() => setIdx(processes.length), 0); }} style={{
                  width: 44, height: 44, border: '2px dashed #E5E7EB', background: '#fff', color: '#999',
                  fontFamily: "'Monument', monospace", fontSize: 11, fontWeight: 700, cursor: 'pointer', transition: 'all 0.2s'
                }}>+</button>
              )}
            </div>

            {process && (
            <div key={idx} className="animate-in">
              <div className="item-card">
                <div className="flex justify-between items-start mb-4">
                  <h3 className="plaak text-2xl">PROCESS {idx + 1}</h3>
                  {processes.length > 1 && (
                    <button onClick={() => { removeProcess(process.id); if (idx >= processes.length - 1) setIdx(Math.max(0, idx - 1)); }} className="btn-remove">REMOVE</button>
                  )}
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="monument text-sm block mb-2">PROCESS NAME</label>
                    <input type="text" value={process.processName || ''} onChange={(e) => updateProcess(process.id, 'processName', e.target.value)} placeholder="What repetitive process consumes your time?" />
                    <CharCounter current={(process.processName || '').length} min={50} />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="monument text-sm block mb-2">TIME CONSUMED (hours per week)</label>
                      <input type="number" value={process.timeConsumed || ''} onChange={(e) => updateProcess(process.id, 'timeConsumed', e.target.value)} placeholder="Hours per week" />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">REPETITION</label>
                      <select value={process.repetition || ''} onChange={(e) => updateProcess(process.id, 'repetition', e.target.value)}>
                        <option value="">Select frequency</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">CURRENT STEPS</label>
                    <textarea value={process.currentSteps || ''} onChange={(e) => updateProcess(process.id, 'currentSteps', e.target.value)} placeholder="Describe how you complete this process today, step by step..." rows={6} />
                    <CharCounter current={(process.currentSteps || '').length} min={200} />
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">AUTOMATION OPPORTUNITY</label>
                    <textarea value={process.automationOpportunity || ''} onChange={(e) => updateProcess(process.id, 'automationOpportunity', e.target.value)} placeholder="Which steps could AI automate? How would it work?" />
                    <CharCounter current={(process.automationOpportunity || '').length} min={150} />
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">KEY PERFORMANCE INDICATORS (KPIs)</label>
                    <textarea value={process.kpis || ''} onChange={(e) => updateProcess(process.id, 'kpis', e.target.value)} placeholder="How will you measure improvement? (time saved, accuracy, speed, quality, etc.)" />
                    <CharCounter current={(process.kpis || '').length} min={100} />
                  </div>

                  <div>
                    <label className="monument text-sm block mb-2">SPECIFIC AI TOOL</label>
                    <input type="text" value={process.aiTool || ''} onChange={(e) => updateProcess(process.id, 'aiTool', e.target.value)} placeholder="Which AI tool would you use? (e.g., Zapier, Make, Monday.com AI)" />
                    <CharCounter current={(process.aiTool || '').length} min={10} />
                  </div>
                </div>
              </div>
            </div>
            )}
        </div>
      );
    }

    // Individual Step 3: AI Implementation Plan
    function IndividualStep3({ data, setData, updateAITool, addAITool, removeAITool, idx, setIdx }) {
      const aiTools = data.individual.implementation?.aiTools || [];
      const tool = aiTools[idx] || aiTools[0];
      const hasFilled = (i) => {
        const t = aiTools[i];
        return t && ((t.tool || '').length > 0 || (t.purpose || '').length > 0);
      };

      return (
        <div>
            <div className="opening-box">
              <div className="numbered-section">03</div>
              <h1 className="plaak text-6xl mt-4 mb-4">AI IMPLEMENTATION PLAN</h1>
              <p className="text-2xl text-gray-300">
                Create your action plan for implementing AI tools and measuring success.
              </p>
            </div>

            <div className="mb-8">
              <h2 className="plaak text-3xl mb-4">AI TOOLS LIST</h2>
              <p className="text-lg text-gray-300 mb-4">
                List all AI tools you will implement, including purpose, cost, and timeline.
              </p>

              <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#999', letterSpacing: '0.06em', textTransform: 'uppercase', marginBottom: 12 }}>
                TOOL {idx + 1} OF {aiTools.length}
              </div>

              <div style={{ display: 'flex', gap: 8, marginBottom: 24, flexWrap: 'wrap' }}>
                {aiTools.map((_, i) => (
                  <button key={i} onClick={() => setIdx(i)} style={{
                    width: 44, height: 44, border: `2px solid ${idx === i ? '#000' : hasFilled(i) ? '#000' : '#E5E7EB'}`,
                    background: idx === i ? '#000' : hasFilled(i) ? '#F0F0F0' : '#fff',
                    color: idx === i ? '#FFF469' : hasFilled(i) ? '#000' : '#999',
                    fontFamily: "'Monument', monospace", fontSize: 14, fontWeight: 700, cursor: 'pointer', transition: 'all 0.2s'
                  }}>{String(i + 1).padStart(2, '0')}</button>
                ))}
                <button onClick={() => { addAITool(); setTimeout(() => setIdx(aiTools.length), 0); }} style={{
                  width: 44, height: 44, border: '2px dashed #E5E7EB', background: '#fff', color: '#999',
                  fontFamily: "'Monument', monospace", fontSize: 11, fontWeight: 700, cursor: 'pointer', transition: 'all 0.2s'
                }}>+</button>
              </div>

              {tool && (
              <div key={idx} className="animate-in">
                <div className="item-card">
                  <div className="flex justify-between items-start mb-4">
                    <h3 className="plaak text-xl">TOOL {idx + 1}</h3>
                    {aiTools.length > 1 && (
                      <button onClick={() => { removeAITool(tool.id); if (idx >= aiTools.length - 1) setIdx(Math.max(0, idx - 1)); }} className="btn-remove">REMOVE</button>
                    )}
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="monument text-sm block mb-2">TOOL NAME</label>
                      <input type="text" value={tool.tool || ''} onChange={(e) => updateAITool(tool.id, 'tool', e.target.value)} placeholder="AI tool name" />
                      <CharCounter current={(tool.tool || '').length} min={5} />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">PURPOSE</label>
                      <input type="text" value={tool.purpose || ''} onChange={(e) => updateAITool(tool.id, 'purpose', e.target.value)} placeholder="What will it do?" />
                      <CharCounter current={(tool.purpose || '').length} min={20} />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">COST ESTIMATE</label>
                      <input type="text" value={tool.cost || ''} onChange={(e) => updateAITool(tool.id, 'cost', e.target.value)} placeholder="Monthly cost" />
                      <CharCounter current={(tool.cost || '').length} min={5} />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">TIMELINE</label>
                      <input type="text" value={tool.timeline || ''} onChange={(e) => updateAITool(tool.id, 'timeline', e.target.value)} placeholder="When to implement" />
                      <CharCounter current={(tool.timeline || '').length} min={10} />
                    </div>
                  </div>
                </div>
              </div>
              )}
            </div>

            <div className="mb-8 space-y-6">
              <div>
                <label className="monument text-sm block mb-2">SUCCESS METRICS</label>
                <textarea
                  value={data.individual.implementation?.successMetrics || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    individual: {
                      ...prev.individual,
                      implementation: {
                        ...prev.individual.implementation,
                        successMetrics: e.target.value
                      }
                    }
                  }))}
                  placeholder="How will you measure success? Time saved, accuracy improvements, productivity gains, revenue impact..."
                  rows={4}
                />
                <CharCounter current={(data.individual.implementation?.successMetrics || '').length} min={200} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">OBSTACLES AND SOLUTIONS</label>
                <textarea
                  value={data.individual.implementation?.obstacles || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    individual: {
                      ...prev.individual,
                      implementation: {
                        ...prev.individual.implementation,
                        obstacles: e.target.value
                      }
                    }
                  }))}
                  placeholder="What challenges do you anticipate? How will you overcome them?"
                  rows={4}
                />
                <CharCounter current={(data.individual.implementation?.obstacles || '').length} min={150} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">SUPPORT NEEDED</label>
                <textarea
                  value={data.individual.implementation?.supportNeeded || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    individual: {
                      ...prev.individual,
                      implementation: {
                        ...prev.individual.implementation,
                        supportNeeded: e.target.value
                      }
                    }
                  }))}
                  placeholder="What help do you need? Budget approval, training, technical support, team buy-in..."
                />
                <CharCounter current={(data.individual.implementation?.supportNeeded || '').length} min={100} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">START DATE</label>
                <input
                  type="date"
                  value={data.individual.implementation?.startDate || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    individual: {
                      ...prev.individual,
                      implementation: {
                        ...prev.individual.implementation,
                        startDate: e.target.value
                      }
                    }
                  }))}
                />
              </div>
            </div>

        </div>
      );
    }

    // Individual Canvas
    function IndividualCanvas({ data, onExport, onSubmit }) {
      return (
        <div className="min-h-screen bg-neutral-900 p-8">
          <div className="max-w-7xl mx-auto">
            <div className="mb-8 text-center no-print">
              <h1 className="plaak text-6xl mb-4">YOUR AI DIGITALIZATION CANVAS</h1>
              <p className="text-2xl text-gray-300 mb-6">Individual Tool Summary</p>
              <div className="flex gap-6 justify-center">
                <button onClick={onExport} className="btn-primary">
                  EXPORT TO PDF
                </button>
                {onSubmit && <button onClick={onSubmit} className="btn-primary">
                  SUBMIT
                </button>}
              </div>
            </div>

            <div id="canvas-content" className="bg-white p-12">
              <div className="text-center mb-12">
                <h1 className="plaak text-5xl mb-2">AI DIGITALIZATION STRATEGY</h1>
                <p className="text-xl text-gray-400">Individual Implementation Plan</p>
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">TOP 3 DECISIONS FOR AI OPTIMIZATION</h2>
                {(data.individual.decisions || []).map((decision, index) => (
                  <div key={decision.id} className="mb-6 pb-6 border-b border-gray-300 last:border-0">
                    <h3 className="riforma-bold text-xl mb-2">DECISION {index + 1}: {decision.decisionName}</h3>
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <p className="monument text-xs text-gray-400">FREQUENCY & IMPACT</p>
                        <p>{decision.frequency} | {decision.impact} impact</p>
                      </div>
                      <div>
                        <p className="monument text-xs text-gray-400">AI TOOL</p>
                        <p>{decision.aiTool}</p>
                      </div>
                      <div className="col-span-2">
                        <p className="monument text-xs text-gray-400">DATA NEEDED</p>
                        <p>{decision.dataNeeded}</p>
                      </div>
                      <div className="col-span-2">
                        <p className="monument text-xs text-gray-400">AI OPPORTUNITY</p>
                        <p>{decision.aiOpportunity}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">TOP 3 PROCESSES FOR AI AUTOMATION</h2>
                {(data.individual.processes || []).map((process, index) => (
                  <div key={process.id} className="mb-6 pb-6 border-b border-gray-300 last:border-0">
                    <h3 className="riforma-bold text-xl mb-2">PROCESS {index + 1}: {process.processName}</h3>
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <p className="monument text-xs text-gray-400">TIME & FREQUENCY</p>
                        <p>{process.timeConsumed} hrs/week | {process.repetition}</p>
                      </div>
                      <div>
                        <p className="monument text-xs text-gray-400">AI TOOL</p>
                        <p>{process.aiTool}</p>
                      </div>
                      <div className="col-span-2">
                        <p className="monument text-xs text-gray-400">AUTOMATION OPPORTUNITY</p>
                        <p>{process.automationOpportunity}</p>
                      </div>
                      <div className="col-span-2">
                        <p className="monument text-xs text-gray-400">SUCCESS METRICS (KPIs)</p>
                        <p>{process.kpis}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">AI TOOLS IMPLEMENTATION TIMELINE</h2>
                <div className="space-y-4">
                  {(data.individual.implementation?.aiTools || []).map((tool, index) => (
                    <div key={tool.id} className="flex justify-between items-center border-b pb-2">
                      <div className="flex-1">
                        <p className="riforma-bold text-lg">{tool.tool}</p>
                        <p className="text-sm text-gray-400">{tool.purpose}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-sm font-bold">{tool.cost}</p>
                        <p className="text-sm text-gray-400">{tool.timeline}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">SUCCESS METRICS & IMPLEMENTATION</h2>
                <div className="space-y-4">
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">SUCCESS METRICS</p>
                    <p>{data.individual.implementation?.successMetrics}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">OBSTACLES & SOLUTIONS</p>
                    <p>{data.individual.implementation?.obstacles}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">SUPPORT NEEDED</p>
                    <p>{data.individual.implementation?.supportNeeded}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">START DATE</p>
                    <p className="riforma-bold text-lg">{data.individual.implementation?.startDate}</p>
                  </div>
                </div>
              </div>

              <div className="canvas-section bg-yellow-50">
                <h2 className="plaak text-3xl mb-4">NEXT ACTIONS</h2>
                <div className="space-y-2">
                  <p className="riforma-bold">WEEK 1: Set up first AI tool and test with pilot decision/process</p>
                  <p className="riforma-bold">WEEK 2: Measure initial results and refine approach</p>
                  <p className="riforma-bold">WEEK 3: Roll out to additional decisions/processes and train team</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Team Step 1: Collect Individual Analyses
    function TeamStep1({ data, updateTeamMember, addTeamMember, removeTeamMember }) {
      return (
        <div>
            <div className="opening-box">
              <div className="numbered-section">01</div>

              <h1 className="plaak text-6xl mt-4 mb-4">COLLECT INDIVIDUAL ANALYSES</h1>
              <p className="text-2xl text-gray-300">
                Gather each team member's individual AI analysis. Minimum 3 team members required.
              </p>
            </div>

            <div className="mb-8">
              {(data.team.individualAnalyses || []).map((member, index) => (
                <div key={member.id} className="item-card">
                  <div className="flex justify-between items-start mb-4">
                    <h3 className="plaak text-2xl">TEAM MEMBER {index + 1}</h3>
                    {(data.team.individualAnalyses || []).length > 1 && (
                      <button
                        onClick={() => removeTeamMember(member.id)}
                        className="btn-remove"
                      >
                        REMOVE
                      </button>
                    )}
                  </div>

                  <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="monument text-sm block mb-2">MEMBER NAME</label>
                        <input
                          type="text"
                          value={member.memberName || ''}
                          onChange={(e) => updateTeamMember(member.id, 'memberName', e.target.value)}
                          placeholder="Full name"
                        />
                        <CharCounter current={(member.memberName || '').length} min={5} />
                      </div>

                      <div>
                        <label className="monument text-sm block mb-2">ROLE</label>
                        <input
                          type="text"
                          value={member.role || ''}
                          onChange={(e) => updateTeamMember(member.id, 'role', e.target.value)}
                          placeholder="Job title"
                        />
                        <CharCounter current={(member.role || '').length} min={5} />
                      </div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">TOP 3 DECISIONS SUMMARY</label>
                      <textarea
                        value={member.top3Decisions || ''}
                        onChange={(e) => updateTeamMember(member.id, 'top3Decisions', e.target.value)}
                        placeholder="Summarize their top 3 decisions for AI optimization..."
                        rows={4}
                      />
                      <CharCounter current={(member.top3Decisions || '').length} min={100} />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">TOP 3 PROCESSES SUMMARY</label>
                      <textarea
                        value={member.top3Processes || ''}
                        onChange={(e) => updateTeamMember(member.id, 'top3Processes', e.target.value)}
                        placeholder="Summarize their top 3 processes for AI automation..."
                        rows={4}
                      />
                      <CharCounter current={(member.top3Processes || '').length} min={100} />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">AI OPPORTUNITIES IDENTIFIED</label>
                      <textarea
                        value={member.aiOpportunities || ''}
                        onChange={(e) => updateTeamMember(member.id, 'aiOpportunities', e.target.value)}
                        placeholder="What AI tools and opportunities did they identify?"
                      />
                      <CharCounter current={(member.aiOpportunities || '').length} min={100} />
                    </div>
                  </div>
                </div>
              ))}

              <button onClick={addTeamMember} className="btn-secondary w-full">
                ADD TEAM MEMBER
              </button>
            </div>
        </div>
      );
    }

    // Team Step 2: Pattern Recognition
    function TeamStep2({ data, setData }) {
      return (
        <div>
            <div className="opening-box">
              <div className="numbered-section">02</div>

              <h1 className="plaak text-6xl mt-4 mb-4">PATTERN RECOGNITION</h1>
              <p className="text-2xl text-gray-300">
                Identify common themes, shared opportunities, and collaboration potential across team members.
              </p>
            </div>

            <div className="mb-8 space-y-6">
              <div>
                <label className="monument text-sm block mb-2">COMMON DECISIONS ACROSS ROLES</label>
                <textarea
                  value={data.team.patterns?.commonDecisions || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      patterns: {
                        ...prev.team.patterns,
                        commonDecisions: e.target.value
                      }
                    }
                  }))}
                  placeholder="Which decisions appear across multiple roles? What patterns emerge?"
                  rows={4}
                />
                <CharCounter current={(data.team.patterns?.commonDecisions || '').length} min={100} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">COMMON PROCESSES ACROSS ROLES</label>
                <textarea
                  value={data.team.patterns?.commonProcesses || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      patterns: {
                        ...prev.team.patterns,
                        commonProcesses: e.target.value
                      }
                    }
                  }))}
                  placeholder="Which processes are repeated across the team? Where can we standardize?"
                  rows={4}
                />
                <CharCounter current={(data.team.patterns?.commonProcesses || '').length} min={100} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">SHARED AI TOOL OPPORTUNITIES</label>
                <textarea
                  value={data.team.patterns?.sharedAITools || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      patterns: {
                        ...prev.team.patterns,
                        sharedAITools: e.target.value
                      }
                    }
                  }))}
                  placeholder="Which AI tools could serve multiple team members? Where can we get economies of scale?"
                  rows={4}
                />
                <CharCounter current={(data.team.patterns?.sharedAITools || '').length} min={100} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">COLLABORATION OPPORTUNITIES</label>
                <textarea
                  value={data.team.patterns?.collaborationOpportunities || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      patterns: {
                        ...prev.team.patterns,
                        collaborationOpportunities: e.target.value
                      }
                    }
                  }))}
                  placeholder="Where can AI enable better cross-functional collaboration? What data could be shared?"
                  rows={4}
                />
                <CharCounter current={(data.team.patterns?.collaborationOpportunities || '').length} min={100} />
              </div>
            </div>

        </div>
      );
    }

    // Team Step 3: Company AI Strategy
    function TeamStep3({ data, setData }) {
      return (
        <div>
            <div className="opening-box">
              <div className="numbered-section">03</div>
              <h1 className="plaak text-6xl mt-4 mb-4">COMPANY AI STRATEGY</h1>
              <p className="text-2xl text-gray-300">
                Define your unified AI approach aligned with company goals.
              </p>
            </div>

            <div className="mb-8 space-y-6">
              <div>
                <label className="monument text-sm block mb-2">COMPANY GOALS ALIGNMENT</label>
                <textarea
                  value={data.team.strategy?.companyGoals || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      strategy: {
                        ...prev.team.strategy,
                        companyGoals: e.target.value
                      }
                    }
                  }))}
                  placeholder="How does AI implementation support our company's strategic goals? What business outcomes will improve?"
                  rows={5}
                />
                <CharCounter current={(data.team.strategy?.companyGoals || '').length} min={150} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">PRIORITY AI AREAS</label>
                <textarea
                  value={data.team.strategy?.priorityAreas || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      strategy: {
                        ...prev.team.strategy,
                        priorityAreas: e.target.value
                      }
                    }
                  }))}
                  placeholder="Which decisions and processes should we AI-enable first? Why these priorities?"
                  rows={5}
                />
                <CharCounter current={(data.team.strategy?.priorityAreas || '').length} min={150} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">CROSS-FUNCTIONAL OPPORTUNITIES</label>
                <textarea
                  value={data.team.strategy?.crossFunctionalOpportunities || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      strategy: {
                        ...prev.team.strategy,
                        crossFunctionalOpportunities: e.target.value
                      }
                    }
                  }))}
                  placeholder="Where can AI break down silos and enable cross-department collaboration?"
                  rows={5}
                />
                <CharCounter current={(data.team.strategy?.crossFunctionalOpportunities || '').length} min={150} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">UNIFIED AI APPROACH</label>
                <textarea
                  value={data.team.strategy?.unifiedApproach || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      strategy: {
                        ...prev.team.strategy,
                        unifiedApproach: e.target.value
                      }
                    }
                  }))}
                  placeholder="What is our overall AI philosophy? How will we coordinate implementation across the organization?"
                  rows={5}
                />
                <CharCounter current={(data.team.strategy?.unifiedApproach || '').length} min={150} />
              </div>
            </div>

        </div>
      );
    }

    // Team Step 4: Implementation Plan
    function TeamStep4({ data, setData, updateActionOwner, addActionOwner, removeActionOwner }) {
      return (
        <div>
            <div className="opening-box">
              <div className="numbered-section">04</div>
              <h1 className="plaak text-6xl mt-4 mb-4">IMPLEMENTATION PLAN</h1>
              <p className="text-2xl text-gray-300">
                Create your 3-week action plan with clear ownership and accountability.
              </p>
            </div>

            <div className="mb-8 space-y-6">
              <div>
                <label className="monument text-sm block mb-2">WEEK 1 ACTIONS</label>
                <textarea
                  value={data.team.implementationPlan?.week1Actions || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      implementationPlan: {
                        ...prev.team.implementationPlan,
                        week1Actions: e.target.value
                      }
                    }
                  }))}
                  placeholder="What will we accomplish in week 1? Setup, tool selection, initial testing..."
                  rows={5}
                />
                <CharCounter current={(data.team.implementationPlan?.week1Actions || '').length} min={200} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">WEEK 2 ACTIONS</label>
                <textarea
                  value={data.team.implementationPlan?.week2Actions || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      implementationPlan: {
                        ...prev.team.implementationPlan,
                        week2Actions: e.target.value
                      }
                    }
                  }))}
                  placeholder="What will we accomplish in week 2? Pilot implementation, training, measurement..."
                  rows={5}
                />
                <CharCounter current={(data.team.implementationPlan?.week2Actions || '').length} min={200} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">WEEK 3 ACTIONS</label>
                <textarea
                  value={data.team.implementationPlan?.week3Actions || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      implementationPlan: {
                        ...prev.team.implementationPlan,
                        week3Actions: e.target.value
                      }
                    }
                  }))}
                  placeholder="What will we accomplish in week 3? Full rollout, optimization, documentation..."
                  rows={5}
                />
                <CharCounter current={(data.team.implementationPlan?.week3Actions || '').length} min={200} />
              </div>
            </div>

            <div className="mb-8">
              <h2 className="plaak text-3xl mb-4">OWNERSHIP MATRIX</h2>
              <p className="text-lg text-gray-300 mb-4">
                Assign specific actions to owners with deadlines. Minimum 5 action items required.
              </p>

              {(data.team.implementationPlan?.owners || []).map((owner, index) => (
                <div key={owner.id} className="item-card">
                  <div className="flex justify-between items-start mb-4">
                    <h3 className="plaak text-xl">ACTION {index + 1}</h3>
                    {(data.team.implementationPlan?.owners || []).length > 1 && (
                      <button
                        onClick={() => removeActionOwner(owner.id)}
                        className="btn-remove"
                      >
                        REMOVE
                      </button>
                    )}
                  </div>

                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="monument text-sm block mb-2">ACTION</label>
                      <input
                        type="text"
                        value={owner.action || ''}
                        onChange={(e) => updateActionOwner(owner.id, 'action', e.target.value)}
                        placeholder="Specific action"
                      />
                      <CharCounter current={(owner.action || '').length} min={10} />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">OWNER</label>
                      <input
                        type="text"
                        value={owner.owner || ''}
                        onChange={(e) => updateActionOwner(owner.id, 'owner', e.target.value)}
                        placeholder="Who owns this"
                      />
                      <CharCounter current={(owner.owner || '').length} min={3} />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">DEADLINE</label>
                      <input
                        type="date"
                        value={owner.deadline || ''}
                        onChange={(e) => updateActionOwner(owner.id, 'deadline', e.target.value)}
                      />
                    </div>
                  </div>
                </div>
              ))}

              <button onClick={addActionOwner} className="btn-secondary w-full">
                ADD ACTION ITEM
              </button>
            </div>

            <div className="mb-8 space-y-6">
              <div>
                <label className="monument text-sm block mb-2">REVIEW SCHEDULE</label>
                <textarea
                  value={data.team.implementationPlan?.reviewSchedule || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      implementationPlan: {
                        ...prev.team.implementationPlan,
                        reviewSchedule: e.target.value
                      }
                    }
                  }))}
                  placeholder="When will we review progress? Weekly check-ins, metrics review meetings..."
                />
                <CharCounter current={(data.team.implementationPlan?.reviewSchedule || '').length} min={50} />
              </div>

              <div>
                <label className="monument text-sm block mb-2">SUCCESS METRICS</label>
                <textarea
                  value={data.team.implementationPlan?.successMetrics || ''}
                  onChange={(e) => setData(prev => ({
                    ...prev,
                    team: {
                      ...prev.team,
                      implementationPlan: {
                        ...prev.team.implementationPlan,
                        successMetrics: e.target.value
                      }
                    }
                  }))}
                  placeholder="How will we measure team-wide success? Time saved, productivity gains, cost savings, quality improvements..."
                  rows={5}
                />
                <CharCounter current={(data.team.implementationPlan?.successMetrics || '').length} min={150} />
              </div>
            </div>

        </div>
      );
    }

    // Team Canvas
    function TeamCanvas({ data, onExport, onSubmit }) {
      return (
        <div className="min-h-screen bg-neutral-900 p-8">
          <div className="max-w-7xl mx-auto">
            <div className="mb-8 text-center no-print">
              <h1 className="plaak text-6xl mb-4">TEAM AI DIGITALIZATION CANVAS</h1>
              <p className="text-2xl text-gray-300 mb-6">Team Tool Summary</p>
              <div className="flex gap-6 justify-center">
                <button onClick={onExport} className="btn-primary">
                  EXPORT TO PDF
                </button>
                {onSubmit && <button onClick={onSubmit} className="btn-primary">
                  SUBMIT
                </button>}
              </div>
            </div>

            {/* Case Study */}
            <CaseStudy
                before={"ManufactureCorp operated with manual procurement (8 hours per vendor analysis), disconnected quality control data, and planning processes that took 3x longer than competitors. Every department had different spreadsheets and no shared AI capability."}
                after={"After enabling every employee with AI tools, procurement became 75% faster, quality control was 90% automated, and planning efficiency improved 60%. ManufactureCorp captured 40% market share while their competitor \u2014 who ignored AI democratization \u2014 filed bankruptcy within 18 months."}
                quote={"We stopped treating AI as an IT project and started treating it as everyone's competitive weapon. The moment each person owned their own AI decisions and processes, transformation became unstoppable. \u2014 CEO, ManufactureCorp"}
            />

            <div id="canvas-content" className="bg-white p-12">
              <div className="text-center mb-12">
                <h1 className="plaak text-5xl mb-2">TEAM AI DIGITALIZATION STRATEGY</h1>
                <p className="text-xl text-gray-400">Collaborative Implementation Plan</p>
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">TEAM MEMBER CONTRIBUTIONS</h2>
                {(data.team.individualAnalyses || []).map((member, index) => (
                  <div key={member.id} className="mb-6 pb-6 border-b border-gray-300 last:border-0">
                    <h3 className="riforma-bold text-xl mb-2">{member.memberName} - {member.role}</h3>
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <p className="monument text-xs text-gray-400">TOP 3 DECISIONS</p>
                        <p>{member.top3Decisions}</p>
                      </div>
                      <div>
                        <p className="monument text-xs text-gray-400">TOP 3 PROCESSES</p>
                        <p>{member.top3Processes}</p>
                      </div>
                      <div className="col-span-2">
                        <p className="monument text-xs text-gray-400">AI OPPORTUNITIES</p>
                        <p>{member.aiOpportunities}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">PATTERN RECOGNITION RESULTS</h2>
                <div className="space-y-4">
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">COMMON DECISIONS</p>
                    <p>{data.team.patterns?.commonDecisions}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">COMMON PROCESSES</p>
                    <p>{data.team.patterns?.commonProcesses}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">SHARED AI TOOLS</p>
                    <p>{data.team.patterns?.sharedAITools}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">COLLABORATION OPPORTUNITIES</p>
                    <p>{data.team.patterns?.collaborationOpportunities}</p>
                  </div>
                </div>
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">COMPANY AI STRATEGY</h2>
                <div className="space-y-4">
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">COMPANY GOALS ALIGNMENT</p>
                    <p>{data.team.strategy?.companyGoals}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">PRIORITY AI AREAS</p>
                    <p>{data.team.strategy?.priorityAreas}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">CROSS-FUNCTIONAL OPPORTUNITIES</p>
                    <p>{data.team.strategy?.crossFunctionalOpportunities}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">UNIFIED APPROACH</p>
                    <p>{data.team.strategy?.unifiedApproach}</p>
                  </div>
                </div>
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">3-WEEK IMPLEMENTATION TIMELINE</h2>
                <div className="space-y-4">
                  <div className="border-l-4 border-black pl-4">
                    <p className="monument text-xs text-gray-400 mb-2">WEEK 1</p>
                    <p>{data.team.implementationPlan?.week1Actions}</p>
                  </div>
                  <div className="border-l-4 border-black pl-4">
                    <p className="monument text-xs text-gray-400 mb-2">WEEK 2</p>
                    <p>{data.team.implementationPlan?.week2Actions}</p>
                  </div>
                  <div className="border-l-4 border-black pl-4">
                    <p className="monument text-xs text-gray-400 mb-2">WEEK 3</p>
                    <p>{data.team.implementationPlan?.week3Actions}</p>
                  </div>
                </div>
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">OWNERSHIP & ACCOUNTABILITY</h2>
                <div className="space-y-2">
                  {(data.team.implementationPlan?.owners || []).map((owner, index) => (
                    <div key={owner.id} className="flex justify-between items-center border-b pb-2">
                      <div className="flex-1">
                        <p className="riforma-bold">{owner.action}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-sm font-bold">{owner.owner}</p>
                        <p className="text-sm text-gray-400">{owner.deadline}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="canvas-section">
                <h2 className="plaak text-3xl mb-6">SUCCESS METRICS & REVIEW</h2>
                <div className="space-y-4">
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">REVIEW SCHEDULE</p>
                    <p>{data.team.implementationPlan?.reviewSchedule}</p>
                  </div>
                  <div>
                    <p className="monument text-xs text-gray-400 mb-2">SUCCESS METRICS</p>
                    <p>{data.team.implementationPlan?.successMetrics}</p>
                  </div>
                </div>
              </div>

              <div className="canvas-section bg-yellow-50">
                <h2 className="plaak text-3xl mb-4">COMMITMENT</h2>
                <p className="riforma-bold text-lg">
                  Our team commits to implementing AI across all identified decisions and processes within 3 weeks.
                  We will democratize AI capabilities, measure impact rigorously, and create sustainable competitive advantage through AI-powered operations.
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Render App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AIDigitalizationApp />);
  </script>
</body>
</html>
