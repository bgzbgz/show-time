<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Segmentation & Target Market | Fast Track Program</title>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../shared/js/tool-db.js"></script>
  <script src="../../shared/js/ai-challenge.js"></script>
  <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    /* Font Face Declarations */
    @font-face {
      font-family: 'Plaak';
      src: url('Plaak3Trial-43-Bold.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
    }

    @font-face {
      font-family: 'Riforma';
      src: url('RiformaLL-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Monument';
      src: url('MonumentGrotesk-Mono.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Riforma', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .plaak {
      font-family: 'Plaak', sans-serif;
      text-transform: uppercase;
      font-weight: bold;
      letter-spacing: -0.02em;
    }

    .riforma-bold {
      font-family: 'Riforma', sans-serif;
      font-weight: bold;
    }

    .monument {
      font-family: 'Monument', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }

    .transition-animate-in {
      animation: slideIn 0.6s ease-out;
    }

    /* Button Styles */
    .btn-primary {
      background: #000000;
      color: #FFFFFF;
      padding: 16px 32px;
      border: 2px solid #000000;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: normal;
    }

    .btn-primary:hover:not(:disabled) {
      transform: scale(1.02);
    }

    .btn-primary:disabled {
      background: #E0E0E0;
      border-color: #E0E0E0;
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #FFFFFF;
      color: #000000;
      padding: 12px 24px;
      border: 2px solid #000000;
      font-size: 16px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: #F8F8F8;
    }

    /* Form Styles */
    input[type="text"],
    input[type="number"],
    input[type="email"],
    textarea,
    select {
      border: 1px solid #E0E0E0;
      padding: 12px 16px;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      width: 100%;
      transition: border-color 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #000000;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    textarea::placeholder {
      white-space: pre-line;
    }

    /* Numbered Section Badge */
    .numbered-section {
      background: #000000;
      color: #FFFFFF;
      padding: 10px 16px;
      font-family: 'Plaak', sans-serif;
      font-size: 26px;
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }

    /* Help Button */
    .help-button {
      position: fixed;
      top: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #000000;
      color: #FFFFFF;
      font-size: 28px;
      border: none;
      cursor: pointer;
      z-index: 40;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Riforma', sans-serif;
    }

    .help-button:hover {
      background: #FFF469;
      color: #000000;
      transform: scale(1.1);
    }

    /* Progress Indicator */
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #E0E0E0;
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: #000000;
      transform: scale(1.3);
    }

    .progress-dot.completed {
      background: #000000;
    }

    .progress-line {
      height: 2px;
      background: #E0E0E0;
      flex: 1;
    }

    /* Print Styles */
    @media print {
      .no-print {
        display: none !important;
      }
    }

    /* Character Counter */
    .char-counter {
      font-size: 14px;
      color: #666;
      margin-top: 4px;
    }

    .char-counter.invalid {
      color: #EF4444;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Configuration
    const CONFIG = {
      SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
      TOOL_SLUG: 'segmentation',
      AUTOSAVE_DELAY: 2000
    };

    const { createClient } = supabase;
    const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

    // Make Supabase client globally available for dependency injection
    window.supabaseClient = supabaseClient;

    // Initialize ToolDB and dependency injection
    ToolDB.init(CONFIG.TOOL_SLUG);
    ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        CognitiveLoad.init('segmentation', {"insights":["Trying to serve everyone means serving no one well.","The best segments are underserved, accessible, and profitable."],"caseStudy":{"before":"A mid-size telecom company marketed the same bundle to all customers. Churn was 22% annually, acquisition costs were rising, and marketing ROI was declining quarter over quarter because messages resonated with nobody in particular.","after":"After implementing behavior-based segmentation, they identified 3 high-value clusters: loyalty-driven subscribers, price-sensitive switchers, and tech-early-adopters. Tailored retention offers reduced churn to 14%, customer acquisition cost dropped 35%, and marketing ROI improved by 48% within 9 months.","quote":"Once we stopped trying to be everything to everyone, we became the obvious choice for the customers who actually mattered. Our NPS jumped 22 points in one quarter."}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

    function DependencyContext({ deps }) {
        if (!deps || deps.length === 0) return null;
        return (
            <div style={{ marginBottom: '24px' }}>
                <div style={{ fontFamily: "'Monument', monospace", fontSize: '11px', textTransform: 'uppercase', letterSpacing: '0.05em', color: '#666', marginBottom: '8px' }}>
                    CONTEXT FROM PREVIOUS TOOLS
                </div>
                {deps.map((dep, i) => (
                    <div key={i} style={{ background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '12px 16px', marginBottom: '8px', fontSize: '14px' }}>
                        <div style={{ fontWeight: 600, marginBottom: '4px', color: '#333' }}>{dep.label}</div>
                        <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                    </div>
                ))}
            </div>
        );
    }

    // Main App Component
    function SegmentationApp() {
      const [deps, setDeps] = useState([]);
      const [step, setStep] = useState(0); // 0=cover, 0.5=intro, 1-4=steps, 5=canvas
      const [showHelp, setShowHelp] = useState(false);
      const [showTransition, setShowTransition] = useState(false);
      const [transitionMessage, setTransitionMessage] = useState('');
      const [transitionProgress, setTransitionProgress] = useState(0);
      const [aiReviewing, setAiReviewing] = useState(false);

      const [data, setData] = useState({
        // User details
        name: '',
        email: '',
        company: '',
        role: '',

        // Step 1: Define Segments
        customerBehaviors: '',
        segments: [
          { name: '', description: '', behaviors: '' }
        ],

        // Step 2: Quantify Segments
        segmentSizes: [
          { segment: '', totalMarket: '', accessibleMarket: '', avgRevenue: '', totalValue: '' }
        ],

        // Step 3: Attractiveness Index
        attractivenessCriteria: [
          { segment: '', size: '', growth: '', profitability: '', fit: '', total: '' }
        ],
        criteriaWeights: { size: '25', growth: '25', profitability: '30', fit: '20' },

        // Step 4: Target Market & Goals
        targetSegments: '',
        marketShareGoals: [
          { segment: '', currentShare: '', targetShare: '', timeline: '', strategy: '' }
        ],
        endGame: ''
      });

      useEffect(() => {
          async function loadDeps() {
              const userId = localStorage.getItem('ft_user_id');
              if (!userId || !window.ToolDB || !window.DependencyInjection) return;
              try {
                  await ToolDB.whenReady();
                  const config = DependencyInjection.getDependenciesConfig();
                  const toolConfig = config[CONFIG.TOOL_SLUG];
                  if (!toolConfig || !toolConfig.fields) return;
                  const loaded = [];
                  for (const field of toolConfig.fields) {
                      const val = await ToolDB.getDependency(userId, field.source_field);
                      if (val) {
                          loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                      }
                  }
                  setDeps(loaded);
              } catch (err) {
                  console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
              }
          }
          loadDeps();
      }, []);

      // Auto-save to localStorage
      useEffect(() => {
        const interval = setInterval(() => {
          localStorage.setItem('segmentationData', JSON.stringify({
            data,
            timestamp: new Date().toISOString()
          }));
        }, 2000);

        return () => clearInterval(interval);
      }, [data]);

      // Load saved data on mount
      useEffect(() => {
        const saved = localStorage.getItem('segmentationData');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            if (parsed.data) {
              setData(parsed.data);
            }
          } catch (e) {
            console.error('Failed to parse saved data');
          }
        }
      }, []);

      const updateData = (field, value) => {
        setData(prev => ({ ...prev, [field]: value }));
      };

      // Array management functions
      const addSegment = () => {
        setData(prev => ({
          ...prev,
          segments: [...prev.segments, { name: '', description: '', behaviors: '' }]
        }));
      };

      const removeSegment = (index) => {
        if (data.segments.length > 1) {
          setData(prev => ({
            ...prev,
            segments: prev.segments.filter((_, i) => i !== index)
          }));
        }
      };

      const updateSegment = (index, field, value) => {
        setData(prev => ({
          ...prev,
          segments: prev.segments.map((s, i) =>
            i === index ? { ...s, [field]: value } : s
          )
        }));
      };

      const addSegmentSize = () => {
        setData(prev => ({
          ...prev,
          segmentSizes: [...prev.segmentSizes, { segment: '', totalMarket: '', accessibleMarket: '', avgRevenue: '', totalValue: '' }]
        }));
      };

      const removeSegmentSize = (index) => {
        if (data.segmentSizes.length > 1) {
          setData(prev => ({
            ...prev,
            segmentSizes: prev.segmentSizes.filter((_, i) => i !== index)
          }));
        }
      };

      const updateSegmentSize = (index, field, value) => {
        setData(prev => ({
          ...prev,
          segmentSizes: prev.segmentSizes.map((s, i) => {
            if (i === index) {
              const updated = { ...s, [field]: value };
              // Auto-calculate total value
              if (field === 'accessibleMarket' || field === 'avgRevenue') {
                const accessible = parseFloat(updated.accessibleMarket) || 0;
                const avgRev = parseFloat(updated.avgRevenue) || 0;
                updated.totalValue = (accessible * avgRev).toFixed(0);
              }
              return updated;
            }
            return s;
          })
        }));
      };

      const addAttractiveness = () => {
        setData(prev => ({
          ...prev,
          attractivenessCriteria: [...prev.attractivenessCriteria, { segment: '', size: '', growth: '', profitability: '', fit: '', total: '' }]
        }));
      };

      const removeAttractiveness = (index) => {
        if (data.attractivenessCriteria.length > 1) {
          setData(prev => ({
            ...prev,
            attractivenessCriteria: prev.attractivenessCriteria.filter((_, i) => i !== index)
          }));
        }
      };

      const updateAttractiveness = (index, field, value) => {
        setData(prev => ({
          ...prev,
          attractivenessCriteria: prev.attractivenessCriteria.map((a, i) => {
            if (i === index) {
              const updated = { ...a, [field]: value };
              // Auto-calculate total score
              if (field !== 'segment' && field !== 'total') {
                const size = (parseFloat(updated.size) || 0) * (parseFloat(data.criteriaWeights.size) / 100);
                const growth = (parseFloat(updated.growth) || 0) * (parseFloat(data.criteriaWeights.growth) / 100);
                const profitability = (parseFloat(updated.profitability) || 0) * (parseFloat(data.criteriaWeights.profitability) / 100);
                const fit = (parseFloat(updated.fit) || 0) * (parseFloat(data.criteriaWeights.fit) / 100);
                updated.total = (size + growth + profitability + fit).toFixed(1);
              }
              return updated;
            }
            return a;
          })
        }));
      };

      const addMarketShareGoal = () => {
        setData(prev => ({
          ...prev,
          marketShareGoals: [...prev.marketShareGoals, { segment: '', currentShare: '', targetShare: '', timeline: '', strategy: '' }]
        }));
      };

      const removeMarketShareGoal = (index) => {
        if (data.marketShareGoals.length > 1) {
          setData(prev => ({
            ...prev,
            marketShareGoals: prev.marketShareGoals.filter((_, i) => i !== index)
          }));
        }
      };

      const updateMarketShareGoal = (index, field, value) => {
        setData(prev => ({
          ...prev,
          marketShareGoals: prev.marketShareGoals.map((g, i) =>
            i === index ? { ...g, [field]: value } : g
          )
        }));
      };

      const doTransition = (nextStep) => {
        if (step >= 1 && step <= 4) {
          const messages = ['25% COMPLETE', '50% COMPLETE', '75% COMPLETE', '100% COMPLETE'];
          const progressValues = [25, 50, 75, 100];
          const idx = Math.min(step - 1, 3);
          setTransitionMessage(step === 4 ? '100% COMPLETE' : messages[idx]);
          setTransitionProgress(step === 4 ? 100 : progressValues[idx]);
          setShowTransition(true);
          setTimeout(() => {
            setShowTransition(false);
            setStep(nextStep);
          }, 2000);
        } else {
          setStep(nextStep);
        }
      };

      const goNext = async () => {
        if (step === 0) { setStep(0.5); return; }
        if (step === 0.5) { setStep(1); return; }

        // AI-gated steps 1-4
        if (step >= 1 && step <= 4) {
          const userId = localStorage.getItem('ft_user_id');
          if (!userId) { alert('User not authenticated.'); return; }
          setAiReviewing(true);
          try {
            let stepAnswers = {};
            let stepName = '';
            if (step === 1) {
              stepName = 'Define Segments';
              stepAnswers = { segments_define: { customerBehaviors: data.customerBehaviors, segments: data.segments } };
            } else if (step === 2) {
              stepName = 'Quantify Segments';
              stepAnswers = { segments_quantify: { segmentSizes: data.segmentSizes } };
            } else if (step === 3) {
              stepName = 'Attractiveness Index';
              stepAnswers = { segments_rank: { attractivenessCriteria: data.attractivenessCriteria, criteriaWeights: data.criteriaWeights } };
            } else if (step === 4) {
              stepName = 'Target Market & Goals';
              stepAnswers = { primary_target: { targetSegments: data.targetSegments, marketShareGoals: data.marketShareGoals, endGame: data.endGame } };
            }
            const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
            if (canProceed) {
              doTransition(step === 4 ? 5 : step + 1);
            }
          } catch (err) {
            console.warn('[AIChallenge] Error, allowing passage:', err);
            doTransition(step === 4 ? 5 : step + 1);
          } finally {
            setAiReviewing(false);
          }
          return;
        }
      };

      const goBack = () => {
        if (step === 5) {
          setStep(4);
        } else if (step > 1) {
          setStep(step - 1);
        } else if (step === 1) {
          setStep(0.5);
        }
      };

      // Validation functions
      const canProceedFromIntro = () => {
        return data.name.length > 0 && data.email.length > 0 && data.company.length > 0;
      };

      const canProceedFromStep1 = () => {
        return data.customerBehaviors.length >= 50 &&
               data.segments.every(s => s.name.length >= 3 && s.description.length >= 30);
      };

      const canProceedFromStep2 = () => {
        return data.segmentSizes.every(s =>
          s.segment.length >= 3 && s.totalMarket.length > 0 && s.accessibleMarket.length > 0
        );
      };

      const canProceedFromStep3 = () => {
        return data.attractivenessCriteria.every(a =>
          a.segment.length >= 3 && a.size.length > 0 && a.growth.length > 0
        );
      };

      const canProceedFromStep4 = () => {
        return data.targetSegments.length >= 30 &&
               data.marketShareGoals.every(g => g.segment.length >= 3 && g.targetShare.length > 0) &&
               data.endGame.length >= 50;
      };

      const exportPDF = async () => {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');

        const canvas = document.getElementById('canvas-content');
        if (canvas) {
          const canvasImage = await html2canvas(canvas, {
            scale: 2,
            useCORS: true,
            logging: false
          });

          const imgData = canvasImage.toDataURL('image/png');
          const imgWidth = 190;
          const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

          pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);

          const filename = `Segmentation-Target-Market-Canvas-${new Date().toISOString().split('T')[0]}.pdf`;
          pdf.save(filename);
        }
      };

      const [submitStatus, setSubmitStatus] = useState(null);
      const [submitMessage, setSubmitMessage] = useState('');

      const handleSubmit = async () => {
        try {
          const userId = localStorage.getItem('ft_user_id');
          if (!userId) {
            alert('User not authenticated. Please return to the dashboard.');
            return;
          }

          const questionMappings = {
              segments_list: { customerBehaviors: data.customerBehaviors, segments: data.segments, segmentSizes: data.segmentSizes, attractivenessCriteria: data.attractivenessCriteria, criteriaWeights: data.criteriaWeights },
              primary_target: { targetSegments: data.targetSegments, marketShareGoals: data.marketShareGoals, endGame: data.endGame }
          };

          await window.AIChallenge.submitWithChallenge(userId, CONFIG.TOOL_SLUG, questionMappings, {
              onReviewStart: () => { setSubmitMessage('AI coach is reviewing...'); },
              onRevise: () => { setSubmitStatus(null); setSubmitMessage(''); setStep(4); },
              onSubmitAnyway: () => { setSubmitStatus('success'); setSubmitMessage('Submission saved successfully!'); alert('Segmentation & Target Market plan submitted successfully!'); },
              onError: (err) => { setSubmitStatus('error'); setSubmitMessage('Failed to save: ' + err.message); alert('Submission failed: ' + err.message); }
          });
        } catch (error) {
          console.error('Submit error:', error);
          alert('Submission failed: ' + error.message + '\n\nYour data is still saved locally. Please try again or contact support.');
        }
      };

      // Render different pages based on step
      if (showTransition) {
        return <TransitionScreen message={transitionMessage} progress={transitionProgress} />;
      }

      if (step === 0) {
        return <CoverPage onStart={goNext} />;
      }

      if (step === 0.5) {
        return <IntroPage data={data} updateData={updateData} onNext={goNext} canProceed={canProceedFromIntro()} />;
      }

      if (step === 1) {
        return (
          <>
            <DependencyContext deps={deps} />
            <Step1Page
              data={data}
              updateData={updateData}
              onNext={goNext}
              onBack={goBack}
              canProceed={canProceedFromStep1()}
              setShowHelp={setShowHelp}
              addSegment={addSegment}
              removeSegment={removeSegment}
              updateSegment={updateSegment}
              aiReviewing={aiReviewing}
            />
            {showHelp && <HelpModal onClose={() => setShowHelp(false)} stepNumber={1} />}
          </>
        );
      }

      if (step === 2) {
        return (
          <>
            <Step2Page
              data={data}
              updateData={updateData}
              onNext={goNext}
              onBack={goBack}
              canProceed={canProceedFromStep2()}
              setShowHelp={setShowHelp}
              addSegmentSize={addSegmentSize}
              removeSegmentSize={removeSegmentSize}
              updateSegmentSize={updateSegmentSize}
              aiReviewing={aiReviewing}
            />
            {showHelp && <HelpModal onClose={() => setShowHelp(false)} stepNumber={2} />}
          </>
        );
      }

      if (step === 3) {
        return (
          <>
            <Step3Page
              data={data}
              updateData={updateData}
              onNext={goNext}
              onBack={goBack}
              canProceed={canProceedFromStep3()}
              setShowHelp={setShowHelp}
              addAttractiveness={addAttractiveness}
              removeAttractiveness={removeAttractiveness}
              updateAttractiveness={updateAttractiveness}
              aiReviewing={aiReviewing}
            />
            {showHelp && <HelpModal onClose={() => setShowHelp(false)} stepNumber={3} />}
          </>
        );
      }

      if (step === 4) {
        return (
          <>
            <Step4Page
              data={data}
              updateData={updateData}
              onNext={goNext}
              onBack={goBack}
              canProceed={canProceedFromStep4()}
              setShowHelp={setShowHelp}
              addMarketShareGoal={addMarketShareGoal}
              removeMarketShareGoal={removeMarketShareGoal}
              updateMarketShareGoal={updateMarketShareGoal}
              aiReviewing={aiReviewing}
            />
            {showHelp && <HelpModal onClose={() => setShowHelp(false)} stepNumber={4} />}
          </>
        );
      }

      if (step === 5) {
        return (
          <CanvasPage
            data={data}
            onBack={goBack}
            onExport={exportPDF}
            onSubmit={handleSubmit}
          />
        );
      }

      return null;
    }

    // Cover Page Component
    function CoverPage({ onStart }) {
      return (
        <div className="relative min-h-screen flex items-center justify-center bg-black">
          <div
            className="absolute inset-0 w-full h-full"
            style={{
              backgroundImage: 'url("https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=1920&q=80")',
              backgroundSize: 'cover',
              backgroundPosition: 'center'
            }}
          ></div>
          <div className="absolute inset-0" style={{background: 'linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.85))'}}></div>

          <div className="relative z-10 text-center text-white px-8 max-w-5xl mx-auto">
            <h1 className="plaak animate-in" style={{fontSize: '110px', lineHeight: '1', marginBottom: '32px'}}>
              SEGMENTATION & TARGET MARKET
            </h1>
            <p className="text-4xl mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              Focus on the vital few that matter most
            </p>
            <button
              onClick={onStart}
              className="bg-white text-black plaak px-16 py-6 border-4 border-white hover:bg-black hover:text-white transition-all text-3xl animate-in"
              style={{animationDelay: '0.4s'}}
            >
              START
            </button>
          </div>
        </div>
      );
    }

    // Intro Page Component
    function IntroPage({ data, updateData, onNext, canProceed }) {
      return (
        <div className="bg-black text-white min-h-screen p-16">
          <div className="max-w-5xl mx-auto">
            <h1 className="plaak mb-16 animate-in" style={{fontSize: '100px'}}>
              BEFORE WE START
            </h1>

            {/* User Details */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.05s'}}>
              <h2 className="plaak text-6xl mb-6">YOUR DETAILS</h2>
              <div className="space-y-6 bg-white text-black p-8">
                <div>
                  <label className="monument text-sm block mb-2">NAME <span className="text-red-500">*</span></label>
                  <input
                    type="text"
                    value={data.name}
                    onChange={(e) => updateData('name', e.target.value)}
                    placeholder="Marcus Chen"
                    className="w-full"
                  />
                </div>
                <div>
                  <label className="monument text-sm block mb-2">EMAIL <span className="text-red-500">*</span></label>
                  <input
                    type="email"
                    value={data.email}
                    onChange={(e) => updateData('email', e.target.value)}
                    placeholder="marcus.chen@company.com"
                    className="w-full"
                  />
                </div>
                <div>
                  <label className="monument text-sm block mb-2">COMPANY <span className="text-red-500">*</span></label>
                  <input
                    type="text"
                    value={data.company}
                    onChange={(e) => updateData('company', e.target.value)}
                    placeholder="TechVenture Solutions"
                    className="w-full"
                  />
                </div>
                <div>
                  <label className="monument text-sm block mb-2">ROLE</label>
                  <input
                    type="text"
                    value={data.role}
                    onChange={(e) => updateData('role', e.target.value)}
                    placeholder="Chief Marketing Officer"
                    className="w-full"
                  />
                </div>
              </div>
            </div>

            {/* Sprint Info */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.08s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>SPRINT INFO</h2>
              <div className="bg-white text-black p-8">
                <p className="text-2xl font-bold mb-4">Sprint 13: Segmentation & Target Market</p>
                <p className="text-xl leading-relaxed mb-4">
                  Transform customer data into actionable behavior-driven segments. Identify and prioritize distinct customer clusters based on shared needs and behaviors, allowing for targeted strategies and optimized resource allocation.
                </p>
                <div className="border-l-4 border-black pl-4 italic text-lg">
                  "Use the 80/20 rule - concentrate on the vital few segments that drive the majority of opportunities. Traditional segmentation often misses the mark because it doesn't account for why customers 'hire' a product."
                </div>
              </div>
            </div>

            {/* Purpose */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <h2 className="plaak text-6xl mb-6">PURPOSE</h2>

              <div className="border-l-4 border-white pl-6 mb-6">
                <p className="text-3xl italic mb-2">"Behavior-based segmentation: understand behaviors to identify unmet needs."</p>
                <p className="text-xl text-gray-400">— MICHAEL E. PORTER, Competitive Advantage</p>
              </div>

              <p className="text-3xl leading-relaxed mb-4">
                Enable clear identification of core customer segments based on behaviors, not just demographics. This sets the stage for precise targeting and strategic alignment.
              </p>
              <p className="text-2xl text-gray-400">
                Teams using behavior-based segmentation see 30% higher customer retention than those using traditional demographic approaches.
              </p>
            </div>

            {/* Mistakes to Avoid */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>MISTAKES TO AVOID</h2>

              <div className="bg-white text-black p-6 mb-6 border-4 border-yellow-400">
                <p className="riforma-bold text-2xl mb-4">THE FOUR SEGMENTATION SINS:</p>
                <ul className="text-xl space-y-3">
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">•</span>
                    <span><strong>Overanalysis Paralysis:</strong> Striving for unnecessary precision. Use the 70% rule - focus on actionable insights, not perfect data</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">•</span>
                    <span><strong>Resistance to Change:</strong> Hesitating to shift from traditional segments. Challenge assumptions about who your real customers are</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">•</span>
                    <span><strong>Resource Misalignment:</strong> Struggling to align resources with prioritized segments. Define clear ownership for each target segment</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">•</span>
                    <span><strong>Unclear Criteria Weights:</strong> Disagreements on how to prioritize. Use collaborative workshops to agree on weights for size, profitability, and fit</span>
                  </li>
                </ul>
              </div>

              <ul className="text-2xl space-y-4">
                <li className="flex items-start">
                  <span className="text-4xl mr-4">•</span>
                  <span>Creating overlapping segments. Segments must be mutually exclusive - no customer should fit in multiple segments.</span>
                </li>
                <li className="flex items-start">
                  <span className="text-4xl mr-4">•</span>
                  <span>Basing segments on demographics alone. Focus on behaviors and needs, not just age or location.</span>
                </li>
                <li className="flex items-start">
                  <span className="text-4xl mr-4">•</span>
                  <span>Setting unrealistic market share targets. Be ambitious but grounded in competitive analysis and resources.</span>
                </li>
              </ul>
            </div>

            {/* The Journey */}
            <div className="mb-16 animate-in" style={{animationDelay: '0.3s'}}>
              <h2 className="plaak text-6xl mb-8">THE JOURNEY</h2>
              <div className="grid grid-cols-4 gap-6 text-center">
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">01</div>
                  <p className="text-xl font-bold mb-2">DEFINE SEGMENTS</p>
                  <p className="text-base text-gray-400">Behavior-based customer clusters</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">02</div>
                  <p className="text-xl font-bold mb-2">QUANTIFY</p>
                  <p className="text-base text-gray-400">Size and value each segment</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">03</div>
                  <p className="text-xl font-bold mb-2">RANK</p>
                  <p className="text-base text-gray-400">Attractiveness index scoring</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">04</div>
                  <p className="text-xl font-bold mb-2">TARGET</p>
                  <p className="text-base text-gray-400">Focus and set market share goals</p>
                </div>
              </div>
            </div>

            <button
              onClick={onNext}
              disabled={!canProceed}
              className="btn-primary w-full text-3xl py-8 plaak"
            >
              LET'S START →
            </button>
          </div>
        </div>
      );
    }

    // Transition Screen Component
    function TransitionScreen({ message, progress }) {
      return (
        <div className="fixed inset-0 bg-black text-white flex items-center justify-center z-50 fade-in">
          <div className="text-center px-8">
            <h1 className="plaak transition-animate-in" style={{fontSize: '120px', marginBottom: '32px'}}>
              SECTION COMPLETE
            </h1>

            <div className="max-w-2xl mx-auto mb-8 transition-animate-in" style={{animationDelay: '0.2s'}}>
              <div className="h-2 bg-gray-800 mb-4">
                <div
                  className="h-full bg-white transition-all duration-1000"
                  style={{width: `${progress}%`}}
                ></div>
              </div>
              <p className="monument text-xl tracking-wider">{message}</p>
            </div>
          </div>
        </div>
      );
    }

    // Step 1: Define Segments
    function Step1Page({ data, updateData, onNext, onBack, canProceed, setShowHelp, addSegment, removeSegment, updateSegment, aiReviewing }) {
      return (
        <div className="min-h-screen bg-white">
          <HelpButton onClick={() => setShowHelp(true)} />

          <header className="border-b-2 border-black py-6 px-8 no-print">
            <h1 className="plaak text-3xl">SEGMENTATION & TARGET MARKET</h1>
            <p className="text-sm mt-2 text-gray-600">Focus on the vital few that matter most</p>
          </header>

          <ProgressIndicator currentStep={1} />

          <main className="p-12 max-w-6xl mx-auto">
            <div className="animate-in">
              <div className="numbered-section mb-8">
                [01] DEFINE MARKET SEGMENTS
              </div>

              {/* Fast Track Insight */}
              <FastTrackInsight>
                  80/20 Principle: 80% of your revenue will come from 20% of your customer segments. The critical first step is identifying behaviors -- not demographics -- that reveal why customers buy. Companies that segment by purchase frequency, price sensitivity, and loyalty patterns unlock growth that demographic-only approaches miss entirely. Invest the time here: this step determines the quality of everything that follows.
              </FastTrackInsight>

              {/* The Science */}
              <ScienceBox collapsible={true}>
                  Clayton Christensen's Jobs-to-be-Done research (Harvard Business School) found that products segmented by customer intent rather than demographics succeed at 5x the rate. Porter's work on competitive advantage confirms that behavior-based segmentation identifies unmet needs invisible to traditional approaches. A Bain & Company study of 81 companies found that those using needs-based segmentation achieved 10% higher profit margins than industry peers over a 5-year period.
              </ScienceBox>

              {/* Common Mistake */}
              <WarningBox>
                  The two deadliest segmentation mistakes: <strong>Too many segments</strong> -- teams create 10+ micro-segments they can never serve distinctly, diluting resources across all of them. Aim for 5-7 mutually exclusive segments. <strong>Demographic-only thinking</strong> -- segmenting by age, location, or company size without understanding buying behavior. A 25-year-old and a 55-year-old who both comparison-shop obsessively belong in the same segment. Focus on <em>how</em> they buy, not <em>who</em> they are.
              </WarningBox>


              <div className="bg-black text-white border-4 border-black p-6 mb-8">
                <h3 className="riforma-bold text-3xl mb-2">Identify Behavior-Based Segments</h3>
                <p className="text-xl mb-4">
                  Define 5-7 distinct customer segments based on behaviors, not demographics. Focus on how they buy, what they value, and why they choose solutions.
                </p>
                <p className="text-lg italic border-l-4 border-yellow-400 pl-4">
                  "Traditional segmentation often misses the mark because it doesn't account for why customers 'hire' a product. Jobs-to-be-Done segmentation understands customer intents rather than demographics." — Clayton Christensen
                </p>
              </div>

              <div className="space-y-8">
                <div>
                  <label className="monument text-sm block mb-2">
                    CUSTOMER BEHAVIORS OBSERVED <span className="text-red-500">*</span>
                  </label>
                  <ScienceBookmarkIcon>
                      Porter's value chain analysis shows that mapping observable customer behaviors -- purchase frequency, channel preference, price sensitivity -- predicts segment profitability 3x better than demographic profiling alone (Competitive Advantage, M. Porter).
                  </ScienceBookmarkIcon>
                  <textarea
                    value={data.customerBehaviors}
                    onChange={(e) => updateData('customerBehaviors', e.target.value)}
                    placeholder="Price-sensitive buyers who compare 3+ options before purchase. Early adopters who value innovation over price. Loyal customers who purchase monthly on subscription. B2B decision-makers who require 90-day approval cycles. Last-minute impulse buyers triggered by scarcity."
                    className="w-full"
                    style={{minHeight: '120px'}}
                  />
                  <div className={`char-counter ${data.customerBehaviors.length < 50 ? 'invalid' : ''}`}>
                    {data.customerBehaviors.length}/1000 characters (min 50)
                  </div>
                </div>

                <div>
                  <h4 className="riforma-bold text-2xl mb-4">Market Segments (5-7 segments)</h4>
                  <p className="text-lg mb-4 text-gray-600">
                    Each segment must be mutually exclusive (no overlap) and collectively exhaustive (covers entire market).
                  </p>

                  {data.segments.map((segment, index) => (
                    <div key={index} className="bg-gray-50 p-6 mb-4 border-2 border-gray-200">
                      <div className="flex justify-between items-start mb-4">
                        <span className="monument text-xs">SEGMENT {index + 1}</span>
                        {data.segments.length > 1 && (
                          <button
                            onClick={() => removeSegment(index)}
                            className="text-sm text-red-600 hover:text-red-800"
                          >
                            × Remove
                          </button>
                        )}
                      </div>

                      <div className="space-y-4">
                        <div>
                          <label className="monument text-xs block mb-2">SEGMENT NAME <span className="text-red-500">*</span></label>
                          <ScienceBookmarkIcon>
                              Kim and Mauborgne's Blue Ocean Strategy research shows that clear, behavior-based segment naming increases cross-team alignment by 40%. Names should describe what the customer does, not who they are.
                          </ScienceBookmarkIcon>
                          <input
                            type="text"
                            value={segment.name}
                            onChange={(e) => updateSegment(index, 'name', e.target.value)}
                            placeholder="Price-Conscious Comparers"
                            className="w-full text-base"
                          />
                          <div className={`char-counter ${segment.name.length < 3 ? 'invalid' : ''}`}>
                            {segment.name.length} characters (min 3)
                          </div>
                        </div>

                        <div>
                          <label className="monument text-xs block mb-2">SEGMENT DESCRIPTION <span className="text-red-500">*</span></label>
                          <ScienceBookmarkIcon>
                              Christensen's Jobs-to-be-Done framework found that detailed segment descriptions including decision triggers, timeline, and deal size improve targeting accuracy by 60% vs. vague persona sketches (The Innovator's Solution, C. Christensen).
                          </ScienceBookmarkIcon>
                          <textarea
                            value={segment.description}
                            onChange={(e) => updateSegment(index, 'description', e.target.value)}
                            placeholder="Mid-market B2B companies (50-200 employees) who research extensively before purchase. They compare 3-5 vendors, focus heavily on ROI calculations, and require detailed case studies. Decision cycle: 60-90 days. Average deal size: $15K-$50K."
                            className="w-full text-base"
                            style={{minHeight: '100px'}}
                          />
                          <div className={`char-counter ${segment.description.length < 30 ? 'invalid' : ''}`}>
                            {segment.description.length}/500 characters (min 30)
                          </div>
                        </div>

                        <div>
                          <label className="monument text-xs block mb-2">KEY BEHAVIORS & NEEDS</label>
                          <textarea
                            value={segment.behaviors}
                            onChange={(e) => updateSegment(index, 'behaviors', e.target.value)}
                            placeholder="Compare multiple vendors rigorously. Request detailed ROI analysis. Require references from similar companies. Negotiate on price but value quality. Need implementation support and training."
                            className="w-full text-base"
                            style={{minHeight: '80px'}}
                          />
                        </div>
                      </div>
                    </div>
                  ))}

                  <button
                    onClick={addSegment}
                    className="btn-secondary w-full"
                  >
                    + Add Segment
                  </button>
                </div>
              </div>

              <div className="flex justify-between mt-12">
                <button onClick={onBack} className="btn-secondary">
                  ← Back
                </button>
                <button
                  onClick={onNext}
                  disabled={!canProceed || aiReviewing}
                  className="btn-primary"
                >
                  {aiReviewing ? 'AI Coach Reviewing...' : 'Next: Quantify Segments →'}
                </button>
              </div>
            </div>
          </main>
        </div>
      );
    }

    // Step 2: Quantify Segments
    function Step2Page({ data, updateData, onNext, onBack, canProceed, setShowHelp, addSegmentSize, removeSegmentSize, updateSegmentSize, aiReviewing }) {
      return (
        <div className="min-h-screen bg-white">
          <HelpButton onClick={() => setShowHelp(true)} />

          <header className="border-b-2 border-black py-6 px-8 no-print">
            <h1 className="plaak text-3xl">SEGMENTATION & TARGET MARKET</h1>
            <p className="text-sm mt-2 text-gray-600">Focus on the vital few that matter most</p>
          </header>

          <ProgressIndicator currentStep={2} />

          <main className="p-12 max-w-6xl mx-auto">
            <div className="animate-in">
              <div className="numbered-section mb-8">
                [02] QUANTIFY SEGMENTS
              </div>

              {/* Fast Track Insight */}
              <FastTrackInsight>
                  80/20 Reality Check: Most teams discover that 2-3 segments contain 80% of their total addressable revenue. Quantifying each segment forces brutal honesty -- that "huge" segment you assumed was your bread and butter may actually be smaller than you think, while an overlooked niche could hold the biggest prize. Do not skip the math. Numbers kill assumptions.
              </FastTrackInsight>

              {/* The Science */}
              <ScienceBox collapsible={true}>
                  McKinsey's research on resource allocation found that companies that systematically quantify market segments reallocate capital 2.5x more aggressively to high-value opportunities, generating 30% higher total shareholder returns over 15 years. Porter's profit pool analysis demonstrates that segment profitability can vary by 10x within the same industry -- making quantification essential, not optional (McKinsey Quarterly, "How to Put Your Money Where Your Strategy Is").
              </ScienceBox>


              <div className="bg-black text-white border-4 border-black p-6 mb-8">
                <h3 className="riforma-bold text-3xl mb-2">Size The Prize</h3>
                <p className="text-xl mb-4">
                  Calculate the total market size, your accessible portion, and the revenue potential for each segment. This data drives prioritization.
                </p>
                <p className="text-lg italic border-l-4 border-yellow-400 pl-4">
                  "Focus on profit pools: analyze segment profitability to guide strategy. Build an attractiveness index emphasizing high-margin segments." — Michael E. Porter
                </p>
              </div>

              <div className="space-y-8">
                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                  <p className="riforma-bold text-lg mb-2">Formula:</p>
                  <p className="text-base">Total Segment Value = Accessible Market (# customers) × Average Revenue per Customer</p>
                </div>

                {data.segmentSizes.map((size, index) => (
                  <div key={index} className="border-2 border-black p-6 mb-4">
                    <div className="flex justify-between items-start mb-4">
                      <span className="monument text-xs">SEGMENT {index + 1}</span>
                      {data.segmentSizes.length > 1 && (
                        <button
                          onClick={() => removeSegmentSize(index)}
                          className="text-sm text-red-600 hover:text-red-800"
                        >
                          × Remove
                        </button>
                      )}
                    </div>

                    <div className="space-y-4">
                      <div>
                        <label className="monument text-xs block mb-2">SEGMENT NAME <span className="text-red-500">*</span></label>
                        <input
                          type="text"
                          value={size.segment}
                          onChange={(e) => updateSegmentSize(index, 'segment', e.target.value)}
                          placeholder="Price-Conscious Comparers"
                          className="w-full text-base"
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="monument text-xs block mb-2">TOTAL MARKET (# customers) <span className="text-red-500">*</span></label>
                          <input
                            type="number"
                            value={size.totalMarket}
                            onChange={(e) => updateSegmentSize(index, 'totalMarket', e.target.value)}
                            placeholder="50000"
                            className="w-full text-base"
                          />
                        </div>
                        <div>
                          <label className="monument text-xs block mb-2">ACCESSIBLE MARKET (# customers) <span className="text-red-500">*</span></label>
                          <input
                            type="number"
                            value={size.accessibleMarket}
                            onChange={(e) => updateSegmentSize(index, 'accessibleMarket', e.target.value)}
                            placeholder="15000"
                            className="w-full text-base"
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="monument text-xs block mb-2">AVG REVENUE PER CUSTOMER ($)</label>
                          <input
                            type="number"
                            value={size.avgRevenue}
                            onChange={(e) => updateSegmentSize(index, 'avgRevenue', e.target.value)}
                            placeholder="2500"
                            className="w-full text-base"
                          />
                        </div>
                        <div>
                          <label className="monument text-xs block mb-2">TOTAL SEGMENT VALUE ($)</label>
                          <input
                            type="text"
                            value={size.totalValue}
                            readOnly
                            className="w-full text-base bg-gray-100 font-bold"
                            placeholder="Auto-calculated"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                ))}

                <button
                  onClick={addSegmentSize}
                  className="btn-secondary w-full"
                >
                  + Add Segment
                </button>
              </div>

              <div className="flex justify-between mt-12">
                <button onClick={onBack} className="btn-secondary">
                  ← Back
                </button>
                <button
                  onClick={onNext}
                  disabled={!canProceed || aiReviewing}
                  className="btn-primary"
                >
                  {aiReviewing ? 'AI Coach Reviewing...' : 'Next: Rank Segments →'}
                </button>
              </div>
            </div>
          </main>
        </div>
      );
    }

    // Step 3: Attractiveness Index
    function Step3Page({ data, updateData, onNext, onBack, canProceed, setShowHelp, addAttractiveness, removeAttractiveness, updateAttractiveness, aiReviewing }) {
      return (
        <div className="min-h-screen bg-white">
          <HelpButton onClick={() => setShowHelp(true)} />

          <header className="border-b-2 border-black py-6 px-8 no-print">
            <h1 className="plaak text-3xl">SEGMENTATION & TARGET MARKET</h1>
            <p className="text-sm mt-2 text-gray-600">Focus on the vital few that matter most</p>
          </header>

          <ProgressIndicator currentStep={3} />

          <main className="p-12 max-w-6xl mx-auto">
            <div className="animate-in">
              <div className="numbered-section mb-8">
                [03] ATTRACTIVENESS INDEX
              </div>

              {/* Fast Track Insight */}
              <FastTrackInsight>
                  80/20 Strategic Lever: The attractiveness index prevents the most expensive mistake in business -- spreading resources across too many segments. Use collaborative weight-setting to align your team: profitability should typically carry the highest weight (30-40%), because a large, growing segment with low margins will drain your resources. When your team disagrees on weights, that disagreement itself reveals misalignment you must resolve before targeting.
              </FastTrackInsight>

              {/* The Science */}
              <ScienceBox collapsible={true}>
                  A BCG study of 200+ companies found that firms using weighted multi-criteria evaluation frameworks for segment prioritization achieved 35% higher strategic execution rates than those relying on intuition. The key mechanism: structured scoring forces teams to make implicit assumptions explicit, reducing groupthink and anchoring bias. Kahneman's research on decision-making confirms that systematic scoring outperforms expert judgment in complex multi-variable assessments (BCG Henderson Institute; Kahneman, "Thinking, Fast and Slow").
              </ScienceBox>


              <div className="bg-black text-white border-4 border-black p-6 mb-8">
                <h3 className="riforma-bold text-3xl mb-2">Rank By Strategic Value</h3>
                <p className="text-xl mb-4">
                  Score each segment on size, growth potential, profitability, and strategic fit. This weighted index reveals where to focus resources.
                </p>
                <p className="text-lg italic border-l-4 border-yellow-400 pl-4">
                  "Use the attractiveness index to pinpoint high-potential markets. Target emerging growth areas with nascent but promising segments." — Clayton Christensen
                </p>
              </div>

              <div className="space-y-8">
                <div className="bg-gray-50 border-2 border-black p-6 mb-6">
                  <h4 className="riforma-bold text-xl mb-4">Criteria Weights (must total 100%)</h4>
                  <div className="grid grid-cols-4 gap-4">
                    <div>
                      <label className="monument text-xs block mb-2">SIZE (%)</label>
                      <input
                        type="number"
                        value={data.criteriaWeights.size}
                        onChange={(e) => updateData('criteriaWeights', {...data.criteriaWeights, size: e.target.value})}
                        className="w-full text-base"
                      />
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">GROWTH (%)</label>
                      <input
                        type="number"
                        value={data.criteriaWeights.growth}
                        onChange={(e) => updateData('criteriaWeights', {...data.criteriaWeights, growth: e.target.value})}
                        className="w-full text-base"
                      />
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">PROFITABILITY (%)</label>
                      <input
                        type="number"
                        value={data.criteriaWeights.profitability}
                        onChange={(e) => updateData('criteriaWeights', {...data.criteriaWeights, profitability: e.target.value})}
                        className="w-full text-base"
                      />
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">STRATEGIC FIT (%)</label>
                      <input
                        type="number"
                        value={data.criteriaWeights.fit}
                        onChange={(e) => updateData('criteriaWeights', {...data.criteriaWeights, fit: e.target.value})}
                        className="w-full text-base"
                      />
                    </div>
                  </div>
                  <p className="text-sm text-gray-600 mt-2">
                    Total: {parseInt(data.criteriaWeights.size || 0) + parseInt(data.criteriaWeights.growth || 0) + parseInt(data.criteriaWeights.profitability || 0) + parseInt(data.criteriaWeights.fit || 0)}%
                    {(parseInt(data.criteriaWeights.size || 0) + parseInt(data.criteriaWeights.growth || 0) + parseInt(data.criteriaWeights.profitability || 0) + parseInt(data.criteriaWeights.fit || 0)) !== 100 &&
                      <span className="text-red-500 ml-2">(Must equal 100%)</span>
                    }
                  </p>
                </div>

                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                  <p className="riforma-bold text-lg mb-2">Scoring Guide:</p>
                  <p className="text-base">Rate each criterion 1-10 (10 = most attractive). Total score auto-calculates using your weights above.</p>
                </div>

                {data.attractivenessCriteria.map((criteria, index) => (
                  <div key={index} className="border-2 border-black p-6 mb-4">
                    <div className="flex justify-between items-start mb-4">
                      <span className="monument text-xs">SEGMENT {index + 1}</span>
                      {data.attractivenessCriteria.length > 1 && (
                        <button
                          onClick={() => removeAttractiveness(index)}
                          className="text-sm text-red-600 hover:text-red-800"
                        >
                          × Remove
                        </button>
                      )}
                    </div>

                    <div className="space-y-4">
                      <div>
                        <label className="monument text-xs block mb-2">SEGMENT NAME <span className="text-red-500">*</span></label>
                        <input
                          type="text"
                          value={criteria.segment}
                          onChange={(e) => updateAttractiveness(index, 'segment', e.target.value)}
                          placeholder="Price-Conscious Comparers"
                          className="w-full text-base"
                        />
                      </div>

                      <div className="grid grid-cols-5 gap-4">
                        <div>
                          <label className="monument text-xs block mb-2">SIZE (1-10) <span className="text-red-500">*</span></label>
                          <input
                            type="number"
                            min="1"
                            max="10"
                            value={criteria.size}
                            onChange={(e) => updateAttractiveness(index, 'size', e.target.value)}
                            className="w-full text-base"
                          />
                        </div>
                        <div>
                          <label className="monument text-xs block mb-2">GROWTH (1-10) <span className="text-red-500">*</span></label>
                          <input
                            type="number"
                            min="1"
                            max="10"
                            value={criteria.growth}
                            onChange={(e) => updateAttractiveness(index, 'growth', e.target.value)}
                            className="w-full text-base"
                          />
                        </div>
                        <div>
                          <label className="monument text-xs block mb-2">PROFIT (1-10)</label>
                          <input
                            type="number"
                            min="1"
                            max="10"
                            value={criteria.profitability}
                            onChange={(e) => updateAttractiveness(index, 'profitability', e.target.value)}
                            className="w-full text-base"
                          />
                        </div>
                        <div>
                          <label className="monument text-xs block mb-2">FIT (1-10)</label>
                          <input
                            type="number"
                            min="1"
                            max="10"
                            value={criteria.fit}
                            onChange={(e) => updateAttractiveness(index, 'fit', e.target.value)}
                            className="w-full text-base"
                          />
                        </div>
                        <div>
                          <label className="monument text-xs block mb-2">TOTAL SCORE</label>
                          <input
                            type="text"
                            value={criteria.total}
                            readOnly
                            className="w-full text-base bg-gray-100 font-bold"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                ))}

                <button
                  onClick={addAttractiveness}
                  className="btn-secondary w-full"
                >
                  + Add Segment
                </button>
              </div>

              <div className="flex justify-between mt-12">
                <button onClick={onBack} className="btn-secondary">
                  ← Back
                </button>
                <button
                  onClick={onNext}
                  disabled={!canProceed || aiReviewing}
                  className="btn-primary"
                >
                  {aiReviewing ? 'AI Coach Reviewing...' : 'Next: Target Market Selection →'}
                </button>
              </div>
            </div>
          </main>
        </div>
      );
    }

    // Step 4: Target Market & Goals
    function Step4Page({ data, updateData, onNext, onBack, canProceed, setShowHelp, addMarketShareGoal, removeMarketShareGoal, updateMarketShareGoal, aiReviewing }) {
      return (
        <div className="min-h-screen bg-white">
          <HelpButton onClick={() => setShowHelp(true)} />

          <header className="border-b-2 border-black py-6 px-8 no-print">
            <h1 className="plaak text-3xl">SEGMENTATION & TARGET MARKET</h1>
            <p className="text-sm mt-2 text-gray-600">Focus on the vital few that matter most</p>
          </header>

          <ProgressIndicator currentStep={4} />

          <main className="p-12 max-w-6xl mx-auto">
            <div className="animate-in">
              <div className="numbered-section mb-8">
                [04] TARGET MARKET & GOALS
              </div>

              {/* Fast Track Insight */}
              <FastTrackInsight>
                  80/20 End Game: Choosing your target segments is the single most consequential strategy decision. Select 2-3 segments maximum -- never more. Your market share targets must connect directly to your Value Proposition (Sprint 15) and Competitive Strategy (Sprint 16). A target without a differentiated offer is just wishful thinking. Your end game vision should be specific enough that every team member can describe what "winning" looks like in concrete numbers.
              </FastTrackInsight>

              {/* The Science */}
              <ScienceBox collapsible={true}>
                  Longitudinal research by Bain & Company across 1,600 companies shows that organizations with clearly defined target segments and measurable market share goals achieve 60% higher revenue growth than competitors who "serve everyone." Porter's sustainable differentiation principle confirms that segment-specific value propositions generate 2-3x higher customer retention. Teams that revisit their target market quarterly maintain strategic alignment and catch market shifts before competitors do (Bain "Founder's Mentality"; Porter, "Competitive Advantage").
              </ScienceBox>


              <div className="bg-black text-white border-4 border-black p-6 mb-8">
                <h3 className="riforma-bold text-3xl mb-2">Set Market Share Targets</h3>
                <p className="text-xl mb-4">
                  Choose your top 2-3 segments and set clear, measurable market share goals. Define your end game - what does winning look like?
                </p>
                <p className="text-lg italic border-l-4 border-yellow-400 pl-4">
                  "Sustainable differentiation: tailor offerings to stand out in key segments. Highlight segment-specific value propositions in marketing." — Michael E. Porter
                </p>
              </div>

              <div className="space-y-8">
                <div>
                  <label className="monument text-sm block mb-2">
                    TARGET SEGMENTS SELECTED (Top 2-3 segments) <span className="text-red-500">*</span>
                  </label>
                  <textarea
                    value={data.targetSegments}
                    onChange={(e) => updateData('targetSegments', e.target.value)}
                    placeholder="Based on our attractiveness index, we will focus on: (1) Price-Conscious Comparers - highest score of 8.2, largest accessible market of 15,000 customers worth $37.5M; (2) Quality-Driven Enterprises - score 7.8, smaller market but 3x higher average deal size and strategic fit with our capabilities."
                    className="w-full"
                    style={{minHeight: '120px'}}
                  />
                  <div className={`char-counter ${data.targetSegments.length < 30 ? 'invalid' : ''}`}>
                    {data.targetSegments.length}/1000 characters (min 30)
                  </div>
                </div>

                <div>
                  <h4 className="riforma-bold text-2xl mb-4">Market Share Goals</h4>

                  {data.marketShareGoals.map((goal, index) => (
                    <div key={index} className="bg-gray-50 border-l-4 border-black p-6 mb-4">
                      <div className="flex justify-between items-start mb-4">
                        <span className="monument text-xs">GOAL {index + 1}</span>
                        {data.marketShareGoals.length > 1 && (
                          <button
                            onClick={() => removeMarketShareGoal(index)}
                            className="text-sm text-red-600 hover:text-red-800"
                          >
                            × Remove
                          </button>
                        )}
                      </div>

                      <div className="space-y-4">
                        <div>
                          <label className="monument text-xs block mb-2">SEGMENT NAME <span className="text-red-500">*</span></label>
                          <input
                            type="text"
                            value={goal.segment}
                            onChange={(e) => updateMarketShareGoal(index, 'segment', e.target.value)}
                            placeholder="Price-Conscious Comparers"
                            className="w-full text-base"
                          />
                        </div>

                        <div className="grid grid-cols-3 gap-4">
                          <div>
                            <label className="monument text-xs block mb-2">CURRENT SHARE (%)</label>
                            <input
                              type="number"
                              value={goal.currentShare}
                              onChange={(e) => updateMarketShareGoal(index, 'currentShare', e.target.value)}
                              placeholder="3"
                              className="w-full text-base"
                            />
                          </div>
                          <div>
                            <label className="monument text-xs block mb-2">TARGET SHARE (%) <span className="text-red-500">*</span></label>
                            <input
                              type="number"
                              value={goal.targetShare}
                              onChange={(e) => updateMarketShareGoal(index, 'targetShare', e.target.value)}
                              placeholder="12"
                              className="w-full text-base"
                            />
                          </div>
                          <div>
                            <label className="monument text-xs block mb-2">TIMELINE</label>
                            <input
                              type="text"
                              value={goal.timeline}
                              onChange={(e) => updateMarketShareGoal(index, 'timeline', e.target.value)}
                              placeholder="18 months"
                              className="w-full text-base"
                            />
                          </div>
                        </div>

                        <div>
                          <label className="monument text-xs block mb-2">STRATEGY TO ACHIEVE</label>
                          <textarea
                            value={goal.strategy}
                            onChange={(e) => updateMarketShareGoal(index, 'strategy', e.target.value)}
                            placeholder="Launch targeted ROI calculator tool. Partner with 3 industry analysts for case studies. Sponsor comparison websites. Offer 90-day money-back guarantee. Build dedicated sales team for mid-market."
                            className="w-full text-base"
                            style={{minHeight: '80px'}}
                          />
                        </div>
                      </div>
                    </div>
                  ))}

                  <button
                    onClick={addMarketShareGoal}
                    className="btn-secondary w-full"
                  >
                    + Add Goal
                  </button>
                </div>

                <div>
                  <label className="monument text-sm block mb-2">
                    END GAME (What does winning look like in 3 years?) <span className="text-red-500">*</span>
                  </label>
                  <textarea
                    value={data.endGame}
                    onChange={(e) => updateData('endGame', e.target.value)}
                    placeholder="In 36 months, we are the #1 choice for Price-Conscious Comparers with 18% market share (2,700 customers generating $67.5M annual revenue). We are recognized as the ROI leader by analyst firms. Quality-Driven Enterprises see us as the premium option, with 8% market share (400 customers at $20M revenue). Combined, these two segments represent $87.5M in revenue - 75% of our total business."
                    className="w-full"
                    style={{minHeight: '140px'}}
                  />
                  <div className={`char-counter ${data.endGame.length < 50 ? 'invalid' : ''}`}>
                    {data.endGame.length}/1000 characters (min 50)
                  </div>
                </div>
              </div>

              <div className="flex justify-between mt-12">
                <button onClick={onBack} className="btn-secondary">
                  ← Back
                </button>
                <button
                  onClick={onNext}
                  disabled={!canProceed || aiReviewing}
                  className="btn-primary"
                >
                  {aiReviewing ? 'AI Coach Reviewing...' : 'Complete & View Canvas →'}
                </button>
              </div>
            </div>
          </main>
        </div>
      );
    }

    // Canvas Page Component
    function CanvasPage({ data, onBack, onExport, onSubmit }) {
      // Sort segments by attractiveness score
      const rankedSegments = [...data.attractivenessCriteria].sort((a, b) =>
        parseFloat(b.total || 0) - parseFloat(a.total || 0)
      );

      return (
        <div className="min-h-screen bg-white">
          <header className="no-print border-b-4 border-black p-6">
            <div className="max-w-6xl mx-auto flex justify-between items-center">
              <div>
                <h1 className="plaak text-4xl mb-2">YOUR SEGMENTATION CANVAS</h1>
                <p className="text-gray-600">Focus on the vital few that matter most</p>
              </div>
              <button onClick={onBack} className="btn-secondary">
                ← Edit
              </button>
            </div>
          </header>

          <div className="max-w-6xl mx-auto p-12">
            <div id="canvas-content" className="border-4 border-black p-8 mb-8 bg-white">
              {/* User Info */}
              <div className="mb-8 pb-8 border-b-2 border-black">
                <h2 className="plaak text-3xl mb-4">PARTICIPANT</h2>
                <div className="grid grid-cols-2 gap-4 text-lg">
                  <div><span className="monument text-xs">NAME:</span> {data.name}</div>
                  <div><span className="monument text-xs">COMPANY:</span> {data.company}</div>
                  <div><span className="monument text-xs">EMAIL:</span> {data.email}</div>
                  <div><span className="monument text-xs">ROLE:</span> {data.role}</div>
                </div>
              </div>

              {/* Market Segments */}
              <div className="mb-8 pb-8 border-b-2 border-black">
                <h2 className="plaak text-3xl mb-4">MARKET SEGMENTS DEFINED</h2>
                <div className="mb-4 p-4 bg-gray-100">
                  <p className="monument text-xs mb-2">OBSERVED BEHAVIORS:</p>
                  <p className="text-base">{data.customerBehaviors}</p>
                </div>
                {data.segments.map((segment, index) => (
                  <div key={index} className="mb-4 p-4 bg-gray-50 border-l-4 border-black">
                    <h3 className="riforma-bold text-xl mb-2">{segment.name}</h3>
                    <p className="text-base mb-2">{segment.description}</p>
                    {segment.behaviors && (
                      <p className="text-sm text-gray-700"><span className="riforma-bold">Key Behaviors:</span> {segment.behaviors}</p>
                    )}
                  </div>
                ))}
              </div>

              {/* Segment Quantification */}
              <div className="mb-8 pb-8 border-b-2 border-black">
                <h2 className="plaak text-3xl mb-4">SEGMENT QUANTIFICATION</h2>
                <table className="w-full text-sm">
                  <thead className="bg-black text-white">
                    <tr>
                      <th className="text-left p-3">SEGMENT</th>
                      <th className="text-right p-3">TOTAL MARKET</th>
                      <th className="text-right p-3">ACCESSIBLE</th>
                      <th className="text-right p-3">AVG REVENUE</th>
                      <th className="text-right p-3">TOTAL VALUE</th>
                    </tr>
                  </thead>
                  <tbody>
                    {data.segmentSizes.map((size, index) => (
                      <tr key={index} className="border-b">
                        <td className="p-3 riforma-bold">{size.segment}</td>
                        <td className="text-right p-3">{size.totalMarket ? parseInt(size.totalMarket).toLocaleString() : '-'}</td>
                        <td className="text-right p-3">{size.accessibleMarket ? parseInt(size.accessibleMarket).toLocaleString() : '-'}</td>
                        <td className="text-right p-3">${size.avgRevenue ? parseInt(size.avgRevenue).toLocaleString() : '-'}</td>
                        <td className="text-right p-3 riforma-bold">${size.totalValue ? parseInt(size.totalValue).toLocaleString() : '-'}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* Attractiveness Rankings */}
              <div className="mb-8 pb-8 border-b-2 border-black">
                <h2 className="plaak text-3xl mb-4">ATTRACTIVENESS INDEX RANKING</h2>
                <div className="mb-4 p-4 bg-gray-100">
                  <p className="monument text-xs mb-2">CRITERIA WEIGHTS:</p>
                  <p className="text-base">
                    Size: {data.criteriaWeights.size}% | Growth: {data.criteriaWeights.growth}% | Profitability: {data.criteriaWeights.profitability}% | Strategic Fit: {data.criteriaWeights.fit}%
                  </p>
                </div>
                {rankedSegments.map((criteria, index) => (
                  <div key={index} className={`mb-3 p-4 border-l-4 ${index === 0 ? 'bg-gray-200 border-black' : index === 1 ? 'bg-yellow-100 border-yellow-600' : 'bg-gray-100 border-gray-400'}`}>
                    <div className="flex justify-between items-center">
                      <div>
                        <span className="monument text-xs">#{index + 1}</span>
                        <h3 className="riforma-bold text-lg">{criteria.segment}</h3>
                      </div>
                      <div className="text-right">
                        <p className="text-3xl riforma-bold">{criteria.total}</p>
                        <p className="text-xs monument">TOTAL SCORE</p>
                      </div>
                    </div>
                    <div className="grid grid-cols-4 gap-2 mt-2 text-sm">
                      <div><span className="monument text-xs">SIZE:</span> {criteria.size}/10</div>
                      <div><span className="monument text-xs">GROWTH:</span> {criteria.growth}/10</div>
                      <div><span className="monument text-xs">PROFIT:</span> {criteria.profitability}/10</div>
                      <div><span className="monument text-xs">FIT:</span> {criteria.fit}/10</div>
                    </div>
                  </div>
                ))}
              </div>

              {/* Target Market & Goals */}
              <div className="mb-8">
                <h2 className="plaak text-3xl mb-4">TARGET MARKET & GOALS</h2>
                <div className="mb-6 p-4 bg-yellow-100 border-l-4 border-yellow-600">
                  <p className="monument text-xs mb-2">SELECTED TARGET SEGMENTS:</p>
                  <p className="text-base">{data.targetSegments}</p>
                </div>

                <div className="mb-6">
                  <h3 className="riforma-bold text-xl mb-3">Market Share Goals:</h3>
                  {data.marketShareGoals.map((goal, index) => (
                    <div key={index} className="mb-4 p-4 bg-gray-50 border-2 border-black">
                      <div className="flex justify-between items-start mb-2">
                        <h4 className="riforma-bold text-lg">{goal.segment}</h4>
                        <div className="text-right">
                          <p className="text-sm monument">TARGET</p>
                          <p className="text-2xl riforma-bold">{goal.targetShare}%</p>
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4 text-sm mb-2">
                        <div><span className="monument text-xs">CURRENT:</span> {goal.currentShare}%</div>
                        <div><span className="monument text-xs">TIMELINE:</span> {goal.timeline}</div>
                      </div>
                      {goal.strategy && (
                        <div className="text-sm">
                          <span className="monument text-xs">STRATEGY:</span> {goal.strategy}
                        </div>
                      )}
                    </div>
                  ))}
                </div>

                <div className="p-6 bg-black text-white">
                  <h3 className="plaak text-2xl mb-3">THE END GAME</h3>
                  <p className="text-lg leading-relaxed">{data.endGame}</p>
                </div>
              </div>
            </div>

            {/* Action Buttons */}
            <div className="flex gap-4 no-print">
              <button onClick={() => window.print()} className="btn-secondary flex-1">
                Print Canvas
              </button>
              <button onClick={onExport} className="btn-secondary flex-1">
                Export PDF
              </button>
              <button onClick={onSubmit} className="btn-primary flex-1">
                Submit to Team
              </button>
            </div>

            {/* Case Study */}
            <CaseStudy
                before={"A mid-size telecom company marketed the same bundle to all customers. Churn was 22% annually, acquisition costs were rising, and marketing ROI was declining quarter over quarter because messages resonated with nobody in particular."}
                after={"After implementing behavior-based segmentation, they identified 3 high-value clusters: loyalty-driven subscribers, price-sensitive switchers, and tech-early-adopters. Tailored retention offers reduced churn to 14%, customer acquisition cost dropped 35%, and marketing ROI improved by 48% within 9 months."}
                quote={"Once we stopped trying to be everything to everyone, we became the obvious choice for the customers who actually mattered. Our NPS jumped 22 points in one quarter."}
            />
          </div>
        </div>
      );
    }

    // Progress Indicator Component
    function ProgressIndicator({ currentStep }) {
      const steps = [
        { num: 1, name: 'DEFINE' },
        { num: 2, name: 'QUANTIFY' },
        { num: 3, name: 'RANK' },
        { num: 4, name: 'TARGET' }
      ];

      return (
        <div className="border-b border-gray-200 py-6 px-8 no-print">
          <div className="max-w-6xl mx-auto">
            <div className="flex items-center justify-between">
              {steps.map((step, index) => (
                <React.Fragment key={step.num}>
                  <div className="flex flex-col items-center">
                    <div
                      className={`progress-dot ${
                        currentStep === step.num ? 'active' :
                        currentStep > step.num ? 'completed' : ''
                      }`}
                    ></div>
                    <span className="monument text-xs mt-2">{step.name}</span>
                  </div>
                  {index < steps.length - 1 && (
                    <div className="progress-line" style={{width: '100px'}}></div>
                  )}
                </React.Fragment>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // Help Button Component
    function HelpButton({ onClick }) {
      return (
        <button className="help-button" onClick={onClick}>
          ?
        </button>
      );
    }

    // Help Modal Component
    function HelpModal({ onClose, stepNumber }) {
      const helpContent = {
        1: {
          title: "DEFINE MARKET SEGMENTS",
          why: "Behavior-based segmentation reveals unmet needs and opportunities that demographics miss. Segments based on how customers buy, what they value, and their decision criteria drive 30% higher retention than demographic segments.",
          what: "Define 5-7 distinct customer segments based on behaviors, needs, and buying patterns. Segments must be mutually exclusive (no overlap) and collectively exhaustive (cover entire market).",
          how: [
            "List all customer behaviors you observe: price sensitivity, decision speed, loyalty patterns, usage frequency, buying triggers",
            "Group customers with similar behaviors into clusters - look for patterns in how they buy, not just who they are",
            "Refine clusters into 5-7 clear segments with descriptive names (e.g., 'Price-Conscious Comparers', 'Quality-First Adopters')",
            "Write detailed descriptions: who they are, what they value, how they buy, typical deal size, decision timeline",
            "Validate: no customer should fit in multiple segments, and every customer should fit in exactly one segment"
          ]
        },
        2: {
          title: "QUANTIFY SEGMENTS",
          why: "Without sizing the prize, you can't prioritize. A segment might be attractive strategically but too small to matter financially. Quantification prevents wasting resources on low-value opportunities.",
          what: "Calculate total market size, your accessible portion, average revenue per customer, and total segment value for each segment you defined.",
          how: [
            "Estimate total market: How many customers exist in this segment globally or in your target geography?",
            "Calculate accessible market: Of that total, how many can you realistically reach with your current channels and resources?",
            "Determine average revenue: What's the typical annual revenue per customer in this segment based on deal size and frequency?",
            "Let the tool auto-calculate total segment value (accessible market × average revenue)",
            "Compare segments: larger values indicate bigger revenue opportunities, but consider growth potential too"
          ]
        },
        3: {
          title: "ATTRACTIVENESS INDEX",
          why: "Size alone doesn't determine priority. A smaller segment with high growth and profitability may be more attractive than a large, stagnant one. The attractiveness index uses weighted criteria to reveal true strategic value.",
          what: "Score each segment on size, growth potential, profitability, and strategic fit. Assign weights to reflect what matters most to your strategy. Higher scores indicate where to focus resources.",
          how: [
            "Set criteria weights (must total 100%): Profitability typically 30-40%, Size 20-30%, Growth 20-30%, Fit 15-20%",
            "Score each segment 1-10 on Size: How large is the accessible market relative to others?",
            "Score Growth: Is the segment expanding, stable, or declining? (10 = rapid growth)",
            "Score Profitability: Average margins, willingness to pay premium prices (10 = highly profitable)",
            "Score Strategic Fit: Does it align with your capabilities, brand, and long-term vision? (10 = perfect fit)",
            "Review total scores: segments ranking 7.5+ are typically worth pursuing, below 6.0 are usually not worth the effort"
          ]
        },
        4: {
          title: "TARGET MARKET & GOALS",
          why: "Without clear targets and measurable goals, segmentation becomes academic exercise. Market share targets create accountability and focus. The end game defines what winning looks like in concrete terms.",
          what: "Choose your top 2-3 segments based on attractiveness scores. Set specific market share goals with timelines and strategies. Define your end game vision for 3 years.",
          how: [
            "Select 2-3 segments: Choose those with highest attractiveness scores and best strategic fit",
            "Set market share targets: Current share (%), target share (%), timeline (usually 12-36 months)",
            "Define strategy to achieve: specific tactics like partnerships, product features, pricing, marketing channels",
            "Write your end game: In 3 years, what market position do you hold? How much revenue? What's your reputation?",
            "Be specific: Use numbers (% market share, customer count, revenue), names (competitors you've surpassed), and measurable outcomes"
          ]
        }
      };

      const content = helpContent[stepNumber] || helpContent[1];

      return (
        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 fade-in" onClick={onClose}>
          <div className="bg-white max-w-3xl p-12 border-8 border-black max-h-[80vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
            <div className="flex justify-between items-start mb-6">
              <h2 className="plaak text-5xl">{content.title}</h2>
              <button onClick={onClose} className="text-4xl font-bold hover:text-gray-600">×</button>
            </div>

            {/* WHY Section */}
            <h3 className="riforma-bold text-3xl mb-4">Why</h3>
            <p className="mb-6 text-lg leading-relaxed">{content.why}</p>

            {/* WHAT Section */}
            <h3 className="riforma-bold text-3xl mb-4">What</h3>
            <p className="mb-6 text-lg leading-relaxed">{content.what}</p>

            {/* HOW Section */}
            <h3 className="riforma-bold text-3xl mb-4">How</h3>
            <ol className="text-lg space-y-3 mb-8">
              {content.how.map((step, index) => (
                <li key={index} className="leading-relaxed">
                  <span className="riforma-bold">{index + 1}.</span> {step}
                </li>
              ))}
            </ol>

            <button onClick={onClose} className="btn-primary w-full text-xl py-4">
              GOT IT
            </button>
          </div>
        </div>
      );
    }

    // Render App
        ReactDOM.render(<SegmentationApp />, document.getElementById('root'));
  </script>
</body>
</html>
