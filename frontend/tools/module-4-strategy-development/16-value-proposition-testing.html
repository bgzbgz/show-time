<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Value Proposition Testing | Fast Track Program</title>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../shared/js/tool-db.js"></script>
  <script src="../../shared/js/ai-challenge.js"></script>
  <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Font preloading to prevent FOUT -->
  <link rel="preload" href="Plaak3Trial-43-Bold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="RiformaLL-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="MonumentGrotesk-Mono.woff2" as="font" type="font/woff2" crossorigin>

  <style>
    /* === FONT FACES === */
    @font-face { font-family: 'Plaak'; src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; font-display: swap; }
    @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: normal; font-display: swap; }
    @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: 600; font-display: swap; }
    @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); font-display: swap; }

    /* === BASE RESET === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Riforma', -apple-system, sans-serif;
      font-size: 16px;
      color: #000;
      background: #000;
      -webkit-font-smoothing: antialiased;
    }

    /* === CUSTOM SCROLLBAR === */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #333; }
    * { scrollbar-width: thin; scrollbar-color: #000 transparent; }

    /* === TYPOGRAPHY HELPERS === */
    .plaak { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
    .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }

    /* === LAYOUT FRAME === */
    .tool-frame { background: #fff; min-height: 100vh; }
    .tool-inner { background: #fff; min-height: 100vh; }

    /* === WIZARD LAYOUT === */
    .wizard-layout { display: flex; min-height: 100vh; }
    .wizard-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: #fff;
    }
    .wizard-content {
      max-width: 640px;
      width: 100%;
      margin: 0 auto;
      padding: 48px 32px;
      flex: 1;
    }

    /* === SIDEBAR === */
    .wizard-sidebar {
      width: 280px;
      background: #000;
      border-left: 1px solid #000;
      flex-shrink: 0;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow: hidden;
    }
    .wizard-sidebar-inner {
      padding: 32px 24px;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
    }
    .sidebar-step-item {
      padding: 12px;
      margin-bottom: 8px;
      border-left: 3px solid transparent;
      transition: all 0.2s ease;
    }
    .sidebar-step-item.active { border-left-color: #FFF469; background: #222; }
    .sidebar-step-item.completed { background: #fff; color: #000; border-left-color: #fff; cursor: pointer; }
    .sidebar-step-item.completed:hover { background: #E0E0E0; }
    .sidebar-step-item.locked { opacity: 0.5; }
    .sidebar-step-item .step-num { font-family: 'Riforma', sans-serif; font-size: 14px; }
    .sidebar-step-item .step-name { font-family: 'Riforma', sans-serif; font-size: 14px; }
    .sidebar-snippet { font-size: 12px; margin-top: 4px; opacity: 0.7; line-height: 1.3; }

    /* === STEP HEADER === */
    .step-indicator {
      font-family: 'Monument', monospace;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #6B7280;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .step-time {
      font-family: 'Monument', monospace;
      font-size: 11px;
      color: #6B7280;
    }
    .step-heading {
      font-family: 'Plaak', sans-serif;
      font-weight: bold;
      font-size: 32px;
      text-transform: uppercase;
      letter-spacing: -0.01em;
      line-height: 1.2;
      color: #000;
      margin-bottom: 6px;
    }
    .step-hint {
      font-size: 16px;
      color: #6B7280;
      line-height: 1.5;
      margin: 0 0 32px 0;
    }

    /* === FORM ELEMENTS === */
    .ft-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-family: 'Monument', monospace;
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #000;
      margin-bottom: 8px;
    }
    .ft-required { color: #DC2626; font-weight: 700; }

    .ft-input {
      width: 100%;
      height: 44px;
      padding: 8px 16px;
      font-family: 'Riforma', sans-serif;
      font-size: 16px;
      color: #000;
      background: #fff;
      border: 1px solid #E5E7EB;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .ft-input:focus {
      outline: none;
      border-color: #000;
      box-shadow: 0 0 0 3px #FFF469;
    }
    .ft-input.has-error {
      border: 2px solid #DC2626;
      padding-right: 40px;
    }
    .ft-input.has-error:focus {
      border-color: #DC2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
    }

    .ft-textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px 16px;
      font-family: 'Riforma', sans-serif;
      font-size: 16px;
      color: #000;
      background: #fff;
      border: 1px solid #E5E7EB;
      resize: none !important;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .ft-textarea:focus {
      outline: none;
      border-color: #000;
      box-shadow: 0 0 0 3px #FFF469;
    }
    .ft-textarea.has-error {
      border: 2px solid #DC2626;
    }
    .ft-textarea.has-error:focus {
      border-color: #DC2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
    }

    .ft-help {
      font-size: 14px;
      color: #6B7280;
      margin-top: 4px;
      line-height: 1.5;
    }
    .ft-error-msg {
      font-size: 14px;
      font-weight: 600;
      color: #DC2626;
      margin-top: 4px;
      line-height: 1.4;
    }
    .ft-field-group {
      margin-bottom: 24px;
    }
    .ft-field-group:last-child { margin-bottom: 0; }
    .ft-section { margin-bottom: 32px; }

    /* === YELLOW INSIGHT BOX === */
    .ft-insight {
      background: #FFF469;
      border: 3px solid #000;
      padding: 16px;
      margin-bottom: 32px;
    }

    /* === EXAMPLE BOX === */
    .ft-example {
      background: #F3F4F6;
      padding: 16px;
      margin-bottom: 8px;
      font-size: 14px;
      line-height: 1.6;
      color: #1F2937;
    }

    /* === ERROR SUMMARY === */
    .ft-error-summary {
      border: 2px solid #DC2626;
      background: #fff;
      padding: 16px;
      margin-bottom: 24px;
    }
    .ft-error-summary a {
      color: #DC2626;
      text-decoration: underline;
      cursor: pointer;
    }
    .ft-error-summary a:hover { text-decoration: none; }

    /* === BUTTON FOOTER === */
    .btn-footer {
      position: sticky;
      bottom: 0;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 32px;
      border-top: 1px solid #E5E7EB;
      background: #fff;
      width: 100%;
    }
    .btn-back {
      background: #fff;
      color: #000;
      border: 2px solid #000;
      padding: 12px 24px;
      font-family: 'Riforma', sans-serif;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px;
    }
    .btn-back:hover { background: #F3F4F6; }
    .btn-next {
      background: #000;
      color: #fff;
      border: 2px solid #000;
      padding: 12px 24px;
      font-family: 'Riforma', sans-serif;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px;
    }
    .btn-next:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .btn-next:disabled { background: #E5E7EB; color: #9CA3AF; border-color: #E5E7EB; cursor: not-allowed; }

    /* === CLOSING MESSAGE === */
    .closing-box {
      border-top: 1px solid #E5E7EB;
      padding: 20px 0 0 0;
      margin-top: 8px;
      text-align: center;
    }
    .closing-box p { font-size: 14px; color: #6B7280; }
    .closing-box .closing-title {
      font-family: 'Monument', monospace;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #000;
      margin-bottom: 6px;
    }

    /* === MOBILE STEP BAR === */
    .mobile-step-bar { display: none; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; background: #F3F4F6; }
    .mobile-step-bar .bar-text { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 6px; }
    .mobile-progress { height: 3px; background: #E5E7EB; width: 100%; }
    .mobile-progress-fill { height: 100%; background: #000; transition: width 0.3s ease; }

    /* === CANVAS STYLES === */
    .numbered-section { background: #000; color: #fff; padding: 8px 14px; font-size: 14px; font-weight: bold; letter-spacing: 0.5px; display: inline-block; font-family: 'Monument', monospace; }
    .canvas-section-box { border: 2px solid #000; background: #FAFAFA; padding: 16px; margin-bottom: 16px; }

    /* === ANIMATIONS === */
    @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .animate-in { animation: fadeSlideIn 0.3s ease-out; }

    /* === PRINT === */
    @media print { .no-print { display: none !important; } }

    /* === RESPONSIVE === */
    @media (min-width: 769px) and (max-width: 1024px) {
      .wizard-sidebar { width: 220px; }
      .wizard-sidebar-inner { padding: 24px 16px; }
    }
    @media (max-width: 768px) {
      .wizard-sidebar { display: none; }
      .mobile-step-bar { display: block; }
      .wizard-content { padding: 24px 16px; }
      .step-heading { font-size: 24px; }
      .btn-footer { padding: 12px 16px; }
    }
    @media (max-width: 480px) {
      .step-heading { font-size: 20px; }
      .wizard-content { padding: 20px 12px; }
    }

    /* === TOOL-SPECIFIC: VP TESTING === */
    .riforma-bold {
      font-family: 'Riforma', sans-serif;
      font-weight: bold;
    }
    .char-counter {
      font-size: 14px;
      color: #666;
      margin-top: 4px;
    }
    .char-counter.invalid {
      color: #EF4444;
    }
    textarea::placeholder {
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, Fragment } = React;

    // Configuration
    const CONFIG = {
      SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
      TOOL_SLUG: 'value-proposition-testing',
      AUTOSAVE_DELAY: 2000
    };

    const { createClient } = supabase;
    const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

    // Make Supabase client globally available for dependency injection
    window.supabaseClient = supabaseClient;

    // Initialize ToolDB and dependency injection
    ToolDB.init(CONFIG.TOOL_SLUG);
    ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        CognitiveLoad.init('vp-testing', {"insights":["An untested value proposition is just a hypothesis.","Real validation requires real customers and real commitment signals."],"caseStudy":{"before":"A B2B software company launched their new product based on internal assumptions about what customers valued. Marketing emphasized technical features the engineering team was proud of. After six months, conversion rates were below 2% and sales cycles averaged 90 days. The team kept adding more features, convinced the product just needed to be better.","after":"Using the VP Testing process, they interviewed 15 target customers across two rounds. Round 1 revealed customers cared about implementation speed, not features. Round 2 validated a refined message focused on '48-hour deployment with zero IT required.' Conversion rates jumped to 11%, sales cycles dropped to 30 days, and 12 of 15 interviewees requested demos on the spot.","quote":"We spent a year building features nobody asked for. Two weeks of structured customer interviews told us more than 12 months of guessing. The words our customers used became our new homepage headline — and it outperformed everything we had written internally."}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

    /* ============================================================
       TRANSITION CONTENT — between steps
       ============================================================ */
    const TRANSITION_CONTENT = {
        1: {
            title: 'PLAN SET.',
            text: "You've defined what you're testing and who you'll test it with. Now it's time to hear what real customers think.",
            brutalTruth: "80% of failed product launches trace back to untested assumptions about customer value. Your testing plan eliminates guesswork — every interview must produce actionable insights, not polite conversation. If your plan is vague, your data will be worthless.",
            peerProof: "Osterwalder et al. (2014) found that companies using structured customer testing processes are 48% more likely to achieve product-market fit within the first year. A clear testing plan is the difference between validation and confirmation bias."
        },
        2: {
            title: 'DISCOVERY DONE.',
            text: "You've heard real customer reactions. Now analyze the patterns and fix what's broken.",
            brutalTruth: "One customer's opinion is noise. Three customers saying the same thing is a pattern. Five confirming it is a fact. If you change your message based on a single person's feedback, you're guessing. Stick to patterns — the 20% of feedback that appears in 80% of conversations.",
            peerProof: "Maurya (2012) found that value propositions refined through evidence-based iteration outperform the original by 3.2x in conversion. Teams that over-revised based on individual opinions performed worse than those who made no changes."
        },
        3: {
            title: 'REFINED.',
            text: "Your message is sharper. Time to validate that the fixes actually work with real customers.",
            brutalTruth: "Round 2 is validation, not discovery. You are no longer exploring — you are confirming. If reactions still vary widely after refinement, the problem isn't the customers — it's the message. Neutral feedback is useless. Push for love-it or clear-concerns.",
            peerProof: "Ries (2011) demonstrated that two-round testing — discover then validate — reduces false positives by 65% compared to single-round approaches. Nielsen Norman Group confirms that retesting after refinement provides the strongest signal of genuine improvement."
        },
        4: {
            title: 'VALIDATED.',
            text: "The evidence is in. Time to lock it in and plan the rollout.",
            brutalTruth: "A great value proposition is not debated forever — it's tested, refined, and executed. The biggest risk now is not an imperfect message — it's endless tweaking that delays execution. After two rounds of customer interviews, commit with conviction.",
            peerProof: "Bain & Company (2022) found that companies with a single, validated value proposition used consistently across all channels achieve 31% higher revenue growth than those with fragmented or untested messaging."
        },
        5: {
            title: 'LOCKED IN.',
            text: "Your value proposition is validated and ready for rollout. Every department speaks it consistently from today.",
            brutalTruth: "McKinsey's 'Decision-Making at Speed' framework shows teams using validation checklists before committing reduce post-launch pivots by 55%. You've done the work — now execute without second-guessing.",
            peerProof: "Companies that maintain message consistency across all channels after structured validation achieve 2.4x faster market penetration than those who continue iterating post-launch."
        }
    };

    /* ============================================================
       SHARED COMPONENTS
       ============================================================ */

    function CheckIcon({ color = "#fff", size = 16 }) {
        return <svg width={size} height={size} viewBox="0 0 24 24" fill={color}><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>;
    }

    function ButtonFooter({ onBack, onNext, nextLabel = 'Next', showBack = true, disabled = false }) {
        return (
            <div className="btn-footer no-print">
                {showBack ? <button className="btn-back" onClick={onBack}>&larr; Back</button> : <div />}
                <button className="btn-next" disabled={disabled} onClick={onNext}>{nextLabel} &rarr;</button>
            </div>
        );
    }

    function MobileStepBar({ currentStep, totalSteps }) {
        const total = totalSteps || 5;
        const progress = currentStep >= 999 ? 100 : Math.round((currentStep / total) * 100);
        return (
            <div className="mobile-step-bar no-print">
                <div className="bar-text">Step {Math.min(currentStep, total)} of {total}</div>
                <div className="mobile-progress"><div className="mobile-progress-fill" style={{ width: `${progress}%` }} /></div>
            </div>
        );
    }

    function DependencyContext({ deps }) {
        if (!deps || deps.length === 0) return null;
        return (
            <div style={{ marginBottom: '24px' }}>
                <div style={{ fontFamily: "'Monument', monospace", fontSize: '11px', textTransform: 'uppercase', letterSpacing: '0.05em', color: '#666', marginBottom: '8px' }}>
                    CONTEXT FROM PREVIOUS TOOLS
                </div>
                {deps.map((dep, i) => (
                    <div key={i} style={{ background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '12px 16px', marginBottom: '8px', fontSize: '14px' }}>
                        <div style={{ fontWeight: 600, marginBottom: '4px', color: '#333' }}>{dep.label}</div>
                        <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                    </div>
                ))}
            </div>
        );
    }

    function CoachFeedbackPanel() {
        const [expanded, setExpanded] = useState(false);
        const [feedback, setFeedback] = useState(null);

        useEffect(() => {
            const check = () => {
                if (window.AIChallenge && window.AIChallenge.getLastFeedback) {
                    setFeedback(window.AIChallenge.getLastFeedback());
                }
            };
            check();
            const interval = setInterval(check, 2000);
            return () => clearInterval(interval);
        }, []);

        if (!feedback) return null;

        return (
            <div style={{ marginTop: 24, borderTop: '1px solid #333', paddingTop: 16 }}>
                <button
                    onClick={() => setExpanded(!expanded)}
                    style={{ background: 'none', border: 'none', color: '#FFF469', cursor: 'pointer', fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', display: 'flex', alignItems: 'center', gap: 6, padding: 0, width: '100%' }}
                >
                    <span style={{ transform: expanded ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block' }}>&#9654;</span>
                    COACH FEEDBACK
                </button>
                {expanded && (
                    <div style={{ marginTop: 10, fontSize: 12, color: '#ccc', lineHeight: 1.5 }}>
                        {feedback.type === 'approved' && (
                            <p style={{ color: '#FFF469' }}>{feedback.message}</p>
                        )}
                        {feedback.type === 'challenges' && (
                            <>
                                {feedback.encouragement && <p style={{ color: '#FFF469', marginBottom: 8 }}>{feedback.encouragement}</p>}
                                {feedback.challenges && feedback.challenges.map((ch, i) => (
                                    <div key={i} style={{ marginBottom: 8, paddingLeft: 8, borderLeft: '2px solid #555' }}>
                                        <div style={{ fontSize: 10, color: '#999', marginBottom: 2 }}>{ch.question_text || ch.question_key}</div>
                                        <div>{ch.feedback}</div>
                                    </div>
                                ))}
                            </>
                        )}
                    </div>
                )}
            </div>
        );
    }

    function WizardSidebar({ currentStep, data, onNavigate }) {
        const steps = [
            { num: 1, label: 'Test Setup', time: '~5 min' },
            { num: 2, label: 'Round 1 Interviews', time: '~10 min' },
            { num: 3, label: 'Analyze & Refine', time: '~8 min' },
            { num: 4, label: 'Round 2 Validation', time: '~10 min' },
            { num: 5, label: 'Final Decision', time: '~5 min' }
        ];

        const getSnippet = (n) => {
            if (n === 1 && data.valuePropBeingTested) return '"' + data.valuePropBeingTested.substring(0, 50) + (data.valuePropBeingTested.length > 50 ? '...' : '') + '"';
            if (n === 2 && data.round1Interviews.some(i => i.customerName)) return data.round1Interviews.filter(i => i.customerName).length + ' interviews documented';
            if (n === 3 && data.refinedValueProp) return '"' + data.refinedValueProp.substring(0, 50) + (data.refinedValueProp.length > 50 ? '...' : '') + '"';
            if (n === 4 && data.round2Interviews.some(i => i.customerName)) return data.round2Interviews.filter(i => i.customerName).length + ' interviews documented';
            if (n === 5 && data.finalValueProp) return '"' + data.finalValueProp.substring(0, 50) + (data.finalValueProp.length > 50 ? '...' : '') + '"';
            return null;
        };

        return (
            <div className="wizard-sidebar no-print">
                <div className="wizard-sidebar-inner">
                    <div style={{ marginBottom: 24 }}>
                        <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', color: '#fff', marginBottom: 4 }}>VP TESTING</div>
                        <div style={{ fontSize: 13, color: '#999' }}>~38 min total</div>
                    </div>
                    <div style={{ marginBottom: 16, fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', color: '#999' }}>Your journey</div>
                    {steps.map(s => {
                        const effectiveStep = Math.ceil(currentStep);
                        const isCompleted = effectiveStep > s.num, isActive = effectiveStep === s.num, isLocked = effectiveStep < s.num;
                        const snippet = isCompleted ? getSnippet(s.num) : null;
                        return (
                            <div key={s.num} className={`sidebar-step-item ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''} ${isLocked ? 'locked' : ''}`}
                                onClick={() => isCompleted && onNavigate && onNavigate(s.num)}
                                title={isCompleted ? 'Click to review this step' : ''}
                            >
                                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                    {isCompleted ? <CheckIcon color="#000" size={14} /> : <span className="step-num" style={{ color: isActive ? '#fff' : '#ccc' }}>{String(s.num).padStart(2, '0')}</span>}
                                    <span className="step-name" style={{ color: isLocked ? '#666' : isCompleted ? '#000' : '#fff' }}>{s.label}</span>
                                </div>
                                {snippet && <div className="sidebar-snippet">{snippet}</div>}
                            </div>
                        );
                    })}

                    <CoachFeedbackPanel />
                </div>
            </div>
        );
    }

    // Main App Component
    function TestingApp() {
      const [deps, setDeps] = useState([]);
      const [step, setStep] = useState(0);
      const [aiReviewing, setAiReviewing] = useState(false);

      const [data, setData] = useState({
        // User details
        name: '',
        email: '',
        company: '',
        role: '',

        // Step 1: Setup
        valuePropBeingTested: '',
        testingObjective: '',
        targetCustomerProfile: '',
        interviewPlan: '',

        // Step 2: Round 1 Interviews
        round1Interviews: [
          {
            customerName: '',
            customerProfile: '',
            date: '',
            problemReconfirm: '',
            valueReaction: '',
            whatWorked: '',
            whatUnclear: '',
            concerns: '',
            theirWords: '',
            callToActionResponse: ''
          }
        ],

        // Step 3: Refinement
        round1Patterns: '',
        positivePatterns: '',
        confusionPoints: '',
        objections: '',
        refinedValueProp: '',
        changesJustification: '',

        // Step 4: Round 2 Interviews
        round2Interviews: [
          {
            customerName: '',
            customerProfile: '',
            date: '',
            problemStillValid: '',
            valueReaction: '',
            clarity: '',
            enthusiasm: '',
            differentiation: '',
            actionability: '',
            concerns: '',
            recommendation: ''
          }
        ],

        // Step 5: Final Decision
        validation: {
          mainNeedsSatisfied: '',
          factsNotOpinions: '',
          generalToSpecific: '',
          askedWhy: '',
          notLeading: '',
          sharedFindings: '',
          updatedAddressesFeedback: ''
        },
        finalValueProp: '',
        consistentReactions: '',
        strongestDifferentiator: '',
        remainingAdjustments: '',
        rolloutPlan: ''
      });

      useEffect(() => {
          async function loadDeps() {
              const userId = localStorage.getItem('ft_user_id');
              if (!userId || !window.ToolDB || !window.DependencyInjection) return;
              try {
                  await ToolDB.whenReady();
                  const config = DependencyInjection.getDependenciesConfig();
                  const toolConfig = config[CONFIG.TOOL_SLUG];
                  if (!toolConfig || !toolConfig.fields) return;
                  const loaded = [];
                  for (const field of toolConfig.fields) {
                      const val = await ToolDB.getDependency(userId, field.source_field);
                      if (val) {
                          loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                      }
                  }
                  setDeps(loaded);
              } catch (err) {
                  console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
              }
          }
          loadDeps();
      }, []);

      // Auto-save
      useEffect(() => {
        const interval = setInterval(() => {
          localStorage.setItem('testingData', JSON.stringify({
            data,
            timestamp: new Date().toISOString()
          }));
        }, 2000);

        return () => clearInterval(interval);
      }, [data]);

      // Load saved data
      useEffect(() => {
        const saved = localStorage.getItem('testingData');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            if (parsed.data) {
              setData(parsed.data);
            }
          } catch (e) {
            console.error('Failed to parse saved data');
          }
        }
      }, []);

      const updateData = (field, value) => {
        setData(prev => ({ ...prev, [field]: value }));
      };

      const updateValidation = (field, value) => {
        setData(prev => ({
          ...prev,
          validation: { ...prev.validation, [field]: value }
        }));
      };

      // Round 1 interview management
      const addRound1Interview = () => {
        setData(prev => ({
          ...prev,
          round1Interviews: [...prev.round1Interviews, {
            customerName: '',
            customerProfile: '',
            date: '',
            problemReconfirm: '',
            valueReaction: '',
            whatWorked: '',
            whatUnclear: '',
            concerns: '',
            theirWords: '',
            callToActionResponse: ''
          }]
        }));
      };

      const removeRound1Interview = (index) => {
        if (data.round1Interviews.length > 1) {
          setData(prev => ({
            ...prev,
            round1Interviews: prev.round1Interviews.filter((_, i) => i !== index)
          }));
        }
      };

      const updateRound1Interview = (index, field, value) => {
        setData(prev => ({
          ...prev,
          round1Interviews: prev.round1Interviews.map((interview, i) =>
            i === index ? { ...interview, [field]: value } : interview
          )
        }));
      };

      // Round 2 interview management
      const addRound2Interview = () => {
        setData(prev => ({
          ...prev,
          round2Interviews: [...prev.round2Interviews, {
            customerName: '',
            customerProfile: '',
            date: '',
            problemStillValid: '',
            valueReaction: '',
            clarity: '',
            enthusiasm: '',
            differentiation: '',
            actionability: '',
            concerns: '',
            recommendation: ''
          }]
        }));
      };

      const removeRound2Interview = (index) => {
        if (data.round2Interviews.length > 1) {
          setData(prev => ({
            ...prev,
            round2Interviews: prev.round2Interviews.filter((_, i) => i !== index)
          }));
        }
      };

      const updateRound2Interview = (index, field, value) => {
        setData(prev => ({
          ...prev,
          round2Interviews: prev.round2Interviews.map((interview, i) =>
            i === index ? { ...interview, [field]: value } : interview
          )
        }));
      };

      /* PRESERVED: AI-gated step navigation — do not modify */
      const handleStepNext = async (nextStepValue, stepAnswers, stepName) => {
          const userId = localStorage.getItem('ft_user_id');
          if (!userId) {
              setStep(nextStepValue);
              return;
          }
          setAiReviewing(true);
          try {
              const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
              if (canProceed) {
                  setStep(nextStepValue);
              }
          } catch (err) {
              console.warn('[AIChallenge] Error, allowing passage:', err);
              setStep(nextStepValue);
          } finally {
              setAiReviewing(false);
          }
      };

      // Validation functions
      const canProceedFromIntro = () => {
        return data.name.length > 0 && data.email.length > 0 && data.company.length > 0;
      };

      const canProceedFromStep1 = () => {
        return data.valuePropBeingTested.length >= 30 &&
               data.testingObjective.length >= 30;
      };

      const canProceedFromStep2 = () => {
        return data.round1Interviews.every(i =>
          i.customerName.length >= 3 && i.valueReaction.length >= 30 && i.whatWorked.length >= 20
        );
      };

      const canProceedFromStep3 = () => {
        return data.positivePatterns.length >= 50 &&
               data.confusionPoints.length >= 30 &&
               data.refinedValueProp.length >= 30;
      };

      const canProceedFromStep4 = () => {
        return data.round2Interviews.every(i =>
          i.customerName.length >= 3 && i.clarity.length > 0 && i.enthusiasm.length > 0
        );
      };

      const canProceedFromStep5 = () => {
        const validations = Object.values(data.validation);
        return validations.filter(v => v === 'yes').length >= 5 &&
               data.finalValueProp.length >= 30;
      };

      const exportPDF = async () => {
        try {
          console.log('Starting PDF export...');

          // Check if libraries are loaded
          if (!window.jspdf) {
            alert('PDF library not loaded. Please refresh the page and try again.');
            return;
          }
          if (!window.html2canvas) {
            alert('Canvas library not loaded. Please refresh the page and try again.');
            return;
          }

          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');

          const canvas = document.getElementById('canvas-content');
          if (!canvas) {
            alert('Canvas element not found. Please make sure you are on the summary page.');
            return;
          }

          // Temporarily hide images to avoid CORS issues
          const images = canvas.querySelectorAll('img');
          const imageStates = [];
          images.forEach(img => {
            imageStates.push({ img, display: img.style.display });
            img.style.display = 'none';
          });

          console.log('Generating PDF...');
          const canvasImage = await html2canvas(canvas, {
            scale: 2,
            logging: false,
            allowTaint: false,
            useCORS: false
          });

          // Restore images
          imageStates.forEach(({ img, display }) => {
            img.style.display = display;
          });

          const imgData = canvasImage.toDataURL('image/png');
          const imgWidth = 190;
          const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

          pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);

          const filename = `Value-Prop-Testing-${new Date().toISOString().split('T')[0]}.pdf`;
          pdf.save(filename);

          console.log('PDF exported successfully!');
        } catch (error) {
          console.error('PDF Export Error:', error);
          alert('Failed to export PDF: ' + error.message);
        }
      };

      const [submitStatus, setSubmitStatus] = useState(null);
      const [submitMessage, setSubmitMessage] = useState('');

      const handleSubmit = async () => {
        try {
          const userId = localStorage.getItem('ft_user_id');
          if (!userId) {
            alert('User not authenticated. Please return to the dashboard.');
            return;
          }

          const questionMappings = {
              customer_feedback: { round1Interviews: data.round1Interviews, round2Interviews: data.round2Interviews },
              comparison_results: { round1Patterns: data.round1Patterns, positivePatterns: data.positivePatterns, confusionPoints: data.confusionPoints, objections: data.objections },
              reality_log: { validation: data.validation, consistentReactions: data.consistentReactions, strongestDifferentiator: data.strongestDifferentiator },
              final_vp: { finalValueProp: data.finalValueProp, refinedValueProp: data.refinedValueProp, changesJustification: data.changesJustification },
              next_steps: { remainingAdjustments: data.remainingAdjustments, rolloutPlan: data.rolloutPlan }
          };

          await window.AIChallenge.submitWithChallenge(userId, CONFIG.TOOL_SLUG, questionMappings, {
              onReviewStart: () => { setSubmitMessage('AI coach is reviewing...'); },
              onRevise: () => { setSubmitStatus(null); setSubmitMessage(''); setStep(5); },
              onSubmitAnyway: () => { setSubmitStatus('success'); setSubmitMessage('Submission saved successfully!'); alert('Value proposition testing results submitted successfully!'); },
              onError: (err) => { setSubmitStatus('error'); setSubmitMessage('Failed to save: ' + err.message); alert('Submission failed: ' + err.message); }
          });
        } catch (error) {
          console.error('Submit error:', error);
          alert('Submission failed: ' + error.message);
        }
      };

      return (
        <div className="tool-frame">
          <div className="tool-inner">
            {/* Step 0: Cover */}
            {step === 0 && (
              <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative', overflow: 'hidden' }}>
                <div style={{ position: 'absolute', inset: 0, backgroundImage: 'url("https://images.unsplash.com/photo-1556761175-b413da4baf72?w=1920&q=80")', backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.5 }} />
                <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                  <h1 className="plaak" style={{ fontSize: 80, marginBottom: 16, textTransform: 'uppercase' }}>VALUE PROPOSITION TESTING</h1>
                  <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48 }}>Turn customer feedback into a bulletproof message</p>
                  <button onClick={() => setStep(0.5)}
                    style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease', minHeight: 44 }}
                    onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                    onMouseOut={e => { e.target.style.background = '#fff'; }}
                  >START</button>
                </div>
              </div>
            )}

            {/* Step 0.5: Intro */}
            {step === 0.5 && (
              <IntroPage data={data} updateData={updateData} onNext={() => setStep(1)} canProceed={true} />
            )}

            {/* Steps 1-5: Wizard */}
            {[1,2,3,4,5].includes(step) && (
              <div className="wizard-layout">
                <div className="wizard-main">
                  <MobileStepBar currentStep={step} totalSteps={5} />

                  <div className="wizard-content animate-in">
                    {step === 1 && <><DependencyContext deps={deps} /><Step1Page data={data} updateData={updateData} /></>}
                    {step === 2 && <Step2Page data={data} updateData={updateData} addRound1Interview={addRound1Interview} removeRound1Interview={removeRound1Interview} updateRound1Interview={updateRound1Interview} />}
                    {step === 3 && <Step3Page data={data} updateData={updateData} />}
                    {step === 4 && <Step4Page data={data} updateData={updateData} addRound2Interview={addRound2Interview} removeRound2Interview={removeRound2Interview} updateRound2Interview={updateRound2Interview} />}
                    {step === 5 && <Step5Page data={data} updateData={updateData} updateValidation={updateValidation} />}
                  </div>

                  <ButtonFooter
                    onBack={() => setStep(step === 1 ? 0 : step - 1)}
                    onNext={() => {
                      if (step === 1) {
                        if (!canProceedFromStep1()) return;
                        handleStepNext(1.5, { setup: { valuePropBeingTested: data.valuePropBeingTested, testingObjective: data.testingObjective, targetCustomerProfile: data.targetCustomerProfile, interviewPlan: data.interviewPlan } }, 'Setup');
                      } else if (step === 2) {
                        if (!canProceedFromStep2()) return;
                        handleStepNext(2.5, { customer_feedback_r1: { round1Interviews: data.round1Interviews } }, 'Round 1 Interviews');
                      } else if (step === 3) {
                        if (!canProceedFromStep3()) return;
                        handleStepNext(3.5, { comparison_results: { round1Patterns: data.round1Patterns, positivePatterns: data.positivePatterns, confusionPoints: data.confusionPoints, objections: data.objections, refinedValueProp: data.refinedValueProp, changesJustification: data.changesJustification } }, 'Refinement');
                      } else if (step === 4) {
                        if (!canProceedFromStep4()) return;
                        handleStepNext(4.5, { customer_feedback_r2: { round2Interviews: data.round2Interviews } }, 'Round 2 Interviews');
                      } else if (step === 5) {
                        if (!canProceedFromStep5()) return;
                        handleStepNext(5.5, { final_vp: { finalValueProp: data.finalValueProp }, reality_log: { validation: data.validation, consistentReactions: data.consistentReactions, strongestDifferentiator: data.strongestDifferentiator }, next_steps: { remainingAdjustments: data.remainingAdjustments, rolloutPlan: data.rolloutPlan } }, 'Final Decision');
                      }
                    }}
                    disabled={aiReviewing}
                    nextLabel={aiReviewing ? 'AI Coach Reviewing...' : step === 5 ? 'View Canvas' : 'Next'}
                    showBack={true}
                  />
                </div>
                <WizardSidebar currentStep={step} data={data} onNavigate={setStep} />
              </div>
            )}

            {/* Transition screens between steps */}
            {[1.5, 2.5, 3.5, 4.5, 5.5].includes(step) && (() => {
              const completedStep = Math.floor(step);
              const nextStep = completedStep === 5 ? 6 : completedStep + 1;
              const t = TRANSITION_CONTENT[completedStep];
              return (
                <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <div style={{ maxWidth: 640, padding: '0 32px', textAlign: 'center', color: '#fff' }} className="animate-in">
                    <div className="monument" style={{ fontSize: 12, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 16 }}>
                      STEP {completedStep} OF 5 COMPLETE
                    </div>
                    <h1 className="plaak" style={{ fontSize: 48, marginBottom: 12 }}>{t.title}</h1>
                    <p style={{ fontSize: 16, color: '#ccc', marginBottom: 48 }}>{t.text}</p>

                    <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #FFF469', padding: '20px 24px', marginBottom: 24, textAlign: 'left' }}>
                      <span className="monument" style={{ fontSize: 10, color: '#FFF469', display: 'block', marginBottom: 8 }}>BRUTAL TRUTH</span>
                      <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>{t.brutalTruth}</p>
                    </div>

                    <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #666', padding: '20px 24px', marginBottom: 48, textAlign: 'left' }}>
                      <span className="monument" style={{ fontSize: 10, color: '#999', display: 'block', marginBottom: 8 }}>PEER PROOF</span>
                      <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic' }}>{t.peerProof}</p>
                    </div>

                    <button
                      onClick={() => setStep(nextStep)}
                      style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }}
                      onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                      onMouseOut={e => { e.target.style.background = '#fff'; }}
                    >CONTINUE</button>
                  </div>
                </div>
              );
            })()}

            {/* Step 6: Canvas */}
            {step === 6 && (
              <CanvasPage
                data={data}
                onBack={() => setStep(5)}
                onExport={exportPDF}
                onSubmit={handleSubmit}
              />
            )}
          </div>
        </div>
      );
    }

    /* CoverPage is now inline in TestingApp render */

    // Intro Page Component (truncated for length - continuing in next part)
    function IntroPage({ data, updateData, onNext, canProceed }) {
      return (
        <div className="bg-black text-white min-h-screen p-16">
          <div className="max-w-5xl mx-auto">
            <h1 className="plaak mb-16 animate-in" style={{fontSize: '100px'}}>
              BEFORE WE START
            </h1>

            {/* User Details */}
            </div>

            {/* Sprint Info */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.08s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>SPRINT INFO</h2>
              <div className="bg-white text-black p-8">
                <p className="text-2xl font-bold mb-4">Sprint 16: Value Proposition Testing</p>
                <p className="text-xl leading-relaxed mb-4">
                  This sprint cuts through assumptions and turns customer insights into a clear, powerful message your market cannot ignore. It is focused on quickly validating and locking in your value proposition with real customer reactions, not guesswork.
                </p>
                <div className="border-l-4 border-black pl-4 italic text-lg">
                  "A value proposition only works if it lands the first time with customers. This process ensures predictability - if multiple customers react the same way, it&apos;s a pattern."
                </div>
              </div>
            </div>

            {/* Purpose */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <h2 className="plaak text-6xl mb-6">PURPOSE</h2>

              <div className="border-l-4 border-white pl-6 mb-6">
                <p className="text-3xl italic mb-2">&quot;The best value proposition isn&apos;t what you think sounds good - it&apos;s what customers can&apos;t ignore.&quot;</p>
                <p className="text-xl text-gray-400">— FAST TRACK TESTING PRINCIPLE</p>
              </div>

              <p className="text-3xl leading-relaxed mb-4">
                Test your value proposition with real customers in two rounds: Round 1 identifies confusion points, Round 2 validates your refined message. The goal is consistency - if multiple customers react the same way, you have a bulletproof value proposition.
              </p>
            </div>

            {/* Mistakes to Avoid */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>MISTAKES TO AVOID</h2>

              <div className="bg-white text-black p-6 mb-6 border-4 border-yellow-400">
                <p className="riforma-bold text-2xl mb-4">VALUE PROPOSITION TESTING PITFALLS:</p>
                <ul className="text-xl space-y-3">
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">1.</span>
                    <span><strong>Accepting polite but unclear feedback:</strong> Never settle for vague responses. Push customers for specifics.</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">2.</span>
                    <span><strong>Over-explaining during tests:</strong> If they don&apos;t get it immediately, the message still needs work</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">3.</span>
                    <span><strong>Leading them to the answer you want:</strong> Your job is to listen, not to get validation</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">4.</span>
                    <span><strong>Defending your original idea:</strong> The point is to improve, not justify what exists</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">5.</span>
                    <span><strong>Jumping to conclusions too fast:</strong> One person&apos;s reaction doesn&apos;t make a pattern. Need 3+ consistent reactions.</span>
                  </li>
                </ul>
              </div>

              <ul className="text-2xl space-y-4">
                <li className="flex items-start">
                  <span className="text-4xl mr-4">•</span>
                  <span>Dismissing hesitation. Every hesitation is a clue about where your message is weak.</span>
                </li>
                <li className="flex items-start">
                  <span className="text-4xl mr-4">•</span>
                  <span>Making changes without evidence. Stick to patterns - if three or more customers say it, it&apos;s real feedback.</span>
                </li>
                <li className="flex items-start">
                  <span className="text-4xl mr-4">•</span>
                  <span>Endless tweaking. After Round 2, lock it in and execute. A great value proposition isn&apos;t debated forever.</span>
                </li>
              </ul>
            </div>

            {/* The Journey */}
            <div className="mb-16 animate-in" style={{animationDelay: '0.3s'}}>
              <h2 className="plaak text-6xl mb-8">THE JOURNEY</h2>
              <div className="grid grid-cols-5 gap-4 text-center">
                <div className="border-2 border-white p-4">
                  <div className="text-6xl plaak mb-2">01</div>
                  <p className="text-lg font-bold mb-1">SETUP</p>
                  <p className="text-sm text-gray-400">Test plan</p>
                </div>
                <div className="border-2 border-white p-4">
                  <div className="text-6xl plaak mb-2">02</div>
                  <p className="text-lg font-bold mb-1">ROUND 1</p>
                  <p className="text-sm text-gray-400">Find issues</p>
                </div>
                <div className="border-2 border-white p-4">
                  <div className="text-6xl plaak mb-2">03</div>
                  <p className="text-lg font-bold mb-1">REFINE</p>
                  <p className="text-sm text-gray-400">Fix problems</p>
                </div>
                <div className="border-2 border-white p-4">
                  <div className="text-6xl plaak mb-2">04</div>
                  <p className="text-lg font-bold mb-1">ROUND 2</p>
                  <p className="text-sm text-gray-400">Validate fix</p>
                </div>
                <div className="border-2 border-white p-4">
                  <div className="text-6xl plaak mb-2">05</div>
                  <p className="text-lg font-bold mb-1">DECIDE</p>
                  <p className="text-sm text-gray-400">Lock it in</p>
                </div>
              </div>
            </div>

            <button
              onClick={onNext}
              disabled={!canProceed}
              className="btn-primary w-full text-3xl py-8 plaak"
            >
              LET&apos;S START →
            </button>
        </div>
      );
    }

    /* TransitionScreen is now inline in TestingApp render using TRANSITION_CONTENT */

    // Step 1: Test Setup
    function Step1Page({ data, updateData }) {
      return (
        <>
            <div className="step-indicator"><span>STEP 01</span><span className="step-time">~5 min</span></div>
            <h2 className="step-heading">TEST SETUP</h2>
            <p className="step-hint">Define what you're testing, who you're testing with, and what success looks like.</p>

            {/* Fast Track Insight */}
            <FastTrackInsight>
                80% of failed product launches trace back to untested assumptions about customer value. The 20% of effort that matters most is this: writing the exact message you will test, defining what success looks like, and choosing the right customers to interview. A clear testing plan eliminates guesswork and ensures every interview produces actionable insights, not polite conversation.
            </FastTrackInsight>

            {/* The Science */}
            <ScienceBox collapsible={true}>
                Research by Osterwalder et al. (2014) in "Value Proposition Design" found that companies using structured customer testing processes are 48% more likely to achieve product-market fit within the first year. A Harvard Business School study by Eisenmann, Ries, and Dillard (2012) demonstrated that startups using hypothesis-driven customer interviews pivoted 2.5x faster and were 3x more likely to survive past year three. Writing your value proposition as a precise, testable statement activates deliberative thinking and reduces the overconfidence bias that plagues internal brainstorming.
            </ScienceBox>

            {/* Common Mistake */}
            <WarningBox>
                The #1 mistake is confirmation bias: designing your test to get the answer you want. If you over-explain your value proposition during interviews, lead customers toward a positive response, or only interview people who already like you, your data is worthless. <strong>Bad:</strong> "Don't you think our solution is faster than competitors?" (leading question that invites agreement). <strong>Good:</strong> "How are you currently solving this problem, and what frustrates you most?" (open question that reveals real pain points).
            </WarningBox>


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Prepare your testing plan
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;This second and final round of customer interviews is designed to validate the updated value proposition with high confidence. We should have a tested, bulletproof value proposition that drives predictable, strong reactions.&quot;
              </p>
              <p className="text-lg text-gray-600 mt-2">— Testing Objective</p>
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.15s'}}>
              <label className="monument text-sm block mb-3">VALUE PROPOSITION BEING TESTED <span className="text-red-500">*</span></label>
              <ScienceBookmarkIcon>
                  Kahneman's research on cognitive fluency shows that value propositions understood within 8 seconds perform 4x better in market tests. Writing the exact words you will say out loud forces precision.
              </ScienceBookmarkIcon>
              <p className="text-base text-gray-600 mb-3">What is the exact value proposition you will test with customers?</p>
              <textarea
                value={data.valuePropBeingTested}
                onChange={(e) => updateData('valuePropBeingTested', e.target.value)}
                placeholder="For high-growth SaaS startups (20-100 employees) struggling with workflow inefficiency, we provide an AI-powered automation platform that eliminates 80% of manual work in 24 hours, unlike competitors who require 6-month implementations and dedicated IT teams."
                className="w-full"
                rows={4}
              />
              <div className={`char-counter ${data.valuePropBeingTested.length < 30 ? 'invalid' : ''}`}>
                {data.valuePropBeingTested.length}/800 (min 30 characters)
              </div>
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <label className="monument text-sm block mb-3">TESTING OBJECTIVE <span className="text-red-500">*</span></label>
              <ScienceBookmarkIcon>
                  Goal-setting theory (Locke & Latham, 2002) confirms that specific testing objectives produce 25% more actionable insights than vague goals like "see what customers think."
              </ScienceBookmarkIcon>
              <p className="text-base text-gray-600 mb-3">What do you want to learn from these tests?</p>
              <textarea
                value={data.testingObjective}
                onChange={(e) => updateData('testingObjective', e.target.value)}
                placeholder="Confirm message lands clearly and persuasively. Identify remaining friction points. Ensure customers see offer as compelling and action-worthy. Finalize key wording before full implementation. Validate that 24-hour promise resonates and differentiation from 6-month competitors is clear."
                className="w-full"
                rows={4}
              />
              <div className={`char-counter ${data.testingObjective.length < 30 ? 'invalid' : ''}`}>
                {data.testingObjective.length}/500 (min 30 characters)
              </div>
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.25s'}}>
              <label className="monument text-sm block mb-3">TARGET CUSTOMER PROFILE FOR INTERVIEWS</label>
              <ScienceBookmarkIcon>
                  Cooper & Vlaskovits (2010) found that interviewing 5 well-selected customers from your core segment yields more reliable validation data than 50 interviews across random demographics.
              </ScienceBookmarkIcon>
              <p className="text-base text-gray-600 mb-3">Who exactly will you interview? Be specific.</p>
              <textarea
                value={data.targetCustomerProfile}
                onChange={(e) => updateData('targetCustomerProfile', e.target.value)}
                placeholder="COOs or VP Operations at SaaS companies with 30-80 employees, $5M-$20M ARR, currently using 8+ disconnected tools, experiencing team frustration with manual processes. Ideally have tried automation before but failed."
                className="w-full"
                rows={3}
              />
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.3s'}}>
              <label className="monument text-sm block mb-3">INTERVIEW PLAN</label>
              <p className="text-base text-gray-600 mb-3">How many interviews? When? Format?</p>
              <textarea
                value={data.interviewPlan}
                onChange={(e) => updateData('interviewPlan', e.target.value)}
                placeholder="Round 1: 5 interviews over 5 days (March 10-14). 30-40 min each via Zoom. Focus on finding confusion points.&#10;Round 2: Same 5 customers + 2 new ones (March 20-22) after refinements. Validate fixes work."
                className="w-full"
                rows={4}
              />
            </div>

        </>
      );
    }

    // Step 2: Round 1 Customer Interviews
    function Step2Page({ data, updateData, addRound1Interview, removeRound1Interview, updateRound1Interview }) {
      return (
        <>
            <div className="step-indicator"><span>STEP 02</span><span className="step-time">~10 min</span></div>
            <h2 className="step-heading">ROUND 1 INTERVIEWS</h2>
            <p className="step-hint">Document customer reactions from your discovery round. Focus on what works, what's unclear, and what concerns arise.</p>

            {/* Fast Track Insight */}
            <FastTrackInsight>
                Round 1 is pure discovery. Your only job is to listen, not to sell. The 80/20 rule applies: 80% of your breakthrough insights will come from the moments customers hesitate, rephrase your message in their own words, or reveal concerns you never anticipated. Capture their exact language — those words are worth more than anything your marketing team writes internally.
            </FastTrackInsight>

            {/* The Science */}
            <ScienceBox collapsible={true}>
                Rob Fitzpatrick's "The Mom Test" research demonstrates that customers will lie to you out of politeness unless you ask about their actual behavior, not their opinions. Questions about what they have done (past actions) predict future behavior 3x better than questions about what they would do (hypothetical intent). Blank et al. (2013) in "The Startup Owner's Manual" found that teams documenting customer reactions immediately after interviews retain 40% more actionable detail than those who wait even 24 hours.
            </ScienceBox>


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Document customer reactions (Discovery Round)
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;Let them talk - your job is to listen. Push for real reactions, not politeness. Confirm if the message creates clarity, urgency, and action.&quot;
              </p>
              <p className="text-lg text-gray-600 mt-2">— Interview Do&apos;s</p>
            </div>

            <p className="text-xl mb-8 text-gray-700">
              Conduct 3-5 interviews. Focus on identifying what works, what&apos;s unclear, and what concerns arise.
            </p>

            {data.round1Interviews.map((interview, index) => (
              <div key={index} className="bg-gray-50 border-4 border-gray-300 p-8 mb-8 animate-in" style={{animationDelay: `${0.15 + index * 0.05}s`}}>
                <div className="flex justify-between items-start mb-6">
                  <h4 className="riforma-bold text-3xl">Interview {index + 1}</h4>
                  {data.round1Interviews.length > 1 && (
                    <button
                      onClick={() => removeRound1Interview(index)}
                      className="text-red-600 hover:text-red-800"
                    >
                      Remove
                    </button>
                  )}
                </div>

                <div className="grid grid-cols-3 gap-4 mb-6">
                  <div>
                    <label className="monument text-xs block mb-2">CUSTOMER NAME <span className="text-red-500">*</span></label>
                    <input
                      type="text"
                      value={interview.customerName}
                      onChange={(e) => updateRound1Interview(index, 'customerName', e.target.value)}
                      placeholder="Sarah Chen"
                      className="w-full"
                    />
                  </div>
                  <div>
                    <label className="monument text-xs block mb-2">PROFILE</label>
                    <input
                      type="text"
                      value={interview.customerProfile}
                      onChange={(e) => updateRound1Interview(index, 'customerProfile', e.target.value)}
                      placeholder="COO at TechFlow (75 employees)"
                      className="w-full"
                    />
                  </div>
                  <div>
                    <label className="monument text-xs block mb-2">DATE</label>
                    <input
                      type="date"
                      value={interview.date}
                      onChange={(e) => updateRound1Interview(index, 'date', e.target.value)}
                      className="w-full"
                    />
                  </div>
                </div>

                <div className="space-y-6">
                  <div>
                    <label className="monument text-xs block mb-2">PROBLEM RECONFIRM</label>
                    <p className="text-sm text-gray-600 mb-2">Is the problem still their biggest challenge? Has anything changed?</p>
                    <textarea
                      value={interview.problemReconfirm}
                      onChange={(e) => updateRound1Interview(index, 'problemReconfirm', e.target.value)}
                      placeholder="Still major issue. Team now spending 50% time on manual work, up from 40%. Lost another key hire last month due to operational chaos. More urgent than before."
                      className="w-full"
                      rows={3}
                    />
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">VALUE PROP REACTION <span className="text-red-500">*</span></label>
                    <p className="text-sm text-gray-600 mb-2">What was their immediate reaction when you presented the value prop?</p>
                    <textarea
                      value={interview.valueReaction}
                      onChange={(e) => updateRound1Interview(index, 'valueReaction', e.target.value)}
                      placeholder="Eyes lit up at 24 hours vs 6 months. Immediately asked if that&apos;s really possible. Skeptical but interested. Said current solution took 4 months to implement and still doesn&apos;t work well."
                      className="w-full"
                      rows={3}
                    />
                    <div className={`char-counter ${interview.valueReaction.length < 30 ? 'invalid' : ''}`}>
                      {interview.valueReaction.length}/1000 (min 30 characters)
                    </div>
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">WHAT WORKED WELL <span className="text-red-500">*</span></label>
                    <p className="text-sm text-gray-600 mb-2">What made them react positively?</p>
                    <textarea
                      value={interview.whatWorked}
                      onChange={(e) => updateRound1Interview(index, 'whatWorked', e.target.value)}
                      placeholder="Loved the 24-hour promise. No IT required resonated strongly - they don&apos;t have dedicated IT. 80% automation specific and believable. Comparison to 6-month competitors was powerful."
                      className="w-full"
                      rows={3}
                    />
                    <div className={`char-counter ${interview.whatWorked.length < 20 ? 'invalid' : ''}`}>
                      {interview.whatWorked.length}/800 (min 20 characters)
                    </div>
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">WHAT WAS UNCLEAR</label>
                    <p className="text-sm text-gray-600 mb-2">Where did they hesitate or need more explanation?</p>
                    <textarea
                      value={interview.whatUnclear}
                      onChange={(e) => updateRound1Interview(index, 'whatUnclear', e.target.value)}
                      placeholder="Not sure what AI-powered means in practice. Unclear if 80% applies to their specific workflows. Confused about pricing - is it per user or flat fee?"
                      className="w-full"
                      rows={3}
                    />
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">CONCERNS RAISED</label>
                    <p className="text-sm text-gray-600 mb-2">Why would they not move forward?</p>
                    <textarea
                      value={interview.concerns}
                      onChange={(e) => updateRound1Interview(index, 'concerns', e.target.value)}
                      placeholder="Worried about data security. Concerned about team adoption - have failed with tools before. Skeptical that 24 hours is realistic for their complexity. Budget approval needed."
                      className="w-full"
                      rows={3}
                    />
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">HOW THEY DESCRIBED IT (THEIR WORDS)</label>
                    <p className="text-sm text-gray-600 mb-2">Did they naturally rephrase the value prop? What words did they use?</p>
                    <textarea
                      value={interview.theirWords}
                      onChange={(e) => updateRound1Interview(index, 'theirWords', e.target.value)}
                      placeholder="&quot;So you basically get rid of all the busy work instantly without needing tech people?&quot; Used instant multiple times. Called it plug-and-play automation."
                      className="w-full"
                      rows={2}
                    />
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">CALL TO ACTION RESPONSE</label>
                    <p className="text-sm text-gray-600 mb-2">Would they act on this? What would their next step be?</p>
                    <textarea
                      value={interview.callToActionResponse}
                      onChange={(e) => updateRound1Interview(index, 'callToActionResponse', e.target.value)}
                      placeholder="Would want demo immediately to see it work. Said if it delivers on promise, would fast-track budget approval. Would recommend to 2 other companies in similar situation."
                      className="w-full"
                      rows={3}
                    />
                  </div>
                </div>
              </div>
            ))}

            <button onClick={addRound1Interview} className="btn-back" style={{ width: '100%', textAlign: 'center', marginBottom: 24 }}>
              + Add Another Round 1 Interview
            </button>
        </>
      );
    }

    // Step 3: Refinement Based on Round 1
    function Step3Page({ data, updateData }) {
      return (
        <>
            <div className="step-indicator"><span>STEP 03</span><span className="step-time">~8 min</span></div>
            <h2 className="step-heading">ANALYZE & REFINE</h2>
            <p className="step-hint">Identify patterns from Round 1 and use evidence to sharpen your value proposition.</p>

            {/* Fast Track Insight */}
            <FastTrackInsight>
                One customer's opinion is noise. Three customers saying the same thing is a pattern. Five customers confirming it is a fact. Focus exclusively on patterns — what was repeated across multiple interviews? The 20% of feedback that appears in 80% of conversations is where your refined value proposition lives. Change only what the evidence demands, and keep everything that already works.
            </FastTrackInsight>

            {/* The Science */}
            <ScienceBox collapsible={true}>
                A Stanford GSB study by Maurya (2012) found that value propositions refined through evidence-based iteration outperform the original version by an average of 3.2x in customer conversion metrics. The key differentiator was the discipline to change only what feedback demanded — teams that over-revised based on individual opinions actually performed worse than those who made no changes at all. Tversky and Kahneman's anchoring research confirms that justifying each change with specific evidence prevents the "kitchen sink" reflex of adding too much.
            </ScienceBox>


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Identify patterns and fix weak spots
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;Stick to patterns - If three or more customers say it, it&apos;s real feedback. Use evidence, not feelings. Prioritize clarity over complexity.&quot;
              </p>
              <p className="text-lg text-gray-600 mt-2">— Analysis Principles</p>
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.15s'}}>
              <label className="monument text-sm block mb-3">PATTERNS ACROSS ALL INTERVIEWS</label>
              <p className="text-base text-gray-600 mb-3">What themes repeated across multiple customers?</p>
              <textarea
                value={data.round1Patterns}
                onChange={(e) => updateData('round1Patterns', e.target.value)}
                placeholder="All 5 customers reacted positively to 24-hour timeline. 4 of 5 said no IT required was critical factor. 3 mentioned skepticism about AI - term creates confusion. All asked about pricing structure."
                className="w-full"
                rows={4}
              />
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <label className="monument text-sm block mb-3">POSITIVE PATTERNS (WHAT WORKED) <span className="text-red-500">*</span></label>
              <p className="text-base text-gray-600 mb-3">What did customers consistently respond well to?</p>
              <textarea
                value={data.positivePatterns}
                onChange={(e) => updateData('positivePatterns', e.target.value)}
                placeholder="Speed promise (24 hours) was universally compelling. No IT required resonated with everyone. 80% specific number more believable than saying &quot;most&quot;. Comparison to 6-month competitors made differentiation clear. Customers used words like instant, plug-and-play, no-brainer."
                className="w-full"
                rows={5}
              />
              <div className={`char-counter ${data.positivePatterns.length < 50 ? 'invalid' : ''}`}>
                {data.positivePatterns.length}/1000 (min 50 characters)
              </div>
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.25s'}}>
              <label className="monument text-sm block mb-3">CONFUSION POINTS (WHAT WAS UNCLEAR) <span className="text-red-500">*</span></label>
              <p className="text-base text-gray-600 mb-3">Where did customers consistently hesitate or ask for clarification?</p>
              <textarea
                value={data.confusionPoints}
                onChange={(e) => updateData('confusionPoints', e.target.value)}
                placeholder="AI-powered confusing - 3 customers asked what it means in practice. SaaS startups too narrow? 2 customers at 110 employees worried they&apos;re too big. 80% unclear - 80% of what exactly? All workflows or specific types?"
                className="w-full"
                rows={5}
              />
              <div className={`char-counter ${data.confusionPoints.length < 30 ? 'invalid' : ''}`}>
                {data.confusionPoints.length}/1000 (min 30 characters)
              </div>
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.3s'}}>
              <label className="monument text-sm block mb-3">OBJECTIONS RAISED</label>
              <p className="text-base text-gray-600 mb-3">What concerns need addressing?</p>
              <textarea
                value={data.objections}
                onChange={(e) => updateData('objections', e.target.value)}
                placeholder="Data security came up in 3 interviews. Skepticism about 24-hour promise - is it really possible? Concern about team adoption after previous failed tools. Pricing uncertainty causing hesitation."
                className="w-full"
                rows={4}
              />
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.35s'}}>
              <label className="monument text-sm block mb-3">REFINED VALUE PROPOSITION <span className="text-red-500">*</span></label>
              <p className="text-base text-gray-600 mb-3">Based on feedback, what is your refined version?</p>
              <textarea
                value={data.refinedValueProp}
                onChange={(e) => updateData('refinedValueProp', e.target.value)}
                placeholder="For fast-growing teams (20-150 employees) drowning in repetitive manual work, we provide zero-code workflow automation that eliminates 80% of busy work in 24 hours with zero IT required, unlike traditional tools that take 6 months to implement and require dedicated technical resources."
                className="w-full"
                rows={4}
              />
              <div className={`char-counter ${data.refinedValueProp.length < 30 ? 'invalid' : ''}`}>
                {data.refinedValueProp.length}/800 (min 30 characters)
              </div>
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.4s'}}>
              <label className="monument text-sm block mb-3">WHAT CHANGED & WHY</label>
              <p className="text-base text-gray-600 mb-3">Justify your changes with evidence from interviews.</p>
              <textarea
                value={data.changesJustification}
                onChange={(e) => updateData('changesJustification', e.target.value)}
                placeholder="Changed SaaS startups to fast-growing teams (20-150 employees) - 2 customers worried about being too big. Removed AI-powered - created confusion. Added zero-code which customers naturally used. Changed workflow inefficiency to drowning in repetitive manual work - their exact words. Added busy work which 4 customers mentioned."
                className="w-full"
                rows={5}
              />
            </div>

        </>
      );
    }

    // Step 4: Round 2 Validation Interviews
    function Step4Page({ data, updateData, addRound2Interview, removeRound2Interview, updateRound2Interview }) {
      return (
        <>
            <div className="step-indicator"><span>STEP 04</span><span className="step-time">~10 min</span></div>
            <h2 className="step-heading">ROUND 2 VALIDATION</h2>
            <p className="step-hint">Test the refined message with customers. Focus on consistency of reactions.</p>

            {/* Fast Track Insight */}
            <FastTrackInsight>
                Round 2 is validation, not discovery. You are no longer exploring — you are confirming. The test is simple: does the refined message produce consistent, strong reactions across multiple customers? If reactions are similar and positive, you have a validated value proposition ready for rollout. If reactions still vary widely, there is more work to do. Neutral feedback is useless — push for love it or have clear concerns.
            </FastTrackInsight>

            {/* The Science */}
            <ScienceBox collapsible={true}>
                Ries (2011) in "The Lean Startup" demonstrated that two-round testing — discover then validate — reduces false positives by 65% compared to single-round approaches. Nielsen Norman Group research on usability testing confirms that testing with 5 users uncovers 85% of issues, and retesting the same users after refinement provides the strongest signal of genuine improvement. Consistency of reactions across multiple customers is a more reliable indicator of market readiness than any individual score.
            </ScienceBox>


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Confirm refinements work
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;We look for consistency. If customers react the same way, we&apos;ve nailed it. If reactions vary widely, there&apos;s still work to do. We want customers to either love it or have clear concerns - neutral feedback is useless.&quot;
              </p>
              <p className="text-lg text-gray-600 mt-2">— Round 2 Principles</p>
            </div>

            {data.refinedValueProp && (
              <div className="mb-12 bg-black text-white p-8 animate-in" style={{animationDelay: '0.15s'}}>
                <h3 className="riforma-bold text-2xl mb-4">Refined Value Proposition Being Tested:</h3>
                <p className="text-2xl leading-relaxed">
                  {data.refinedValueProp}
                </p>
              </div>
            )}

            <p className="text-xl mb-8 text-gray-700">
              Test the refined message with customers. Focus on consistency - do they all react similarly?
            </p>

            {data.round2Interviews.map((interview, index) => (
              <div key={index} className="bg-gray-50 border-4 border-gray-300 p-8 mb-8 animate-in" style={{animationDelay: `${0.2 + index * 0.05}s`}}>
                <div className="flex justify-between items-start mb-6">
                  <h4 className="riforma-bold text-3xl">Round 2 - Interview {index + 1}</h4>
                  {data.round2Interviews.length > 1 && (
                    <button
                      onClick={() => removeRound2Interview(index)}
                      className="text-red-600 hover:text-red-800"
                    >
                      Remove
                    </button>
                  )}
                </div>

                <div className="grid grid-cols-3 gap-4 mb-6">
                  <div>
                    <label className="monument text-xs block mb-2">CUSTOMER NAME <span className="text-red-500">*</span></label>
                    <input
                      type="text"
                      value={interview.customerName}
                      onChange={(e) => updateRound2Interview(index, 'customerName', e.target.value)}
                      placeholder="Sarah Chen (returning)"
                      className="w-full"
                    />
                  </div>
                  <div>
                    <label className="monument text-xs block mb-2">PROFILE</label>
                    <input
                      type="text"
                      value={interview.customerProfile}
                      onChange={(e) => updateRound2Interview(index, 'customerProfile', e.target.value)}
                      placeholder="COO at TechFlow"
                      className="w-full"
                    />
                  </div>
                  <div>
                    <label className="monument text-xs block mb-2">DATE</label>
                    <input
                      type="date"
                      value={interview.date}
                      onChange={(e) => updateRound2Interview(index, 'date', e.target.value)}
                      className="w-full"
                    />
                  </div>
                </div>

                <div className="space-y-6">
                  <div>
                    <label className="monument text-xs block mb-2">PROBLEM STILL VALID?</label>
                    <textarea
                      value={interview.problemStillValid}
                      onChange={(e) => updateRound2Interview(index, 'problemStillValid', e.target.value)}
                      placeholder="Yes, even more urgent. Team now at breaking point with manual work."
                      className="w-full"
                      rows={2}
                    />
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">IMMEDIATE REACTION</label>
                    <textarea
                      value={interview.valueReaction}
                      onChange={(e) => updateRound2Interview(index, 'valueReaction', e.target.value)}
                      placeholder="Much clearer now. Zero-code makes more sense than AI-powered. Loves fast-growing teams instead of just startups - feels inclusive. Drowning in manual work exactly how she describes it internally."
                      className="w-full"
                      rows={3}
                    />
                  </div>

                  <div className="grid grid-cols-4 gap-4">
                    <div>
                      <label className="monument text-xs block mb-2">CLARITY (1-5) <span className="text-red-500">*</span></label>
                      <select
                        value={interview.clarity}
                        onChange={(e) => updateRound2Interview(index, 'clarity', e.target.value)}
                        className="w-full"
                      >
                        <option value="">Rate...</option>
                        <option value="1">1 - Very Unclear</option>
                        <option value="2">2 - Somewhat Unclear</option>
                        <option value="3">3 - Neutral</option>
                        <option value="4">4 - Clear</option>
                        <option value="5">5 - Crystal Clear</option>
                      </select>
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">ENTHUSIASM (1-5) <span className="text-red-500">*</span></label>
                      <select
                        value={interview.enthusiasm}
                        onChange={(e) => updateRound2Interview(index, 'enthusiasm', e.target.value)}
                        className="w-full"
                      >
                        <option value="">Rate...</option>
                        <option value="1">1 - Not Interested</option>
                        <option value="2">2 - Mildly Interested</option>
                        <option value="3">3 - Interested</option>
                        <option value="4">4 - Very Interested</option>
                        <option value="5">5 - Extremely Excited</option>
                      </select>
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">DIFFERENTIATION (1-5)</label>
                      <select
                        value={interview.differentiation}
                        onChange={(e) => updateRound2Interview(index, 'differentiation', e.target.value)}
                        className="w-full"
                      >
                        <option value="">Rate...</option>
                        <option value="1">1 - Same as Others</option>
                        <option value="2">2 - Slightly Different</option>
                        <option value="3">3 - Noticeably Different</option>
                        <option value="4">4 - Very Different</option>
                        <option value="5">5 - Completely Unique</option>
                      </select>
                    </div>
                    <div>
                      <label className="monument text-xs block mb-2">ACTIONABILITY (1-5)</label>
                      <select
                        value={interview.actionability}
                        onChange={(e) => updateRound2Interview(index, 'actionability', e.target.value)}
                        className="w-full"
                      >
                        <option value="">Rate...</option>
                        <option value="1">1 - Won&apos;t Act</option>
                        <option value="2">2 - Might Consider</option>
                        <option value="3">3 - Will Explore</option>
                        <option value="4">4 - Want Demo Soon</option>
                        <option value="5">5 - Want It Now</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">REMAINING CONCERNS</label>
                    <textarea
                      value={interview.concerns}
                      onChange={(e) => updateRound2Interview(index, 'concerns', e.target.value)}
                      placeholder="Only concern is pricing. Otherwise ready to move forward."
                      className="w-full"
                      rows={2}
                    />
                  </div>

                  <div>
                    <label className="monument text-xs block mb-2">WOULD RECOMMEND? TO WHO?</label>
                    <textarea
                      value={interview.recommendation}
                      onChange={(e) => updateRound2Interview(index, 'recommendation', e.target.value)}
                      placeholder="Absolutely. Would recommend to 3 other COOs in similar situation. Already thinking about who to share this with."
                      className="w-full"
                      rows={2}
                    />
                  </div>
                </div>
              </div>
            ))}

            <button onClick={addRound2Interview} className="btn-back" style={{ width: '100%', textAlign: 'center', marginBottom: 24 }}>
              + Add Another Round 2 Interview
            </button>
        </>
      );
    }

    // Step 5: Final Decision & Validation
    function Step5Page({ data, updateData, updateValidation }) {
      const validationQuestions = [
        { key: 'mainNeedsSatisfied', label: 'We have verified if the value proposition satisfies the main core segment/customer needs' },
        { key: 'factsNotOpinions', label: 'During customer interviews, we asked for facts about their attitudes, behaviors, and real actions they are likely to take rather than their opinions' },
        { key: 'generalToSpecific', label: 'The questions asked during customer interviews start from general to more specific' },
        { key: 'askedWhy', label: 'We have asked our customers WHY as many times as we could to get to the root causes of their actions' },
        { key: 'notLeading', label: 'The questions asked during customer interviews are NOT leading or close-ended' },
        { key: 'sharedFindings', label: 'The team has prepared a summary of the main findings from the interviews and has been shared with everyone' },
        { key: 'updatedAddressesFeedback', label: 'The initial value proposition has been updated and addresses interview feedback - it is solving the primary customer needs in a differentiated way' }
      ];

      const yesCount = Object.values(data.validation).filter(v => v === 'yes').length;

      // Calculate average scores from Round 2
      const avgClarity = data.round2Interviews.filter(i => i.clarity).reduce((sum, i) => sum + parseInt(i.clarity), 0) / data.round2Interviews.filter(i => i.clarity).length || 0;
      const avgEnthusiasm = data.round2Interviews.filter(i => i.enthusiasm).reduce((sum, i) => sum + parseInt(i.enthusiasm), 0) / data.round2Interviews.filter(i => i.enthusiasm).length || 0;

      return (
        <>
            <div className="step-indicator"><span>STEP 05</span><span className="step-time">~5 min</span></div>
            <h2 className="step-heading">FINAL DECISION</h2>
            <p className="step-hint">Lock in your validated value proposition and plan the rollout.</p>

            {/* Fast Track Insight */}
            <FastTrackInsight>
                A great value proposition is not debated forever — it is tested, refined, and executed. After two rounds of customer interviews, the evidence is in. Lock it in with conviction. The biggest risk now is not an imperfect message — it is endless tweaking that delays execution. Your validated value proposition becomes the core message across marketing, sales, and product development. Every department must speak it consistently.
            </FastTrackInsight>

            {/* The Science */}
            <ScienceBox collapsible={true}>
                Bain & Company's research on go-to-market effectiveness (2022) found that companies with a single, validated value proposition used consistently across all channels achieve 31% higher revenue growth than those with fragmented or untested messaging. McKinsey's "Decision-Making at Speed" framework shows that teams using validation checklists before committing to execution reduce post-launch pivots by 55%. The sprint validation checklist below is based on the most predictive indicators of market-ready messaging.
            </ScienceBox>


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Lock in your value proposition
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;A great value proposition isn&apos;t debated forever - it&apos;s tested, refined, and executed. This is the final decision meeting. No going back after today.&quot;
              </p>
              <p className="text-lg text-gray-600 mt-2">— Final Decision Principle</p>
            </div>

            {/* Round 2 Score Summary */}
            {avgClarity > 0 && (
              <div className="mb-12 bg-gray-100 border-4 border-black p-8 animate-in" style={{animationDelay: '0.15s'}}>
                <h3 className="riforma-bold text-3xl mb-6">Round 2 Average Scores</h3>
                <div className="grid grid-cols-2 gap-6">
                  <div className="text-center">
                    <div className="text-7xl font-bold mb-2">{avgClarity.toFixed(1)}/5</div>
                    <p className="text-xl">Clarity</p>
                  </div>
                  <div className="text-center">
                    <div className="text-7xl font-bold mb-2">{avgEnthusiasm.toFixed(1)}/5</div>
                    <p className="text-xl">Enthusiasm</p>
                  </div>
                </div>
                {avgClarity >= 4 && avgEnthusiasm >= 4 ? (
                  <div className="bg-gray-100 border-2 border-black p-4 mt-6">
                    <p className="riforma-bold text-xl">✓ Strong validation! Customers understand and are excited.</p>
                  </div>
                ) : (
                  <div className="bg-red-100 border-2 border-red-600 p-4 mt-6">
                    <p className="riforma-bold text-xl">⚠️ Scores below 4.0 suggest more refinement needed.</p>
                  </div>
                )}
              </div>
            )}

            {/* Final Value Proposition */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <label className="monument text-sm block mb-3">FINAL VALUE PROPOSITION <span className="text-red-500">*</span></label>
              <p className="text-base text-gray-600 mb-3">This is IT. The version you&apos;re locking in for execution.</p>
              <textarea
                value={data.finalValueProp}
                onChange={(e) => updateData('finalValueProp', e.target.value)}
                placeholder="For fast-growing teams (20-150 employees) drowning in repetitive manual work, we provide zero-code workflow automation that eliminates 80% of busy work in 24 hours with zero IT required, unlike traditional tools that take 6 months to implement and require dedicated technical resources."
                className="w-full"
                rows={4}
              />
              <div className={`char-counter ${data.finalValueProp.length < 30 ? 'invalid' : ''}`}>
                {data.finalValueProp.length}/800 (min 30 characters)
              </div>
            </div>

            {/* Validation Checklist */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.25s'}}>
              <h3 className="riforma-bold text-3xl mb-6">Sprint Validation Checklist</h3>
              <p className="text-lg mb-6 text-gray-700">
                You need at least 5 &quot;Yes&quot; answers. Current score: <strong>{yesCount}/7</strong>
              </p>

              <div className="space-y-4">
                {validationQuestions.map((q, index) => (
                  <div key={q.key} className="bg-gray-50 border-2 border-gray-200 p-6">
                    <p className="text-lg mb-4 font-bold">{index + 1}. {q.label}</p>
                    <div className="flex gap-4">
                      <label className="flex items-center cursor-pointer">
                        <input
                          type="radio"
                          name={q.key}
                          value="yes"
                          checked={data.validation[q.key] === 'yes'}
                          onChange={(e) => updateValidation(q.key, e.target.value)}
                          className="mr-2 w-5 h-5"
                        />
                        <span className="text-lg">Yes</span>
                      </label>
                      <label className="flex items-center cursor-pointer">
                        <input
                          type="radio"
                          name={q.key}
                          value="no"
                          checked={data.validation[q.key] === 'no'}
                          onChange={(e) => updateValidation(q.key, e.target.value)}
                          className="mr-2 w-5 h-5"
                        />
                        <span className="text-lg">No</span>
                      </label>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Analysis */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.3s'}}>
              <label className="monument text-sm block mb-3">CONSISTENT REACTIONS?</label>
              <p className="text-base text-gray-600 mb-3">Did customers react the same way? What patterns emerged?</p>
              <textarea
                value={data.consistentReactions}
                onChange={(e) => updateData('consistentReactions', e.target.value)}
                placeholder="All 7 Round 2 customers understood message immediately. 6 of 7 rated clarity 4 or 5. 5 of 7 asked for demo within first 5 minutes. Universal positive response to zero-code and 24-hour promise. Reactions highly consistent."
                className="w-full"
                rows={4}
              />
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.35s'}}>
              <label className="monument text-sm block mb-3">STRONGEST DIFFERENTIATOR</label>
              <p className="text-base text-gray-600 mb-3">What makes you stand out most clearly to customers?</p>
              <textarea
                value={data.strongestDifferentiator}
                onChange={(e) => updateData('strongestDifferentiator', e.target.value)}
                placeholder="24 hours vs 6 months is the killer differentiator. Every customer mentioned it unprompted. Zero IT required also powerful. Combination of speed + simplicity makes us unique."
                className="w-full"
                rows={3}
              />
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.4s'}}>
              <label className="monument text-sm block mb-3">REMAINING ADJUSTMENTS (IF ANY)</label>
              <p className="text-base text-gray-600 mb-3">Any final tweaks before execution? Or are we locked in?</p>
              <textarea
                value={data.remainingAdjustments}
                onChange={(e) => updateData('remainingAdjustments', e.target.value)}
                placeholder="No changes needed. Message is clear, differentiated, and creates urgency. Ready for rollout."
                className="w-full"
                rows={3}
              />
            </div>

            <div className="mb-12 animate-in" style={{animationDelay: '0.45s'}}>
              <label className="monument text-sm block mb-3">ROLLOUT PLAN</label>
              <p className="text-base text-gray-600 mb-3">How will you implement this across all channels?</p>
              <textarea
                value={data.rolloutPlan}
                onChange={(e) => updateData('rolloutPlan', e.target.value)}
                placeholder="Week 1: Update website homepage and all landing pages. Week 2: Train sales team on new messaging, update all decks. Week 3: Update email templates, ad copy, social media. Week 4: Internal all-hands to align entire company."
                className="w-full"
                rows={4}
              />
            </div>

        </>
      );
    }

    // Canvas Page Component
    function CanvasPage({ data, onBack, onExport, onSubmit }) {
      const yesCount = Object.values(data.validation).filter(v => v === 'yes').length;
      const avgClarity = data.round2Interviews.filter(i => i.clarity).reduce((sum, i) => sum + parseInt(i.clarity), 0) / data.round2Interviews.filter(i => i.clarity).length || 0;
      const avgEnthusiasm = data.round2Interviews.filter(i => i.enthusiasm).reduce((sum, i) => sum + parseInt(i.enthusiasm), 0) / data.round2Interviews.filter(i => i.enthusiasm).length || 0;

      return (
        <div className="bg-white min-h-screen p-16">
          <div className="max-w-6xl mx-auto">
            <h1 className="plaak text-6xl mb-12 text-center animate-in">VALUE PROPOSITION TESTING RESULTS</h1>

            <div id="canvas-content" className="border-8 border-black p-12 mb-12">
              {/* Header */}
              <div className="text-center mb-12">
                <div className="plaak text-3xl mb-4" style={{letterSpacing: '0.1em'}}>FAST TRACK</div>
                <h2 className="plaak text-4xl mb-2">VALUE PROPOSITION TESTING</h2>
                <p className="text-xl text-gray-600">Sprint 16: Customer Validation</p>
                <p className="text-lg text-gray-600 mt-2">{data.name} • {data.company}</p>
              </div>

              {/* Final Value Proposition */}
              <div className="mb-10 bg-yellow-100 border-4 border-black p-8">
                <h3 className="riforma-bold text-2xl mb-4 text-center">FINAL VALUE PROPOSITION</h3>
                <p className="text-3xl leading-relaxed font-bold text-center">
                  {data.finalValueProp}
                </p>
              </div>

              {/* Testing Summary */}
              <div className="mb-10">
                <h3 className="riforma-bold text-3xl mb-4 border-b-2 border-black pb-2">Testing Summary</h3>
                <div className="grid grid-cols-3 gap-6">
                  <div className="text-center bg-gray-100 p-6">
                    <div className="text-5xl font-bold mb-2">{data.round1Interviews.length}</div>
                    <p className="text-lg">Round 1 Interviews</p>
                  </div>
                  <div className="text-center bg-gray-100 p-6">
                    <div className="text-5xl font-bold mb-2">{data.round2Interviews.length}</div>
                    <p className="text-lg">Round 2 Interviews</p>
                  </div>
                  <div className="text-center bg-gray-100 p-6">
                    <div className="text-5xl font-bold mb-2">{yesCount}/7</div>
                    <p className="text-lg">Validation Score</p>
                  </div>
                </div>
              </div>

              {/* Round 2 Performance */}
              {avgClarity > 0 && (
                <div className="mb-10">
                  <h3 className="riforma-bold text-3xl mb-4 border-b-2 border-black pb-2">Round 2 Performance</h3>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-gray-50 p-6 text-center">
                      <div className="text-6xl font-bold mb-2">{avgClarity.toFixed(1)}/5</div>
                      <p className="text-xl">Average Clarity</p>
                    </div>
                    <div className="bg-gray-50 p-6 text-center">
                      <div className="text-6xl font-bold mb-2">{avgEnthusiasm.toFixed(1)}/5</div>
                      <p className="text-xl">Average Enthusiasm</p>
                    </div>
                  </div>
                </div>
              )}

              {/* Key Insights */}
              <div className="mb-10">
                <h3 className="riforma-bold text-3xl mb-4 border-b-2 border-black pb-2">Key Insights</h3>

                {data.positivePatterns && (
                  <div className="mb-4">
                    <p className="monument text-xs mb-2 text-black">WHAT WORKED</p>
                    <p className="text-lg leading-relaxed">{data.positivePatterns}</p>
                  </div>
                )}

                {data.confusionPoints && (
                  <div className="mb-4">
                    <p className="monument text-xs mb-2 text-orange-600">WHAT WAS FIXED</p>
                    <p className="text-lg leading-relaxed">{data.confusionPoints}</p>
                  </div>
                )}

                {data.strongestDifferentiator && (
                  <div className="mb-4">
                    <p className="monument text-xs mb-2 text-black">STRONGEST DIFFERENTIATOR</p>
                    <p className="text-lg leading-relaxed">{data.strongestDifferentiator}</p>
                  </div>
                )}
              </div>

              {/* Evolution */}
              <div className="mb-10">
                <h3 className="riforma-bold text-3xl mb-4 border-b-2 border-black pb-2">Value Proposition Evolution</h3>

                <div className="mb-4 bg-gray-100 p-4">
                  <p className="monument text-xs mb-2">ORIGINAL (PRE-TESTING)</p>
                  <p className="text-lg">{data.valuePropBeingTested}</p>
                </div>

                {data.refinedValueProp && data.refinedValueProp !== data.finalValueProp && (
                  <div className="mb-4 bg-gray-100 p-4">
                    <p className="monument text-xs mb-2">REFINED (AFTER ROUND 1)</p>
                    <p className="text-lg">{data.refinedValueProp}</p>
                  </div>
                )}

                <div className="bg-yellow-100 border-2 border-black p-4">
                  <p className="monument text-xs mb-2">FINAL (LOCKED IN)</p>
                  <p className="text-lg font-bold">{data.finalValueProp}</p>
                </div>
              </div>

              {/* Rollout Plan */}
              {data.rolloutPlan && (
                <div className="mb-10">
                  <h3 className="riforma-bold text-3xl mb-4 border-b-2 border-black pb-2">Rollout Plan</h3>
                  <p className="text-lg leading-relaxed whitespace-pre-line">{data.rolloutPlan}</p>
                </div>
              )}

              <div className="text-center text-sm text-gray-500 mt-12 pt-6 border-t border-gray-300">
                Generated on {new Date().toLocaleDateString()} • Fast Track Program Sprint 16
              </div>
            </div>

            {/* Action Buttons */}
            <div className="grid grid-cols-3 gap-6 mb-8 no-print">
              <button onClick={onBack} className="btn-secondary text-xl py-6">
                ← EDIT
              </button>
              <button onClick={onExport} className="btn-primary text-xl py-6">
                EXPORT PDF
              </button>
              <button onClick={onSubmit} className="btn-primary text-xl py-6">
                SUBMIT
              </button>
            </div>

            {/* Case Study */}
            <CaseStudy
                before={"A B2B software company launched their new product based on internal assumptions about what customers valued. Marketing emphasized technical features the engineering team was proud of. After six months, conversion rates were below 2% and sales cycles averaged 90 days. The team kept adding more features, convinced the product just needed to be better."}
                after={"Using the VP Testing process, they interviewed 15 target customers across two rounds. Round 1 revealed customers cared about implementation speed, not features. Round 2 validated a refined message focused on '48-hour deployment with zero IT required.' Conversion rates jumped to 11%, sales cycles dropped to 30 days, and 12 of 15 interviewees requested demos on the spot."}
                quote={"We spent a year building features nobody asked for. Two weeks of structured customer interviews told us more than 12 months of guessing. The words our customers used became our new homepage headline — and it outperformed everything we had written internally."}
            />
          </div>
        </div>
      );
    }

    /* HelpModal, ProgressIndicator, HelpButton removed — replaced by WizardSidebar */

    // Render App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TestingApp />);
  </script>
</body>
</html>
