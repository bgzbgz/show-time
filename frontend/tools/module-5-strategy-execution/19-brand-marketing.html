<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand and Marketing | Fast Track Program</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="../../shared/js/tool-db.js"></script>
    <script src="../../shared/js/ai-challenge.js"></script>
    <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

    <style>
        @font-face { font-family: 'Plaak';    src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; }
        @font-face { font-family: 'Riforma';  src: url('RiformaLL-Regular.woff2')   format('woff2'); font-weight: normal; }
        @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Riforma', -apple-system, sans-serif; font-size: 16px; color: #000; background: #000; -webkit-font-smoothing: antialiased; }

        .plaak   { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
        .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }

        /* ── Wizard layout ── */
        .wizard-layout { display: flex; min-height: 100vh; }
        .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; padding: 0 48px; }
        .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }

        /* ── Step content ── */
        .step-content { max-width: 100%; padding: 40px 0; flex: 1; }
        .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #666; margin-bottom: 8px; }
        .opening-box { margin-bottom: 32px; }
        .opening-box .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
        .opening-box .step-hint { font-size: 14px; color: #666; line-height: 1.5; margin: 0; }

        /* ── Fields ── */
        .field-group { margin-bottom: 28px; }
        .field-group:last-child { margin-bottom: 0; }
        .field-label { font-weight: 600; font-size: 15px; color: #000; margin-bottom: 6px; display: block; }
        .field-sub { font-size: 13px; color: #666; margin-bottom: 6px; line-height: 1.5; }
        .field-input { border: 1px solid #E0E0E0; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; width: 100%; color: #000; background: #fff; transition: border-color 0.2s; }
        .field-input:focus { outline: none; border-color: #000; }
        .field-textarea { border: 1px solid #E0E0E0; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; width: 100%; min-height: 100px; resize: none !important; color: #000; background: #fff; transition: border-color 0.2s; }
        .field-textarea:focus { outline: none; border-color: #000; }
        .field-help { font-size: 13px; color: #666; margin-top: 4px; }

        /* ── Split layout (side-by-side paired sections) ── */
        .field-split { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 28px; }

        /* ── Section headings ── */
        .section-head { border-top: 2px solid #000; padding-top: 24px; margin-bottom: 16px; }
        .section-head.light { border-top: 1px solid #E0E0E0; }
        .section-tag { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase; color: #666; margin-bottom: 4px; }
        .section-name { font-family: 'Plaak', sans-serif; font-size: 22px; color: #000; margin-bottom: 4px; }
        .section-desc { font-size: 14px; color: #666; line-height: 1.5; }

        /* ── Sidebar ── */
        .sidebar-tool-num { font-family: 'Monument', monospace; font-size: 10px; color: #fff; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 8px; }
        .sidebar-tool-title { font-family: 'Plaak', sans-serif; font-size: 22px; color: #fff; margin-bottom: 32px; line-height: 1.1; }
        .sidebar-step { padding: 8px 0; border-bottom: 1px solid #2a2a2a; display: flex; align-items: center; gap: 8px; }
        .sidebar-step:last-child { border-bottom: none; }
        .sidebar-step-dot { width: 6px; height: 6px; border-radius: 50%; background: #555; flex-shrink: 0; transition: background 0.2s; }
        .sidebar-step-dot.active { background: #FFF469; }
        .sidebar-step-dot.done   { background: #4ade80; }
        .sidebar-step-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.08em; color: #666; text-transform: uppercase; transition: color 0.2s; }
        .sidebar-step-label.active { color: #FFF469; }
        .sidebar-step-label.done   { color: #4ade80; }

        /* ── Wizard footer ── */
        .wizard-footer { display: flex; justify-content: space-between; align-items: center; padding: 24px 48px; border-top: 1px solid #e5e7eb; background: #fff; }
        .btn-wiz-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 12px 28px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-back:hover { border-color: #000; color: #000; }
        .btn-wiz-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 36px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-wiz-next:hover:not(:disabled) { background: #FFF469; color: #000; border-color: #FFF469; }
        .btn-wiz-next:disabled { background: #E0E0E0; color: #9CA3AF; border-color: #E0E0E0; cursor: not-allowed; }

        /* ── Item navigator (action plan pagination) ── */
        .item-nav { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .item-nav-btn { width: 44px; height: 44px; border: 2px solid #E0E0E0; background: #F0F0F0; font-family: 'Monument', monospace; font-size: 13px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .item-nav-btn.active { background: #000; color: #FFF469; border-color: #000; }
        .item-nav-btn:hover:not(.active) { border-color: #000; }
        .item-nav-btn.add-btn { background: transparent; border: 2px dashed #E0E0E0; color: #999; font-size: 20px; }
        .item-nav-btn.add-btn:hover { border-color: #000; color: #000; }

        /* ── Project rows ── */
        .project-row { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .project-num { font-family: 'Monument', monospace; font-size: 12px; color: #999; min-width: 28px; }

        /* ── Learn more toggle ── */
        .learn-more-toggle { font-family: 'Monument', monospace; font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; color: #000; background: #F5F5F5; border: 1px solid #E0E0E0; cursor: pointer; padding: 10px 14px; display: flex; align-items: center; gap: 8px; margin-bottom: 24px; width: 100%; }
        .learn-more-content { background: #F5F5F5; border: 1px solid #E0E0E0; border-top: none; padding: 16px; font-size: 14px; color: #333; line-height: 1.7; margin-bottom: 24px; }

        /* ── Dep context ── */
        .dep-context { border: 1px solid #E0E0E0; margin-bottom: 24px; }
        .dep-context-header { background: #F5F5F5; padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .dep-context-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.1em; color: #666; text-transform: uppercase; }
        .dep-context-body { padding: 14px 16px; font-size: 14px; color: #333; line-height: 1.6; }

        /* ── Canvas ── */
        .canvas-wrap { background: #fff; min-height: 100vh; padding: 48px 40px; max-width: 960px; margin: 0 auto; }
        .canvas-section { border: 1px solid #E0E0E0; margin-bottom: 24px; }
        .canvas-section-header { background: #000; color: #fff; padding: 16px 24px; }
        .canvas-sheet-tag { font-family: 'Monument', monospace; font-size: 10px; color: #FFF469; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 4px; }
        .canvas-section-title { font-family: 'Plaak', sans-serif; font-size: 22px; color: #fff; }
        .canvas-body { padding: 24px; }
        .canvas-split { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .canvas-field { margin-bottom: 16px; }
        .canvas-field:last-child { margin-bottom: 0; }
        .canvas-field-label { font-family: 'Monument', monospace; font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase; color: #999; margin-bottom: 6px; }
        .canvas-field-value { font-size: 15px; color: #000; line-height: 1.6; white-space: pre-wrap; }
        .canvas-actions { display: flex; gap: 16px; justify-content: center; padding: 24px 0; border-top: 1px solid #E0E0E0; margin-top: 8px; }
        .btn-canvas-submit { background: #000; color: #fff; border: 2px solid #000; padding: 16px 48px; font-family: 'Monument', monospace; font-size: 13px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-canvas-submit:hover { background: #FFF469; color: #000; border-color: #FFF469; }
        .btn-canvas-back { background: transparent; border: 2px solid #d1d5db; color: #6b7280; padding: 16px 32px; font-family: 'Monument', monospace; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .btn-canvas-back:hover { border-color: #000; color: #000; }

        /* ── Mobile ── */
        .mobile-step-bar { display: none; }
        @media (max-width: 768px) {
            .wizard-sidebar { display: none; }
            .wizard-main { padding: 0 24px; }
            .mobile-step-bar { display: flex; align-items: center; gap: 8px; padding: 16px 24px; background: #1a1a1a; }
            .mobile-step-dot { width: 8px; height: 8px; border-radius: 50%; background: #333; transition: background 0.2s; }
            .mobile-step-dot.active { background: #FFF469; }
            .mobile-step-dot.done   { background: #4ade80; }
            .mobile-step-text { font-family: 'Monument', monospace; font-size: 11px; color: #fff; letter-spacing: 0.06em; margin-right: 8px; }
            .wizard-footer { padding: 16px 24px; }
            .field-split { grid-template-columns: 1fr; }
            .canvas-split { grid-template-columns: 1fr; }
            .canvas-wrap { padding: 24px 20px; }
        }

        /* ── Animations ── */
        .animate-in { animation: fadeSlideIn 0.4s ease both; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ── CONFIG ──────────────────────────────────────────────────────────────────
    const CONFIG = {
        TOOL_SLUG:   'brand-marketing',
        TOOL_TITLE:  'BRAND & MARKETING',
        COVER_IMAGE: 'https://images.unsplash.com/photo-1493421419110-74f4e85ba126?w=1600&q=80',
        TOTAL_STEPS: 2,
        TRANSITION_CONTENT: {
            1: {
                brutalTruth: 'Most companies build their external brand before they have earned it internally. Your employer brand is the foundation — if your own people would not recommend working there, no amount of external positioning will fix it. The inside must match the outside.',
                peerProof: '"A €12M B2B services firm spent 6 months redefining their employer brand before launching any external campaign. Employee referrals tripled. Recruitment time halved. Their best marketing turned out to be the culture they built first."'
            },
            2: {
                brutalTruth: 'Brand consistency is not a design preference — it is a trust signal. If your team cannot describe what you stand for in 10 words, your customers cannot either. Inconsistency signals uncertainty, and customers do not trust uncertain suppliers.',
                peerProof: '"A regional professional services firm defined 3 words they wanted to own in the market and drilled them into every proposal, email, and client meeting. Within 6 months, unsolicited referrals increased 40%. The brand did the selling."'
            }
        },
        CLOSING_MESSAGES: {
            1: { title: 'EMPLOYER BRAND DEFINED', text: 'Your employer brand foundation is set. Now build the external brand that earns customer trust.' },
            2: { title: 'BRAND STRATEGY LOCKED', text: 'Your brand personality and strategy is complete. Review your canvas and submit.' }
        }
    };

    ToolDB.init(CONFIG.TOOL_SLUG);
    ToolAccessControl.init(CONFIG.TOOL_SLUG);
    CognitiveLoad.init('brand-marketing', {
        insights: [
            'Brand is not your logo. It is the promise you make and consistently keep.',
            'Marketing without strategy is noise. Brand without personality is forgettable.'
        ],
        caseStudy: {
            before: 'A mid-market B2B services firm spent 15% of revenue on marketing across six channels with no unified brand message. Sales decks contradicted the website, social felt generic, and lead quality was declining despite increased ad spend.',
            after: 'After defining a sharp brand promise rooted in their value proposition and aligning employee and consumer brand messaging, they cut marketing spend by 40% while tripling qualified inbound leads within two quarters.',
            quote: 'We stopped trying to be everything to everyone. Once the brand matched the reality of what we delivered, customers started coming to us instead of us chasing them.'
        }
    });

    // ── Default data ─────────────────────────────────────────────────────────
    const makeDefaultData = () => ({
        // Sheet 1: Employee Brand Personality
        currentPerceptionPluses: '',
        currentPerceptionMinuses: '',
        targetEmployeeProfile: '',
        reasonsToJoin: '',
        employeeBrandPersonality: '',
        brandPromiseEmployee: '',
        wordsToOwnEmployee: '',
        measurementApproach: '',
        top5Projects: ['', '', '', '', ''],
        actionPlan: [{ who: '', what: '', when: '' }],
        // Sheet 2: Brand Personality and Strategy
        coreCustomerProfile: '',
        customerWordsToOwn: '',
        customerBrandPromise: '',
        antiBrandPromise: '',
        brandPersonalityAsAPerson: '',
        whatPeopleLove: '',
        whatPeopleHate: '',
    });

    // ── WizardSidebar ─────────────────────────────────────────────────────────
    function WizardSidebar({ currentStep }) {
        const steps = [
            { num: 1, label: 'Employer Brand' },
            { num: 2, label: 'Customer Brand' },
            { num: 'canvas', label: 'Canvas' },
        ];
        return (
            <div className="wizard-sidebar">
                <div className="sidebar-tool-num">SPRINT 19</div>
                <div className="sidebar-tool-title">{CONFIG.TOOL_TITLE}</div>
                {steps.map(s => {
                    const isCanvas = s.num === 'canvas';
                    const isDone   = isCanvas ? false : (typeof currentStep === 'number' && currentStep > s.num);
                    const isActive = isCanvas ? currentStep === 'canvas' : (typeof currentStep === 'number' && Math.floor(currentStep) === s.num);
                    const isFuture = isCanvas ? currentStep !== 'canvas' && (typeof currentStep !== 'number' || currentStep < 3) : (typeof currentStep === 'number' && currentStep < s.num);
                    return (
                        <div key={s.num} className="sidebar-step" style={{ opacity: isFuture ? 0.45 : 1 }}>
                            <div className={`sidebar-step-dot ${isActive ? 'active' : isDone ? 'done' : ''}`} />
                            <span className={`sidebar-step-label ${isActive ? 'active' : isDone ? 'done' : ''}`}>{s.label}</span>
                        </div>
                    );
                })}
            </div>
        );
    }

    // ── MobileStepBar ─────────────────────────────────────────────────────────
    function MobileStepBar({ currentStep }) {
        const n = typeof currentStep === 'number' ? Math.ceil(currentStep) : 0;
        return (
            <div className="mobile-step-bar">
                <span className="mobile-step-text">STEP {n} OF {CONFIG.TOTAL_STEPS}</span>
                {[1, 2].map(i => {
                    const done   = typeof currentStep === 'number' && currentStep > i;
                    const active = typeof currentStep === 'number' && Math.floor(currentStep) === i;
                    return <div key={i} className={`mobile-step-dot ${active ? 'active' : done ? 'done' : ''}`} />;
                })}
            </div>
        );
    }

    // ── DependencyContext ─────────────────────────────────────────────────────
    function DependencyContext({ deps }) {
        const [open, setOpen] = useState(false);
        if (!deps || deps.length === 0) return null;
        return (
            <div className="dep-context">
                <div className="dep-context-header" onClick={() => setOpen(o => !o)}>
                    <span className="dep-context-label">Context from previous tools ({deps.length})</span>
                    <span style={{ fontSize: 12, color: '#999' }}>{open ? '▲' : '▼'}</span>
                </div>
                {open && (
                    <div className="dep-context-body">
                        {deps.map((dep, i) => (
                            <div key={i} style={{ marginBottom: 8 }}>
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', textTransform: 'uppercase', letterSpacing: '0.08em' }}>{dep.label}: </span>
                                <span>{dep.value}</span>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    }

    // ── LearnMore ─────────────────────────────────────────────────────────────
    function LearnMore({ children }) {
        const [open, setOpen] = useState(false);
        return (
            <>
                <button className="learn-more-toggle" onClick={() => setOpen(o => !o)}>
                    <span>{open ? '▲' : '▼'}</span> {open ? 'Hide context' : 'Why this matters'}
                </button>
                {open && <div className="learn-more-content">{children}</div>}
            </>
        );
    }

    // ── TransitionScreen ──────────────────────────────────────────────────────
    function TransitionScreen({ stepNum, onNext }) {
        const t = CONFIG.TRANSITION_CONTENT[stepNum];
        const c = CONFIG.CLOSING_MESSAGES[stepNum];
        if (!t) { onNext(); return null; }
        return (
            <div style={{ position: 'fixed', inset: 0, background: '#000', color: '#fff', zIndex: 200, overflowY: 'auto', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '64px 32px' }}>
                <div style={{ maxWidth: 720, width: '100%' }} className="animate-in">
                    <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#555', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 32 }}>
                        SPRINT 19 — BRAND &amp; MARKETING
                    </div>
                    {c && (
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#4ade80', letterSpacing: '0.1em', textTransform: 'uppercase', marginBottom: 16 }}>
                            ✓ {c.title}
                        </div>
                    )}
                    <div style={{ borderLeft: '4px solid #DC2626', paddingLeft: 24, marginBottom: 48 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#DC2626', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 12 }}>BRUTAL TRUTH</div>
                        <p className="plaak" style={{ fontSize: 26, lineHeight: 1.35 }}>{t.brutalTruth}</p>
                    </div>
                    <div style={{ borderLeft: '4px solid #FFF469', paddingLeft: 24, marginBottom: 64 }}>
                        <div style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#FFF469', letterSpacing: '0.12em', textTransform: 'uppercase', marginBottom: 12 }}>PEER PROOF</div>
                        <p style={{ fontSize: 18, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic' }}>{t.peerProof}</p>
                    </div>
                    <button onClick={onNext} className="plaak"
                        style={{ background: '#FFF469', color: '#000', border: 'none', padding: '18px 48px', fontSize: 18, cursor: 'pointer', letterSpacing: '0.05em', transition: 'all 0.2s' }}>
                        CONTINUE →
                    </button>
                </div>
            </div>
        );
    }

    // ── Step 1: Employee Brand Personality (Sheet 1) ───────────────────────────
    function Step1({ data, updateData, actionIdx, setActionIdx, deps }) {
        const plan    = data.actionPlan || [{ who: '', what: '', when: '' }];
        const idx     = Math.min(actionIdx, plan.length - 1);
        const current = plan[idx];

        const updateProject = (i, val) => {
            const projects = [...(data.top5Projects || ['', '', '', '', ''])];
            projects[i] = val;
            updateData('top5Projects', projects);
        };

        const updateActionField = (field, val) => {
            updateData('actionPlan', plan.map((a, i) => i === idx ? { ...a, [field]: val } : a));
        };

        const addAction = () => {
            updateData('actionPlan', [...plan, { who: '', what: '', when: '' }]);
            setActionIdx(plan.length);
        };

        const removeAction = () => {
            if (plan.length <= 1) return;
            const updated = plan.filter((_, i) => i !== idx);
            updateData('actionPlan', updated);
            setActionIdx(Math.max(0, idx - 1));
        };

        return (
            <div className="step-content animate-in">
                <DependencyContext deps={deps} />
                <p className="step-indicator">STEP 1 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Employee Brand Personality</h1>
                    <p className="step-hint">Before you build your external brand, define the employer brand that attracts the right people and earns their loyalty from day one.</p>
                </div>
                <LearnMore>
                    Your employer brand is how future employees perceive you as a place to work. Companies with a strong employer brand receive 50% more qualified applicants and significantly reduce recruitment costs. The foundation: understand your current reality honestly, define who you want to attract, and articulate a brand promise your own team can vouch for.
                </LearnMore>

                {/* SECTION 01 — Current Perception */}
                <div className="section-head">
                    <p className="section-tag">SECTION 01</p>
                    <p className="section-name">Current Employer Perception</p>
                    <p className="section-desc">What is the current perception of your company as an employer? Be honest about both sides.</p>
                </div>
                <div className="field-split">
                    <div>
                        <label className="field-label" style={{ color: '#16a34a' }}>+ PLUSES</label>
                        <p className="field-sub">What do current employees love? What is genuinely good about working here?</p>
                        <textarea className="field-textarea" style={{ minHeight: 120 }}
                            value={data.currentPerceptionPluses}
                            onChange={e => updateData('currentPerceptionPluses', e.target.value)}
                            placeholder="e.g. Autonomy and ownership, flat hierarchy, exciting clients, remote flexibility, strong team culture..."
                            maxLength={500} />
                        <p className="field-help">{(data.currentPerceptionPluses || '').length}/500</p>
                    </div>
                    <div>
                        <label className="field-label" style={{ color: '#DC2626' }}>− MINUSES</label>
                        <p className="field-sub">What are the honest weaknesses? What would current or past employees say?</p>
                        <textarea className="field-textarea" style={{ minHeight: 120 }}
                            value={data.currentPerceptionMinuses}
                            onChange={e => updateData('currentPerceptionMinuses', e.target.value)}
                            placeholder="e.g. Unclear career paths, below-market salaries, high workload, limited L&D budget..."
                            maxLength={500} />
                        <p className="field-help">{(data.currentPerceptionMinuses || '').length}/500</p>
                    </div>
                </div>

                {/* SECTION 02 — Target Employee Profile */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 02</p>
                    <p className="section-name">Target Employee Profile</p>
                </div>
                <div className="field-group">
                    <label className="field-label">Who are the people we want to attract?</label>
                    <p className="field-sub">Be specific: seniority, mindset, values, what drives them.</p>
                    <textarea className="field-textarea" style={{ minHeight: 100 }}
                        value={data.targetEmployeeProfile}
                        onChange={e => updateData('targetEmployeeProfile', e.target.value)}
                        placeholder="e.g. Mid-senior B2B sales professionals energised by complex deals, who value autonomy, are results-driven and want to own their territory..."
                        maxLength={600} />
                    <p className="field-help">{(data.targetEmployeeProfile || '').length}/600</p>
                </div>

                {/* SECTION 03 — Reasons to Join */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 03</p>
                    <p className="section-name">Employee Value Proposition</p>
                </div>
                <div className="field-group">
                    <label className="field-label">Why should they come and work for us?</label>
                    <p className="field-sub">List the real, specific reasons — not generic HR speak. What makes you genuinely different as an employer?</p>
                    <textarea className="field-textarea" style={{ minHeight: 130 }}
                        value={data.reasonsToJoin}
                        onChange={e => updateData('reasonsToJoin', e.target.value)}
                        placeholder="e.g. You'll own a full region from day one. Uncapped commission with transparent structure. Weekly leadership coaching. Real equity path for top performers. Direct access to founders..."
                        maxLength={800} />
                    <p className="field-help">{(data.reasonsToJoin || '').length}/800</p>
                </div>

                {/* SECTION 04+05 — Brand Personality + Brand Promise */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 04 + 05</p>
                    <p className="section-name">Employer Brand Personality &amp; Promise</p>
                </div>
                <div className="field-split">
                    <div>
                        <label className="field-label">Employee Brand Personality</label>
                        <p className="field-sub">If your company were a person, who would it be as an employer?</p>
                        <textarea className="field-textarea" style={{ minHeight: 110 }}
                            value={data.employeeBrandPersonality}
                            onChange={e => updateData('employeeBrandPersonality', e.target.value)}
                            placeholder="e.g. The demanding but fair mentor. High expectations, genuine support. Celebrates performance, tolerates no politics."
                            maxLength={300} />
                        <p className="field-help">{(data.employeeBrandPersonality || '').length}/300</p>
                    </div>
                    <div>
                        <label className="field-label">Brand Promise to Employees</label>
                        <p className="field-sub">What do you commit to delivering for the people who join? One clear, specific promise.</p>
                        <textarea className="field-textarea" style={{ minHeight: 110 }}
                            value={data.brandPromiseEmployee}
                            onChange={e => updateData('brandPromiseEmployee', e.target.value)}
                            placeholder="e.g. We will give you the freedom and tools to become the best version of your professional self — or the courage to leave if we are not the right fit."
                            maxLength={300} />
                        <p className="field-help">{(data.brandPromiseEmployee || '').length}/300</p>
                    </div>
                </div>

                {/* SECTION 06+07 — Words to Own + Measurement */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 06 + 07</p>
                    <p className="section-name">Words We Own &amp; Measurement</p>
                </div>
                <div className="field-split">
                    <div>
                        <label className="field-label">Words We Own (in candidates' minds)</label>
                        <p className="field-sub">3–5 words future employees associate with your company as a workplace.</p>
                        <textarea className="field-textarea" style={{ minHeight: 100 }}
                            value={data.wordsToOwnEmployee}
                            onChange={e => updateData('wordsToOwnEmployee', e.target.value)}
                            placeholder="e.g. Growth. Ownership. Transparency. Speed. Ambition."
                            maxLength={300} />
                        <p className="field-help">{(data.wordsToOwnEmployee || '').length}/300</p>
                    </div>
                    <div>
                        <label className="field-label">How Will We Measure This?</label>
                        <p className="field-sub">How will you track employer brand health? (e.g. eNPS, Glassdoor rating, referral rate)</p>
                        <textarea className="field-textarea" style={{ minHeight: 100 }}
                            value={data.measurementApproach}
                            onChange={e => updateData('measurementApproach', e.target.value)}
                            placeholder="e.g. eNPS quarterly (target: +30). Glassdoor rating (target: 4.2+). % new hires from employee referrals (target: 40%)."
                            maxLength={300} />
                        <p className="field-help">{(data.measurementApproach || '').length}/300</p>
                    </div>
                </div>

                {/* SECTION 08 — Top 5 Projects */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 08</p>
                    <p className="section-name">Top 5 Employer Brand Projects</p>
                    <p className="section-desc">The 5 initiatives you will undertake in the next 12 months to build your employer brand.</p>
                </div>
                <div style={{ marginBottom: 28 }}>
                    {(data.top5Projects || ['', '', '', '', '']).map((proj, i) => (
                        <div key={i} className="project-row">
                            <span className="project-num">{String(i + 1).padStart(2, '0')}</span>
                            <input className="field-input"
                                value={proj}
                                onChange={e => updateProject(i, e.target.value)}
                                placeholder={`Project ${i + 1} — e.g. Launch Glassdoor profile with 10 genuine reviews`}
                                maxLength={200} />
                        </div>
                    ))}
                </div>

                {/* ACTION PLAN */}
                <div className="section-head light">
                    <p className="section-tag">ACTION PLAN</p>
                    <p className="section-name">Who Does What by When</p>
                    <p className="section-desc">Assign accountability for each employer brand action.</p>
                </div>
                <div className="item-nav">
                    {plan.map((_, i) => (
                        <button key={i} className={`item-nav-btn ${i === idx ? 'active' : ''}`} onClick={() => setActionIdx(i)}>
                            {i + 1}
                        </button>
                    ))}
                    <button className="item-nav-btn add-btn" onClick={addAction} title="Add action">+</button>
                </div>
                {current && (
                    <div>
                        <div className="field-group">
                            <label className="field-label">WHO</label>
                            <input className="field-input" value={current.who}
                                onChange={e => updateActionField('who', e.target.value)}
                                placeholder="Name or role responsible" maxLength={100} />
                        </div>
                        <div className="field-group">
                            <label className="field-label">WHAT</label>
                            <textarea className="field-textarea" value={current.what}
                                onChange={e => updateActionField('what', e.target.value)}
                                placeholder="Specific action to be taken" maxLength={300} />
                        </div>
                        <div className="field-group">
                            <label className="field-label">WHEN</label>
                            <input className="field-input" value={current.when}
                                onChange={e => updateActionField('when', e.target.value)}
                                placeholder="Deadline (e.g. Q2 2026, end of March)" maxLength={100} />
                        </div>
                        {plan.length > 1 && (
                            <button onClick={removeAction} style={{ background: 'none', border: 'none', color: '#DC2626', fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.05em', cursor: 'pointer', padding: '4px 0' }}>
                                REMOVE THIS ACTION
                            </button>
                        )}
                    </div>
                )}
            </div>
        );
    }

    // ── Step 2: Brand Personality and Strategy (Sheet 2) ──────────────────────
    function Step2({ data, updateData }) {
        return (
            <div className="step-content animate-in">
                <p className="step-indicator">STEP 2 OF {CONFIG.TOTAL_STEPS}</p>
                <div className="opening-box">
                    <h1 className="step-heading">Brand Personality and Strategy</h1>
                    <p className="step-hint">Define the external brand identity — the words, promise, and personality your company owns in the mind of its core customer.</p>
                </div>
                <LearnMore>
                    Your external brand is how your customers and market perceive you. The most powerful brands own 2–3 words in their customers' minds. They have a clear brand promise (what they deliver) and an anti brand promise (what they will never be). They describe themselves as a person — because humans connect with personalities, not feature lists.
                </LearnMore>

                {/* SECTION 01 — Core Customer Reminder */}
                <div className="section-head">
                    <p className="section-tag">SECTION 01</p>
                    <p className="section-name">Core Customer Reminder</p>
                    <p className="section-desc">Who are we building this brand for? This anchors every brand decision that follows.</p>
                </div>
                <div className="field-group">
                    <label className="field-label">Core Customer Profile</label>
                    <p className="field-sub">Reference your target segment from Sprint 13–14. Who specifically is this brand built for?</p>
                    <textarea className="field-textarea" style={{ minHeight: 100 }}
                        value={data.coreCustomerProfile}
                        onChange={e => updateData('coreCustomerProfile', e.target.value)}
                        placeholder="e.g. CEOs and Managing Directors of B2B services firms with 20–150 employees, €5M–€30M revenue, frustrated by inconsistent performance and wanting strategic clarity."
                        maxLength={600} />
                    <p className="field-help">{(data.coreCustomerProfile || '').length}/600</p>
                </div>

                {/* SECTION 02 — Words to Own */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 02</p>
                    <p className="section-name">Words We Want to Own</p>
                </div>
                <div className="field-group">
                    <label className="field-label">Words to own in the customer's mind</label>
                    <p className="field-sub">3–5 words or short phrases. When customers think of you, these are the words that come to mind first.</p>
                    <textarea className="field-textarea" style={{ minHeight: 90 }}
                        value={data.customerWordsToOwn}
                        onChange={e => updateData('customerWordsToOwn', e.target.value)}
                        placeholder="e.g. Clarity. Speed. Accountability. Results. No-nonsense."
                        maxLength={300} />
                    <p className="field-help">{(data.customerWordsToOwn || '').length}/300</p>
                </div>

                {/* SECTION 03+04 — Brand Promise + Anti Brand Promise */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 03 + 04</p>
                    <p className="section-name">Brand Promise &amp; Anti Brand Promise</p>
                </div>
                <div className="field-split">
                    <div>
                        <label className="field-label">Brand Promise</label>
                        <p className="field-sub">The core promise you make to your customers. One clear, specific commitment.</p>
                        <textarea className="field-textarea" style={{ minHeight: 130 }}
                            value={data.customerBrandPromise}
                            onChange={e => updateData('customerBrandPromise', e.target.value)}
                            placeholder="e.g. We help mid-market CEOs build organisations that perform without them — a team that executes, a strategy that is clear, a business that no longer depends on you being everywhere."
                            maxLength={400} />
                        <p className="field-help">{(data.customerBrandPromise || '').length}/400</p>
                    </div>
                    <div>
                        <label className="field-label" style={{ color: '#DC2626' }}>Anti Brand Promise</label>
                        <p className="field-sub">What will you NEVER be? What do you stand against? The opposite of your brand.</p>
                        <textarea className="field-textarea" style={{ minHeight: 130 }}
                            value={data.antiBrandPromise}
                            onChange={e => updateData('antiBrandPromise', e.target.value)}
                            placeholder="e.g. We will never be consultants who write a beautiful report and disappear. We are anti-vague, anti-theory, anti-complexity. No frameworks without execution."
                            maxLength={400} />
                        <p className="field-help">{(data.antiBrandPromise || '').length}/400</p>
                    </div>
                </div>

                {/* SECTION 05 — Brand Personality */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 05</p>
                    <p className="section-name">Brand Personality</p>
                </div>
                <div className="field-group">
                    <label className="field-label">If your company were a person, who would it be?</label>
                    <p className="field-sub">Describe them — their personality, how they speak, what they wear, what they value. Be specific and visual.</p>
                    <textarea className="field-textarea" style={{ minHeight: 130 }}
                        value={data.brandPersonalityAsAPerson}
                        onChange={e => updateData('brandPersonalityAsAPerson', e.target.value)}
                        placeholder="e.g. A 45-year-old ex-McKinsey partner who left to build something real. Speaks in plain English. Intolerant of bullshit. Dresses well but not flashy. Has done it themselves. Gives hard feedback with genuine respect."
                        maxLength={600} />
                    <p className="field-help">{(data.brandPersonalityAsAPerson || '').length}/600</p>
                </div>

                {/* SECTION 05+06 — Love + Hate */}
                <div className="section-head light">
                    <p className="section-tag">SECTION 05 + 06</p>
                    <p className="section-name">Love &amp; Hate</p>
                    <p className="section-desc">The strongest brands are polarising. They attract the right customers fiercely and repel the wrong ones cleanly.</p>
                </div>
                <div className="field-split">
                    <div>
                        <label className="field-label" style={{ color: '#16a34a' }}>What people will LOVE about us</label>
                        <p className="field-sub">What will your ideal customers love, respect, and tell others about?</p>
                        <textarea className="field-textarea" style={{ minHeight: 130 }}
                            value={data.whatPeopleLove}
                            onChange={e => updateData('whatPeopleLove', e.target.value)}
                            placeholder="e.g. Our directness. The fact that we push back. That we have opinions and are not afraid to use them. Every engagement ends with a clear plan and an accountable team."
                            maxLength={400} />
                        <p className="field-help">{(data.whatPeopleLove || '').length}/400</p>
                    </div>
                    <div>
                        <label className="field-label" style={{ color: '#DC2626' }}>What people will HATE (and that's ok)</label>
                        <p className="field-sub">What will the wrong customers dislike? This is your brand filter — it protects you from the wrong clients.</p>
                        <textarea className="field-textarea" style={{ minHeight: 130 }}
                            value={data.whatPeopleHate}
                            onChange={e => updateData('whatPeopleHate', e.target.value)}
                            placeholder="e.g. We don't do 'nice' reports. We don't validate poor strategies. We are expensive. We have zero interest in companies that want comfort over results."
                            maxLength={400} />
                        <p className="field-help">{(data.whatPeopleHate || '').length}/400</p>
                    </div>
                </div>
            </div>
        );
    }

    // ── Canvas Step ────────────────────────────────────────────────────────────
    function CanvasStep({ data, onBack, onSubmit, submitStatus, submitMessage }) {
        const projects = (data.top5Projects || []).filter(p => p.trim());
        const actions  = (data.actionPlan || []).filter(a => a.who || a.what || a.when);
        return (
            <div style={{ background: '#fff', minHeight: '100vh' }}>
                <div className="canvas-wrap">
                    <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, letterSpacing: '0.1em', textTransform: 'uppercase', color: '#999', marginBottom: 8 }}>SPRINT 19</p>
                    <h1 className="plaak" style={{ fontSize: 40, marginBottom: 6 }}>BRAND &amp; MARKETING CANVAS</h1>
                    <p style={{ fontSize: 14, color: '#666', marginBottom: 40 }}>Your complete brand strategy — employer facing and customer facing.</p>

                    {/* Sheet 1: Employee Brand Personality */}
                    <div className="canvas-section">
                        <div className="canvas-section-header">
                            <p className="canvas-sheet-tag">SHEET 1</p>
                            <div className="canvas-section-title">Employee Brand Personality</div>
                        </div>
                        <div className="canvas-body">
                            <div className="canvas-split">
                                <div className="canvas-field">
                                    <div className="canvas-field-label">+ Current Perception (Pluses)</div>
                                    <div className="canvas-field-value">{data.currentPerceptionPluses || '—'}</div>
                                </div>
                                <div className="canvas-field">
                                    <div className="canvas-field-label">− Current Perception (Minuses)</div>
                                    <div className="canvas-field-value">{data.currentPerceptionMinuses || '—'}</div>
                                </div>
                            </div>
                            <div className="canvas-field">
                                <div className="canvas-field-label">Target Employee Profile</div>
                                <div className="canvas-field-value">{data.targetEmployeeProfile || '—'}</div>
                            </div>
                            <div className="canvas-field">
                                <div className="canvas-field-label">Reasons to Join (EVP)</div>
                                <div className="canvas-field-value">{data.reasonsToJoin || '—'}</div>
                            </div>
                            <div className="canvas-split">
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Employee Brand Personality</div>
                                    <div className="canvas-field-value">{data.employeeBrandPersonality || '—'}</div>
                                </div>
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Brand Promise to Employees</div>
                                    <div className="canvas-field-value">{data.brandPromiseEmployee || '—'}</div>
                                </div>
                            </div>
                            <div className="canvas-split">
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Words We Own (Employer)</div>
                                    <div className="canvas-field-value">{data.wordsToOwnEmployee || '—'}</div>
                                </div>
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Measurement</div>
                                    <div className="canvas-field-value">{data.measurementApproach || '—'}</div>
                                </div>
                            </div>
                            {projects.length > 0 && (
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Top 5 Brand Projects</div>
                                    {projects.map((p, i) => (
                                        <div key={i} style={{ display: 'flex', gap: 10, marginBottom: 4 }}>
                                            <span style={{ fontFamily: "'Monument', monospace", fontSize: 11, color: '#999', minWidth: 24 }}>{i + 1}.</span>
                                            <span style={{ fontSize: 15 }}>{p}</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                            {actions.length > 0 && (
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Action Plan</div>
                                    {actions.map((a, i) => (
                                        <div key={i} style={{ border: '1px solid #E0E0E0', padding: '12px 16px', marginBottom: 8 }}>
                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr 1fr', gap: 16, fontSize: 14 }}>
                                                <div><span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', display: 'block', marginBottom: 4 }}>WHO</span>{a.who || '—'}</div>
                                                <div><span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', display: 'block', marginBottom: 4 }}>WHAT</span>{a.what || '—'}</div>
                                                <div><span style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#999', display: 'block', marginBottom: 4 }}>WHEN</span>{a.when || '—'}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Sheet 2: Brand Personality and Strategy */}
                    <div className="canvas-section">
                        <div className="canvas-section-header">
                            <p className="canvas-sheet-tag">SHEET 2</p>
                            <div className="canvas-section-title">Brand Personality and Strategy</div>
                        </div>
                        <div className="canvas-body">
                            <div className="canvas-field">
                                <div className="canvas-field-label">Core Customer Profile</div>
                                <div className="canvas-field-value">{data.coreCustomerProfile || '—'}</div>
                            </div>
                            <div className="canvas-field">
                                <div className="canvas-field-label">Words to Own (Customer)</div>
                                <div className="canvas-field-value">{data.customerWordsToOwn || '—'}</div>
                            </div>
                            <div className="canvas-split">
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Brand Promise</div>
                                    <div className="canvas-field-value">{data.customerBrandPromise || '—'}</div>
                                </div>
                                <div className="canvas-field">
                                    <div className="canvas-field-label">Anti Brand Promise</div>
                                    <div className="canvas-field-value">{data.antiBrandPromise || '—'}</div>
                                </div>
                            </div>
                            <div className="canvas-field">
                                <div className="canvas-field-label">Brand Personality (as a person)</div>
                                <div className="canvas-field-value">{data.brandPersonalityAsAPerson || '—'}</div>
                            </div>
                            <div className="canvas-split">
                                <div className="canvas-field">
                                    <div className="canvas-field-label">What People Will LOVE</div>
                                    <div className="canvas-field-value">{data.whatPeopleLove || '—'}</div>
                                </div>
                                <div className="canvas-field">
                                    <div className="canvas-field-label">What People Will HATE (and that's ok)</div>
                                    <div className="canvas-field-value">{data.whatPeopleHate || '—'}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Actions */}
                    <div className="canvas-actions">
                        <button className="btn-canvas-back" onClick={onBack}>← BACK</button>
                        {submitStatus === 'success' ? (
                            <div style={{ color: '#16a34a', fontFamily: "'Monument', monospace", fontSize: 13, display: 'flex', alignItems: 'center', gap: 8 }}>
                                ✓ {submitMessage || 'Submitted successfully!'}
                            </div>
                        ) : submitStatus === 'error' ? (
                            <div style={{ color: '#DC2626', fontSize: 14 }}>{submitMessage}</div>
                        ) : (
                            <button className="btn-canvas-submit" onClick={onSubmit}>SUBMIT BRAND STRATEGY →</button>
                        )}
                    </div>
                </div>
            </div>
        );
    }

    // ── Cover Page ────────────────────────────────────────────────────────────
    function CoverPage({ onStart }) {
        return (
            <div style={{ position: 'relative', minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#000' }}>
                <div style={{
                    position: 'absolute', inset: 0,
                    backgroundImage: `url("${CONFIG.COVER_IMAGE}")`,
                    backgroundSize: 'cover', backgroundPosition: 'center',
                    opacity: 0.35
                }} />
                <div style={{ position: 'relative', zIndex: 10, textAlign: 'center', color: '#fff', padding: '64px 32px', maxWidth: 800, margin: '0 auto' }}>
                    <p style={{ fontFamily: "'Monument', monospace", fontSize: 11, letterSpacing: '0.2em', textTransform: 'uppercase', color: '#FFF469', marginBottom: 24 }}>SPRINT 19</p>
                    <h1 className="plaak animate-in" style={{ fontSize: 80, lineHeight: 1, marginBottom: 8, color: '#fff' }}>BRAND AND</h1>
                    <h2 className="plaak animate-in" style={{ fontSize: 80, lineHeight: 1, marginBottom: 32, color: '#FFF469' }}>MARKETING</h2>
                    <p style={{ fontSize: 18, color: 'rgba(255,255,255,0.7)', marginBottom: 48, lineHeight: 1.6 }}>
                        Build the employer brand that attracts the right people.<br />
                        Build the customer brand that earns trust and drives growth.
                    </p>
                    <button onClick={onStart} className="plaak"
                        style={{ background: '#FFF469', color: '#000', border: 'none', padding: '20px 64px', fontSize: 22, cursor: 'pointer', letterSpacing: '0.05em', transition: 'all 0.2s' }}>
                        START
                    </button>
                </div>
            </div>
        );
    }

    // ── Intro Page ────────────────────────────────────────────────────────────
    function IntroPage({ onNext }) {
        return (
            <div style={{ background: '#000', minHeight: '100vh', padding: '64px 48px', color: '#fff' }}>
                <div style={{ maxWidth: 800, margin: '0 auto' }}>
                    <h1 className="plaak animate-in" style={{ fontSize: 64, marginBottom: 48 }}>BEFORE WE START</h1>

                    <div style={{ background: '#111', border: '1px solid #222', padding: '32px', marginBottom: 32 }}>
                        <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, letterSpacing: '0.1em', textTransform: 'uppercase', color: '#FFF469', marginBottom: 12 }}>SPRINT INFO</p>
                        <p style={{ fontFamily: "'Plaak', sans-serif", fontSize: 24, marginBottom: 12 }}>Sprint 19: Brand and Marketing</p>
                        <p style={{ fontSize: 16, color: '#ccc', lineHeight: 1.7 }}>
                            Your brand is not your logo. It is the feeling people get when they think of you — as an employer and as a supplier. Strong brands outperform the market by 206%. This sprint builds both: the employer brand that attracts the right talent, and the customer brand that earns trust and drives growth.
                        </p>
                    </div>

                    <div style={{ marginBottom: 32 }}>
                        <p className="plaak" style={{ fontSize: 28, marginBottom: 16 }}>PURPOSE</p>
                        <div style={{ borderLeft: '4px solid #FFF469', paddingLeft: 24, marginBottom: 16 }}>
                            <p style={{ fontSize: 20, fontStyle: 'italic', color: '#ccc', lineHeight: 1.6 }}>
                                "If people believe they share values with a company, they will stay loyal to the brand."
                            </p>
                            <p style={{ fontFamily: "'Monument', monospace", fontSize: 10, color: '#555', marginTop: 8, letterSpacing: '0.1em' }}>— HOWARD SCHULTZ</p>
                        </div>
                        <p style={{ fontSize: 16, color: '#ccc', lineHeight: 1.7 }}>
                            This sprint forces clarity on who you are for — as an employer and as a market player. Define the words you want to own, the promise you make, and the personality that makes you memorable. When you nail your brand, the right people find you, trust you, and stay.
                        </p>
                    </div>

                    <div style={{ marginBottom: 32 }}>
                        <p className="plaak" style={{ fontSize: 28, color: '#FFF469', marginBottom: 16 }}>MISTAKES TO AVOID</p>
                        {[
                            ['Building external brand before internal brand', 'Your team must believe it before your market will.'],
                            ['Generic brand promises', '"We deliver quality service" is not a promise — it is a cliché.'],
                            ['Inconsistent messaging', 'Brand trust collapses when employee experience contradicts the customer promise.'],
                            ['Trying to appeal to everyone', 'A brand for everyone is a brand for no one. Choose who you are for.'],
                            ['No measurement', 'If you cannot measure employer brand, you cannot improve it. Set KPIs.']
                        ].map(([title, text], i) => (
                            <div key={i} style={{ display: 'flex', gap: 16, marginBottom: 16 }}>
                                <span style={{ fontFamily: "'Monument', monospace", fontSize: 13, color: '#FFF469', minWidth: 28, marginTop: 2 }}>{String(i + 1).padStart(2, '0')}</span>
                                <div>
                                    <p style={{ fontWeight: 600, marginBottom: 4 }}>{title}</p>
                                    <p style={{ fontSize: 14, color: '#777' }}>{text}</p>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div style={{ marginBottom: 48 }}>
                        <p className="plaak" style={{ fontSize: 28, marginBottom: 24 }}>THE JOURNEY</p>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>
                            {[
                                ['01', 'EMPLOYER BRAND', 'Perception · EVP · Personality · Promise · Words to Own · Projects'],
                                ['02', 'CUSTOMER BRAND', 'Core Customer · Words · Promise · Anti Promise · Personality · Love & Hate']
                            ].map(([num, title, desc]) => (
                                <div key={num} style={{ border: '1px solid #333', padding: '28px 24px' }}>
                                    <p className="plaak" style={{ fontSize: 44, color: '#FFF469', marginBottom: 8 }}>{num}</p>
                                    <p style={{ fontWeight: 600, fontSize: 16, marginBottom: 8 }}>{title}</p>
                                    <p style={{ fontSize: 13, color: '#777', lineHeight: 1.5 }}>{desc}</p>
                                </div>
                            ))}
                        </div>
                    </div>

                    <button onClick={onNext} className="plaak"
                        style={{ background: '#FFF469', color: '#000', border: 'none', padding: '18px 64px', fontSize: 20, cursor: 'pointer', letterSpacing: '0.05em', width: '100%', transition: 'all 0.2s' }}>
                        LET'S START →
                    </button>
                </div>
            </div>
        );
    }

    // ── Main App ──────────────────────────────────────────────────────────────
    function BrandApp() {
        const [step, setStep]               = useState(0);
        const [deps, setDeps]               = useState([]);
        const [data, setData]               = useState(makeDefaultData());
        const [actionIdx, setActionIdx]     = useState(0);
        const [aiReviewing, setAiReviewing] = useState(false);
        const [submitStatus, setSubmitStatus]   = useState(null);
        const [submitMessage, setSubmitMessage] = useState('');
        const savedRef = useRef(false);

        // Load dependencies
        useEffect(() => {
            async function loadDeps() {
                const userId = localStorage.getItem('ft_user_id');
                if (!userId || !window.ToolDB || !window.DependencyInjection) return;
                try {
                    await ToolDB.whenReady();
                    const config = DependencyInjection.getDependenciesConfig();
                    const toolConfig = config[CONFIG.TOOL_SLUG];
                    if (!toolConfig || !toolConfig.fields) return;
                    const loaded = [];
                    for (const field of toolConfig.fields) {
                        const val = await ToolDB.getDependency(userId, field.source_field);
                        if (val) {
                            loaded.push({
                                label: field.display_label || field.source_field,
                                value: window.DependencyInjection ? DependencyInjection.formatValue(val) : String(val)
                            });
                        }
                    }
                    setDeps(loaded);
                } catch (err) {
                    console.warn('[brand-marketing] Failed to load dependencies:', err);
                }
            }
            loadDeps();
        }, []);

        // Load from DB
        useEffect(() => {
            async function loadData() {
                const userId = localStorage.getItem('ft_user_id');
                if (!userId || !window.ToolDB) return;
                try {
                    await ToolDB.whenReady();
                    const saved = await ToolDB.load(userId, CONFIG.TOOL_SLUG);
                    if (saved) setData(d => ({ ...makeDefaultData(), ...saved }));
                } catch (err) {
                    console.warn('[brand-marketing] Load error:', err);
                }
            }
            loadData();
        }, []);

        // Autosave
        useEffect(() => {
            if (!savedRef.current) { savedRef.current = true; return; }
            const t = setTimeout(async () => {
                const userId = localStorage.getItem('ft_user_id');
                if (!userId || !window.ToolDB) return;
                try { await ToolDB.save(userId, CONFIG.TOOL_SLUG, data); } catch {}
            }, 2000);
            return () => clearTimeout(t);
        }, [data]);

        const updateData = (field, value) => setData(d => ({ ...d, [field]: value }));

        // Validation
        const isStep1Valid = () => {
            const d = data;
            return (d.currentPerceptionPluses || '').length >= 20
                && (d.currentPerceptionMinuses || '').length >= 20
                && (d.targetEmployeeProfile || '').length >= 30
                && (d.reasonsToJoin || '').length >= 30
                && (d.employeeBrandPersonality || '').length >= 15
                && (d.brandPromiseEmployee || '').length >= 15
                && (d.wordsToOwnEmployee || '').length >= 10
                && (d.measurementApproach || '').length >= 10;
        };

        const isStep2Valid = () => {
            const d = data;
            return (d.coreCustomerProfile || '').length >= 30
                && (d.customerWordsToOwn || '').length >= 10
                && (d.customerBrandPromise || '').length >= 30
                && (d.antiBrandPromise || '').length >= 20
                && (d.brandPersonalityAsAPerson || '').length >= 30
                && (d.whatPeopleLove || '').length >= 20
                && (d.whatPeopleHate || '').length >= 20;
        };

        const handleNext = async (fromStep) => {
            const userId = localStorage.getItem('ft_user_id');
            if (!userId) { alert('User not authenticated.'); return; }
            setAiReviewing(true);
            let canProceed = false;
            try {
                let stepAnswers = {};
                let stepName = '';
                if (fromStep === 1) {
                    stepName = 'Employee Brand Personality';
                    stepAnswers = {
                        currentPerceptionPluses: data.currentPerceptionPluses,
                        currentPerceptionMinuses: data.currentPerceptionMinuses,
                        targetEmployeeProfile: data.targetEmployeeProfile,
                        reasonsToJoin: data.reasonsToJoin,
                        employeeBrandPersonality: data.employeeBrandPersonality,
                        brandPromiseEmployee: data.brandPromiseEmployee,
                        wordsToOwnEmployee: data.wordsToOwnEmployee,
                        measurementApproach: data.measurementApproach,
                    };
                } else if (fromStep === 2) {
                    stepName = 'Brand Personality and Strategy';
                    stepAnswers = {
                        coreCustomerProfile: data.coreCustomerProfile,
                        customerWordsToOwn: data.customerWordsToOwn,
                        customerBrandPromise: data.customerBrandPromise,
                        antiBrandPromise: data.antiBrandPromise,
                        brandPersonalityAsAPerson: data.brandPersonalityAsAPerson,
                        whatPeopleLove: data.whatPeopleLove,
                        whatPeopleHate: data.whatPeopleHate,
                    };
                }
                canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
            } catch {
                canProceed = true;
            } finally {
                setAiReviewing(false);
            }
            if (canProceed) setStep(fromStep + 0.5);
        };

        const goBack = () => {
            if (step === 'canvas') setStep(2);
            else if (step === 2) setStep(1);
            else if (step === 1) setStep(0.5);
            else if (step === 0.5) setStep(0);
        };

        const handleSubmit = async () => {
            const userId = localStorage.getItem('ft_user_id');
            if (!userId) { alert('User not authenticated.'); return; }
            const questionMappings = {
                employee_brand_personality: {
                    currentPerceptionPluses: data.currentPerceptionPluses,
                    currentPerceptionMinuses: data.currentPerceptionMinuses,
                    targetEmployeeProfile: data.targetEmployeeProfile,
                    reasonsToJoin: data.reasonsToJoin,
                    employeeBrandPersonality: data.employeeBrandPersonality,
                    brandPromiseEmployee: data.brandPromiseEmployee,
                    wordsToOwnEmployee: data.wordsToOwnEmployee,
                    measurementApproach: data.measurementApproach,
                    top5Projects: data.top5Projects,
                    actionPlan: data.actionPlan,
                },
                brand_personality_strategy: {
                    coreCustomerProfile: data.coreCustomerProfile,
                    customerWordsToOwn: data.customerWordsToOwn,
                    customerBrandPromise: data.customerBrandPromise,
                    antiBrandPromise: data.antiBrandPromise,
                    brandPersonalityAsAPerson: data.brandPersonalityAsAPerson,
                    whatPeopleLove: data.whatPeopleLove,
                    whatPeopleHate: data.whatPeopleHate,
                }
            };
            await window.AIChallenge.submitWithChallenge(userId, CONFIG.TOOL_SLUG, questionMappings, {
                onReviewStart: () => setSubmitMessage('AI coach is reviewing...'),
                onRevise: () => { setSubmitStatus(null); setSubmitMessage(''); setStep(2); },
                onSubmitAnyway: () => { setSubmitStatus('success'); setSubmitMessage('Brand strategy saved successfully!'); },
                onError: (err) => { setSubmitStatus('error'); setSubmitMessage('Failed to save: ' + err.message); }
            });
        };

        // Transitions (must be before wizard render guard)
        if (step === 1.5) return <TransitionScreen stepNum={1} onNext={() => setStep(2)} />;
        if (step === 2.5) return <TransitionScreen stepNum={2} onNext={() => setStep('canvas')} />;

        // Cover
        if (step === 0) return <CoverPage onStart={() => setStep(0.5)} />;

        // Intro
        if (step === 0.5) return <IntroPage onNext={() => setStep(1)} />;

        // Canvas
        if (step === 'canvas') {
            return (
                <CanvasStep
                    data={data}
                    onBack={goBack}
                    onSubmit={handleSubmit}
                    submitStatus={submitStatus}
                    submitMessage={submitMessage}
                />
            );
        }

        // Wizard steps 1–2
        if (step >= 1 && step <= CONFIG.TOTAL_STEPS && Number.isInteger(step)) {
            const isValid  = step === 1 ? isStep1Valid() : isStep2Valid();
            const nextLabel = step === 1 ? 'NEXT: CUSTOMER BRAND →' : 'VIEW CANVAS →';
            return (
                <div className="wizard-layout">
                    <WizardSidebar currentStep={step} />
                    <div className="wizard-main">
                        <MobileStepBar currentStep={step} />
                        {step === 1 && (
                            <Step1
                                data={data}
                                updateData={updateData}
                                actionIdx={actionIdx}
                                setActionIdx={setActionIdx}
                                deps={deps}
                            />
                        )}
                        {step === 2 && <Step2 data={data} updateData={updateData} />}
                        <div className="wizard-footer">
                            <button className="btn-wiz-back" onClick={goBack}>← BACK</button>
                            <button className="btn-wiz-next" disabled={!isValid || aiReviewing} onClick={() => handleNext(step)}>
                                {aiReviewing ? 'AI COACH REVIEWING...' : nextLabel}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        return null;
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BrandApp />);
</script>
</body>
</html>
