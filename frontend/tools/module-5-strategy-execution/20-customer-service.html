<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Service Strategy | Fast Track Program</title>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../shared/js/tool-db.js"></script>
  <script src="../../shared/js/ai-challenge.js"></script>
  <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../shared/js/transition-screen.js"></script>
    <script src="../../js/tool-access-control.js"></script>

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    /* Font Face Declarations */
    @font-face {
      font-family: 'Plaak';
      src: url('Plaak3Trial-43-Bold.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
    }

    @font-face {
      font-family: 'Riforma';
      src: url('RiformaLL-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Monument';
      src: url('MonumentGrotesk-Mono.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Riforma', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .plaak {
      font-family: 'Plaak', sans-serif;
      text-transform: uppercase;
      font-weight: bold;
      letter-spacing: -0.02em;
    }

    .riforma-bold {
      font-family: 'Riforma', sans-serif;
      font-weight: bold;
    }

    .monument {
      font-family: 'Monument', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }

    .transition-animate-in {
      animation: slideIn 0.6s ease-out;
    }

    /* Button Styles */
    .btn-primary {
      background: #000000;
      color: #FFFFFF;
      padding: 16px 32px;
      border: 2px solid #000000;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: normal;
    }

    .btn-primary:hover:not(:disabled) {
      transform: scale(1.02);
    }

    .btn-primary:disabled {
      background: #E0E0E0;
      border-color: #E0E0E0;
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #FFFFFF;
      color: #000000;
      padding: 12px 24px;
      border: 2px solid #000000;
      font-size: 16px;
      font-family: 'Riforma', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: #F8F8F8;
    }

    /* Form Styles */
    input[type="text"],
    input[type="number"],
    input[type="email"],
    textarea,
    select {
      border: 1px solid #E0E0E0;
      padding: 12px 16px;
      font-size: 18px;
      font-family: 'Riforma', sans-serif;
      width: 100%;
      transition: border-color 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #000000;
    }

    textarea {
      min-height: 120px;
      resize: none !important;
    }

    textarea::placeholder {
      white-space: pre-line;
    }

    /* Numbered Section Badge */
    .numbered-section {
      background: #000000;
      color: #FFFFFF;
      padding: 10px 16px;
      font-family: 'Plaak', sans-serif;
      font-size: 26px;
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }

    /* Progress Indicator */
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #E0E0E0;
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: #000000;
      transform: scale(1.3);
    }

    .progress-dot.completed {
      background: #000000;
    }

    .progress-line {
      height: 2px;
      background: #E0E0E0;
      flex: 1;
    }

    /* Character Counter */
    .char-counter {
      font-size: 14px;
      color: #666;
      margin-top: 4px;
    }

    .char-counter.invalid {
      color: #EF4444;
    }

    /* Wizard Layout */
    .wizard-layout { display: flex; min-height: 100vh; }
    .wizard-main { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
    .wizard-content { flex: 1; padding: 48px 64px; max-width: 860px; }
    .wizard-sidebar { width: 280px; background: #1a1a1a; color: #fff; padding: 40px 32px; position: sticky; top: 0; height: 100vh; overflow-y: auto; flex-shrink: 0; display: flex; flex-direction: column; }
    .wizard-footer { padding: 24px 64px; border-top: 1px solid #E0E0E0; display: flex; gap: 16px; background: #fff; }
    .btn-wiz-back { background: #fff; color: #000; padding: 14px 24px; border: 2px solid #000; font-family: 'Riforma', sans-serif; font-size: 14px; cursor: pointer; letter-spacing: 0.05em; text-transform: uppercase; }
    .btn-wiz-next { flex: 1; background: #000; color: #fff; padding: 14px 24px; border: 2px solid #000; font-family: 'Riforma', sans-serif; font-size: 14px; cursor: pointer; letter-spacing: 0.05em; text-transform: uppercase; }
    .btn-wiz-next:disabled { background: #E0E0E0; border-color: #E0E0E0; cursor: not-allowed; color: #999; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, Fragment } = React;

    // Configuration
    const CONFIG = {
      SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
      TOOL_SLUG: 'customer-service',
      AUTOSAVE_DELAY: 2000,
      TRANSITION_CONTENT: {
        1: {
          brutalTruth: 'Acquiring a new customer costs 5-7x more than retaining an existing one. Poor service is not a satisfaction issue — it is a P&L issue. Every churn event is a silent acquisition cost you pay twice.',
          peerProof: '"A €4M SaaS company tracked NPS monthly and discovered their highest-churning segment was also their most complaint-prone. They assigned a dedicated CS rep. Churn dropped 40% in two quarters."'
        },
        2: {
          brutalTruth: 'Customer complaints are not problems — they are free consulting. The companies that grow fastest treat every complaint as a product roadmap item. The ones that ignore them repeat the same failures quarterly.',
          peerProof: '"One B2B services firm created a monthly \'complaint digest\' for their leadership team. Three systemic issues surfaced. Fixing them cut support tickets by 55% and improved renewal rates by 28%."'
        },
        3: {
          brutalTruth: 'Service standards without enforcement are just aspirations. If your team does not know what \'good\' looks like — with specific response times, resolution rates, and escalation triggers — you have a policy, not a system.',
          peerProof: '"A regional bank branch set explicit service standards: 24h response, 48h resolution, personal callback on all complaints. Within 6 months, their NPS moved from 22 to 47. The standard came first. The score followed."'
        },
        4: {
          brutalTruth: 'Ownership without accountability is delegation theater. If nobody is measured on a service metric, nobody owns it. Clear KPIs with named owners are the difference between a service strategy that lives in a document and one that lives in behavior.',
          peerProof: '"A distribution company assigned service ownership with clear KPIs to 6 touchpoint owners. Three months later, first-contact resolution rose from 51% to 78%. The data didn\'t change — the accountability did."'
        },
        5: {
          brutalTruth: 'The implementation plan is where most service transformations die. Not from bad ideas — from no execution system. Without a rollout sequence, a communication plan, and a review cadence, your strategy dissolves within 60 days.',
          peerProof: '"A financial services firm created a 90-day service rollout with weekly check-ins. Every month they reviewed one WOW touchpoint and two Just Better improvements. NPS rose 23 points in a year. Not from inspiration — from iteration."'
        }
      },
      CLOSING_MESSAGES: {
        1: { title: 'JOURNEY MAPPED', text: 'Your customer touchpoints are visible. Now design the WOW moments that create loyalty.' },
        2: { title: 'WOW MOMENTS SET', text: 'Your emotional touchpoints are designed. Now make the basics better than the industry norm.' },
        3: { title: 'IMPROVEMENTS DEFINED', text: 'Your baseline is set. Now assign clear ownership and metrics to every touchpoint.' },
        4: { title: 'OWNERSHIP LOCKED', text: 'Every touchpoint has an owner. Now build the implementation plan to bring it to life.' },
        5: { title: 'STRATEGY COMPLETE', text: 'Your customer service strategy is built. Submit it and start executing.' }
      }
    };

    const { createClient } = supabase;
    const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

    // Make Supabase client globally available for dependency injection
    window.supabaseClient = supabaseClient;

    // Initialize ToolDB and dependency injection
    ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        CognitiveLoad.init('customer-service', {"insights":["Customer service is not a cost center - it is your retention and growth engine.","One delighted customer tells 3 people. One angry customer tells 11."],"caseStudy":{"before":"Zappos had average customer service ratings and generic call scripts. Agents were measured on call handling time, not customer emotion. NPS sat at 22, and repeat purchase rate was stagnant at 40%.","after":"Tony Hsieh rebuilt service as company culture: every employee did support rotations, agents were empowered with no time limits on calls, and the goal shifted from efficiency to emotional connection. NPS jumped to 77, and repeat purchase rate rose to 75%.","quote":"Customer service shouldn\u0027t just be a department. It should be the entire company. - Tony Hsieh, Zappos"}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

        function DependencyContext({ deps }) {
            const [open, setOpen] = React.useState(false);
            if (!deps || deps.length === 0) return null;
            return (
                <div style={{ marginBottom: '16px' }}>
                    <button onClick={() => setOpen(o => !o)} style={{ display: 'flex', alignItems: 'center', gap: 8, background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '8px 14px', fontSize: 12, fontFamily: "'Monument', monospace", letterSpacing: '0.05em', textTransform: 'uppercase', cursor: 'pointer', color: '#555', width: '100%' }}>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#DAA520" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        CONTEXT FROM PREVIOUS TOOLS ({deps.length})
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#999" strokeWidth="2" style={{ marginLeft: 'auto', transform: open ? 'rotate(180deg)' : 'none', transition: 'transform 0.2s' }}><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    {open && (
                        <div style={{ border: '1px solid #F0E68C', borderTop: 'none', padding: '12px 14px' }}>
                            {deps.map((dep, i) => (
                                <div key={i} style={{ background: '#fff', padding: '8px 0', borderBottom: i < deps.length - 1 ? '1px solid #F0E68C' : 'none', fontSize: '13px' }}>
                                    <div style={{ fontWeight: 600, marginBottom: '2px', color: '#333', fontSize: '11px', fontFamily: "'Monument', monospace", letterSpacing: '0.04em', textTransform: 'uppercase' }}>{dep.label}</div>
                                    <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

    // Main App Component
    function ServiceApp() {
            const [deps, setDeps] = useState([]);
      const [step, setStep] = useState(0);
      const [aiReviewing, setAiReviewing] = useState(false);
      const [submitStatus, setSubmitStatus] = useState(null);
      const [submitMessage, setSubmitMessage] = useState('');

      const [data, setData] = useState({
        // Step 1: Journey Mapping
        journeyStages: [
          { id: 1, stage: '', customerGoal: '', customerAction: '', customerThought: '' },
          { id: 2, stage: '', customerGoal: '', customerAction: '', customerThought: '' },
          { id: 3, stage: '', customerGoal: '', customerAction: '', customerThought: '' },
          { id: 4, stage: '', customerGoal: '', customerAction: '', customerThought: '' },
          { id: 5, stage: '', customerGoal: '', customerAction: '', customerThought: '' }
        ],

        // Step 2: WOW Touchpoints
        wowTouchpoints: [
          { id: 1, moment: '', emotional: '', action: '', measurement: '' },
          { id: 2, moment: '', emotional: '', action: '', measurement: '' },
          { id: 3, moment: '', emotional: '', action: '', measurement: '' }
        ],

        // Step 3: Just Better
        justBetter: [
          { id: 1, improvement: '', execution: '', responsible: '', metric: '' },
          { id: 2, improvement: '', execution: '', responsible: '', metric: '' },
          { id: 3, improvement: '', execution: '', responsible: '', metric: '' }
        ],

        // Step 4: Ownership
        ownership: [
          { id: 1, touchpoint: 'WOW Touchpoint 1', owner: '', kpi: '', deadline: '' },
          { id: 2, touchpoint: 'WOW Touchpoint 2', owner: '', kpi: '', deadline: '' },
          { id: 3, touchpoint: 'WOW Touchpoint 3', owner: '', kpi: '', deadline: '' },
          { id: 4, touchpoint: 'Just Better 1', owner: '', kpi: '', deadline: '' },
          { id: 5, touchpoint: 'Just Better 2', owner: '', kpi: '', deadline: '' },
          { id: 6, touchpoint: 'Just Better 3', owner: '', kpi: '', deadline: '' }
        ],

        // Step 5: Implementation
        executionPlan: '',
        frontlineCommunication: '',
        metricTracking: '',
        quarterlyReview: ''
      });

            useEffect(() => {
                async function loadDeps() {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId || !window.ToolDB || !window.DependencyInjection) return;
                    try {
                        await ToolDB.whenReady();
                        const config = DependencyInjection.getDependenciesConfig();
                        const toolConfig = config[CONFIG.TOOL_SLUG];
                        if (!toolConfig || !toolConfig.fields) return;
                        const loaded = [];
                        for (const field of toolConfig.fields) {
                            const val = await ToolDB.getDependency(userId, field.source_field);
                            if (val) {
                                loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                            }
                        }
                        setDeps(loaded);
                    } catch (err) {
                        console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
                    }
                }
                loadDeps();
            }, []);

      // Load from localStorage
      useEffect(() => {
        const saved = localStorage.getItem('customerServiceData');
        if (saved) {
          try {
            setData(JSON.parse(saved));
          } catch (e) {
            console.error('Failed to load saved data');
          }
        }
      }, []);

      // Auto-save to localStorage
      useEffect(() => {
        const interval = setInterval(() => {
          localStorage.setItem('customerServiceData', JSON.stringify(data));
        }, 2000);
        return () => clearInterval(interval);
      }, [data]);

      const updateData = (field, value) => {
        setData(prev => ({ ...prev, [field]: value }));
      };

      const updateStage = (id, field, value) => {
        setData(prev => ({
          ...prev,
          journeyStages: prev.journeyStages.map(s =>
            s.id === id ? { ...s, [field]: value } : s
          )
        }));
      };

      const addStage = () => {
        const newId = Math.max(...data.journeyStages.map(s => s.id)) + 1;
        setData(prev => ({
          ...prev,
          journeyStages: [...prev.journeyStages, { id: newId, stage: '', customerGoal: '', customerAction: '', customerThought: '' }]
        }));
      };

      const removeStage = (id) => {
        if (data.journeyStages.length > 3) {
          setData(prev => ({
            ...prev,
            journeyStages: prev.journeyStages.filter(s => s.id !== id)
          }));
        }
      };

      const updateWow = (id, field, value) => {
        setData(prev => ({
          ...prev,
          wowTouchpoints: prev.wowTouchpoints.map(w =>
            w.id === id ? { ...w, [field]: value } : w
          )
        }));
      };

      const updateBetter = (id, field, value) => {
        setData(prev => ({
          ...prev,
          justBetter: prev.justBetter.map(b =>
            b.id === id ? { ...b, [field]: value } : b
          )
        }));
      };

      const updateOwnership = (id, field, value) => {
        setData(prev => ({
          ...prev,
          ownership: prev.ownership.map(o =>
            o.id === id ? { ...o, [field]: value } : o
          )
        }));
      };

      // Validation functions
      const isStep1Valid = () => {
        return data.journeyStages.every(s =>
          s.stage.length >= 3 &&
          s.customerGoal.length >= 20 &&
          s.customerAction.length >= 20 &&
          s.customerThought.length >= 20
        );
      };

      const isStep2Valid = () => {
        return data.wowTouchpoints.every(w =>
          w.moment.length >= 30 &&
          w.emotional.length >= 20 &&
          w.action.length >= 30 &&
          w.measurement.length >= 20
        );
      };

      const isStep3Valid = () => {
        return data.justBetter.every(b =>
          b.improvement.length >= 30 &&
          b.execution.length >= 30 &&
          b.responsible.length >= 5 &&
          b.metric.length >= 20
        );
      };

      const isStep4Valid = () => {
        return data.ownership.every(o =>
          o.owner && o.owner.length >= 5 &&
          o.kpi && o.kpi.length >= 15 &&
          o.deadline && o.deadline.length >= 8
        );
      };

      const isStep5Valid = () => {
        return (
          data.executionPlan.length >= 50 &&
          data.frontlineCommunication.length >= 50 &&
          data.metricTracking.length >= 30 &&
          data.quarterlyReview.length >= 30
        );
      };

      // Navigation
      const advanceStep = (fromStep) => {
        setStep(fromStep + 0.5);
      };

      const goNext = () => {
        if (step === 0.5) {
          setStep(1);
        } else if (step === 0) {
          setStep(0.5);
        }
      };

      const handleNext = async (fromStep) => {
        const userId = localStorage.getItem('ft_user_id');
        if (!userId) { alert('User not authenticated.'); return; }
        setAiReviewing(true);
        try {
          let stepAnswers = {};
          let stepName = '';
          if (fromStep === 1) {
            stepName = 'Customer Journey Map';
            stepAnswers = { journeyStages: data.journeyStages };
          } else if (fromStep === 2) {
            stepName = 'WOW Touchpoints';
            stepAnswers = { wowTouchpoints: data.wowTouchpoints };
          } else if (fromStep === 3) {
            stepName = 'Just Better Improvements';
            stepAnswers = { justBetter: data.justBetter };
          } else if (fromStep === 4) {
            stepName = 'Ownership & Metrics';
            stepAnswers = { ownership: data.ownership };
          } else if (fromStep === 5) {
            stepName = 'Implementation Plan';
            stepAnswers = { executionPlan: data.executionPlan, frontlineCommunication: data.frontlineCommunication, metricTracking: data.metricTracking, quarterlyReview: data.quarterlyReview };
          }
          const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
          if (canProceed) {
            advanceStep(fromStep);
          }
        } catch (err) {
          console.warn('[AIChallenge] Error, allowing passage:', err);
          advanceStep(fromStep);
        } finally {
          setAiReviewing(false);
        }
      };

      const goBack = () => {
        if (step === 0.5) {
          setStep(0);
        } else if (step === 6) {
          setStep(5);
        } else if (step > 1) {
          setStep(step - 1);
        }
      };

      // PDF Export
      const exportPDF = async () => {
        try {
          const canvas = document.getElementById('canvas-page');
          const images = canvas.querySelectorAll('img');
          const imageStates = [];
          images.forEach(img => {
            imageStates.push({ img, display: img.style.display });
            img.style.display = 'none';
          });

          const canvasImage = await html2canvas(canvas, {
            scale: 2,
            logging: false,
            backgroundColor: '#ffffff'
          });

          imageStates.forEach(({ img, display }) => {
            img.style.display = display;
          });

          const imgData = canvasImage.toDataURL('image/png');
          const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = pdf.internal.pageSize.getHeight();
          const imgWidth = pdfWidth - 20;
          const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

          let heightLeft = imgHeight;
          let position = 10;

          pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
          heightLeft -= pdfHeight;

          while (heightLeft > 0) {
            position = heightLeft - imgHeight + 10;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= pdfHeight;
          }

          pdf.save('customer-service-strategy.pdf');
        } catch (error) {
          alert('Failed to export PDF: ' + error.message);
        }
      };

      // Submit
      const handleSubmit = async () => {
        try {
          const userId = localStorage.getItem('ft_user_id');
          if (!userId) {
            alert('User not authenticated. Please return to the dashboard.');
            return;
          }

          const questionMappings = {
            journey_map: {
              journeyStages: data.journeyStages,
              wowTouchpoints: data.wowTouchpoints,
              justBetter: data.justBetter
            },
            service_standards: {
              ownership: data.ownership,
              executionPlan: data.executionPlan,
              frontlineCommunication: data.frontlineCommunication,
              metricTracking: data.metricTracking,
              quarterlyReview: data.quarterlyReview
            }
          };

          await ToolDB.saveResponses(userId, CONFIG.TOOL_SLUG, questionMappings);
          setSubmitStatus('success');
          setSubmitMessage('Submission saved successfully!');
        } catch (error) {
          console.error('Submit error:', error);
          alert('Submission failed: ' + error.message);
        }
      };

      // Render different pages based on step
      if ([1.5, 2.5, 3.5, 4.5, 5.5].includes(step)) {
        return window.renderTransitionScreen(step, CONFIG, 5, setStep);
      }

      if (step === 0) {
        return <CoverPage onStart={goNext} />;
      }

      if (step === 0.5) {
        return <IntroPage onNext={goNext} />;
      }

      // Steps 1-5: Wizard layout
      if (step >= 1 && step <= 5) {
        const stepLabels = ['Customer Journey Map', 'WOW Touchpoints', 'Just Better', 'Ownership & Metrics', 'Implementation'];
        const isValid = step === 1 ? isStep1Valid() : step === 2 ? isStep2Valid() : step === 3 ? isStep3Valid() : step === 4 ? isStep4Valid() : isStep5Valid();
        const canProceed = !aiReviewing && isValid;
        const nextLabels = { 1: 'NEXT: WOW MOMENTS →', 2: 'NEXT: JUST BETTER →', 3: 'NEXT: OWNERSHIP →', 4: 'NEXT: IMPLEMENTATION →', 5: 'VIEW SUMMARY →' };
        return (
          <div className="wizard-layout">
            <div className="wizard-main">
              <div className="wizard-content animate-in">
                <DependencyContext deps={deps} />
                {step === 1 && <Step1Page data={data} updateStage={updateStage} addStage={addStage} removeStage={removeStage} />}
                {step === 2 && <Step2Page data={data} updateWow={updateWow} />}
                {step === 3 && <Step3Page data={data} updateBetter={updateBetter} />}
                {step === 4 && <Step4Page data={data} updateOwnership={updateOwnership} />}
                {step === 5 && <Step5Page data={data} updateData={updateData} />}
              </div>
              <div className="wizard-footer">
                <button className="btn-wiz-back" onClick={goBack}>← BACK</button>
                <button className="btn-wiz-next" disabled={!canProceed} onClick={() => handleNext(step)}>
                  {aiReviewing ? 'AI COACH REVIEWING...' : (nextLabels[step] || 'NEXT →')}
                </button>
              </div>
            </div>
            <WizardSidebar currentStep={step} stepLabels={stepLabels} totalSteps={5} />
          </div>
        );
      }

      if (step === 6) {
        return (
          <CanvasPage
            data={data}
            onExport={exportPDF}
            onSubmit={handleSubmit}
          />
        );
      }

      return null;
    }

    // Cover Page Component
    function CoverPage({ onStart }) {
      return (
        <div className="relative min-h-screen flex items-center justify-center bg-black">
          <div
            className="absolute inset-0 w-full h-full"
            style={{
              backgroundImage: 'url("https://images.unsplash.com/photo-1521791136064-7986c2920216?w=1920&q=80")',
              backgroundSize: 'cover',
              backgroundPosition: 'center'
            }}
          ></div>
          <div className="absolute inset-0" style={{background: 'linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.85))'}}></div>

          <div className="relative z-10 text-center text-white px-8 max-w-5xl mx-auto">
            <h1 className="plaak animate-in" style={{fontSize: '100px', lineHeight: '1', marginBottom: '32px'}}>
              CUSTOMER SERVICE
            </h1>
            <h2 className="plaak animate-in" style={{fontSize: '80px', lineHeight: '1', marginBottom: '32px', color: '#FFF469', animationDelay: '0.1s'}}>
              STRATEGY & EXECUTION
            </h2>
            <p className="text-4xl mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              Transform service into strategic execution.
            </p>
            <button
              onClick={onStart}
              className="bg-white text-black plaak px-16 py-6 border-4 border-white hover:bg-black hover:text-white transition-all text-3xl animate-in"
              style={{animationDelay: '0.4s'}}
            >
              START
            </button>
          </div>
        </div>
      );
    }

    // Intro Page Component
    function IntroPage({ onNext }) {
      return (
        <div className="bg-black text-white min-h-screen p-16">
          <div className="max-w-5xl mx-auto">
            <h1 className="plaak mb-16 animate-in" style={{fontSize: '100px'}}>
              BEFORE WE START
            </h1>

            {/* Sprint Info */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.05s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>SPRINT INFO</h2>
              <div className="bg-white text-black p-8">
                <p className="text-2xl font-bold mb-4">Sprint 20: Customer Service Strategy & Execution</p>
                <p className="text-xl leading-relaxed mb-4">
                  96% of customers say service is critical, but only 8% believe companies deliver excellent service. This sprint transforms customer service from reactive function into strategic execution. Map touchpoints, design WOW moments, and align every interaction with your value proposition.
                </p>
                <div className="border-l-4 border-black pl-4 italic text-lg">
                  &quot;Customer service shouldn&apos;t just be a department. It should be the entire company.&quot; — Tony Hsieh, Zappos
                </div>
              </div>
            </div>

            {/* Purpose */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <h2 className="plaak text-6xl mb-6">PURPOSE</h2>

              <div className="border-l-4 border-white pl-6 mb-6">
                <p className="text-3xl italic mb-2">&quot;People will forget what you said. They will forget what you did. But they will never forget how you made them feel.&quot;</p>
                <p className="text-xl text-gray-400">— MAYA ANGELOU</p>
              </div>

              <p className="text-3xl leading-relaxed mb-4">
                This tool maps your customer journey, identifies 3 WOW moments to create emotional impact, defines 3 Just Better improvements to outperform expectations, and assigns ownership with KPIs. Service becomes strategy in action.
              </p>
            </div>

            {/* Mistakes to Avoid */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>MISTAKES TO AVOID</h2>

              <div className="bg-white text-black p-6 mb-6 border-4 border-yellow-400">
                <p className="riforma-bold text-2xl mb-4">CARDINAL SINS OF SERVICE:</p>
                <ul className="text-xl space-y-3">
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">1.</span>
                    <span><strong>Designing for everyone instead of your segment:</strong> Generic service fails. Design for specific pain and delight triggers of your behavioral segment</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">2.</span>
                    <span><strong>Inconsistency kills trust:</strong> A single bad moment erases five good ones. Trust requires predictability across every channel, every time</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">3.</span>
                    <span><strong>Superficial improvements without fixing structure:</strong> Changing tone or scripts won&apos;t matter if the process is broken. Fix friction points first</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">4.</span>
                    <span><strong>No ownership or metrics:</strong> Without clear accountability and measurement, service excellence becomes vague aspiration</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">5.</span>
                    <span><strong>Optimizing for internal efficiency over customer feeling:</strong> Customers are 4x more likely to switch due to poor service than price</span>
                  </li>
                </ul>
              </div>
            </div>

            {/* The Journey */}
            <div className="mb-16 animate-in" style={{animationDelay: '0.3s'}}>
              <h2 className="plaak text-6xl mb-8">THE JOURNEY</h2>
              <div className="grid grid-cols-5 gap-4 text-center">
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">01</div>
                  <p className="text-xl font-bold mb-2">JOURNEY</p>
                  <p className="text-base text-gray-400">Map touchpoints</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">02</div>
                  <p className="text-xl font-bold mb-2">WOW</p>
                  <p className="text-base text-gray-400">Emotional moments</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">03</div>
                  <p className="text-xl font-bold mb-4">BETTER</p>
                  <p className="text-base text-gray-400">Reliability upgrades</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">04</div>
                  <p className="text-xl font-bold mb-2">OWNERS</p>
                  <p className="text-base text-gray-400">Accountability</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">05</div>
                  <p className="text-xl font-bold mb-2">PLAN</p>
                  <p className="text-base text-gray-400">Execute & track</p>
                </div>
              </div>
            </div>

            {/* Next Button */}
            <button
              onClick={onNext}
              className="btn-primary w-full text-3xl py-8 plaak"
            >
              LET&apos;S START →
            </button>
          </div>
        </div>
      );
    }

    // Wizard Sidebar
    function WizardSidebar({ currentStep, stepLabels, totalSteps }) {
      return (
        <div className="wizard-sidebar">
          <div style={{ marginBottom: '48px' }}>
            <div className="monument" style={{ fontSize: '10px', color: '#888', letterSpacing: '0.1em', marginBottom: '8px' }}>SPRINT 20</div>
            <div className="plaak" style={{ fontSize: '20px', lineHeight: '1.1', color: '#fff' }}>CUSTOMER<br />SERVICE</div>
          </div>
          <div style={{ flex: 1 }}>
            {stepLabels.map((label, i) => {
              const stepNum = i + 1;
              const isActive = Math.floor(currentStep) === stepNum;
              const isCompleted = currentStep > stepNum;
              return (
                <div key={stepNum} style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '24px', opacity: isActive || isCompleted ? 1 : 0.4 }}>
                  <div style={{ width: '24px', height: '24px', borderRadius: '50%', background: isCompleted ? '#FFF469' : isActive ? '#fff' : 'transparent', border: `2px solid ${isCompleted ? '#FFF469' : isActive ? '#fff' : '#555'}`, display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0, marginTop: '2px' }}>
                    {isCompleted ? (
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#000" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>
                    ) : (
                      <span style={{ fontSize: '10px', color: isActive ? '#000' : '#555', fontFamily: "'Monument', monospace" }}>{stepNum}</span>
                    )}
                  </div>
                  <div style={{ fontSize: '11px', fontFamily: "'Monument', monospace", letterSpacing: '0.05em', color: isActive ? '#fff' : isCompleted ? '#FFF469' : '#555', textTransform: 'uppercase', paddingTop: '4px' }}>{label}</div>
                </div>
              );
            })}
          </div>
          <div style={{ borderTop: '1px solid #333', paddingTop: '24px' }}>
            <div className="monument" style={{ fontSize: '10px', color: '#555', letterSpacing: '0.05em' }}>STEP {Math.floor(Math.max(1, currentStep))} OF {totalSteps}</div>
          </div>
        </div>
      );
    }

    // Progress Indicator Component
    function ProgressIndicator({ currentStep }) {
      const steps = [1, 2, 3, 4, 5];
      return (
        <div className="flex items-center justify-center mb-8">
          {steps.map((s, index) => (
            <Fragment key={s}>
              <div
                className={`progress-dot ${s === currentStep ? 'active' : ''} ${s < currentStep ? 'completed' : ''}`}
              ></div>
              {index < steps.length - 1 && <div className="progress-line" style={{width: '40px'}}></div>}
            </Fragment>
          ))}
        </div>
      );
    }

    // Step 1: Customer Journey Map
    function Step1Page({ data, updateStage, addStage, removeStage }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">01. CUSTOMER JOURNEY MAP</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            

            {/* Common Mistake */}


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Map every touchpoint where trust is built or broken
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;Great service requires being bad at something else. No company can be excellent everywhere.&quot; — Frances Frei, Uncommon Service
              </p>
            </div>

            <p className="text-xl mb-8 text-gray-700">
              Map 5-8 key customer-facing stages from first awareness to post-sale. For each stage, document what the customer is trying to achieve, what they actually do, and what&apos;s going through their mind. Use their language, not internal jargon.
            </p>

            <div className="space-y-8 mb-12">
              {data.journeyStages.map((stage, index) => (
                <div key={stage.id} className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: `${0.15 + index * 0.03}s`}}>
                  <div className="flex justify-between items-start mb-4">
                    <h4 className="riforma-bold text-2xl">Stage {index + 1}</h4>
                    {data.journeyStages.length > 3 && (
                      <button
                        onClick={() => removeStage(stage.id)}
                        className="text-red-600 hover:text-red-800 text-sm"
                      >
                        REMOVE
                      </button>
                    )}
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="monument text-sm block mb-2">STAGE NAME <span className="text-red-500">*</span></label>
                      <ScienceBookmarkIcon>
                          Frances Frei (Uncommon Service): Great service requires being bad at something else. No company can be excellent everywhere -- name each stage based on what the customer is trying to accomplish, not your internal process.
                      </ScienceBookmarkIcon>
                      <input
                        type="text"
                        value={stage.stage}
                        onChange={(e) => updateStage(stage.id, 'stage', e.target.value)}
                        placeholder="First Contact"
                        className="w-full"
                      />
                      <div className="char-counter">{stage.stage.length}/100 (min 3)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">CUSTOMER GOAL <span className="text-red-500">*</span></label>
                      <ScienceBookmarkIcon>
                          Matthew Dixon (The Effortless Experience): The strongest driver of customer retention is reducing effort. Document what the customer is actually trying to achieve -- the less energy they expend, the more loyal they become.
                      </ScienceBookmarkIcon>
                      <p className="text-sm text-gray-400 mb-2">What are they trying to accomplish at this stage?</p>
                      <textarea
                        value={stage.customerGoal}
                        onChange={(e) => updateStage(stage.id, 'customerGoal', e.target.value)}
                        placeholder="I need to understand if this company can solve my specific problem. I want a quick response that shows they actually read my inquiry, not a template."
                        className="w-full"
                        rows={3}
                      />
                      <div className="char-counter">{stage.customerGoal.length}/500 (min 20)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">CUSTOMER ACTION <span className="text-red-500">*</span></label>
                      <ScienceBookmarkIcon>
                          Bain &amp; Company: 96% of customers say service is critical to brand loyalty, but only 8% believe companies deliver excellent service. Map what customers actually do at each stage -- the gap between expectation and reality is where trust is built or broken.
                      </ScienceBookmarkIcon>
                      <p className="text-sm text-gray-400 mb-2">What do they actually do?</p>
                      <textarea
                        value={stage.customerAction}
                        onChange={(e) => updateStage(stage.id, 'customerAction', e.target.value)}
                        placeholder="I fill out the contact form, describing my situation in detail. Then I wait. I check my email multiple times in the first hour, then less frequently over the next 24 hours."
                        className="w-full"
                        rows={3}
                      />
                      <div className="char-counter">{stage.customerAction.length}/500 (min 20)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">CUSTOMER THOUGHT <span className="text-red-500">*</span></label>
                      <p className="text-sm text-gray-400 mb-2">What&apos;s going through their mind?</p>
                      <textarea
                        value={stage.customerThought}
                        onChange={(e) => updateStage(stage.id, 'customerThought', e.target.value)}
                        placeholder="I hope they respond quickly. I&apos;m comparing three companies right now. If they take more than 24 hours, I&apos;ll probably go with someone else. I&apos;m wondering if they&apos;ll actually understand what I need or just send me generic pricing."
                        className="w-full"
                        rows={3}
                      />
                      <div className="char-counter">{stage.customerThought.length}/500 (min 20)</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            {data.journeyStages.length < 8 && (
              <button onClick={addStage} className="btn-secondary text-sm w-full mb-12">
                + ADD ANOTHER STAGE
              </button>
            )}

        </div>
      );
    }

    // Step 2: WOW Touchpoints
    function Step2Page({ data, updateWow }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">02. WOW TOUCHPOINTS</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Design 3 memorable, emotional, share-worthy moments
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;Memories are built on peaks, pits, and transitions. Deliberately create signature moments in the customer journey.&quot; — Chip & Dan Heath, The Power of Moments
              </p>
            </div>

            <p className="text-xl mb-8 text-gray-700">
              Identify 3 moments where you can create unexpected, emotional, memorable experiences that reinforce your value proposition. Think Ritz-Carlton empowering staff to spend $2,000 instantly to solve guest problems. Make it share-worthy.
            </p>

            <div className="space-y-8 mb-12">
              {data.wowTouchpoints.map((wow, index) => (
                <div key={wow.id} className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: `${0.15 + index * 0.05}s`}}>
                  <h4 className="riforma-bold text-2xl mb-4">WOW Touchpoint {index + 1}</h4>

                  <div className="space-y-4">
                    <div>
                      <label className="monument text-sm block mb-2">WHAT WOULD MAKE THIS MOMENT MEMORABLE? <span className="text-red-500">*</span></label>
                      <textarea
                        value={wow.moment}
                        onChange={(e) => updateWow(wow.id, 'moment', e.target.value)}
                        placeholder="When a customer reports a critical issue on Friday evening, we don&apos;t just log a ticket. Our CEO personally calls them within 30 minutes, stays on the line until it&apos;s resolved, and follows up Monday morning to ensure everything is working perfectly."
                        className="w-full"
                        rows={4}
                      />
                      <div className="char-counter">{wow.moment.length}/1000 (min 30)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">WHAT EMOTIONAL EFFECT ARE WE AIMING FOR? <span className="text-red-500">*</span></label>
                      <textarea
                        value={wow.emotional}
                        onChange={(e) => updateWow(wow.id, 'emotional', e.target.value)}
                        placeholder="Shock that someone at the top cares this much. Relief that they&apos;re not alone with the problem. Trust that we&apos;re genuinely invested in their success, not just their money."
                        className="w-full"
                        rows={3}
                      />
                      <div className="char-counter">{wow.emotional.length}/500 (min 20)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">WHAT ACTION OR CHANGE IS REQUIRED? <span className="text-red-500">*</span></label>
                      <textarea
                        value={wow.action}
                        onChange={(e) => updateWow(wow.id, 'action', e.target.value)}
                        placeholder="Set up 24/7 escalation protocol. CEO and CTO on rotating on-call for P1 issues. Implement 30-minute response SLA for critical problems. Train support team to identify and escalate immediately. Create follow-up automation for Monday check-ins."
                        className="w-full"
                        rows={4}
                      />
                      <div className="char-counter">{wow.action.length}/1000 (min 30)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">HOW WILL SUCCESS BE MEASURED? <span className="text-red-500">*</span></label>
                      <textarea
                        value={wow.measurement}
                        onChange={(e) => updateWow(wow.id, 'measurement', e.target.value)}
                        placeholder="Track: Response time to P1 issues, NPS score after CEO intervention, number of customers who mention this in testimonials, customer retention rate after critical issues."
                        className="w-full"
                        rows={3}
                      />
                      <div className="char-counter">{wow.measurement.length}/500 (min 20)</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

        </div>
      );
    }

    // Step 3: Just Better Improvements
    function Step3Page({ data, updateBetter }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">03. JUST BETTER IMPROVEMENTS</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Outperform the norm through reliability and simplicity
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;Reduce effort, not just add delight. Simplicity wins. Eliminate repeat contacts—it&apos;s the #1 driver of dissatisfaction.&quot; — Matthew Dixon, The Effortless Experience
              </p>
            </div>

            <p className="text-xl mb-8 text-gray-700">
              Identify 3 touchpoints where you&apos;ll outperform industry standards through superior speed, clarity, tone, simplicity, or consistency. These aren&apos;t flashy, but they build trust through reliability. Focus on reducing friction.
            </p>

            <div className="space-y-8 mb-12">
              {data.justBetter.map((better, index) => (
                <div key={better.id} className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: `${0.15 + index * 0.05}s`}}>
                  <h4 className="riforma-bold text-2xl mb-4">Just Better Improvement {index + 1}</h4>

                  <div className="space-y-4">
                    <div>
                      <label className="monument text-sm block mb-2">WHAT NEEDS TO BE IMPROVED? <span className="text-red-500">*</span></label>
                      <textarea
                        value={better.improvement}
                        onChange={(e) => updateBetter(better.id, 'improvement', e.target.value)}
                        placeholder="Our current onboarding email sequence is 5 emails over 10 days with dense paragraphs and multiple CTAs per email. Customers are confused about what to do first. We need to simplify to 3 emails, single clear action per email, plain language."
                        className="w-full"
                        rows={4}
                      />
                      <div className="char-counter">{better.improvement.length}/1000 (min 30)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">HOW WILL IT BE EXECUTED? <span className="text-red-500">*</span></label>
                      <textarea
                        value={better.execution}
                        onChange={(e) => updateBetter(better.id, 'execution', e.target.value)}
                        placeholder="Rewrite all onboarding emails to 6th grade reading level. Each email has one primary CTA. Sequence: Day 1 (Welcome + one setup task), Day 3 (One key feature), Day 7 (Where to get help). A/B test new sequence with 500 customers before full rollout."
                        className="w-full"
                        rows={4}
                      />
                      <div className="char-counter">{better.execution.length}/1000 (min 30)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">WHO IS RESPONSIBLE? <span className="text-red-500">*</span></label>
                      <input
                        type="text"
                        value={better.responsible}
                        onChange={(e) => updateBetter(better.id, 'responsible', e.target.value)}
                        placeholder="Sarah Chen, Customer Success Manager"
                        className="w-full"
                      />
                      <div className="char-counter">{better.responsible.length}/200 (min 5)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">WHAT METRIC WILL TRACK IT? <span className="text-red-500">*</span></label>
                      <textarea
                        value={better.metric}
                        onChange={(e) => updateBetter(better.id, 'metric', e.target.value)}
                        placeholder="Primary: Onboarding completion rate (target: 80% complete all setup tasks within 7 days). Secondary: Support tickets during first 14 days (target: reduce by 40%). Tertiary: Day 30 activation rate."
                        className="w-full"
                        rows={3}
                      />
                      <div className="char-counter">{better.metric.length}/500 (min 20)</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

        </div>
      );
    }

    // Step 4: Ownership & Metrics
    function Step4Page({ data, updateOwnership }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">04. OWNERSHIP & METRICS</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Assign clear accountability for every touchpoint
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;Operational excellence in service is about repeatable systems, not heroics. Every touchpoint must have one owner.&quot; — Frances Frei
              </p>
            </div>

            <p className="text-xl mb-8 text-gray-700">
              Assign clear ownership and performance indicators for each of your 6 strategic touchpoints. Without accountability and measurement, service excellence becomes vague aspiration. One owner per touchpoint, never split responsibility.
            </p>

            <div className="space-y-8 mb-12">
              {data.ownership.map((item, index) => (
                <div key={item.id} className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: `${0.15 + index * 0.02}s`}}>
                  <h4 className="riforma-bold text-2xl mb-4">{item.touchpoint}</h4>

                  <div className="space-y-4">
                    <div>
                      <label className="monument text-sm block mb-2">RESPONSIBLE OWNER (TEAM OR PERSON) <span className="text-red-500">*</span></label>
                      <input
                        type="text"
                        value={item.owner}
                        onChange={(e) => updateOwnership(item.id, 'owner', e.target.value)}
                        placeholder="Maria Rodriguez, Head of Customer Experience"
                        className="w-full"
                      />
                      <div className="char-counter">{item.owner.length}/200 (min 5)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">PERFORMANCE INDICATOR (KPI) <span className="text-red-500">*</span></label>
                      <textarea
                        value={item.kpi}
                        onChange={(e) => updateOwnership(item.id, 'kpi', e.target.value)}
                        placeholder="Primary: NPS score for this touchpoint (target: 9+). Secondary: Response time (target: under 2 hours). Tertiary: Customer sentiment analysis (target: 85% positive)."
                        className="w-full"
                        rows={3}
                      />
                      <div className="char-counter">{item.kpi.length}/500 (min 15)</div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">DEADLINE FOR IMPLEMENTATION <span className="text-red-500">*</span></label>
                      <input
                        type="text"
                        value={item.deadline}
                        onChange={(e) => updateOwnership(item.id, 'deadline', e.target.value)}
                        placeholder="March 15, 2024 (60 days from now)"
                        className="w-full"
                      />
                      <div className="char-counter">{item.deadline.length}/200 (min 8)</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

        </div>
      );
    }

    // Step 5: Implementation Plan
    function Step5Page({ data, updateData }) {
      return (
        <div>
            <div className="numbered-section mb-8 animate-in">05. IMPLEMENTATION PLAN</div>

            {/* Fast Track Insight */}

            {/* The Science */}
            


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Turn strategy into execution with clear actions and timelines
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;Service isn&apos;t what you do. It&apos;s who you are. Culture equals execution.&quot; — Tony Hsieh, Zappos
              </p>
            </div>

            <p className="text-xl mb-8 text-gray-700">
              Strategy without execution is fantasy. Create your roadmap for rolling out improvements, communicating to frontline teams, tracking metrics, and reviewing performance quarterly. Make service excellence operational reality.
            </p>

            <div className="space-y-8 mb-12">
              <div className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: '0.15s'}}>
                <label className="monument text-sm block mb-2">EXECUTION SEQUENCE & ROLLOUT PLAN <span className="text-red-500">*</span></label>
                <p className="text-sm text-gray-400 mb-2">What gets implemented first, second, third? What are the dependencies? What&apos;s the timeline for each phase?</p>
                <textarea
                  value={data.executionPlan}
                  onChange={(e) => updateData('executionPlan', e.target.value)}
                  placeholder="Phase 1 (Weeks 1-2): Implement all 3 Just Better improvements—these are quick wins that build momentum. Start with onboarding email simplification, then response time improvements, then tone training.&#10;&#10;Phase 2 (Weeks 3-6): Roll out first WOW moment—CEO escalation protocol. Train support team on identification criteria, set up on-call rotation, test with 10 customers before full launch.&#10;&#10;Phase 3 (Weeks 7-10): Implement WOW moments 2 and 3. Each gets 2-week pilot with selected segment customers before company-wide rollout.&#10;&#10;Phase 4 (Week 11+): Full operation mode. All touchpoints live. Daily metric monitoring. Weekly team reviews."
                  className="w-full"
                  rows={12}
                />
                <div className="char-counter">{data.executionPlan.length}/3000 (min 50)</div>
              </div>

              <div className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: '0.2s'}}>
                <label className="monument text-sm block mb-2">FRONTLINE COMMUNICATION PLAN <span className="text-red-500">*</span></label>
                <p className="text-sm text-gray-400 mb-2">How will you communicate these changes to customer-facing teams? What training is needed? How will you empower them to execute?</p>
                <textarea
                  value={data.frontlineCommunication}
                  onChange={(e) => updateData('frontlineCommunication', e.target.value)}
                  placeholder="All-hands kickoff meeting: Present customer journey map, explain WOW vs Just Better strategy, show how this aligns with our value proposition and segment focus.&#10;&#10;Weekly training sessions (4 weeks): Week 1—Segment psychology and pain points. Week 2—WOW moment identification and escalation protocols. Week 3—Just Better execution details and scripts. Week 4—Metric understanding and empowerment boundaries.&#10;&#10;Empowerment guidelines: Support team authorized to make decisions up to $500 without approval. Clear escalation paths for WOW moments. Monthly recognition for team members who create memorable customer moments.&#10;&#10;Living documentation: Notion workspace with journey map, touchpoint playbooks, customer stories, and lessons learned. Updated weekly."
                  className="w-full"
                  rows={12}
                />
                <div className="char-counter">{data.frontlineCommunication.length}/3000 (min 50)</div>
              </div>

              <div className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: '0.25s'}}>
                <label className="monument text-sm block mb-2">METRIC TRACKING SYSTEM <span className="text-red-500">*</span></label>
                <p className="text-sm text-gray-400 mb-2">How will you track performance? What dashboards? What review cadence? What triggers escalation?</p>
                <textarea
                  value={data.metricTracking}
                  onChange={(e) => updateData('metricTracking', e.target.value)}
                  placeholder="Dashboard setup: Tableau dashboard with 6 sections (one per touchpoint). Each shows: primary KPI, trend over 30 days, current week performance, customer verbatim feedback.&#10;&#10;Review cadence: Daily check by touchpoint owners (5 min scan). Weekly team review (30 min deep dive on any red flags). Monthly leadership review (strategic adjustments).&#10;&#10;Escalation triggers: Any touchpoint KPI drops 15% week-over-week. Any customer sentiment below 70% positive. Any WOW moment not executed as designed. Owner must present action plan within 24 hours."
                  className="w-full"
                  rows={8}
                />
                <div className="char-counter">{data.metricTracking.length}/2000 (min 30)</div>
              </div>

              <div className="bg-gray-50 border-2 border-gray-200 p-6 animate-in" style={{animationDelay: '0.3s'}}>
                <label className="monument text-sm block mb-2">QUARTERLY REVIEW & UPGRADE PLAN <span className="text-red-500">*</span></label>
                <p className="text-sm text-gray-400 mb-2">How will you audit and improve the journey every 90 days? What gets upgraded each quarter?</p>
                <textarea
                  value={data.quarterlyReview}
                  onChange={(e) => updateData('quarterlyReview', e.target.value)}
                  placeholder="Q1 Review (End of March): Full journey audit. Customer interviews (10-15 from target segment). Identify: What&apos;s working? What&apos;s falling short? Where is segment evolution happening?&#10;&#10;Upgrade commitment per quarter: One WOW moment enhancement (make it even more memorable). Two Just Better fixes (address new friction points). Update journey map based on customer feedback and market changes.&#10;&#10;Review meeting structure: Half-day workshop. Customer verbatim feedback review. Metric deep dive. Prioritization session. Action assignment. 30/60/90 day milestones set."
                  className="w-full"
                  rows={8}
                />
                <div className="char-counter">{data.quarterlyReview.length}/2000 (min 30)</div>
              </div>
            </div>

        </div>
      );
    }

    // Canvas Page Component
    function CanvasPage({ data, onExport, onSubmit }) {
      return (
        <div className="bg-black text-white min-h-screen p-16">
          <div className="max-w-7xl mx-auto">
            <div id="canvas-page" className="bg-white border-8 border-black p-16 mb-12">
              <div className="mb-12">
                <h1 className="plaak" style={{fontSize: '80px'}}>CUSTOMER SERVICE STRATEGY</h1>
                <p className="monument text-xl mt-2">SPRINT 20 - {new Date().toLocaleDateString()}</p>
              </div>

              <div className="space-y-12">
                {/* Journey Map */}
                <div>
                  <h2 className="riforma-bold text-4xl mb-6 pb-3 border-b-4 border-black">Customer Journey Map</h2>
                  <div className="grid gap-4">
                    {data.journeyStages.map((stage, i) => (
                      <div key={stage.id} className="border-2 border-black p-4">
                        <h3 className="riforma-bold text-xl mb-3">{stage.stage || `Stage ${i + 1}`}</h3>
                        <div className="grid grid-cols-3 gap-3 text-sm">
                          <div>
                            <div className="monument text-xs mb-1">GOAL</div>
                            <div>{stage.customerGoal}</div>
                          </div>
                          <div>
                            <div className="monument text-xs mb-1">ACTION</div>
                            <div>{stage.customerAction}</div>
                          </div>
                          <div>
                            <div className="monument text-xs mb-1">THOUGHT</div>
                            <div>{stage.customerThought}</div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* WOW Touchpoints */}
                <div>
                  <h2 className="riforma-bold text-4xl mb-6 pb-3 border-b-4 border-black">WOW Touchpoints</h2>
                  <div className="space-y-4">
                    {data.wowTouchpoints.map((wow, i) => (
                      <div key={wow.id} className="border-2 border-black p-4">
                        <h3 className="riforma-bold text-lg mb-2">WOW {i + 1}</h3>
                        <div className="space-y-2 text-sm">
                          <div><span className="monument text-xs">MOMENT:</span> {wow.moment}</div>
                          <div><span className="monument text-xs">EMOTIONAL:</span> {wow.emotional}</div>
                          <div><span className="monument text-xs">ACTION:</span> {wow.action}</div>
                          <div><span className="monument text-xs">MEASUREMENT:</span> {wow.measurement}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Just Better */}
                <div>
                  <h2 className="riforma-bold text-4xl mb-6 pb-3 border-b-4 border-black">Just Better Improvements</h2>
                  <div className="space-y-4">
                    {data.justBetter.map((better, i) => (
                      <div key={better.id} className="border-2 border-black p-4">
                        <h3 className="riforma-bold text-lg mb-2">Just Better {i + 1}</h3>
                        <div className="space-y-2 text-sm">
                          <div><span className="monument text-xs">IMPROVEMENT:</span> {better.improvement}</div>
                          <div><span className="monument text-xs">EXECUTION:</span> {better.execution}</div>
                          <div><span className="monument text-xs">RESPONSIBLE:</span> {better.responsible}</div>
                          <div><span className="monument text-xs">METRIC:</span> {better.metric}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Implementation */}
                <div>
                  <h2 className="riforma-bold text-4xl mb-6 pb-3 border-b-4 border-black">Implementation Plan</h2>
                  <div className="space-y-3 text-sm">
                    <div>
                      <div className="monument text-xs mb-1">EXECUTION</div>
                      <div className="whitespace-pre-wrap">{data.executionPlan}</div>
                    </div>
                    <div>
                      <div className="monument text-xs mb-1">COMMUNICATION</div>
                      <div className="whitespace-pre-wrap">{data.frontlineCommunication}</div>
                    </div>
                    <div>
                      <div className="monument text-xs mb-1">TRACKING</div>
                      <div className="whitespace-pre-wrap">{data.metricTracking}</div>
                    </div>
                    <div>
                      <div className="monument text-xs mb-1">QUARTERLY REVIEW</div>
                      <div className="whitespace-pre-wrap">{data.quarterlyReview}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Action Buttons */}
            <div className="flex gap-6 justify-center">
              <button onClick={onExport} className="btn-primary text-xl px-12 py-4">
                EXPORT PDF
              </button>
              <button onClick={onSubmit} className="btn-primary text-xl px-12 py-4">
                SUBMIT
              </button>
            </div>

            {/* Case Study */}
            <CaseStudy
                before={"Zappos had average customer service ratings with generic call scripts. Agents were measured on call handling time, not customer emotion. Service was a cost center with high turnover. NPS: 22. Repeat purchase rate: 40%."}
                after={"Tony Hsieh rebuilt service as company culture. Every employee rotated through support. Agents had no time limits on calls and were empowered to act without approval. Service became the brand. NPS jumped to 77. Repeat purchase rate: 75%. Customer lifetime value increased 306%."}
                quote={"Customer service shouldn't just be a department. It should be the entire company. Culture equals execution. - Tony Hsieh, Zappos"}
            />
          </div>
        </div>
      );
    }

    // Mount the app
        ReactDOM.render(<ServiceApp />, document.getElementById('root'));
  </script>
</body>
</html>
