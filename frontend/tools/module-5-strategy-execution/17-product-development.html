<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Development WTP Testing | Fast Track Program</title>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../shared/js/tool-db.js"></script>
  <script src="../../shared/js/ai-challenge.js"></script>
  <script src="../../shared/js/dependency-injection.js"></script>
    <link rel="stylesheet" href="../../shared/css/cognitive-load.css">
    <script src="../../shared/js/cognitive-load.js"></script>
    <script src="../../js/tool-access-control.js"></script>

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Font preloading to prevent FOUT -->
  <link rel="preload" href="Plaak3Trial-43-Bold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="RiformaLL-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="MonumentGrotesk-Mono.woff2" as="font" type="font/woff2" crossorigin>

  <style>
    /* === FONT FACES === */
    @font-face { font-family: 'Plaak'; src: url('Plaak3Trial-43-Bold.woff2') format('woff2'); font-weight: bold; font-display: swap; }
    @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: normal; font-display: swap; }
    @font-face { font-family: 'Riforma'; src: url('RiformaLL-Regular.woff2') format('woff2'); font-weight: 600; font-display: swap; }
    @font-face { font-family: 'Monument'; src: url('MonumentGrotesk-Mono.woff2') format('woff2'); font-display: swap; }

    /* === BASE RESET === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Riforma', -apple-system, sans-serif; font-size: 16px; color: #000; background: #000; -webkit-font-smoothing: antialiased; }

    /* === CUSTOM SCROLLBAR === */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #333; }
    * { scrollbar-width: thin; scrollbar-color: #000 transparent; }

    /* === TYPOGRAPHY HELPERS === */
    .plaak { font-family: 'Plaak', sans-serif; font-weight: bold; letter-spacing: -0.01em; line-height: 1.2; }
    .monument { font-family: 'Monument', monospace; letter-spacing: 0.05em; }

    /* === LAYOUT FRAME === */
    .tool-frame { background: #fff; min-height: 100vh; }
    .tool-inner { background: #fff; min-height: 100vh; }

    /* === WIZARD LAYOUT === */
    .wizard-layout { display: flex; min-height: 100vh; }
    .wizard-main { flex: 1; display: flex; flex-direction: column; min-height: 100vh; background: #fff; }
    .wizard-content { flex: 1; padding: 48px 32px; max-width: 720px; width: 100%; margin: 0 auto; }

    /* === SIDEBAR === */
    .wizard-sidebar { width: 280px; background: #1a1a1a; min-height: 100vh; padding: 48px 32px; display: flex; flex-direction: column; position: sticky; top: 0; align-self: flex-start; height: 100vh; overflow-y: auto; }
    .wizard-sidebar-inner { padding: 32px 24px; height: 100%; overflow-y: auto; overflow-x: hidden; }
    .sidebar-step-item { padding: 12px; margin-bottom: 8px; border-left: 3px solid transparent; transition: all 0.2s ease; }
    .sidebar-step-item.active { border-left-color: #FFF469; background: #222; }
    .sidebar-step-item.completed { background: #fff; color: #000; border-left-color: #fff; cursor: pointer; }
    .sidebar-step-item.completed:hover { background: #E0E0E0; }
    .sidebar-step-item.locked { opacity: 0.5; }
    .sidebar-step-item .step-num { font-family: 'Riforma', sans-serif; font-size: 14px; }
    .sidebar-step-item .step-name { font-family: 'Riforma', sans-serif; font-size: 14px; }
    .sidebar-snippet { font-size: 12px; margin-top: 4px; opacity: 0.7; line-height: 1.3; }

    /* === STEP HEADER === */
    .step-indicator { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
    .step-time { font-family: 'Monument', monospace; font-size: 11px; color: #6B7280; }
    .step-heading { font-family: 'Plaak', sans-serif; font-weight: bold; font-size: 32px; text-transform: uppercase; letter-spacing: -0.01em; line-height: 1.2; color: #000; margin-bottom: 6px; }
    .step-hint { font-size: 16px; color: #6B7280; line-height: 1.5; margin: 0 0 32px 0; }

    /* === FORM ELEMENTS === */
    .ft-label { display: flex; align-items: center; gap: 6px; font-family: 'Monument', monospace; font-size: 14px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; color: #000; margin-bottom: 8px; }
    .ft-required { color: #DC2626; font-weight: 700; }
    .ft-input { width: 100%; height: 44px; padding: 8px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
    .ft-input:focus { outline: none; border-color: #000; box-shadow: 0 0 0 3px #FFF469; }
    .ft-textarea { width: 100%; min-height: 120px; padding: 12px 16px; font-family: 'Riforma', sans-serif; font-size: 16px; color: #000; background: #fff; border: 1px solid #E5E7EB; resize: none !important; transition: border-color 0.2s ease, box-shadow 0.2s ease; word-wrap: break-word; white-space: pre-wrap; }
    .feature-box { min-height: 120px; word-wrap: break-word; }
    .feature-box textarea, .feature-box input { word-wrap: break-word; }
    .ft-textarea:focus { outline: none; border-color: #000; box-shadow: 0 0 0 3px #FFF469; }
    .ft-help { font-size: 14px; color: #6B7280; margin-top: 4px; line-height: 1.5; }
    .ft-field-group { margin-bottom: 24px; }
    .ft-field-group:last-child { margin-bottom: 0; }
    .ft-section { margin-bottom: 32px; }

    /* === YELLOW INSIGHT BOX === */
    .ft-insight { background: #FFF469; border: 3px solid #000; padding: 16px; margin-bottom: 32px; }

    /* === BUTTON FOOTER === */
    .btn-footer { position: sticky; bottom: 0; z-index: 10; display: flex; justify-content: space-between; align-items: center; padding: 16px 32px; border-top: 1px solid #E5E7EB; background: #fff; width: 100%; }
    .btn-back { background: #fff; color: #000; border: 2px solid #000; padding: 12px 24px; font-family: 'Riforma', sans-serif; font-size: 16px; cursor: pointer; transition: all 0.2s ease; min-height: 44px; }
    .btn-back:hover { background: #F3F4F6; }
    .btn-next { background: #000; color: #fff; border: 2px solid #000; padding: 12px 24px; font-family: 'Riforma', sans-serif; font-size: 16px; cursor: pointer; transition: all 0.2s ease; min-height: 44px; }
    .btn-next:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .btn-next:disabled { background: #E5E7EB; color: #9CA3AF; border-color: #E5E7EB; cursor: not-allowed; }

    /* === MOBILE STEP BAR === */
    .mobile-step-bar { display: none; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; background: #F3F4F6; }
    .mobile-step-bar .bar-text { font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; margin-bottom: 6px; }
    .mobile-progress { height: 3px; background: #E5E7EB; width: 100%; }
    .mobile-progress-fill { height: 100%; background: #000; transition: width 0.3s ease; }

    /* === CANVAS STYLES === */
    .numbered-section { background: #000; color: #fff; padding: 8px 14px; font-size: 14px; font-weight: bold; letter-spacing: 0.5px; display: inline-block; font-family: 'Monument', monospace; }

    /* === ANIMATIONS === */
    @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .animate-in { animation: fadeSlideIn 0.3s ease-out; }

    /* === PRINT === */
    @media print { .no-print { display: none !important; } }

    /* === RESPONSIVE === */
    @media (min-width: 769px) and (max-width: 1024px) { .wizard-sidebar { width: 220px; } .wizard-sidebar-inner { padding: 24px 16px; } }
    @media (max-width: 768px) { .wizard-sidebar { display: none; } .mobile-step-bar { display: block; } .wizard-content { padding: 24px 16px; } .step-heading { font-size: 24px; } .btn-footer { padding: 12px 16px; } }
    @media (max-width: 480px) { .step-heading { font-size: 20px; } .wizard-content { padding: 20px 12px; } }

    /* === TOOL-SPECIFIC === */
    .riforma-bold { font-family: 'Riforma', sans-serif; font-weight: bold; }
    .char-counter { font-size: 14px; color: #666; margin-top: 4px; }
    .char-counter.invalid { color: #EF4444; }
    textarea::placeholder { white-space: pre-line; }

    /* === ITEM NAVIGATOR === */
    .item-nav { display: flex; align-items: center; gap: 6px; margin-bottom: 20px; flex-wrap: wrap; }
    .item-nav-btn { width: 36px; height: 36px; border-radius: 50%; border: 2px solid #000; background: #fff; color: #000; font-family: 'Monument', monospace; font-size: 13px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; padding: 0; }
    .item-nav-btn.active { background: #000; color: #FFF469; border-color: #000; }
    .item-nav-btn.filled { background: #E5E7EB; border-color: #9CA3AF; color: #000; }
    .item-nav-btn.empty { background: #fff; border-color: #D1D5DB; color: #9CA3AF; }
    .item-nav-btn:hover:not(.active) { border-color: #000; background: #F3F4F6; }
    .item-nav-add { height: 36px; border-radius: 18px; border: 2px dashed #9CA3AF; background: #fff; color: #6B7280; font-family: 'Monument', monospace; font-size: 11px; cursor: pointer; padding: 0 14px; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; }
    .item-nav-add:hover { border-color: #000; color: #000; background: #F3F4F6; }
    .section-nav { display: flex; gap: 8px; margin-bottom: 20px; }
    .section-nav-btn { padding: 8px 16px; border: 2px solid #E5E7EB; background: #fff; font-family: 'Monument', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; transition: all 0.15s ease; color: #6B7280; }
    .section-nav-btn.active { border-color: #000; background: #000; color: #FFF469; }
    .section-nav-btn:hover:not(.active) { border-color: #000; color: #000; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, Fragment } = React;

    // Configuration
    const CONFIG = {
      SUPABASE_URL: 'https://lutzzfaedkbsmbobmrzx.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1dHp6ZmFlZGtic21ib2Jtcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDA0MDQsImV4cCI6MjA4NjM3NjQwNH0.o2gJba85vDl4NLS-C8Mq3OudWKxet-b0IqO9kazqb8U',
      TOOL_SLUG: 'product-development',
      AUTOSAVE_DELAY: 2000
    };

    const { createClient } = supabase;
    const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

    // Make Supabase client globally available for dependency injection
    window.supabaseClient = supabaseClient;

    // Initialize ToolDB and dependency injection
    ToolDB.init(CONFIG.TOOL_SLUG);
        ToolAccessControl.init(CONFIG.TOOL_SLUG);

        // Initialize cognitive load components
        CognitiveLoad.init('product-development', {"insights":["Build the minimum viable product, not the maximum imagined product.","WTP analysis before development prevents building unprofitable products."],"caseStudy":{"before":"An FMCG company had a bloated portfolio misaligned with health-conscious consumers. Products were developed from internal ideas with no WTP testing, leading to declining market share and brand perception scores.","after":"After applying Fast Track feature prioritization and MVP testing with real customers, the company launched a targeted organic product line. Market share grew 20% in the first year, brand perception shifted to industry leader in natural products.","quote":"We stopped guessing what customers wanted and started asking what they would actually pay for. That single shift transformed our entire portfolio strategy."}});
        const { FastTrackInsight, ScienceBox, WarningBox, CaseStudy, ScienceBookmarkIcon, ToolGuideDrawer } = CognitiveLoad.components;

    /* ============================================================
       TRANSITION CONTENT
       ============================================================ */
    const TRANSITION_CONTENT = {
        1: {
            title: 'FEATURES MAPPED.',
            text: "You've identified the features that could differentiate your offering. Now plan how to validate them with real customers.",
            brutalTruth: "Every product is merely a range of features wrapped as one. If you skip WTP testing and build from internal ideas, you join the 70% of products that fail. The features you love most might be the ones customers value least.",
            peerProof: "Companies that actively engage customers in product development are 30% more likely to launch successful products (PDMA, 2023). Determining willingness to pay before building is the single most predictive factor of product success."
        },
        2: {
            title: 'INTERVIEWS PLANNED.',
            text: "Your interview plan is set. Time to document what customers actually said about each feature's value.",
            brutalTruth: "What customers say they value and what they will actually pay for are different things. Your job is to uncover both. If nobody would pay for a feature, kill it now -- not after you have built it.",
            peerProof: "Madhavan Ramanujam's research at Simon-Kucher found that structured WTP interviews conducted before product design reduce failure rates from 72% to under 30%."
        },
        3: {
            title: 'DATA COLLECTED.',
            text: "You know what customers value and will pay for. Now design your strategic product portfolio.",
            brutalTruth: "Features scoring 8-10 from multiple segments are must-haves. Features scoring below 5 should be cut immediately, no matter how much your team loves them. Use priority scores to drive every portfolio decision.",
            peerProof: "Feature prioritization based on WTP data reduces time-to-market by 35% and increases first-year revenue by 25-40% (Product Development and Management Association)."
        },
        4: {
            title: 'PORTFOLIO DESIGNED.',
            text: "Your products have clear strategic roles. Now create the implementation plan to execute.",
            brutalTruth: "A 'flat' portfolio with no differentiation between product roles makes buying decisions harder and leaves money on the table. Every product must serve a storyteller, top-line, or profit role -- or be discontinued.",
            peerProof: "BCG's 2023 study shows companies with clearly defined product roles achieve 25% higher profit margins and 40% more efficient marketing spend than undifferentiated portfolios."
        },
        5: {
            title: 'PLAN LOCKED.',
            text: "Your product development strategy is validated by real customer data. Execute with conviction.",
            brutalTruth: "Legacy products -- the 'undead dead' -- are the main reason for strategy confusion and cash drain. Speed of execution separates Fast Track companies from the rest. Kill underperformers, launch winners, measure ruthlessly.",
            peerProof: "Companies implementing structured portfolio reviews with clear kill criteria reduce time-to-market by 40% and achieve 30% higher ROI on product development investment (Bain & Company, 2023)."
        }
    };

    /* ============================================================
       SHARED COMPONENTS
       ============================================================ */
    function CheckIcon({ color = "#fff", size = 16 }) {
        return <svg width={size} height={size} viewBox="0 0 24 24" fill={color}><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>;
    }

    function ButtonFooter({ onBack, onNext, nextLabel = 'Next', showBack = true, disabled = false }) {
        return (
            <div className="btn-footer no-print">
                {showBack ? <button className="btn-back" onClick={onBack}>&larr; Back</button> : <div />}
                <button className="btn-next" disabled={disabled} onClick={onNext}>{nextLabel} &rarr;</button>
            </div>
        );
    }

    function MobileStepBar({ currentStep, totalSteps }) {
        const total = totalSteps || 5;
        const progress = currentStep >= 999 ? 100 : Math.round((currentStep / total) * 100);
        return (
            <div className="mobile-step-bar no-print">
                <div className="bar-text">Step {Math.min(currentStep, total)} of {total}</div>
                <div className="mobile-progress"><div className="mobile-progress-fill" style={{ width: `${progress}%` }} /></div>
            </div>
        );
    }

    function DependencyContext({ deps }) {
        const [open, setOpen] = React.useState(false);
        if (!deps || deps.length === 0) return null;
        return (
            <div style={{ marginBottom: '16px' }}>
                <button onClick={() => setOpen(o => !o)} style={{ display: 'flex', alignItems: 'center', gap: 8, background: '#FFF9E0', border: '1px solid #F0E68C', borderLeft: '3px solid #DAA520', padding: '8px 14px', fontSize: 12, fontFamily: "'Monument', monospace", letterSpacing: '0.05em', textTransform: 'uppercase', cursor: 'pointer', color: '#555', width: '100%' }}>
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#DAA520" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    CONTEXT FROM PREVIOUS TOOLS ({deps.length})
                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#999" strokeWidth="2" style={{ marginLeft: 'auto', transform: open ? 'rotate(180deg)' : 'none', transition: 'transform 0.2s' }}><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                {open && (
                    <div style={{ border: '1px solid #F0E68C', borderTop: 'none', padding: '12px 14px' }}>
                        {deps.map((dep, i) => (
                            <div key={i} style={{ background: '#fff', padding: '8px 0', borderBottom: i < deps.length - 1 ? '1px solid #F0E68C' : 'none', fontSize: '13px' }}>
                                <div style={{ fontWeight: 600, marginBottom: '2px', color: '#333', fontSize: '11px', fontFamily: "'Monument', monospace", letterSpacing: '0.04em', textTransform: 'uppercase' }}>{dep.label}</div>
                                <div style={{ color: '#555', whiteSpace: 'pre-wrap' }}>{dep.value}</div>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    }

    function CoachFeedbackPanel() {
        const [expanded, setExpanded] = useState(false);
        const [feedback, setFeedback] = useState(null);
        useEffect(() => {
            const check = () => { if (window.AIChallenge && window.AIChallenge.getLastFeedback) setFeedback(window.AIChallenge.getLastFeedback()); };
            check(); const interval = setInterval(check, 2000); return () => clearInterval(interval);
        }, []);
        if (!feedback) return null;
        return (
            <div style={{ marginTop: 24, borderTop: '1px solid #333', paddingTop: 16 }}>
                <button onClick={() => setExpanded(!expanded)} style={{ background: 'none', border: 'none', color: '#FFF469', cursor: 'pointer', fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', display: 'flex', alignItems: 'center', gap: 6, padding: 0, width: '100%' }}>
                    <span style={{ transform: expanded ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block' }}>&#9654;</span> COACH FEEDBACK
                </button>
                {expanded && (
                    <div style={{ marginTop: 10, fontSize: 12, color: '#ccc', lineHeight: 1.5 }}>
                        {feedback.type === 'approved' && <p style={{ color: '#FFF469' }}>{feedback.message}</p>}
                        {feedback.type === 'challenges' && (<>
                            {feedback.encouragement && <p style={{ color: '#FFF469', marginBottom: 8 }}>{feedback.encouragement}</p>}
                            {feedback.challenges && feedback.challenges.map((ch, i) => (
                                <div key={i} style={{ marginBottom: 8, paddingLeft: 8, borderLeft: '2px solid #555' }}>
                                    <div style={{ fontSize: 10, color: '#999', marginBottom: 2 }}>{ch.question_text || ch.question_key}</div>
                                    <div>{ch.feedback}</div>
                                </div>
                            ))}
                        </>)}
                    </div>
                )}
            </div>
        );
    }

    function WizardSidebar({ currentStep, data, onNavigate }) {
        const steps = [
            { num: 1, label: 'Feature ID', time: '~5 min' },
            { num: 2, label: 'Interview Setup', time: '~5 min' },
            { num: 3, label: 'WTP Results', time: '~10 min' },
            { num: 4, label: 'Portfolio Design', time: '~8 min' },
            { num: 5, label: 'Implementation', time: '~5 min' }
        ];
        const getSnippet = (n) => {
            if (n === 1 && data.features.some(f => f.name)) return data.features.filter(f => f.name).length + ' features listed';
            if (n === 2 && data.targetCustomers) return '"' + data.targetCustomers.substring(0, 50) + '..."';
            if (n === 3 && data.wtpResults.some(r => r.priorityScore)) return data.wtpResults.filter(r => r.priorityScore).length + ' features scored';
            if (n === 4 && data.storytellers.some(s => s.product)) return 'Portfolio categorized';
            if (n === 5 && data.quickWins) return '"' + data.quickWins.substring(0, 50) + '..."';
            return null;
        };
        return (
            <div className="wizard-sidebar no-print">
                <div className="wizard-sidebar-inner">
                    <div style={{ marginBottom: 24 }}>
                        <div className="monument" style={{ fontSize: 12, textTransform: 'uppercase', color: '#fff', marginBottom: 4 }}>PRODUCT DEV</div>
                        <div style={{ fontSize: 13, color: '#999' }}>~33 min total</div>
                    </div>
                    <div style={{ marginBottom: 16, fontFamily: "'Monument', monospace", fontSize: 10, textTransform: 'uppercase', letterSpacing: '0.05em', color: '#999' }}>Your journey</div>
                    {steps.map(s => {
                        const effectiveStep = Math.ceil(currentStep);
                        const isCompleted = effectiveStep > s.num, isActive = effectiveStep === s.num, isLocked = effectiveStep < s.num;
                        const snippet = isCompleted ? getSnippet(s.num) : null;
                        return (
                            <div key={s.num} className={`sidebar-step-item ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''} ${isLocked ? 'locked' : ''}`}
                                onClick={() => isCompleted && onNavigate && onNavigate(s.num)} title={isCompleted ? 'Click to review this step' : ''}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                    {isCompleted ? <CheckIcon color="#000" size={14} /> : <span className="step-num" style={{ color: isActive ? '#fff' : '#ccc' }}>{String(s.num).padStart(2, '0')}</span>}
                                    <span className="step-name" style={{ color: isLocked ? '#666' : isCompleted ? '#000' : '#fff' }}>{s.label}</span>
                                </div>
                                {snippet && <div className="sidebar-snippet">{snippet}</div>}
                            </div>
                        );
                    })}
                    <CoachFeedbackPanel />
                </div>
            </div>
        );
    }

    // Main App Component
    function WTPApp() {
            const [deps, setDeps] = useState([]);
      const [step, setStep] = useState(0);
      const [aiReviewing, setAiReviewing] = useState(false);
      const [aiMessage, setAiMessage] = useState('');
      const [submitStatus, setSubmitStatus] = useState(null);
      const [submitMessage, setSubmitMessage] = useState('');
      const [featureIdx, setFeatureIdx] = useState(0);
      const [wtpIdx, setWtpIdx] = useState(0);
      const [portfolioSection, setPortfolioSection] = useState(0);
      const [portfolioIdx, setPortfolioIdx] = useState(0);

      const [data, setData] = useState({
        // Step 1: Feature Identification
        features: [
          { id: 1, name: '', description: '', currentState: '' }
        ],

        // Step 2: Interview Setup
        targetCustomers: '',
        numberOfInterviews: '',
        interviewFormat: '',
        keyQuestions: '',

        // Step 3: WTP Testing Results
        wtpResults: [],

        // Step 4: Product Portfolio
        storytellers: [{ id: 1, product: '', reason: '', targetPercentage: '' }],
        topLineContributors: [{ id: 1, product: '', features: '', pricingStrategy: '' }],
        profitContributors: [{ id: 1, product: '', uniqueFeatures: '', marginTarget: '' }],

        // Step 5: Implementation Plan
        quickWins: '',
        resourceAllocation: '',
        timeline: '',
        successMetrics: ''
      });

            useEffect(() => {
                async function loadDeps() {
                    const userId = localStorage.getItem('ft_user_id');
                    if (!userId || !window.ToolDB || !window.DependencyInjection) return;
                    try {
                        await ToolDB.whenReady();
                        const config = DependencyInjection.getDependenciesConfig();
                        const toolConfig = config[CONFIG.TOOL_SLUG];
                        if (!toolConfig || !toolConfig.fields) return;
                        const loaded = [];
                        for (const field of toolConfig.fields) {
                            const val = await ToolDB.getDependency(userId, field.source_field);
                            if (val) {
                                loaded.push({ label: field.display_label || field.source_field, value: window.DependencyInjection ? DependencyInjection.formatValue(val) : (typeof val === 'object' ? JSON.stringify(val, null, 2) : String(val)) });
                            }
                        }
                        setDeps(loaded);
                    } catch (err) {
                        console.warn('[' + CONFIG.TOOL_SLUG + '] Failed to load dependencies:', err);
                    }
                }
                loadDeps();
            }, []);

      // Load from localStorage
      useEffect(() => {
        const saved = localStorage.getItem('wtp-tool-data');
        if (saved) {
          try {
            const savedData = JSON.parse(saved);
            setData(savedData);
          } catch (e) {
            console.error('Error loading saved data:', e);
          }
        }
      }, []);

      // Auto-save every 2 seconds
      useEffect(() => {
        const interval = setInterval(() => {
          localStorage.setItem('wtp-tool-data', JSON.stringify(data));
        }, 2000);
        return () => clearInterval(interval);
      }, [data]);

      // Initialize WTP results when features change
      useEffect(() => {
        if (data.features.length > 0 && data.wtpResults.length === 0) {
          const results = data.features.map(f => ({
            featureId: f.id,
            featureName: f.name,
            customerValue: '',
            willingnessToPay: '',
            competitiveAdvantage: '',
            priorityScore: ''
          }));
          updateData('wtpResults', results);
        }
      }, [data.features]);

      const updateData = (field, value) => {
        setData({ ...data, [field]: value });
      };

      const addFeature = () => {
        const newFeature = { id: Date.now(), name: '', description: '', currentState: '' };
        updateData('features', [...data.features, newFeature]);
        setFeatureIdx(data.features.length);
      };

      const removeFeature = (id) => {
        updateData('features', data.features.filter(f => f.id !== id));
      };

      const updateFeature = (id, field, value) => {
        const updated = data.features.map(f => f.id === id ? { ...f, [field]: value } : f);
        updateData('features', updated);
      };

      const addPortfolioItem = (category) => {
        const newItem = { id: Date.now(), product: '', reason: '', targetPercentage: '' };
        updateData(category, [...data[category], newItem]);
        setPortfolioIdx(data[category].length);
      };

      const removePortfolioItem = (category, id) => {
        updateData(category, data[category].filter(item => item.id !== id));
      };

      const updatePortfolioItem = (category, id, field, value) => {
        const updated = data[category].map(item => item.id === id ? { ...item, [field]: value } : item);
        updateData(category, updated);
      };

      const updateWTPResult = (featureId, field, value) => {
        const updated = data.wtpResults.map(r => r.featureId === featureId ? { ...r, [field]: value } : r);
        updateData('wtpResults', updated);
      };

      /* PRESERVED: AI-gated step navigation */
      const handleStepNext = async (nextStepValue, stepAnswers, stepName) => {
          const userId = localStorage.getItem('ft_user_id');
          if (!userId) { setAiMessage(''); setStep(nextStepValue); return; }
          setAiReviewing(true);
          try {
              const canProceed = await window.AIChallenge.reviewStep(userId, CONFIG.TOOL_SLUG, stepAnswers, stepName);
              if (canProceed) {
                  setAiMessage('');
                  setStep(nextStepValue);
              } else {
                  setAiMessage(window.AIChallenge?.getLastFeedback?.()?.suggestion || 'Please expand your answer before continuing.');
              }
          } catch (err) {
              console.warn('[AIChallenge] Error, allowing passage:', err);
              setAiMessage('');
              setStep(nextStepValue);
          } finally { setAiReviewing(false); }
      };

      // Validation functions
      const isStep1Valid = () => {
        return data.features.some(f => f.name.trim().length >= 2);
      };

      const isStep2Valid = () => {
        return data.targetCustomers.length >= 30 &&
               data.numberOfInterviews.length >= 1 &&
               data.interviewFormat.length >= 10 &&
               data.keyQuestions.length >= 50;
      };

      const isStep3Valid = () => {
        return data.wtpResults.length > 0 &&
               data.wtpResults.every(r =>
                 r.customerValue.length >= 20 &&
                 r.willingnessToPay.length >= 5 &&
                 r.priorityScore.length >= 1
               );
      };

      const isStep4Valid = () => {
        return data.storytellers.some(s => s.product.length >= 3) &&
               data.topLineContributors.some(t => t.product.length >= 3) &&
               data.profitContributors.some(p => p.product.length >= 3);
      };

      const isStep5Valid = () => {
        return data.quickWins.length >= 30 &&
               data.resourceAllocation.length >= 30 &&
               data.timeline.length >= 20 &&
               data.successMetrics.length >= 30;
      };

      const exportPDF = async () => {
        try {
          const canvas = document.getElementById('canvas-content');
          if (!canvas) {
            alert('Canvas not found');
            return;
          }

          // Hide images to avoid CORS
          const images = canvas.querySelectorAll('img');
          const imageStates = [];
          images.forEach(img => {
            imageStates.push({ img, display: img.style.display });
            img.style.display = 'none';
          });

          const canvasImage = await html2canvas(canvas, {
            scale: 2,
            logging: false,
            backgroundColor: '#ffffff'
          });

          // Restore images
          imageStates.forEach(({ img, display }) => {
            img.style.display = display;
          });

          const imgWidth = 190;
          const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');
          const imgData = canvasImage.toDataURL('image/png');

          pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
          pdf.save('product-development-wtp-testing.pdf');
        } catch (error) {
          console.error('PDF export error:', error);
          alert('Failed to export PDF: ' + error.message);
        }
      };

      const handleSubmit = async () => {
        try {
          const userId = localStorage.getItem('ft_user_id');
          if (!userId) {
            alert('User not authenticated. Please return to the dashboard.');
            return;
          }

          const questionMappings = {
            feature_list: data.features,
            portfolio: {
              storytellers: data.storytellers,
              topLineContributors: data.topLineContributors,
              profitContributors: data.profitContributors
            }
          };

          await window.AIChallenge.submitWithChallenge(userId, CONFIG.TOOL_SLUG, questionMappings, {
            onReviewStart: () => { setSubmitMessage('AI coach is reviewing...'); },
            onRevise: () => { setSubmitStatus(null); setSubmitMessage(''); setStep(5); },
            onSubmitAnyway: () => { setSubmitStatus('success'); setSubmitMessage('Submission saved successfully!'); },
            onError: (err) => { setSubmitStatus('error'); setSubmitMessage('Failed to save: ' + err.message); }
          });
        } catch (error) {
          console.error('Submit error:', error);
          alert('Submission failed: ' + error.message);
        }
      };

      return (
        <div className="tool-frame">
          <div className="tool-inner">
            {/* Step 0: Cover */}
            {step === 0 && (
              <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative', overflow: 'hidden' }}>
                <div style={{ position: 'absolute', inset: 0, backgroundImage: 'url("https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=1920&q=80")', backgroundSize: 'cover', backgroundPosition: 'center', opacity: 0.5 }} />
                <div style={{ position: 'relative', textAlign: 'center', color: '#fff', padding: '0 32px' }} className="animate-in">
                  <h1 className="plaak" style={{ fontSize: 80, marginBottom: 16, textTransform: 'uppercase' }}>PRODUCT DEVELOPMENT</h1>
                  <p style={{ fontSize: 18, color: '#ccc', marginBottom: 48 }}>Discover what features customers value and will pay for</p>
                  <button onClick={() => setStep(0.5)}
                    style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease', minHeight: 44 }}
                    onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                    onMouseOut={e => { e.target.style.background = '#fff'; }}
                  >START</button>
                </div>
              </div>
            )}

            {/* Step 0.5: Intro */}
            {step === 0.5 && <IntroPage onNext={() => { setFeatureIdx(0); setStep(1); }} />}

            {/* Steps 1-5: Wizard */}
            {[1,2,3,4,5].includes(step) && (
              <div className="wizard-layout">
                <div className="wizard-main">
                  <MobileStepBar currentStep={step} totalSteps={5} />
                  <div className="wizard-content animate-in">
                    {step === 1 && <><DependencyContext deps={deps} /><Step1Page data={data} updateFeature={updateFeature} addFeature={addFeature} removeFeature={removeFeature} featureIdx={featureIdx} setFeatureIdx={setFeatureIdx} /></>}
                    {step === 2 && <Step2Page data={data} updateData={updateData} />}
                    {step === 3 && <Step3Page data={data} updateWTPResult={updateWTPResult} wtpIdx={wtpIdx} setWtpIdx={setWtpIdx} />}
                    {step === 4 && <Step4Page data={data} updatePortfolioItem={updatePortfolioItem} addPortfolioItem={addPortfolioItem} removePortfolioItem={removePortfolioItem} portfolioSection={portfolioSection} setPortfolioSection={setPortfolioSection} portfolioIdx={portfolioIdx} setPortfolioIdx={setPortfolioIdx} />}
                    {step === 5 && <Step5Page data={data} updateData={updateData} />}
                  </div>
                  <ButtonFooter
                    onBack={() => {
                      if (step === 1) {
                        if (featureIdx > 0) { setFeatureIdx(featureIdx - 1); }
                        else { setStep(0); }
                      } else if (step === 3) {
                        if (wtpIdx > 0) { setWtpIdx(wtpIdx - 1); }
                        else { setStep(2); }
                      } else if (step === 4) {
                        const cats = ['storytellers', 'topLineContributors', 'profitContributors'];
                        if (portfolioIdx > 0) { setPortfolioIdx(portfolioIdx - 1); }
                        else if (portfolioSection > 0) {
                          const prevSec = portfolioSection - 1;
                          setPortfolioSection(prevSec);
                          setPortfolioIdx(Math.max(0, data[cats[prevSec]].length - 1));
                        } else { setStep(3); }
                      } else {
                        setStep(step - 1);
                      }
                    }}
                    onNext={() => {
                      if (step === 1) {
                        if (featureIdx < data.features.length - 1) { setFeatureIdx(featureIdx + 1); return; }
                        if (!isStep1Valid()) return;
                        handleStepNext(1.5, { feature_list: data.features }, 'Feature Identification');
                      } else if (step === 2) {
                        if (!isStep2Valid()) return;
                        setWtpIdx(0);
                        handleStepNext(2.5, { targetCustomers: data.targetCustomers, numberOfInterviews: data.numberOfInterviews, interviewFormat: data.interviewFormat, keyQuestions: data.keyQuestions }, 'Interview Setup');
                      } else if (step === 3) {
                        if (wtpIdx < data.wtpResults.length - 1) { setWtpIdx(wtpIdx + 1); return; }
                        if (!isStep3Valid()) return;
                        setPortfolioSection(0); setPortfolioIdx(0);
                        handleStepNext(3.5, { wtpResults: data.wtpResults }, 'WTP Testing Results');
                      } else if (step === 4) {
                        const cats = ['storytellers', 'topLineContributors', 'profitContributors'];
                        if (portfolioIdx < data[cats[portfolioSection]].length - 1) { setPortfolioIdx(portfolioIdx + 1); return; }
                        if (portfolioSection < 2) { setPortfolioSection(portfolioSection + 1); setPortfolioIdx(0); return; }
                        if (!isStep4Valid()) return;
                        handleStepNext(4.5, { portfolio: { storytellers: data.storytellers, topLineContributors: data.topLineContributors, profitContributors: data.profitContributors } }, 'Product Portfolio');
                      } else if (step === 5) {
                        if (!isStep5Valid()) return;
                        handleStepNext(5.5, { quickWins: data.quickWins, resourceAllocation: data.resourceAllocation, timeline: data.timeline, successMetrics: data.successMetrics }, 'Implementation Plan');
                      }
                    }}
                    disabled={aiReviewing}
                    nextLabel={aiReviewing ? 'AI Coach Reviewing...' : step === 5 ? 'View Canvas' : 'Next'}
                    showBack={true}
                  />
                  {aiMessage && <div style={{color:'#dc2626', fontSize:'13px', marginTop:'8px', padding:'8px 12px 8px 32px', background:'#fef2f2', borderRadius:'6px'}}>{aiMessage}</div>}
                </div>
                <WizardSidebar currentStep={step} data={data} onNavigate={setStep} />
              </div>
            )}

            {/* Transition screens */}
            {[1.5, 2.5, 3.5, 4.5, 5.5].includes(step) && (() => {
              const completedStep = Math.floor(step);
              const nextStep = completedStep === 5 ? 6 : completedStep + 1;
              const t = TRANSITION_CONTENT[completedStep];
              return (
                <div style={{ minHeight: '100vh', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <div style={{ maxWidth: 640, padding: '0 32px', textAlign: 'center', color: '#fff' }} className="animate-in">
                    <div className="monument" style={{ fontSize: 12, color: '#FFF469', letterSpacing: '0.1em', marginBottom: 16 }}>STEP {completedStep} OF 5 COMPLETE</div>
                    <h1 className="plaak" style={{ fontSize: 48, marginBottom: 12 }}>{t.title}</h1>
                    <p style={{ fontSize: 16, color: '#ccc', marginBottom: 48 }}>{t.text}</p>
                    <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #FFF469', padding: '20px 24px', marginBottom: 24, textAlign: 'left' }}>
                      <span className="monument" style={{ fontSize: 10, color: '#FFF469', display: 'block', marginBottom: 8 }}>BRUTAL TRUTH</span>
                      <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7 }}>{t.brutalTruth}</p>
                    </div>
                    <div style={{ background: '#111', border: '1px solid #333', borderLeft: '4px solid #666', padding: '20px 24px', marginBottom: 48, textAlign: 'left' }}>
                      <span className="monument" style={{ fontSize: 10, color: '#999', display: 'block', marginBottom: 8 }}>PEER PROOF</span>
                      <p style={{ fontSize: 14, color: '#ccc', lineHeight: 1.7, fontStyle: 'italic' }}>{t.peerProof}</p>
                    </div>
                    <button onClick={() => setStep(nextStep)}
                      style={{ background: '#fff', color: '#000', border: 'none', padding: '16px 48px', fontSize: 16, fontFamily: "'Monument', monospace", letterSpacing: '0.1em', textTransform: 'uppercase', cursor: 'pointer', transition: 'all 0.2s ease' }}
                      onMouseOver={e => { e.target.style.background = '#FFF469'; }}
                      onMouseOut={e => { e.target.style.background = '#fff'; }}
                    >CONTINUE</button>
                  </div>
                </div>
              );
            })()}

            {/* Step 6: Canvas */}
            {step === 6 && <CanvasPage data={data} onExport={exportPDF} onSubmit={handleSubmit} />}
          </div>
        </div>
      );
    }

    /* CoverPage is now inline in WTPApp render */

    // Intro Page Component
    function IntroPage({ onNext }) {
      return (
        <div className="bg-black text-white min-h-screen p-16">
          <div className="max-w-5xl mx-auto">
            <h1 className="plaak mb-16 animate-in" style={{fontSize: '100px'}}>
              BEFORE WE START
            </h1>

            {/* Sprint Info */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.05s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>SPRINT INFO</h2>
              <div className="bg-white text-black p-8">
                <p className="text-2xl font-bold mb-4">Sprint 17: Product Development - WTP Testing</p>
                <p className="text-xl leading-relaxed mb-4">
                  70% of new products fail because they don&apos;t align with actual customer needs and willingness to pay. This sprint helps you test what features customers value BEFORE you build.
                </p>
                <div className="border-l-4 border-black pl-4 italic text-lg">
                  &quot;Products are made in the factory, but brands are created in the mind.&quot; — Walter Landor
                </div>
              </div>
            </div>

            {/* Purpose */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <h2 className="plaak text-6xl mb-6">PURPOSE</h2>

              <div className="border-l-4 border-white pl-6 mb-6">
                <p className="text-3xl italic mb-2">&quot;A strategic product portfolio has storytellers for differentiation, top line contributors for volume, and profit contributors for margin.&quot;</p>
                <p className="text-xl text-gray-400">— GARDENER&apos;S STRATEGY METAPHOR</p>
              </div>

              <p className="text-3xl leading-relaxed mb-4">
                Most companies build products based on internal ideas, then wonder why customers don&apos;t buy. This tool helps you understand customer willingness to pay and design a strategic product portfolio.
              </p>
            </div>

            {/* Mistakes to Avoid */}
            <div className="mb-12 animate-in" style={{animationDelay: '0.2s'}}>
              <h2 className="plaak text-6xl mb-6" style={{color: '#FFF469'}}>MISTAKES TO AVOID</h2>

              <div className="bg-white text-black p-6 mb-6 border-4 border-yellow-400">
                <p className="riforma-bold text-2xl mb-4">COMMON PRODUCT DEVELOPMENT FAILURES:</p>
                <ul className="text-xl space-y-3">
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">1.</span>
                    <span><strong>Developing products from internal ideas only:</strong> Not testing customer demand before building leads to wasted resources</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">2.</span>
                    <span><strong>Deciding price after product development:</strong> You should determine willingness to pay FIRST, then build</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">3.</span>
                    <span><strong>Not testing market fit before full launch:</strong> 70% of products fail due to misalignment with customer needs</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">4.</span>
                    <span><strong>Being slow to kill underperforming products:</strong> Drains resources from winners and confuses your market position</span>
                  </li>
                  <li className="flex items-start">
                    <span className="text-3xl mr-3">5.</span>
                    <span><strong>Sending conflicting messages:</strong> Portfolio should tell a coherent strategy story to customers</span>
                  </li>
                </ul>
              </div>
            </div>

            {/* The Journey */}
            <div className="mb-16 animate-in" style={{animationDelay: '0.3s'}}>
              <h2 className="plaak text-6xl mb-8">THE JOURNEY</h2>
              <div className="grid grid-cols-5 gap-4 text-center">
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">01</div>
                  <p className="text-xl font-bold mb-2">FEATURES</p>
                  <p className="text-base text-gray-400">Identify 10-15 features</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">02</div>
                  <p className="text-xl font-bold mb-2">INTERVIEWS</p>
                  <p className="text-base text-gray-400">Setup customer interviews</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">03</div>
                  <p className="text-xl font-bold mb-2">WTP RESULTS</p>
                  <p className="text-base text-gray-400">Document customer value</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">04</div>
                  <p className="text-xl font-bold mb-2">PORTFOLIO</p>
                  <p className="text-base text-gray-400">Design strategic mix</p>
                </div>
                <div className="border-2 border-white p-6">
                  <div className="text-8xl plaak mb-4">05</div>
                  <p className="text-xl font-bold mb-2">IMPLEMENT</p>
                  <p className="text-base text-gray-400">Action plan</p>
                </div>
              </div>
            </div>

            {/* Next Button */}
            <button
              onClick={onNext}
              className="btn-primary w-full text-3xl py-8 plaak"
            >
              LET&apos;S START →
            </button>
          </div>
        </div>
      );
    }

    /* TransitionScreen is now inline in WTPApp render using TRANSITION_CONTENT */

    // Step 1: Feature Identification
    function Step1Page({ data, updateFeature, addFeature, removeFeature, featureIdx, setFeatureIdx }) {
      const feature = data.features[featureIdx] || data.features[0];
      const idx = Math.min(featureIdx, data.features.length - 1);
      const isFilled = (i) => { const f = data.features[i]; return f && f.name && f.name.trim().length >= 2; };

      return (
        <>
            <div className="step-indicator"><span>STEP 01 OF 5 &middot; Feature {idx + 1} of {data.features.length}</span><span className="step-time">~5 min</span></div>
            <h2 className="step-heading">FEATURE IDENTIFICATION</h2>
            <p className="step-hint">List 10-15 features that could differentiate your offering. Test these with customers to find what they'll actually pay for.</p>

            {/* Item Navigator */}
            <div className="item-nav">
              {data.features.map((f, i) => (
                <button key={f.id} className={`item-nav-btn ${i === idx ? 'active' : isFilled(i) ? 'filled' : 'empty'}`} onClick={() => setFeatureIdx(i)}>{i + 1}</button>
              ))}
              <button className="item-nav-add" onClick={addFeature}>+ ADD</button>
            </div>

            {/* Fast Track Insight */}
            {(data.features[0].description || '').length >= 20 && (
                <div className="ft-reveal">
                    <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                    <p className="ft-reveal-text">70% of new products fail to meet revenue or market share expectations due to misalignment with customer needs (Product Development and Management Association, 2023). Companies that actively engage customers in product development are 30% more likely to launch successful products. Research by Madhavan Ramanujam at Simon-Kucher &amp; Partners found that determining willingness to pay before building -- not after -- is the single most predictive factor of product success.</p>
                </div>
            )}

            <div className="border-l-4 border-yellow-400 pl-6 mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              <p className="text-lg italic text-gray-700">
                &quot;Products are made in the factory, but brands are created in the mind. Start with what customers value, not what your factory can make.&quot;
              </p>
              <p className="text-sm text-gray-500 mt-2">— Walter Landor</p>
            </div>

            {/* Single Feature Card */}
            <div className="mb-12" key={idx}>
                <div className="bg-gray-50 border-2 border-gray-200 p-6 mb-6 animate-in feature-box">
                  <div className="flex justify-between items-start mb-4">
                    <h4 className="riforma-bold text-2xl">Feature {idx + 1}</h4>
                    {data.features.length > 1 && (
                      <button
                        onClick={() => { removeFeature(feature.id); if (idx >= data.features.length - 1) setFeatureIdx(Math.max(0, data.features.length - 2)); }}
                        className="text-red-600 hover:text-red-800 text-sm"
                      >
                        REMOVE
                      </button>
                    )}
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="monument text-sm block mb-2">FEATURE NAME <span className="text-red-500">*</span></label>
                      <ScienceBookmarkIcon>
                          A product should have ONE leading feature and supporting ones. Pirelli P Zero tires lead with high-speed capability, supported by superior traction and low noise (Fast Track Feature Prioritization Method).
                      </ScienceBookmarkIcon>
                      <input
                        type="text"
                        value={feature.name}
                        onChange={(e) => updateFeature(feature.id, 'name', e.target.value)}
                        placeholder="Real-time inventory synchronization"
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">DESCRIPTION &amp; VALUE <span className="text-red-500">*</span></label>
                      <ScienceBookmarkIcon>
                          Companies optimizing their product portfolios annually report 25% higher profit margins on average. Describe the customer outcome, not just the technical capability (Harvard Business Review, 2022).
                      </ScienceBookmarkIcon>
                      <p className="text-sm text-gray-600 mb-2">What does this feature do? What customer pain does it solve?</p>
                      <textarea
                        value={feature.description}
                        onChange={(e) => updateFeature(feature.id, 'description', e.target.value)}
                        onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                        placeholder="Automatically syncs inventory across 3 warehouses and 2 retail locations. Reduces stockouts by showing real-time availability to sales team. Currently customers wait 24-48 hours for inventory confirmation, losing deals."
                        rows={4}
                        className="w-full"
                        style={{ resize: 'none', overflow: 'hidden' }}
                      />
                      <div className={`char-counter ${feature.description.length < 20 ? 'invalid' : ''}`}>
                        {feature.description.length}/500 (min 20 characters)
                      </div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">CURRENT STATE</label>
                      <ScienceBookmarkIcon>
                          The cost of misaligned product development can exceed $100M annually for major enterprises. Documenting the current state gap quantifies the opportunity for customers and your pricing team.
                      </ScienceBookmarkIcon>
                      <input
                        type="text"
                        value={feature.currentState}
                        onChange={(e) => updateFeature(feature.id, 'currentState', e.target.value)}
                        placeholder="Manual inventory checks, 24-hour lag, 15% stockout rate"
                        className="w-full"
                      />
                    </div>
                  </div>
                </div>
            </div>
        </>
      );
    }

    // Step 2: Interview Setup
    function Step2Page({ data, updateData }) {
      return (
        <>
            <div className="step-indicator"><span>STEP 02</span><span className="step-time">~5 min</span></div>
            <h2 className="step-heading">INTERVIEW SETUP</h2>
            <p className="step-hint">Plan structured interviews to understand customer value and willingness to pay.</p>

            {/* Fast Track Insight */}

            {(data.targetCustomers || '').length >= 20 && (
                <div className="ft-reveal">
                    <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                    <p className="ft-reveal-text">A consumer goods company that involved customers through virtual testing platforms enhanced product acceptance by 40% at launch (Fast Track Case Study Database). Madhavan Ramanujam's research at Simon-Kucher, published in "Monetizing Innovation" (Wiley, 2016), found that structured WTP interviews conducted before product design reduce failure rates from 72% to under 30%. The key: ask about willingness to pay early, not after the product is built.</p>
                </div>
            )}


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Plan structured interviews to understand customer value
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="text-2xl italic">
                &quot;70% of new products fail because they don&apos;t align with actual customer needs. Direct customer conversations reveal what they value versus what you assume.&quot;
              </p>
            </div>

            <div className="space-y-8">
              <div className="animate-in" style={{animationDelay: '0.15s'}}>
                <label className="monument text-sm block mb-3">TARGET CUSTOMER SEGMENTS <span className="text-red-500">*</span></label>
                <p className="text-base text-gray-600 mb-3">Who will you interview? Be specific about segments and decision-makers.</p>
                <textarea
                  value={data.targetCustomers}
                  onChange={(e) => updateData('targetCustomers', e.target.value)}
                  onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                  placeholder="CFOs at mid-market manufacturing companies ($50M-$200M revenue), currently using QuickBooks or legacy ERP systems. Decision-makers who control IT budget and experience inventory management pain."
                  rows={4}
                  className="w-full"
                  style={{ resize: 'none', overflow: 'hidden' }}
                />
                <div className={`char-counter ${data.targetCustomers.length < 30 ? 'invalid' : ''}`}>
                  {data.targetCustomers.length}/500 (min 30 characters)
                </div>
              </div>

              <div className="animate-in" style={{animationDelay: '0.2s'}}>
                <label className="monument text-sm block mb-3">NUMBER OF INTERVIEWS PLANNED <span className="text-red-500">*</span></label>
                <input
                  type="text"
                  value={data.numberOfInterviews}
                  onChange={(e) => updateData('numberOfInterviews', e.target.value)}
                  placeholder="12-15 interviews (4-5 per customer segment)"
                  className="w-full"
                />
              </div>

              <div className="animate-in" style={{animationDelay: '0.25s'}}>
                <label className="monument text-sm block mb-3">INTERVIEW FORMAT & DURATION <span className="text-red-500">*</span></label>
                <input
                  type="text"
                  value={data.interviewFormat}
                  onChange={(e) => updateData('interviewFormat', e.target.value)}
                  placeholder="45-minute Zoom calls, recorded with permission, conducted by product manager + sales lead"
                  className="w-full"
                />
              </div>

              <div className="animate-in" style={{animationDelay: '0.3s'}}>
                <label className="monument text-sm block mb-3">KEY QUESTIONS TO ASK <span className="text-red-500">*</span></label>
                <p className="text-base text-gray-600 mb-3">What will you ask to understand customer value and willingness to pay?</p>
                <textarea
                  value={data.keyQuestions}
                  onChange={(e) => updateData('keyQuestions', e.target.value)}
                  onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                  placeholder={'1. Walk me through your current inventory management process\n2. What does it cost you when inventory data is inaccurate?\n3. If we could solve X problem, what would that be worth to you?\n4. How do you currently budget for inventory management tools?\n5. What would make you switch from your current solution?'}
                  rows={6}
                  className="w-full"
                  style={{ resize: 'none', overflow: 'hidden' }}
                />
                <div className={`char-counter ${data.keyQuestions.length < 50 ? 'invalid' : ''}`}>
                  {data.keyQuestions.length}/1000 (min 50 characters)
                </div>
              </div>
            </div>

        </>
      );
    }

    // Step 3: WTP Testing Results
    function Step3Page({ data, updateWTPResult, wtpIdx, setWtpIdx }) {
      const idx = Math.min(wtpIdx, Math.max(0, data.wtpResults.length - 1));
      const result = data.wtpResults[idx];
      const isFilled = (i) => { const r = data.wtpResults[i]; return r && r.customerValue && r.customerValue.length >= 20 && r.willingnessToPay && r.willingnessToPay.length >= 5 && r.priorityScore; };

      if (!result) return <div className="step-hint">No features to score yet. Go back and add features in Step 1.</div>;

      return (
        <>
            <div className="step-indicator"><span>STEP 03 OF 5 &middot; Feature {idx + 1} of {data.wtpResults.length}</span><span className="step-time">~10 min</span></div>
            <h2 className="step-heading">WTP TESTING RESULTS</h2>
            <p className="step-hint">Document what customers said about each feature's value and willingness to pay.</p>

            {/* Item Navigator */}
            <div className="item-nav">
              {data.wtpResults.map((r, i) => (
                <button key={r.featureId} className={`item-nav-btn ${i === idx ? 'active' : isFilled(i) ? 'filled' : 'empty'}`} onClick={() => setWtpIdx(i)}>{i + 1}</button>
              ))}
            </div>

            {/* Fast Track Insight */}
            {(data.wtpResults[0]?.customerValue || '').length >= 20 && (
                <div className="ft-reveal">
                    <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                    <p className="ft-reveal-text">A tech startup reversed a product flop by realigning its features to address unmet customer needs, resulting in a 50% increase in sales within the first quarter post-adjustment (Fast Track Case Study). Research by the Product Development and Management Association shows that feature prioritization based on WTP data -- rather than internal opinion -- reduces time-to-market by 35% and increases first-year revenue by 25-40%. Document both the stated value and the actual price threshold customers reveal.</p>
                </div>
            )}

            <div className="border-l-4 border-yellow-400 pl-6 mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              <p className="text-lg italic text-gray-700">
                &quot;What customers say they value and what they&apos;ll actually pay for are different. Document both to make informed product decisions.&quot;
              </p>
            </div>

            <div className="mb-12" key={idx}>
                <div className="bg-gray-50 border-2 border-gray-200 p-6 mb-6 animate-in feature-box">
                  <h4 className="riforma-bold text-2xl mb-4">
                    {data.features.find(f => f.id === result.featureId)?.name || ('Feature ' + (idx + 1))}
                  </h4>

                  <div className="space-y-4">
                    <div>
                      <label className="monument text-sm block mb-2">CUSTOMER VALUE FEEDBACK <span className="text-red-500">*</span></label>
                      <p className="text-sm text-gray-600 mb-2">What did customers say about the value of this feature?</p>
                      <textarea
                        value={result.customerValue}
                        onChange={(e) => updateWTPResult(result.featureId, 'customerValue', e.target.value)}
                        onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                        placeholder="8 out of 12 customers said this would save them 10-15 hours per week. CFO at Company X said: &quot;This alone would justify the cost - we lose $50K annually to stockouts.&quot; 3 customers said it&apos;s nice-to-have but not critical."
                        rows={4}
                        className="w-full"
                        style={{ resize: 'none', overflow: 'hidden' }}
                      />
                      <div className={`char-counter ${result.customerValue.length < 20 ? 'invalid' : ''}`}>
                        {result.customerValue.length}/500 (min 20 characters)
                      </div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">WILLINGNESS TO PAY <span className="text-red-500">*</span></label>
                      <textarea
                        value={result.willingnessToPay}
                        onChange={(e) => updateWTPResult(result.featureId, 'willingnessToPay', e.target.value)}
                        onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                        placeholder="$500-$800/month for this feature alone. 5 customers would pay $1000+ if bundled with reporting. 2 customers said $200-$300 max."
                        rows={3}
                        className="w-full"
                        style={{ resize: 'none', overflow: 'hidden' }}
                      />
                      <div className={`char-counter ${result.willingnessToPay.length < 5 ? 'invalid' : ''}`}>
                        {result.willingnessToPay.length}/300 (min 5 characters)
                      </div>
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">COMPETITIVE ADVANTAGE</label>
                      <input
                        type="text"
                        value={result.competitiveAdvantage}
                        onChange={(e) => updateWTPResult(result.featureId, 'competitiveAdvantage', e.target.value)}
                        placeholder="Competitor A has similar feature but 4-hour delay. Competitor B requires $10K setup fee."
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="monument text-sm block mb-2">PRIORITY SCORE (1-10) <span className="text-red-500">*</span></label>
                      <select
                        value={result.priorityScore}
                        onChange={(e) => updateWTPResult(result.featureId, 'priorityScore', e.target.value)}
                        className="w-full"
                      >
                        <option value="">Select priority score...</option>
                        <option value="10">10 - Must have immediately</option>
                        <option value="9">9 - Very high priority</option>
                        <option value="8">8 - High priority</option>
                        <option value="7">7 - Above average</option>
                        <option value="6">6 - Average priority</option>
                        <option value="5">5 - Medium priority</option>
                        <option value="4">4 - Below average</option>
                        <option value="3">3 - Low priority</option>
                        <option value="2">2 - Very low priority</option>
                        <option value="1">1 - Not worth pursuing</option>
                      </select>
                    </div>
                  </div>
                </div>
            </div>

        </>
      );
    }

    // Step 4: Product Portfolio Design
    function Step4Page({ data, updatePortfolioItem, addPortfolioItem, removePortfolioItem, portfolioSection, setPortfolioSection, portfolioIdx, setPortfolioIdx }) {
      const cats = ['storytellers', 'topLineContributors', 'profitContributors'];
      const catLabels = ['Storytellers', 'Top Line', 'Profit'];
      const catDescriptions = [
        'Products that manifest your strategy and differentiate your brand. May not be profitable but critical for positioning.',
        'High-volume products. Aggressively priced to win market share. These drive revenue growth.',
        'Premium products with unique features customers will pay for. Protect these margins. Fund innovation with these profits.'
      ];
      const catSubtitles = ['<10% of portfolio', '70-80% of sales', 'High margin'];
      const currentCat = cats[portfolioSection];
      const items = data[currentCat];
      const itemIdx = Math.min(portfolioIdx, Math.max(0, items.length - 1));
      const item = items[itemIdx];
      const isItemFilled = (cat, i) => { const it = data[cat][i]; return it && it.product && it.product.trim().length >= 3; };

      return (
        <>
            <div className="step-indicator"><span>STEP 04 OF 5 &middot; {catLabels[portfolioSection]} {itemIdx + 1} of {items.length}</span><span className="step-time">~8 min</span></div>
            <h2 className="step-heading">PORTFOLIO DESIGN</h2>
            <p className="step-hint">Categorize products into storytellers, top-line contributors, and profit contributors.</p>

            {/* Section Navigator */}
            <div className="section-nav">
              {catLabels.map((label, i) => (
                <button key={i} className={`section-nav-btn ${i === portfolioSection ? 'active' : ''}`} onClick={() => { setPortfolioSection(i); setPortfolioIdx(0); }}>{label}</button>
              ))}
            </div>

            {/* Fast Track Insight */}
            {(data.storytellers[0]?.product || '').length >= 5 && (
                <div className="ft-reveal">
                    <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                    <p className="ft-reveal-text">Research from BCG's 2023 Product Portfolio Study shows that companies with clearly defined product roles (storyteller, top-line, profit) achieve 25% higher profit margins and 40% more efficient marketing spend than those with undifferentiated portfolios. The key finding: resist promoting profit contributors in advertising, as this diverts attention from storytellers and damages long-term brand positioning -- a short-term gain that creates long-term erosion.</p>
                </div>
            )}

            <div className="border-l-4 border-yellow-400 pl-6 mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              <p className="text-lg italic text-gray-700">
                &quot;Like a gardener&apos;s strategy: some plants for beauty (storytellers), some for harvest volume (top line), some for premium herbs (profit).&quot;
              </p>
            </div>

            <h3 className="riforma-bold text-2xl mb-2">{catLabels[portfolioSection]} ({catSubtitles[portfolioSection]})</h3>
            <p className="text-base text-gray-600 mb-4">{catDescriptions[portfolioSection]}</p>

            {/* Item Navigator */}
            <div className="item-nav">
              {items.map((it, i) => (
                <button key={it.id} className={`item-nav-btn ${i === itemIdx ? 'active' : isItemFilled(currentCat, i) ? 'filled' : 'empty'}`} onClick={() => setPortfolioIdx(i)}>{i + 1}</button>
              ))}
              <button className="item-nav-add" onClick={() => addPortfolioItem(currentCat)}>+ ADD</button>
            </div>

            {/* Single Item Card */}
            {item && (
            <div className="mb-12" key={currentCat + '-' + itemIdx}>
              {portfolioSection === 0 && (
                <div className="bg-gray-50 border-2 border-gray-200 p-4 mb-3 animate-in">
                    <div className="flex justify-between items-center mb-3">
                      <span className="monument text-xs">STORYTELLER {itemIdx + 1}</span>
                      {items.length > 1 && (
                        <button onClick={() => { removePortfolioItem('storytellers', item.id); if (itemIdx >= items.length - 1) setPortfolioIdx(Math.max(0, items.length - 2)); }} className="text-red-600 text-sm">REMOVE</button>
                      )}
                    </div>
                    <div className="space-y-3">
                      <input type="text" value={item.product} onChange={(e) => updatePortfolioItem('storytellers', item.id, 'product', e.target.value)} placeholder="Real-time inventory sync" className="w-full" />
                      <textarea value={item.reason} onChange={(e) => updatePortfolioItem('storytellers', item.id, 'reason', e.target.value)} placeholder="Shows we're the innovation leader. Competitors don't have this. Gets us in the door with enterprise clients even though margins are thin." rows={2} className="w-full" />
                    </div>
                </div>
              )}
              {portfolioSection === 1 && (
                <div className="bg-gray-50 border-2 border-gray-200 p-4 mb-3 animate-in">
                    <div className="flex justify-between items-center mb-3">
                      <span className="monument text-xs">TOP LINE CONTRIBUTOR {itemIdx + 1}</span>
                      {items.length > 1 && (
                        <button onClick={() => { removePortfolioItem('topLineContributors', item.id); if (itemIdx >= items.length - 1) setPortfolioIdx(Math.max(0, items.length - 2)); }} className="text-red-600 text-sm">REMOVE</button>
                      )}
                    </div>
                    <div className="space-y-3">
                      <input type="text" value={item.product} onChange={(e) => updatePortfolioItem('topLineContributors', item.id, 'product', e.target.value)} placeholder="Basic inventory management" className="w-full" />
                      <textarea value={item.features} onChange={(e) => updatePortfolioItem('topLineContributors', item.id, 'features', e.target.value)} placeholder="Standard tracking, reporting, alerts. Everything customers expect. Priced 20% below competitor X to gain market share." rows={2} className="w-full" />
                      <input type="text" value={item.pricingStrategy} onChange={(e) => updatePortfolioItem('topLineContributors', item.id, 'pricingStrategy', e.target.value)} placeholder="$299/month, 15% margin, volume play" className="w-full" />
                    </div>
                </div>
              )}
              {portfolioSection === 2 && (
                <div className="bg-gray-50 border-2 border-gray-200 p-4 mb-3 animate-in">
                    <div className="flex justify-between items-center mb-3">
                      <span className="monument text-xs">PROFIT CONTRIBUTOR {itemIdx + 1}</span>
                      {items.length > 1 && (
                        <button onClick={() => { removePortfolioItem('profitContributors', item.id); if (itemIdx >= items.length - 1) setPortfolioIdx(Math.max(0, items.length - 2)); }} className="text-red-600 text-sm">REMOVE</button>
                      )}
                    </div>
                    <div className="space-y-3">
                      <input type="text" value={item.product} onChange={(e) => updatePortfolioItem('profitContributors', item.id, 'product', e.target.value)} placeholder="Enterprise API integration" className="w-full" />
                      <textarea value={item.uniqueFeatures} onChange={(e) => updatePortfolioItem('profitContributors', item.id, 'uniqueFeatures', e.target.value)} placeholder="Custom ERP integrations, dedicated support, SLA guarantees. Only we offer this level of integration." rows={2} className="w-full" />
                      <input type="text" value={item.marginTarget} onChange={(e) => updatePortfolioItem('profitContributors', item.id, 'marginTarget', e.target.value)} placeholder="$2,500/month, 60% margin" className="w-full" />
                    </div>
                </div>
              )}
            </div>
            )}

        </>
      );
    }

    // Step 5: Implementation Plan
    function Step5Page({ data, updateData }) {
      return (
        <>
            <div className="step-indicator"><span>STEP 05</span><span className="step-time">~5 min</span></div>
            <h2 className="step-heading">IMPLEMENTATION</h2>
            <p className="step-hint">Transform insights into an actionable plan with quick wins, resources, and metrics.</p>

            {/* Fast Track Insight */}

            {(data.quickWins || '').length >= 20 && (
                <div className="ft-reveal">
                    <div className="ft-reveal-label">FAST TRACK SCIENCE</div>
                    <p className="ft-reveal-text">Bain &amp; Company's 2023 Product Portfolio Excellence study found that companies implementing structured portfolio reviews with clear kill criteria reduce time-to-market by 40% and achieve 30% higher ROI on product development investment. The MVP (Minimum Viable Product) approach -- testing product concepts quickly without extensive upfront investment -- was pioneered by Eric Ries ("The Lean Startup," 2011) and validated across 500+ companies showing 3x faster learning cycles versus traditional development.</p>
                </div>
            )}


            <h3 className="riforma-bold text-5xl mb-8 animate-in" style={{animationDelay: '0.05s'}}>
              Transform insights into action
            </h3>

            <div className="border-l-4 border-yellow-400 pl-6 mb-12 animate-in" style={{animationDelay: '0.1s'}}>
              <p className="riforma-bold text-2xl mb-4">SPRINT VALIDATION CHECKLIST:</p>
              <div className="space-y-2 text-lg">
                <div>□ Interviewed at least 10 customers about product features</div>
                <div>□ Documented willingness to pay for each key feature</div>
                <div>□ Categorized products into storytellers, top line, and profit contributors</div>
                <div>□ Identified which features have competitive advantage and pricing power</div>
              </div>
            </div>

            <div className="space-y-8">
              <div className="animate-in" style={{animationDelay: '0.15s'}}>
                <label className="monument text-sm block mb-3">QUICK WINS (NEXT 30 DAYS) <span className="text-red-500">*</span></label>
                <p className="text-base text-gray-600 mb-3">What can you launch, adjust pricing on, or kill immediately?</p>
                <textarea
                  value={data.quickWins}
                  onChange={(e) => updateData('quickWins', e.target.value)}
                  onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                  placeholder={'1. Launch real-time sync feature for 3 pilot customers (identified as high WTP)\n2. Adjust pricing on basic package to $299 (20% below Competitor X)\n3. Create case study from pilot customers for storyteller positioning\n4. Kill Feature Y (scored 2/10 in interviews, no customer demand)'}
                  rows={5}
                  className="w-full"
                  style={{ resize: 'none', overflow: 'hidden' }}
                />
                <div className={`char-counter ${data.quickWins.length < 30 ? 'invalid' : ''}`}>
                  {data.quickWins.length}/1000 (min 30 characters)
                </div>
              </div>

              <div className="animate-in" style={{animationDelay: '0.2s'}}>
                <label className="monument text-sm block mb-3">RESOURCE ALLOCATION <span className="text-red-500">*</span></label>
                <p className="text-base text-gray-600 mb-3">How will you allocate development, sales, and marketing resources?</p>
                <textarea
                  value={data.resourceAllocation}
                  onChange={(e) => updateData('resourceAllocation', e.target.value)}
                  onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                  placeholder="Development: 60% on top line features, 30% on profit contributor enhancements, 10% on storyteller innovation. Sales: Focus on mid-market (top line) and enterprise (profit). Marketing: Case studies on storyteller wins, ROI calculator for profit contributors."
                  rows={4}
                  className="w-full"
                  style={{ resize: 'none', overflow: 'hidden' }}
                />
                <div className={`char-counter ${data.resourceAllocation.length < 30 ? 'invalid' : ''}`}>
                  {data.resourceAllocation.length}/1000 (min 30 characters)
                </div>
              </div>

              <div className="animate-in" style={{animationDelay: '0.25s'}}>
                <label className="monument text-sm block mb-3">TIMELINE & MILESTONES <span className="text-red-500">*</span></label>
                <textarea
                  value={data.timeline}
                  onChange={(e) => updateData('timeline', e.target.value)}
                  onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                  placeholder={'Week 1-2: Pilot launches\nWeek 3-4: Gather pilot feedback, adjust pricing\nMonth 2: Full rollout of top 3 features\nMonth 3: Review portfolio mix, kill underperformers\nQuarter 2: Hit 70/20/10 portfolio balance'}
                  rows={5}
                  className="w-full"
                  style={{ resize: 'none', overflow: 'hidden' }}
                />
                <div className={`char-counter ${data.timeline.length < 20 ? 'invalid' : ''}`}>
                  {data.timeline.length}/500 (min 20 characters)
                </div>
              </div>

              <div className="animate-in" style={{animationDelay: '0.3s'}}>
                <label className="monument text-sm block mb-3">SUCCESS METRICS <span className="text-red-500">*</span></label>
                <textarea
                  value={data.successMetrics}
                  onChange={(e) => updateData('successMetrics', e.target.value)}
                  onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                  placeholder={'Revenue: 70% from top line contributors by Q2\nMargins: Overall margin improvement from 25% to 35%\nMarket share: Gain 500 new customers in mid-market segment\nCustomer feedback: NPS of 50+ on profit contributor features\nPortfolio health: Kill 3 underperforming products, launch 2 new profit contributors'}
                  rows={5}
                  className="w-full"
                  style={{ resize: 'none', overflow: 'hidden' }}
                />
                <div className={`char-counter ${data.successMetrics.length < 30 ? 'invalid' : ''}`}>
                  {data.successMetrics.length}/1000 (min 30 characters)
                </div>
              </div>
            </div>

        </>
      );
    }

    // Canvas Page
    function CanvasPage({ data, onExport, onSubmit }) {
      return (
        <div className="bg-white min-h-screen p-16">
          <div id="canvas-content" className="max-w-6xl mx-auto border-8 border-black p-12 bg-white">
            <div className="flex items-center justify-between mb-12">
              <div className="plaak text-3xl" style={{letterSpacing: '0.1em'}}>FAST TRACK</div>
              <h1 className="plaak" style={{fontSize: '60px'}}>PRODUCT DEVELOPMENT WTP TESTING</h1>
            </div>

            <div className="space-y-8">
              {/* Features Tested */}
              <div>
                <h2 className="plaak text-4xl mb-4 border-b-4 border-black pb-2">FEATURES TESTED</h2>
                <div className="grid grid-cols-2 gap-4">
                  {(data.features || []).slice(0, 6).map((feature, index) => (
                    <div key={feature.id} className="border-2 border-black p-4">
                      <div className="monument text-xs mb-2">FEATURE {index + 1}</div>
                      <div className="riforma-bold text-lg mb-2">{feature.name}</div>
                      <div className="text-sm">{(feature.description || '').substring(0, 100)}...</div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Top Priorities */}
              <div>
                <h2 className="plaak text-4xl mb-4 border-b-4 border-black pb-2">TOP PRIORITIES</h2>
                <div className="space-y-3">
                  {(data.wtpResults || [])
                    .filter(r => parseInt(r.priorityScore) >= 7)
                    .sort((a, b) => parseInt(b.priorityScore) - parseInt(a.priorityScore))
                    .slice(0, 5)
                    .map((result) => {
                      const feature = (data.features || []).find(f => f.id === result.featureId);
                      return (
                        <div key={result.featureId} className="border-2 border-black p-4 bg-yellow-50 flex justify-between items-start">
                          <div className="flex-1">
                            <div className="riforma-bold text-xl">{feature?.name}</div>
                            <div className="text-sm mt-2">{(result.customerValue || '').substring(0, 120)}...</div>
                            <div className="monument text-xs mt-2">WTP: {(result.willingnessToPay || '').substring(0, 60)}</div>
                          </div>
                          <div className="w-16 h-16 bg-black text-white flex items-center justify-center plaak text-3xl ml-4">
                            {result.priorityScore}
                          </div>
                        </div>
                      );
                    })}
                </div>
              </div>

              {/* Product Portfolio */}
              <div>
                <h2 className="plaak text-4xl mb-4 border-b-4 border-black pb-2">PRODUCT PORTFOLIO</h2>
                <div className="grid grid-cols-3 gap-4">
                  <div className="border-2 border-black p-4">
                    <div className="riforma-bold text-lg mb-3">STORYTELLERS</div>
                    <div className="monument text-xs mb-2">&lt;10% of portfolio</div>
                    {(data.storytellers || []).map(s => s.product && (
                      <div key={s.id} className="text-sm mb-2">• {s.product}</div>
                    ))}
                  </div>
                  <div className="border-2 border-black p-4 bg-yellow-50">
                    <div className="riforma-bold text-lg mb-3">TOP LINE</div>
                    <div className="monument text-xs mb-2">70-80% of sales</div>
                    {(data.topLineContributors || []).map(t => t.product && (
                      <div key={t.id} className="text-sm mb-2">• {t.product}</div>
                    ))}
                  </div>
                  <div className="border-2 border-black p-4">
                    <div className="riforma-bold text-lg mb-3">PROFIT</div>
                    <div className="monument text-xs mb-2">High margin</div>
                    {(data.profitContributors || []).map(p => p.product && (
                      <div key={p.id} className="text-sm mb-2">• {p.product}</div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Next Steps */}
              <div>
                <h2 className="plaak text-4xl mb-4 border-b-4 border-black pb-2">IMPLEMENTATION PLAN</h2>
                <div className="border-2 border-black p-6">
                  <div className="monument text-xs mb-2">QUICK WINS (30 DAYS)</div>
                  <div className="whitespace-pre-line mb-4 text-sm">{data.quickWins}</div>
                  <div className="monument text-xs mb-2">SUCCESS METRICS</div>
                  <div className="whitespace-pre-line text-sm">{data.successMetrics}</div>
                </div>
              </div>
            </div>

            <div className="mt-12 text-center text-sm text-gray-500">
              Generated {new Date().toLocaleDateString()} • Fast Track Sprint 17 • Product Development WTP Testing
            </div>
          </div>

          {/* Action Buttons */}
          <div className="max-w-6xl mx-auto mt-8 flex gap-4 justify-center">
            <button onClick={onExport} className="btn-secondary">EXPORT PDF</button>
            <button onClick={onSubmit} className="btn-primary">SUBMIT</button>
          </div>

          {/* Case Study */}
          <CaseStudy
              before={"A leading FMCG company faced a saturated market with products perceived as outdated. Their portfolio was misaligned with health-conscious consumer trends, threatening long-term relevance. No WTP testing existed -- product decisions came from internal brainstorming alone."}
              after={"Using Fast Track feature prioritization and MVP testing, they launched a targeted organic product line in phased rollouts. Market share grew 20% in the organic segment within the first year. Brand perception shifted to industry leader in natural products, with customer loyalty scores up 40%."}
              quote={"We stopped developing products from internal ideas and started validating with customers first. Feature prioritization based on willingness to pay transformed our entire go-to-market strategy. -- FMCG Portfolio Transformation Case Study"}
          />
        </div>
      );
    }

    /* ProgressIndicator, HelpButton removed — replaced by WizardSidebar */

    // Render App
        ReactDOM.render(<WTPApp />, document.getElementById('root'));
  </script>
</body>
</html>
